{"version":3,"sources":["../../../packages/modeling/src/shapes/AABB.ts","../../../packages/modeling/src/shapes/Frustum.ts","../../../packages/modeling/src/shapes/BoundingSphere.ts","../../../packages/modeling/src/shapes/const.ts","../../../packages/modeling/src/shapes/Rectangle.ts","../../../packages/modeling/src/elements/types/line.ts","../../../packages/modeling/src/elements/types/ui.ts","../../../packages/modeling/src/elements/types/type.ts","../../../packages/modeling/src/shapes/OBB.ts","../../../packages/modeling/src/utils/math.ts","../../../packages/modeling/src/elements/styles/default.ts","../../../packages/modeling/src/events/events.ts","../../../packages/modeling/src/refline/types.ts","../../../packages/modeling/src/refline/utils.ts","../../../packages/modeling/src/refline/index.ts","../../../packages/renderer-pixi/src/events/events.ts","../../../packages/modeling/src/elements/Element.ts","../../../packages/modeling/src/utils/uuid.ts","../../../packages/modeling/src/elements/Node.ts","../../../packages/modeling/src/elements/Shape.ts","../../../packages/modeling/src/elements/ShapeLine.ts","../../../packages/modeling/src/unredo/memento.ts","../../../packages/modeling/src/unredo/command.ts","../../../packages/modeling/src/topo/Vertex.ts","../../../packages/modeling/src/topo/Edge.ts","../../../packages/modeling/src/topo/Group.ts","../../../packages/renderer-pixi/src/gizmos/spots/DragSpot.ts","../../../packages/renderer-pixi/src/components/grid/Grid.ts","../../../packages/renderer-pixi/src/components/grid/GridStyle.ts","../../../packages/renderer-pixi/src/gizmos/BaseGizmo.ts","../../../packages/renderer-pixi/src/gizmos/LabelGizmo.ts","../../../packages/renderer-pixi/src/gizmos/Label2Gizmo.ts","../../../packages/renderer-pixi/src/gizmos/spots/AlignSpot.ts","../../../packages/renderer-pixi/src/gizmos/spots/DimensionSpot.ts","../../../packages/renderer-pixi/src/gizmos/spots/RotateSpot.ts","../../../packages/renderer-pixi/src/gizmos/EditorGizmo.ts","../../../packages/renderer-pixi/src/gizmos/AlignGizmo.ts","../../../packages/renderer-pixi/src/gizmos/DimensionGizmo.ts","../../../packages/renderer-pixi/src/ui/UI.ts","../../../packages/renderer-pixi/src/utils/uuid.ts","../../../packages/renderer-pixi/src/ui/NodeUI.ts","../../../packages/renderer-pixi/src/utils/math.ts","../../../packages/renderer-pixi/src/ui/ShapeUI.ts","../../../packages/renderer-pixi/src/components/dashline/DashLine.ts","../../../packages/renderer-pixi/src/components/guide/Guide.ts","../../../packages/models/src/events/model.ts","../../../packages/models/src/events/selection.ts","../../../packages/renderer-pixi/src/components/refline/RefLine.ts","../../../packages/renderer-pixi/src/ui/LineUI.ts","../../../packages/renderer-pixi/src/ui/ShapeLineUI.ts","../../../packages/renderer-pixi/src/ui/EdgeUI.ts","../../../packages/renderer-pixi/src/ui/GroupUI.ts","../../../packages/renderer-pixi/src/interaction/BaseInteraction.ts","../../../packages/renderer-pixi/src/interaction/DefaultInteraction.ts","../../../packages/renderer-pixi/src/interaction/EditInteraction.ts","../../../packages/renderer-pixi/src/interaction/CreateInteraction.ts","../../../packages/renderer-pixi/src/interaction/AutoCreateinteraction.ts","../../../packages/renderer-pixi/src/interaction/CreateLineInteraction.ts","../../../packages/renderer-pixi/src/interaction/InteractionManager.ts","../../../packages/models/src/model.ts","components/renderer/application.ts","../../../packages/models/src/SelectionModel.ts","../../../packages/renderer-pixi/src/PixiRenderer.ts","components/controlPane/ControlPane.ts","components/renderer/index.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["Mask","AABB","x","y","width","height","_x","_y","_width","_height","_originPoints","_points","this","Number","points","aabb","fromPoints","update","value","rectangle","bounds","paddingX","paddingY","x1","Math","max","x2","min","y1","y2","resolution","eps","ceil","floor","length","count","point","i","vec3","create","PI","SHAPES","DEG_TO_RAD","LINE_CAP","LINE_JOIN","UI2D","UI3D","ElementType","FillType","AnchorType","PositionType","LayerType","SHAPE","Rectangle","type","RECT","OBB","originPoints","offset","delta","line","expand","corners","square","size","hullPoints","hull","Infinity","edges","push","rotations","map","edge","abs","atan2","angle","cos","rotPoints","rotation","multiply","matrix","transpose","toArray","minXY","pMat","minValues","maxXY","minX","m","minY","maxX","maxY","areas","_","bestIdx","reduce","iMax","arr","r","minRect","sortCCW","axisX","center","sort","a","b","vec2","fromValues","Events","DEFAULT_STYLE_PROPS","interactive","buttonMode","cursor","zIndex","DefaultZIndex","fill","fillVector","fillImage","fillType","Default","fillColor","fillAlpha","offsetDelta","blur","blurQuality","blurX","blurY","strokeWidth","strokeColor","strokeAlpha","shapeClosed","selectFill","selectFillColor","selectFillAlpha","selectStrokeWidth","selectStrokeColor","selectStrokeAlpha","hoverFill","hoverFillColor","hoverFillAlpha","hoverStrokeWidth","hoverStrokeColor","hoverStrokeAlpha","alarmFill","alarmFillColor","alarmFillAlpha","alarmStrokeWidth","alarmStrokeColor","alarmStrokeAlpha","labelGizmoVisible","labelGizmoZIndex","LabelZIndex","labelGizmoInteractive","labelGizmoButtonMode","labelGizmoCursor","labelGizmoPosition","labelGizmoRotation","labelGizmoPositionOffsetX","labelGizmoPositionOffsetY","label2GizmoVisible","label2GizmoZIndex","Label2ZIndex","label2GizmoInteractive","label2GizmoButtonMode","label2GizmoCursor","label2GizmoPosition","label2GizmoRotation","label2GizmoPositionOffsetX","label2GizmoPositionOffsetY","editorGizmoVisible","editorGizmoZIndex","EditorZIndex","editorGizmoInteractive","editorGizmoButtonMode","editorGizmoRotation","editorGizmoCursor","alignGizmoVisible","alignGizmoZIndex","alignGizmoInteractive","alignGizmoButtonMode","alignGizmoRotation","alignGizmoCursor","dimensionGizmoVisible","dimensionGizmoZIndex","DimensionGizmoZIndex","dimensionGizmoInteractive","dimensionGizmoButtonMode","dimensionGizmoRotation","dimensionGizmoCursor","MOVE_DIR","toNumber","v","numDigits","toFixed","coordinateRotation","cx","cy","deg","rad","sin","getBoundingRect","rect","coords","left","top","rotate","topLeft","topRight","bottomLeft","bottomRight","xX","yY","getBoundingRectCoordinate","xMin","yMin","xMax","yMax","right","bottom","getRectRefLines","boundingRect","mx","my","position","start","end","groupBy","values","getKey","keys","group","Object","forEach","key","find","predicate","getMatchedLine","matched","isVertical","refLineMetaList","opts","rLine","undefined","startPoint","mergeRefLineMeta","isNil","RefLine","seq","__rects","_rects","current","_dirty","_vLines","_hLines","_vLineMap","Map","_hLineMap","_adsorbVLines","_adsorbHLines","_lineFilter","rects","lineFilter","adsorbVLines","adsorbHLines","setCurrent","initRefLines","lines","fixNumber","vLineMap","hLineMap","get","toLineMapKey","getRectByKey","old","getCurrent","getRect","filter","adsorbOnly","getLineFilter","isEnableLine","vLines","hLines","mKey","getLineMapKey","set","refLineMeta","vGroup","hGroup","lineMap","matchedLines","matchedLine","prev","prevDist","next","nextDist","d","vl","vc","vr","ht","hc","hb","getLineTypeFromPosition","matchRefLines","matchVRefLines","matchHRefLines","adsorbDistance","hasMatchedLine","getOffsetRefLineMetaList","n","getNearestOffsetFromOffset","isMoveTopOrLeft","useIndex","nearestOffset","dist","dir","dirX","dirY","origAdsorbDistance","newDelta","lineStatus","hasMatchedVRefLine","hasMatchedRefLine","hasMatchedHRefLine","currentOffsetList","n1","n2","n3","isMoveLeft","distValues","minDist","minIndex","indexOf","minOffset","isMoveTop","pageX","pageY","distance","disableAdsorb","scale","Error","currentRect","startX","startY","startLeft","startTop","_scale","defaultDisableAdsorb","lastX","lastY","lastDirX","lastDirY","data","currentX","currentY","offsetX","offsetY","raw","getAdsorbDelta","KeyboardEvents","InteractionEvents","Element","props","_id","tS4","random","toString","substring","guide","name","name2","anchor","visible","movable","hovered","selected","dragging","rotating","resizing","isEditing","isAlarm","mode","Show","_children","_styles","_clients","_attributes","styles","clients","attributes","icons","debug","ui2d","NodeUI","ui3d","CubeUI","image","parent","_obb","_aabb","_matrix","mat2d","_grids","refLine","updater","id","_angleToMatrix","Proxy","prop","getStyle","setStyle","getClient","setClient","isNull","oldValue","isNumber","isNumberEqual","isEqual","_updatePoints","_updateRotate","newValue","emit","AttributeChange","source","oldAngle","newAngle","StyleChange","ClientChange","dx","dy","padding","tx","ty","elements","element","adsorbCreator","_updateSize","index","clone","pop","Array","ii","Center","anchorVector","Top","Right","Bottom","Left","TopLeft","TopRight","BottomRight","BottomLeft","add","updatePoint","ChildrenChangeAdd","delete","ChildrenChangeRemove","clear","newPoints","out","pp","transformMat2d","segments","linePath2","path2","closed","offsetLinePath1","offsetPoints1","toPoints","getOffsetPoints","geom","geom2","toSides","geometries","json","EventEmitter","Node","getAABB","primitives","Shape","ShapeUI","oldMatrix","oldPoints","newMatrix","innerPoints","obb","along","from","to","intersectionCount","polygons","self","poly1","poly2","checkPoint","alongPoints","getAlongPoints","linePoints","polygonPoints","t","getT","u","getU","getIntersection","l1","l2","ShapeLine","dash","ShapeLineUI","expandedPathGeom2","expandedPoints","result","MementoManager","options","_maxLength","_history","_position","_initialState","_isExceeded","_suspendSave","_onUpdate","_onBeforeSave","_onMaxLength","_provider","provider","maxLength","_initiliaze","slice","action","history","scope","item","beforeSave","_isEqual","arrA","isArray","arrB","dateA","Date","dateB","getTime","regexpA","RegExp","regexpB","map1","map2","val","has","compareMaps","prototype","hasOwnProperty","call","TypeError","_rejectSave","cloneDeep","JSON","parse","stringify","_checkMaxLength","state","callback","canUndo","canRedo","callbackError","CommandManager","_commands","_cursor","_suspended","_limit","_batch","_onBeforeAdd","_onLimited","_onSuspended","console","log","command","batch","commands","splice","undo","redo","limit","suspended","startBatch","endBatch","Vertex","_edges","Set","_fromEdges","_toEdges","Edge","BottomZIndex","_from","_to","EdgeUI","offsetLinePath2","geometry","vertex","addToEdge","addFromEdge","p0","p1","tan","direction","Group","GroupUI","children","child","geometry1","geometry2","ResizeDirectionType","Grid","_backgroundFillAlpha","_backgroundFillColor","_backgroundVisible","_graphHeight","_graphWidth","_intermediateGridSize","_intermediateGridVisible","_intermediateStrokeAlpha","_intermediateStrokeColor","_intermediateStrokeWeight","_majorGridSize","_majorGridVisible","_majorStrokeAlpha","_majorStrokeColor","_majorStrokeWeight","_minorGridSize","_minorGridVisible","_minorStrokeAlpha","_minorStrokeColor","_minorStrokeWeight","_graphics","_reflines","PIXI","addChild","assign","renderer","renderBackground","renderMinorGrid","renderIntermediateGrid","renderMajorGrid","renderRefLines","refline","lineStyle","moveTo","lineTo","closePath","beginFill","drawRect","endFill","GridStyle","backgroundFillAlpha","backgroundFillColor","backgroundVisible","intermediateGridVisible","majorGridSize","majorGridVisible","majorStrokeAlpha","majorStrokeColor","majorStrokeWeight","minorGridSize","minorGridVisible","minorStrokeAlpha","minorStrokeColor","minorStrokeWeight","intermediateGridSize","intermediateStrokeAlpha","intermediateStrokeColor","intermediateStrokeWeight","BaseGizmo","_renderer","_element","_mouseDownEvent","_mouseUpEvent","_mouseMoveEvent","_mouseOverEvent","_mouseOutEvent","_mousePoint","Point","_keydownEvent","_keyupEvent","_ctrlDown","_shiftDown","_altDown","_eventEmitter","_isDragging","handle_mousedown","bind","_updateStyles","_validateImpl","_draw","_invalidate","_validate","_drawBody","_drawAABB","evt","stopPropagation","currentTarget","__dragStart","__dragEnd","__dragMove","code","oldCtrlDown","isCtrlDown","newCtrlDown","CtrlKeyDown","oldShiftDown","isShiftDown","newShiftDown","ShiftKey","oldAltDown","isAltDown","newAltDown","AltKey","CtrlKeyUp","ctrlKey","metaKey","shiftKey","altKey","Graphics","LabelGizmo","_text","Text","fontFamily","fontSize","align","fontWeight","text","getLocalBounds","Label2Gizmo","_directionsMap","DragSpot","shape","_index","_angle","_shape","_center","_fillColor","_mousedownEvent","_mouseupEvent","_mousemoveEvent","_mouseoutEvent","_hitTarget","_doubleClickedTimeout","_originSize","_originCenter","_zIndex","mount","handle_mouseup","handle_mousemove","handle_mouseout","on","viewport","off","removeChild","AlignLine","Line","scaled","getScaled","path","hitArea","Polygon","Domain","RAD_TO_DEG","setMatrix","Matrix","drawCircle","isEditable","drawRoundedRect","color","hitTarget","plugins","interaction","hitTest","global","getLocalPosition","p","newX","newY","currentInteraction","interactionManager","getCurrentInteraction","DefaultInteraction","ResizeStart","target","UnableResize","_handleResize","_handleScale","_reversPoint","translatePoint","fromPoint","toPoint","normalize","c","dot","Resizing","diagonal","sqrt","ResizeEnd","e","preventDefault","AlignSpot","_fillAlpha","_size","_mouseoverEvent","handle_mouseover","clearTimeout","_handleAlignOption","setTimeout","_handleAlign","RotateSpot","url","_offset","_sprite","_url","sprite","Sprite","Texture","apply","RotateStart","getGlobalPosition","_calculateAngle","Rotating","round","RotateEnd","DimensionSpot","unmount","fromV","toV","fromToV","fromToVN","fromRotateV","fromRotateV_Center","scaleAndAdd","toRotateV","toRotateV_Center","EditorGizmo","_dragSpots","_rotateSpot","_zoomedEvent","dragSpot","drawPolygon","setAngle","handle_keydown","handle_keyup","document","addEventListener","handle_zoomed","centerDragSpot","spot","AlignGizmo","_alignSpots","setFromTo","removeEventListener","DimensionGizmo","_spots","p2","f1","t1","UI","_imageCache","_textureCache","_gizmos","_outlineFilterBlue","OutlineFilter","_outlineFilterRed","GlowFilter","outerStrength","innerStrength","quality","knockout","checkGizmo","_checkGizmos","getBounds","pivot","_checkLabelGizmo","_checkLabel2Gizmo","_checkEditorGizmo","_checkDimensionGizmo","gizmo","_drawOuter","_drawHover","_drawSelect","_drawGizmos","_drawBoundingBox","_drawOBB","drawEllipse","filters","src","Promise","resolve","reject","img","Image","onload","onerror","boundingbox","rect1","union","_boundsRect","getBoundingBox","boundingbox2","getOBB","box2d","loadImage","then","res","HTMLImageElement","catch","ImageVector","translate","texture","BaseTexture","VectorImage","dashLineOptionsDefault","alpha","useTexture","alignment","DashLine","graphics","lineLength","activeTexture","dashSize","getTexture","lineTextureStyle","cap","join","adjustLineStyle","gap","x0","y0","place","dashIndex","dashStart","dashX","remaining","lastDash","radius","interval","first","radiusX","radiusY","textureStart","pow","dashTextureCache","canvas","createElement","context","getContext","strokeStyle","globalAlpha","lineWidth","stroke","baseTexture","scaleMode","NEAREST","warn","EventsModel","EventsSelection","Guide","_graphicsDash","_datas","useDots","renderDatas","LineUI","getHitArea","unionPoints","localBounds","points4","path4","lineDash","isDrawing","BaseInteraction","cursorStyles","crosshair","default","setCursorMode","_pannedEvent","_selectedEvent","_contextmenu","_onDocumentMouseDown","_onDocumentMouseUp","_hoverTarget","_oldOutTarget","_oldMousePoint","body","style","drag","wheel","mouseButtons","pressDrag","pinch","wheelZoom","handle_panned","handle_contextmenu","selectionModel","grid","sm","contains","removeSelection","appendSelection","setSelection","DoubleClick","Click","gizmos","datas","getSelection","ui","getUIById","hoverTarget","oldHover","newHover","oldElement","newElement","Hover","handle_documentMouseUp","mousePoint","translation","DragStart","moveSelectedElements","Dragging","DragEnd","KeyDown","event","KeyUp","EditInteraction","model","getDatas","gatherRects","getAllRefLines","CreateInteraction","onMouseDown","onMouseMove","onMouseUp","onFinish","_onMouseDown","_onMouseMove","_onMouseUp","_onFinish","selection","changeLayer","SelectZIndex","moveUI","cb","AutoCreateInteraction","uis","handle_documentMouseDown","CreateLineInteraction","InteractionManager","_current","_interactionMap","execute","editInteraction","modes","interactions","LineType","Model","pros","_pros","_datasMap","datasMap","Add","remove","Remove","thisArg","Clear","BatchAdd","SelectionModel","_model","_selectionMode","_filterFunction","Change","ClearSelection","batchAdd","AppendSelection","RemoveSelection","oldSelection","SetSelection","SelectionAll","PixiRenderer","config","clientWidth","clientHeight","window","devicePixelRatio","antialias","backgroundAlpha","view","resizeTo","_config","_canvas","_viewrect","_enabled","_stats","_uis","eventEmitter","_timeout","getBoundingClientRect","backgroundColor","resize","Viewport","screenWidth","screenHeight","worldWidth","worldHeight","disableOnContextMenu","stage","sortableChildren","handleSelectionChange","graphWidth","graphHeight","dark","stopTimer","startTimer","stats","display","_add","node","_remove","_clear","clazz","w","h","ratio","setTransform","setZoom","isMovable","d02","d13","blueprint","engineering","quad","setInteractions","UnDirty","Dirty","download","extract","toBlob","FileReader","readAsDataURL","append","href","URL","createObjectURL","click","Application","ControlPane","_pane","Pane","title","_tabs","_anime","_app","show","parentElement","pane","app","expanded","tabs","addTab","pages","_initToolPane","_initModelPane","hidden","dispose","render","_initRenderPane","tab1","fdev","addFolder","addButton","label","disabled","initScene","clearScene","ftoolbar","fapis","fetch","method","response","vertices","nodes","v0","getById","fmodels","easing","alert","getDatasMap","select","getLastData","_initSelectPane","PARAMS","background","frenderer_basic","addInput","addBlade","setGridStyle","setGridVisible","frenderer_interaction","setDefaultInteraction","setEditInteraction","frenderer_api","tab3","pause","fattribute","fstyle","speed","step","flabelgizmo","flabel2gizmo","feditorgizmo","fclient","people","fanimate","anime","targets","loop","fAlgorithm","defaultDomainStyles","_options","_debug","origin","controlPane","_controlPane","pixiRenderer","boundingBox","_mode","io","mementoManager","commandManager","initCommandManager","initMementoManager","initInteractionListener","initModelListener","Scale","Sleep","getChildren","domains","save","v1","v2","v3","v4","v5","onBeforeAdd","onUpdate","onSuspended","onLimited","onBeforeSave","onMaxLength","load","points1","Edit","initModel","deserialize","serializer","oldDatas","clearSelection","RendererComponent","canvasRef","createRef","location","search","includes","application","ref","Component","App","isMounted","onClick","setState","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.25385a62.chunk.js","sourcesContent":["/**\r\n * AABB Boundingbox\r\n */\r\nexport class AABB {\r\n\tprotected _x: number = 0;\r\n\tprotected _y: number = 0;\r\n\tprotected _width: number = 0;\r\n\tprotected _height: number = 0;\r\n\tprotected _originPoints: number[][] = [];\r\n\tprotected _points: number[][] = [];\r\n\r\n\t/**\r\n\t * @param [x=0] - The X coordinate of the upper-left corner of the rectangle\r\n\t * @param [y=0] - The Y coordinate of the upper-left corner of the rectangle\r\n\t * @param [width=0] - The overall width of this rectangle\r\n\t * @param [height=0] - The overall height of this rectangle\r\n\t */\r\n\tconstructor(x = 0, y = 0, width = 0, height = 0) {\r\n\t\tthis._x = Number(x);\r\n\t\tthis._y = Number(y);\r\n\t\tthis._width = Number(width);\r\n\t\tthis._height = Number(height);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tset originPoints(points: number[][]) {\r\n\t\tthis._originPoints = points;\r\n\t\tconst aabb = AABB.fromPoints(points);\r\n\t\tthis.x = aabb.x;\r\n\t\tthis.y = aabb.y;\r\n\t\tthis.width = aabb.width;\r\n\t\tthis.height = aabb.height;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tget x(): number {\r\n\t\treturn this._x;\r\n\t}\r\n\r\n\tset x(value: number) {\r\n\t\tthis._x = value;\r\n\t}\r\n\r\n\tget y(): number {\r\n\t\treturn this._y;\r\n\t}\r\n\r\n\tset y(value: number) {\r\n\t\tthis._y = value;\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tset width(value: number) {\r\n\t\tthis._width = value;\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tset height(value: number) {\r\n\t\tthis._height = value;\r\n\t}\r\n\r\n\tget points(): number[][] {\r\n\t\tthis.update();\r\n\t\treturn this._points;\r\n\t}\r\n\r\n\tget topLeft(): number[] {\r\n\t\tthis.update();\r\n\t\treturn this._points[0];\r\n\t}\r\n\r\n\tget topRight(): number[] {\r\n\t\tthis.update();\r\n\t\treturn this._points[1];\r\n\t}\r\n\r\n\tget bottomRight(): number[] {\r\n\t\tthis.update();\r\n\t\treturn this._points[2];\r\n\t}\r\n\r\n\tget bottomLeft(): number[] {\r\n\t\tthis.update();\r\n\t\treturn this._points[3];\r\n\t}\r\n\r\n\tprotected update(): void {\r\n\t\tthis._points = [\r\n\t\t\t[this._x, this._y],\r\n\t\t\t[this._x + this._width, this._y],\r\n\t\t\t[this._x + this._width, this._y + this._height],\r\n\t\t\t[this._x, this._y + this._height]\r\n\t\t];\r\n\t}\r\n\r\n\t/**\r\n\t * returns the left edge of the rectangle\r\n\t *\r\n\t * @member {number}\r\n\t */\r\n\tget left(): number {\r\n\t\treturn this.x;\r\n\t}\r\n\r\n\t/**\r\n\t * returns the right edge of the rectangle\r\n\t */\r\n\tget right(): number {\r\n\t\treturn this.x + this.width;\r\n\t}\r\n\r\n\t/**\r\n\t * returns the top edge of the rectangle\r\n\t */\r\n\tget top(): number {\r\n\t\treturn this.y;\r\n\t}\r\n\r\n\t/**\r\n\t * returns the bottom edge of the rectangle\r\n\t */\r\n\tget bottom(): number {\r\n\t\treturn this.y + this.height;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a clone of this Rectangle\r\n\t *\r\n\t * @return A copy of this AABB.\r\n\t */\r\n\tclone(): AABB {\r\n\t\treturn new AABB(this.x, this.y, this.width, this.height);\r\n\t}\r\n\r\n\t/**\r\n\t * Copies another rectangle to this one.\r\n\t *\r\n\t * @param rectangle - The rectangle to copy from.\r\n\t * @return Returns itself.\r\n\t */\r\n\tcopyFrom(rectangle: AABB): AABB {\r\n\t\tthis.x = rectangle.x;\r\n\t\tthis.y = rectangle.y;\r\n\t\tthis.width = rectangle.width;\r\n\t\tthis.height = rectangle.height;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies this rectangle to another one.\r\n\t *\r\n\t * @param rectangle - The rectangle to copy to.\r\n\t * @return Returns given parameter.\r\n\t */\r\n\tcopyTo(rectangle: AABB): AABB {\r\n\t\trectangle.x = this.x;\r\n\t\trectangle.y = this.y;\r\n\t\trectangle.width = this.width;\r\n\t\trectangle.height = this.height;\r\n\r\n\t\treturn rectangle;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the x and y coordinates given are contained within this Rectangle\r\n\t *\r\n\t * @param x - The X coordinate of the point to test\r\n\t * @param y - The Y coordinate of the point to test\r\n\t * @return Whether the x/y coordinates are within this Rectangle\r\n\t */\r\n\tcontains(x: number, y: number): boolean {\r\n\t\tif (this.width <= 0 || this.height <= 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (x >= this.x && x < this.x + this.width) {\r\n\t\t\tif (y >= this.y && y < this.y + this.height) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the given {@code bounds} are equal to this.\r\n\t *\r\n\t * @param bounds\r\n\t */\r\n\tequals(bounds: AABB): boolean {\r\n\t\tif (!bounds) return false;\r\n\r\n\t\treturn (\r\n\t\t\tbounds.x === this.x && bounds.y === this.y && bounds.width === this.width && bounds.height === this.height\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Pads the rectangle making it grow in all directions.\r\n\t * If paddingY is omitted, both paddingX and paddingY will be set to paddingX.\r\n\t *\r\n\t * @param [paddingX=0] - The horizontal padding amount.\r\n\t * @param [paddingY=0] - The vertical padding amount.\r\n\t * @return Returns itself.\r\n\t */\r\n\tpad(paddingX = 0, paddingY = paddingX): this {\r\n\t\tthis.x -= paddingX;\r\n\t\tthis.y -= paddingY;\r\n\r\n\t\tthis.width += paddingX * 2;\r\n\t\tthis.height += paddingY * 2;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Fits this rectangle around the passed one.\r\n\t *\r\n\t * @param rectangle - The rectangle to fit.\r\n\t * @return Returns itself.\r\n\t */\r\n\tfit(rectangle: AABB): this {\r\n\t\tconst x1 = Math.max(this.x, rectangle.x);\r\n\t\tconst x2 = Math.min(this.x + this.width, rectangle.x + rectangle.width);\r\n\t\tconst y1 = Math.max(this.y, rectangle.y);\r\n\t\tconst y2 = Math.min(this.y + this.height, rectangle.y + rectangle.height);\r\n\r\n\t\tthis.x = x1;\r\n\t\tthis.width = Math.max(x2 - x1, 0);\r\n\t\tthis.y = y1;\r\n\t\tthis.height = Math.max(y2 - y1, 0);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Enlarges rectangle that way its corners lie on grid\r\n\t *\r\n\t * @param [resolution=1] - resolution\r\n\t * @param [eps=0.001] - precision\r\n\t * @return Returns itself.\r\n\t */\r\n\tceil(resolution = 1, eps = 0.001): this {\r\n\t\tconst x2 = Math.ceil((this.x + this.width - eps) * resolution) / resolution;\r\n\t\tconst y2 = Math.ceil((this.y + this.height - eps) * resolution) / resolution;\r\n\r\n\t\tthis.x = Math.floor((this.x + eps) * resolution) / resolution;\r\n\t\tthis.y = Math.floor((this.y + eps) * resolution) / resolution;\r\n\r\n\t\tthis.width = x2 - this.x;\r\n\t\tthis.height = y2 - this.y;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Enlarges this rectangle to include the passed rectangle.\r\n\t *\r\n\t * @param rectangle - The rectangle to include.\r\n\t * @return Returns itself.\r\n\t */\r\n\tenlarge(rectangle: AABB): this {\r\n\t\tconst x1 = Math.min(this.x, rectangle.x);\r\n\t\tconst x2 = Math.max(this.x + this.width, rectangle.x + rectangle.width);\r\n\t\tconst y1 = Math.min(this.y, rectangle.y);\r\n\t\tconst y2 = Math.max(this.y + this.height, rectangle.y + rectangle.height);\r\n\r\n\t\tthis.x = x1;\r\n\t\tthis.width = x2 - x1;\r\n\t\tthis.y = y1;\r\n\t\tthis.height = y2 - y1;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param points\r\n\t */\r\n\tpublic static fromPoints(points: number[][]) {\r\n\t\tconst aabb = new AABB(0, 0, 0, 0);\r\n\t\tif (!points || points.length === 0) return aabb;\r\n\t\tconst count = points.length;\r\n\t\tlet point = points[0];\r\n\t\taabb.x = point[0];\r\n\t\taabb.y = point[1];\r\n\r\n\t\tfor (let i = 1; i < count; i += 1) {\r\n\t\t\tpoint = points[i];\r\n\t\t\tconst x1 = Math.min(aabb.x, point[0]);\r\n\t\t\tconst y1 = Math.min(aabb.y, point[1]);\r\n\t\t\tconst x2 = Math.max(aabb.x + aabb.width, point[0]);\r\n\t\t\tconst y2 = Math.max(aabb.y + aabb.height, point[1]);\r\n\t\t\taabb.x = x1;\r\n\t\t\taabb.y = y1;\r\n\t\t\taabb.width = x2 - x1;\r\n\t\t\taabb.height = y2 - y1;\r\n\t\t}\r\n\t\treturn aabb;\r\n\t}\r\n}\r\n","import type { mat4 } from 'gl-matrix';\r\nimport { vec3 } from 'gl-matrix';\r\nimport { Plane } from './Plane';\r\n\r\nexport enum Mask {\r\n\tOUTSIDE = 0xffffffff,\r\n\tINSIDE = 0x00000000,\r\n\tINDETERMINATE = 0x7fffffff\r\n}\r\n\r\nexport class Frustum {\r\n\tpublic planes: Plane[] = [];\r\n\r\n\tconstructor(planes?: Plane[]) {\r\n\t\tif (planes) {\r\n\t\t\tthis.planes = planes;\r\n\t\t} else {\r\n\t\t\tfor (let i = 0; i < 6; i++) {\r\n\t\t\t\tthis.planes.push(new Plane());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * extract 6 planes from projectionMatrix\r\n\t * @see http://www8.cs.umu.se/kurser/5DV051/HT12/lab/plane_extraction.pdf\r\n\t */\r\n\tpublic extractFromVPMatrix(projectionMatrix: mat4) {\r\n\t\t// @ts-ignore\r\n\t\tconst [m0, m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12, m13, m14, m15] = projectionMatrix;\r\n\r\n\t\t// right\r\n\t\tvec3.set(this.planes[0].normal, m3 - m0, m7 - m4, m11 - m8);\r\n\t\tthis.planes[0].distance = m15 - m12;\r\n\r\n\t\t// left\r\n\t\tvec3.set(this.planes[1].normal, m3 + m0, m7 + m4, m11 + m8);\r\n\t\tthis.planes[1].distance = m15 + m12;\r\n\r\n\t\t// bottom\r\n\t\tvec3.set(this.planes[2].normal, m3 + m1, m7 + m5, m11 + m9);\r\n\t\tthis.planes[2].distance = m15 + m13;\r\n\r\n\t\t// top\r\n\t\tvec3.set(this.planes[3].normal, m3 - m1, m7 - m5, m11 - m9);\r\n\t\tthis.planes[3].distance = m15 - m13;\r\n\r\n\t\t// far\r\n\t\tvec3.set(this.planes[4].normal, m3 - m2, m7 - m6, m11 - m10);\r\n\t\tthis.planes[4].distance = m15 - m14;\r\n\r\n\t\t// near\r\n\t\tvec3.set(this.planes[5].normal, m3 + m2, m7 + m6, m11 + m10);\r\n\t\tthis.planes[5].distance = m15 + m14;\r\n\r\n\t\tthis.planes.forEach((plane) => {\r\n\t\t\tplane.normalize();\r\n\t\t\tplane.updatePNVertexFlag();\r\n\t\t});\r\n\t}\r\n}\r\n","import { vec3 } from 'gl-matrix';\r\n\r\nconst tmpVecA = vec3.create();\r\n\r\nexport class BoundingSphere {\r\n\tpublic center: vec3;\r\n\tpublic radius: number;\r\n\r\n\tconstructor(center?: vec3, radius?: number) {\r\n\t\tthis.center = center || vec3.create();\r\n\t\tthis.radius = radius || 0.5;\r\n\t}\r\n\r\n\tpublic containsPoint(point: vec3) {\r\n\t\tvec3.sub(tmpVecA, point, this.center);\r\n\t\treturn vec3.length(tmpVecA) < this.radius * this.radius;\r\n\t}\r\n\r\n\tpublic intersects(sphere: BoundingSphere) {\r\n\t\tvec3.sub(tmpVecA, sphere.center, this.center);\r\n\t\tconst totalRadius = sphere.radius + this.radius;\r\n\r\n\t\tif (vec3.length(tmpVecA) <= totalRadius * totalRadius) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/**\r\n * Two Pi.\r\n *\r\n * @static\r\n * @member {number}\r\n * @memberof PIXI\r\n */\r\nexport const PI_2 = Math.PI * 2;\r\n\r\n/**\r\n * Conversion factor for converting radians to degrees.\r\n *\r\n * @static\r\n * @member {number} RAD_TO_DEG\r\n * @memberof PIXI\r\n */\r\nexport const RAD_TO_DEG = 180 / Math.PI;\r\n\r\n/**\r\n * Conversion factor for converting degrees to radians.\r\n *\r\n * @static\r\n * @member {number}\r\n * @memberof PIXI\r\n */\r\nexport const DEG_TO_RAD = Math.PI / 180;\r\n\r\n/**\r\n * Constants that identify shapes, mainly to prevent `instanceof` calls.\r\n *\r\n * @static\r\n * @memberof PIXI\r\n * @enum {number}\r\n * @property {number} POLY Polygon\r\n * @property {number} RECT Rectangle\r\n * @property {number} CIRC Circle\r\n * @property {number} ELIP Ellipse\r\n * @property {number} RREC Rounded Rectangle\r\n */\r\nexport enum SHAPES {\r\n\tPOLY = 0,\r\n\tRECT = 1,\r\n\tCIRC = 2,\r\n\tELIP = 3,\r\n\tRREC = 4\r\n}\r\n","import { SHAPES } from './const';\r\n\r\nexport interface Rectangle {}\r\n\r\n/**\r\n * Size object, contains width and height\r\n *\r\n * @memberof PIXI\r\n * @typedef {object} ISize\r\n */\r\n\r\n/**\r\n * Rectangle object is an area defined by its position, as indicated by its top-left corner\r\n * point (x, y) and by its width and its height.\r\n *\r\n * @memberof PIXI\r\n */\r\nexport class Rectangle {\r\n\t/** @default 0 */\r\n\tpublic x: number;\r\n\r\n\t/** @default 0 */\r\n\tpublic y: number;\r\n\t/** @default 0 */\r\n\tpublic width: number;\r\n\r\n\t/** @default 0 */\r\n\tpublic height: number;\r\n\r\n\t/**\r\n\t * The type of the object, mainly used to avoid `instanceof` checks\r\n\t * @default PIXI.SHAPES.RECT\r\n\t * @see PIXI.SHAPES\r\n\t */\r\n\tpublic readonly type: SHAPES.RECT;\r\n\r\n\t/**\r\n\t * @param x - The X coordinate of the upper-left corner of the rectangle\r\n\t * @param y - The Y coordinate of the upper-left corner of the rectangle\r\n\t * @param width - The overall width of the rectangle\r\n\t * @param height - The overall height of the rectangle\r\n\t */\r\n\tconstructor(x = 0, y = 0, width = 0, height = 0) {\r\n\t\tthis.x = Number(x);\r\n\t\tthis.y = Number(y);\r\n\t\tthis.width = Number(width);\r\n\t\tthis.height = Number(height);\r\n\t\tthis.type = SHAPES.RECT;\r\n\t}\r\n\r\n\t/** Returns the left edge of the rectangle. */\r\n\tget left(): number {\r\n\t\treturn this.x;\r\n\t}\r\n\r\n\t/** Returns the right edge of the rectangle. */\r\n\tget right(): number {\r\n\t\treturn this.x + this.width;\r\n\t}\r\n\r\n\t/** Returns the top edge of the rectangle. */\r\n\tget top(): number {\r\n\t\treturn this.y;\r\n\t}\r\n\r\n\t/** Returns the bottom edge of the rectangle. */\r\n\tget bottom(): number {\r\n\t\treturn this.y + this.height;\r\n\t}\r\n\r\n\t/** A constant empty rectangle. */\r\n\tstatic get EMPTY(): Rectangle {\r\n\t\treturn new Rectangle(0, 0, 0, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a clone of this Rectangle\r\n\t *\r\n\t * @return a copy of the rectangle\r\n\t */\r\n\tclone(): Rectangle {\r\n\t\treturn new Rectangle(this.x, this.y, this.width, this.height);\r\n\t}\r\n\r\n\t/**\r\n\t * Copies another rectangle to this one.\r\n\t *\r\n\t * @param rectangle - The rectangle to copy from.\r\n\t * @return Returns itself.\r\n\t */\r\n\tcopyFrom(rectangle: Rectangle): Rectangle {\r\n\t\tthis.x = rectangle.x;\r\n\t\tthis.y = rectangle.y;\r\n\t\tthis.width = rectangle.width;\r\n\t\tthis.height = rectangle.height;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies this rectangle to another one.\r\n\t *\r\n\t * @param rectangle - The rectangle to copy to.\r\n\t * @return Returns given parameter.\r\n\t */\r\n\tcopyTo(rectangle: Rectangle): Rectangle {\r\n\t\trectangle.x = this.x;\r\n\t\trectangle.y = this.y;\r\n\t\trectangle.width = this.width;\r\n\t\trectangle.height = this.height;\r\n\r\n\t\treturn rectangle;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether the x and y coordinates given are contained within this Rectangle\r\n\t *\r\n\t * @param x - The X coordinate of the point to test\r\n\t * @param y - The Y coordinate of the point to test\r\n\t * @return Whether the x/y coordinates are within this Rectangle\r\n\t */\r\n\tcontains(x: number, y: number): boolean {\r\n\t\tif (this.width <= 0 || this.height <= 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (x >= this.x && x < this.x + this.width) {\r\n\t\t\tif (y >= this.y && y < this.y + this.height) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Pads the rectangle making it grow in all directions.\r\n\t * If paddingY is omitted, both paddingX and paddingY will be set to paddingX.\r\n\t *\r\n\t * @param paddingX - The horizontal padding amount.\r\n\t * @param paddingY - The vertical padding amount.\r\n\t * @return Returns itself.\r\n\t */\r\n\tpad(paddingX = 0, paddingY = paddingX): this {\r\n\t\tthis.x -= paddingX;\r\n\t\tthis.y -= paddingY;\r\n\r\n\t\tthis.width += paddingX * 2;\r\n\t\tthis.height += paddingY * 2;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Fits this rectangle around the passed one.\r\n\t *\r\n\t * @param rectangle - The rectangle to fit.\r\n\t * @return Returns itself.\r\n\t */\r\n\tfit(rectangle: Rectangle): this {\r\n\t\tconst x1 = Math.max(this.x, rectangle.x);\r\n\t\tconst x2 = Math.min(this.x + this.width, rectangle.x + rectangle.width);\r\n\t\tconst y1 = Math.max(this.y, rectangle.y);\r\n\t\tconst y2 = Math.min(this.y + this.height, rectangle.y + rectangle.height);\r\n\r\n\t\tthis.x = x1;\r\n\t\tthis.width = Math.max(x2 - x1, 0);\r\n\t\tthis.y = y1;\r\n\t\tthis.height = Math.max(y2 - y1, 0);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Enlarges rectangle that way its corners lie on grid\r\n\t *\r\n\t * @param resolution - resolution\r\n\t * @param eps - precision\r\n\t * @return Returns itself.\r\n\t */\r\n\tceil(resolution = 1, eps = 0.001): this {\r\n\t\tconst x2 = Math.ceil((this.x + this.width - eps) * resolution) / resolution;\r\n\t\tconst y2 = Math.ceil((this.y + this.height - eps) * resolution) / resolution;\r\n\r\n\t\tthis.x = Math.floor((this.x + eps) * resolution) / resolution;\r\n\t\tthis.y = Math.floor((this.y + eps) * resolution) / resolution;\r\n\r\n\t\tthis.width = x2 - this.x;\r\n\t\tthis.height = y2 - this.y;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Enlarges this rectangle to include the passed rectangle.\r\n\t *\r\n\t * @param rectangle - The rectangle to include.\r\n\t * @return Returns itself.\r\n\t */\r\n\tenlarge(rectangle: Rectangle): this {\r\n\t\tconst x1 = Math.min(this.x, rectangle.x);\r\n\t\tconst x2 = Math.max(this.x + this.width, rectangle.x + rectangle.width);\r\n\t\tconst y1 = Math.min(this.y, rectangle.y);\r\n\t\tconst y2 = Math.max(this.y + this.height, rectangle.y + rectangle.height);\r\n\r\n\t\tthis.x = x1;\r\n\t\tthis.width = x2 - x1;\r\n\t\tthis.y = y1;\r\n\t\tthis.height = y2 - y1;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// #if _DEBUG\r\n\ttoString(): string {\r\n\t\treturn `[Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`;\r\n\t}\r\n\t// #endif\r\n}\r\n","export enum LINE_CAP {\r\n\tButt = 'butt',\r\n\tRound = 'round',\r\n\tSquare = 'square'\r\n}\r\n\r\nexport enum LINE_JOIN {\r\n\tBevel = 'bevel',\r\n\tRound = 'round',\r\n\tMiter = 'miter'\r\n}\r\n","/**\r\n * UI2D\r\n */\r\nexport enum UI2D {\r\n\tNodeUI = \"NodeUI\",\r\n\tShapeUI = \"ShapeUI\",\r\n\tLineUI = \"LineUI\",\r\n\tShapeLineUI = \"ShapeLineUI\",\r\n\tDomainUI = \"DomainUI\",\r\n\tDoorUI = \"DoorUI\",\r\n\tVertexUI = \"VertexUI\",\r\n\tEdgeUI = \"EdgeUI\",\r\n\tGroupUI = \"GroupUI\",\r\n}\r\n\r\n/**\r\n * UI3D\r\n */\r\nexport enum UI3D {\r\n\tCubeUI = \"CubeUI\",\r\n}\r\n","export type ColorType = string | number;\r\n\r\nexport enum ElementType {\r\n\tShow = \"show\", // \r\n\tEdit = \"edit\", // \r\n}\r\n\r\nexport enum FillType {\r\n\tDefault = \"ImageVector\",\r\n\tImageVector = \"ImageVector\",\r\n\tVectorImage = \"VectorImage\",\r\n}\r\n\r\nexport enum AnchorType {\r\n\tCenter = \"Center\",\r\n\tTop = \"Top\",\r\n\tBottom = \"Bottom\",\r\n\tLeft = \"Left\",\r\n\tRight = \"Right\",\r\n\tTopLeft = \"TopLeft\",\r\n\tTopRight = \"TopRight\",\r\n\tBottomLeft = \"BottomLeft\",\r\n\tBottomRight = \"BottomRight\",\r\n}\r\n\r\n/**\r\n * Label Position\r\n */\r\nexport enum PositionType {\r\n\tCenter = \"Center\",\r\n\tTop = \"Top\",\r\n\tBottom = \"Bottom\",\r\n\tLeft = \"Left\",\r\n\tRight = \"Right\",\r\n\tTopLeft = \"TopLeft\",\r\n\tTopRight = \"TopRight\",\r\n\tBottomLeft = \"BottomLeft\",\r\n\tBottomRight = \"BottomRight\",\r\n}\r\n\r\nexport enum LayerType {\r\n\tBottomZIndex = 0,\r\n\tDefaultZIndex = 1,\r\n\tLabelZIndex = 2,\r\n\tLabel2ZIndex = 2,\r\n\tEditorZIndex = 3,\r\n\tSelectZIndex = 4,\r\n\tPreviewZIndex = 5,\r\n\tAlignLineZIndex = 6,\r\n\tDimensionGizmoZIndex = 6,\r\n\tHoverZIndex = 7,\r\n}\r\n\r\n// Cursor style\r\n// See: https://developer.mozilla.org/en-US/docs/Web/CSS/cursor\r\nexport type Cursor =\r\n\t| \"auto\"\r\n\t| \"default\"\r\n\t| \"none\"\r\n\t| \"context-menu\"\r\n\t| \"help\"\r\n\t| \"pointer\"\r\n\t| \"progress\"\r\n\t| \"wait\"\r\n\t| \"cell\"\r\n\t| \"crosshair\"\r\n\t| \"text\"\r\n\t| \"vertical-text\"\r\n\t| \"alias\"\r\n\t| \"copy\"\r\n\t| \"move\"\r\n\t| \"no-drop\"\r\n\t| \"not-allowed\"\r\n\t| \"grab\"\r\n\t| \"grabbing\"\r\n\t| \"all-scroll\"\r\n\t| \"col-resize\"\r\n\t| \"row-resize\"\r\n\t| \"n-resize\"\r\n\t| \"e-resize\"\r\n\t| \"s-resize\"\r\n\t| \"w-resize\"\r\n\t| \"ne-resize\"\r\n\t| \"nw-resize\"\r\n\t| \"se-resize\"\r\n\t| \"sw-resize\"\r\n\t| \"ew-resize\"\r\n\t| \"ns-resize\"\r\n\t| \"nesw-resize\"\r\n\t| \"nwse-resize\"\r\n\t| \"zoom-in\"\r\n\t| \"zoom-out\";\r\n\r\nexport type Position =\r\n\t| \"Center\"\r\n\t| \"Top\"\r\n\t| \"Bottom\"\r\n\t| \"Left\"\r\n\t| \"Right\"\r\n\t| \"TopLeft\"\r\n\t| \"TopRight\"\r\n\t| \"BottomLeft\"\r\n\t| \"BottomRight\";\r\n\r\nexport type Anchor =\r\n\t| \"Center\"\r\n\t| \"Top\"\r\n\t| \"Bottom\"\r\n\t| \"Left\"\r\n\t| \"Right\"\r\n\t| \"TopLeft\"\r\n\t| \"TopRight\"\r\n\t| \"BottomLeft\"\r\n\t| \"BottomRight\";\r\n\r\nexport enum SHAPE {\r\n\tElement = \"element\",\r\n\tNode = \"node\",\r\n\tShape = \"shape\",\r\n\tDomain = \"domain\",\r\n\tWall = \"wall\",\r\n\tLine = \"line\",\r\n\tAlignLine = \"alignLine\",\r\n\tShapeLine = \"shapeLine\",\r\n\tDoor = \"door\",\r\n\tVertex = \"vertex\",\r\n\tEdge = \"edge\",\r\n\tGroup = \"group\",\r\n}\r\n","import { expand, offset } from '@jscad/modeling/src/operations/expansions';\r\nimport { line, square } from '@jscad/modeling/src/primitives';\r\nimport hull from 'hull.js';\r\nimport { matrix, transpose, multiply, min, max } from 'mathjs';\r\n\r\nexport class OBB {\r\n\tprivate _originPoints: number[][] = [];\r\n\tprivate _points: number[][] = [];\r\n\r\n\tconstructor(originPoints: number[][]) {\r\n\t\tthis._originPoints = originPoints;\r\n\t\tthis._points = OBB.fromPoints(originPoints);\r\n\t}\r\n\r\n\tpublic get points(): number[][] {\r\n\t\treturn this._points;\r\n\t}\r\n\r\n\tstatic fromPoints(points: number[][]): number[][] {\r\n\t\tif (!points || points.length === 0) return [];\r\n\t\tconst hullPoints = hull(points, Infinity) as number[][];\r\n\t\tconst edges: number[][] = [];\r\n\t\tfor (let i = 0; i < hullPoints.length - 1; i++) {\r\n\t\t\tedges.push([hullPoints[i + 1][0] - hullPoints[i][0], hullPoints[i + 1][1] - hullPoints[i][1]]);\r\n\t\t}\r\n\r\n\t\tconst angles = edges.map((edge) => Math.abs(Math.atan2(edge[1], edge[0]) % (Math.PI / 2)));\r\n\r\n\t\tconst rotations = angles.map((angle) => {\r\n\t\t\treturn [\r\n\t\t\t\t[Math.cos(angle), Math.cos(angle - Math.PI / 2)],\r\n\t\t\t\t[Math.cos(angle + Math.PI / 2), Math.cos(angle)]\r\n\t\t\t];\r\n\t\t});\r\n\r\n\t\tconst rotPoints = rotations.map((rotation) =>\r\n\t\t\tmultiply(matrix(rotation), transpose(matrix(hullPoints))).toArray()\r\n\t\t);\r\n\r\n\t\tconst minXY = rotPoints.map((pMat) => {\r\n\t\t\tconst minValues = min(pMat, 1);\r\n\t\t\treturn [minValues[0], minValues[1]];\r\n\t\t});\r\n\r\n\t\tconst maxXY = rotPoints.map((pMat) => {\r\n\t\t\tconst minValues = max(pMat, 1);\r\n\t\t\treturn [minValues[0], minValues[1]];\r\n\t\t});\r\n\r\n\t\tconst minX = minXY.map((m) => m[0]);\r\n\t\tconst minY = minXY.map((m) => m[1]);\r\n\t\tconst maxX = maxXY.map((m) => m[0]);\r\n\t\tconst maxY = maxXY.map((m) => m[1]);\r\n\r\n\t\tconst areas = minX.map((_, i) => (maxX[i] - minX[i]) * (maxY[i] - minY[i]));\r\n\r\n\t\tconst bestIdx = areas.reduce((iMax, x, i, arr) => (x < arr[iMax] ? i : iMax), 0);\r\n\r\n\t\tconst x1 = maxX[bestIdx];\r\n\t\tconst x2 = minX[bestIdx];\r\n\t\tconst y1 = maxY[bestIdx];\r\n\t\tconst y2 = minY[bestIdx];\r\n\t\tconst r = rotations[bestIdx];\r\n\t\tconst minRect: number[][] = [];\r\n\t\tminRect.push(multiply([x1, y2], r));\r\n\t\tminRect.push(multiply([x2, y2], r));\r\n\t\tminRect.push(multiply([x2, y1], r));\r\n\t\tminRect.push(multiply([x1, y1], r));\r\n\t\treturn minRect;\r\n\t}\r\n\r\n\t/**\r\n\t * Pads the rectangle making it grow in all directions.\r\n\t * If paddingY is omitted, both paddingX and paddingY will be set to paddingX.\r\n\t *\r\n\t * @param [paddingX=0] - The horizontal padding amount.\r\n\t * @param [paddingY=0] - The vertical padding amount.\r\n\t * @return Returns itself.\r\n\t */\r\n\tpad(paddingX = 0, paddingY = paddingX): this {\r\n\t\tlet small = offset(\r\n\t\t\t{ delta: 10 },\r\n\t\t\tline([\r\n\t\t\t\t[0, 0],\r\n\t\t\t\t[100, 0]\r\n\t\t\t])\r\n\t\t);\r\n\t\tlet newsquare = expand({ delta: 5, corners: 'chamfer' }, square({ size: 30 }));\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { Point, Rectangle } from \"../shapes\";\r\nimport { mat2d, vec2, vec3 } from \"gl-matrix\";\r\n\r\n/**\r\n *\r\n * @param points\r\n * @returns\r\n */\r\nexport function aabb(points: vec2[] | number[][]): Rectangle {\r\n\tconst aabb = new Rectangle(0, 0, 0, 0);\r\n\tif (!points || points.length === 0) return aabb;\r\n\tconst count = points.length;\r\n\tlet point = points[0];\r\n\taabb.x = point[0];\r\n\taabb.y = point[1];\r\n\r\n\tfor (let i = 1; i < count; i += 1) {\r\n\t\tpoint = points[i];\r\n\t\tconst x1 = Math.min(aabb.x, point[0]);\r\n\t\tconst y1 = Math.min(aabb.y, point[1]);\r\n\t\tconst x2 = Math.max(aabb.x + aabb.width, point[0]);\r\n\t\tconst y2 = Math.max(aabb.y + aabb.height, point[1]);\r\n\t\taabb.x = x1;\r\n\t\taabb.y = y1;\r\n\t\taabb.width = x2 - x1;\r\n\t\taabb.height = y2 - y1;\r\n\t}\r\n\treturn aabb;\r\n}\r\n\r\n/**\r\n * union rectangle\r\n * @param a\r\n * @param b\r\n * @param out\r\n * @returns\r\n */\r\nexport function union(a: Rectangle, b: Rectangle, out?: Rectangle): Rectangle {\r\n\tif (!out) {\r\n\t\t// eslint-disable-next-line no-param-reassign\r\n\t\t(out as any) = new Rectangle();\r\n\t}\r\n\r\n\tconst x1 = Math.min(a.x, b.x);\r\n\tconst x2 = Math.max(a.x + a.width, b.x + b.width);\r\n\tconst y1 = Math.min(a.y, b.y);\r\n\tconst y2 = Math.max(a.y + a.height, b.y + b.height);\r\n\r\n\tif (out) {\r\n\t\tout.x = x1;\r\n\t\tout.y = y1;\r\n\t\tout.width = x2 - x1;\r\n\t\tout.height = y2 - y1;\r\n\t\treturn out;\r\n\t}\r\n\treturn new Rectangle();\r\n}\r\n\r\n/**\r\n * If the area of the intersection between the Rectangles `b` and `a` is not zero,\r\n * returns the area of intersection as a Rectangle object. bwise, return an empty Rectangle\r\n * with its properties set to zero.\r\n * Rectangles without area (width or height equal to zero) can't intersect or be intersected\r\n * and will always return an empty rectangle with its properties set to zero.\r\n *\r\n * _Note: Only available with **@pixi/math-extras**._\r\n *\r\n * @method intersects\r\n * @memberof PIXI.Rectangle#\r\n * @param {Rectangle} b - The Rectangle to intersect with `a`.\r\n * @param {Rectangle} [out] - A Rectangle object in which to store the value,\r\n * optional (bwise will create a new Rectangle).\r\n * @returns {Rectangle} The intersection of `a` and `b`.\r\n */\r\nexport function intersection(\r\n\ta: Rectangle,\r\n\tb: Rectangle,\r\n\tout?: Rectangle\r\n): Rectangle {\r\n\tif (!out) {\r\n\t\t// eslint-disable-next-line no-param-reassign\r\n\t\t(out as any) = new Rectangle();\r\n\t}\r\n\tconst x0 = a.x < b.x ? b.x : a.x;\r\n\tconst x1 = a.right > b.right ? b.right : a.right;\r\n\tif (out) {\r\n\t\tif (x1 <= x0) {\r\n\t\t\tout.x = out.y = out.width = out.height = 0;\r\n\r\n\t\t\treturn out;\r\n\t\t}\r\n\r\n\t\tconst y0 = a.y < b.y ? b.y : a.y;\r\n\t\tconst y1 = a.bottom > b.bottom ? b.bottom : a.bottom;\r\n\r\n\t\tif (y1 <= y0) {\r\n\t\t\tout.x = out.y = out.width = out.height = 0;\r\n\r\n\t\t\treturn out;\r\n\t\t}\r\n\r\n\t\tout.x = x0;\r\n\t\tout.y = y0;\r\n\t\tout.width = x1 - x0;\r\n\t\tout.height = y1 - y0;\r\n\r\n\t\treturn out;\r\n\t}\r\n\treturn new Rectangle();\r\n}\r\n\r\n/**\r\n *\r\n * @param min\r\n * @param max\r\n * @param x\r\n * @returns\r\n */\r\nexport function clamp(min: number, max: number, x: number) {\r\n\treturn Math.min(Math.max(x, min), max);\r\n}\r\n\r\n/**\r\n * \r\n * @param points\r\n * @param point\r\n * @returns\r\n */\r\nexport function isPointInPolygon(points: Point[], point: Point): boolean {\r\n\tlet i = 0,\r\n\t\tj = 0,\r\n\t\tc = false,\r\n\t\tsize = points.length;\r\n\tfor (i = 0, j = size - 1; i < size; j = i++) {\r\n\t\tvar p1 = points[i];\r\n\t\tvar p2 = points[j];\r\n\t\tif (\r\n\t\t\tp1.y > point.y != p2.y > point.y &&\r\n\t\t\tpoint.x < ((p2.x - p1.x) * (point.y - p1.y)) / (p2.y - p1.y) + p1.x\r\n\t\t) {\r\n\t\t\tc = !c;\r\n\t\t}\r\n\t}\r\n\treturn c;\r\n}\r\n\r\n/**\r\n * \r\n * @param points\r\n * @returns\r\n */\r\nexport function sortCCW(points: number[][], axisX?: number[]): number[][] {\r\n\tlet center = points[0];\r\n\tif (!axisX) center = points[0];\r\n\tif (axisX && axisX[1] === 0) {\r\n\t\tpoints.sort((a, b) => a[1] - b[1]);\r\n\t\tcenter = points[0][0] < points[1][0] ? points[0] : points[1];\r\n\t} else if (axisX && axisX[0] === 0) {\r\n\t\tpoints.sort((a, b) => a[1] - b[1]);\r\n\t\tcenter = points[0][0] > points[1][0] ? points[0] : points[1];\r\n\t} else if (axisX && axisX[0] * axisX[1] > 0) {\r\n\t\tpoints.sort((a, b) => a[0] - b[0]);\r\n\t\tcenter = points[0];\r\n\t} else if (axisX && axisX[0] * axisX[1] < 0) {\r\n\t\tpoints.sort((a, b) => a[1] - b[1]);\r\n\t\tcenter = points[0];\r\n\t}\r\n\r\n\tconst angles = points.map((point: number[]) => {\r\n\t\tconst angle = vec2.angle(\r\n\t\t\tvec2.fromValues(1, 0),\r\n\t\t\tvec2.fromValues(point[0] - (center[0] + 1), -(point[1] - center[1]))\r\n\t\t);\r\n\t\treturn [point[0], point[1], angle];\r\n\t});\r\n\r\n\tconst sorted = angles.sort((a, b) => a[2] - b[2]);\r\n\treturn sorted;\r\n}\r\n\r\nfunction nearest(v1: vec2, v2s: vec2[]) {\r\n\tlet max = Number.MAX_VALUE,\r\n\t\tnearest = null,\r\n\t\tcurrent = 0;\r\n\tv2s.forEach((v2: vec2) => {\r\n\t\tcurrent = vec2.distance(v1, v2);\r\n\t\tif (current <= max) {\r\n\t\t\tmax = current;\r\n\t\t\tnearest = v2;\r\n\t\t}\r\n\t});\r\n\treturn nearest;\r\n}\r\n\r\n/**\r\n * \r\n * @param points\r\n * @returns\r\n */\r\nexport function isConvex(points: number[][] = []) {\r\n\tconst { length } = points;\r\n\tlet pre = 0,\r\n\t\tcurr = 0;\r\n\tfor (let i = 0; i < length; ++i) {\r\n\t\tlet dx1 = points[(i + 1) % length][0] - points[i][0];\r\n\t\tlet dx2 = points[(i + 2) % length][0] - points[(i + 1) % length][0];\r\n\t\tlet dy1 = points[(i + 1) % length][1] - points[i][1];\r\n\t\tlet dy2 = points[(i + 2) % length][1] - points[(i + 1) % length][1];\r\n\t\tcurr = dx1 * dy2 - dx2 * dy1;\r\n\t\tif (curr != 0) {\r\n\t\t\tif ((curr > 0 && pre < 0) || (curr < 0 && pre > 0)) return false;\r\n\t\t\telse pre = curr;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * \r\n * @param points\r\n * @returns\r\n */\r\nexport function isRectangle(points: number[][]): boolean {\r\n\tif (points.length !== 4) {\r\n\t\treturn false;\r\n\t} else {\r\n\t\tconst d02 =\r\n\t\t\t(points[0][0] - points[2][0]) * (points[0][0] - points[2][0]) +\r\n\t\t\t(points[0][1] - points[2][1]) * (points[0][1] - points[2][1]);\r\n\t\tconst d13 =\r\n\t\t\t(points[1][0] - points[3][0]) * (points[1][0] - points[3][0]) +\r\n\t\t\t(points[1][1] - points[3][1]) * (points[1][1] - points[3][1]);\r\n\t\treturn Math.abs(d02 - d13) < 1;\r\n\t}\r\n}\r\n","import {\r\n\tBaseStyleProps,\r\n\tCursor,\r\n\tFillType,\r\n\tLayerType,\r\n\tPosition,\r\n} from \"../types\";\r\n\r\n/**\r\n * Style\r\n */\r\nexport const DEFAULT_STYLE_PROPS: BaseStyleProps = {\r\n\t// basic\r\n\tinteractive: true,\r\n\tbuttonMode: true,\r\n\tcursor: \"default\" as Cursor,\r\n\tzIndex: LayerType.DefaultZIndex,\r\n\r\n\t// fill\r\n\tfill: true,\r\n\tfillVector: false,\r\n\tfillImage: true,\r\n\tfillType: FillType.Default,\r\n\tfillColor: 0xe7e8e7,\r\n\tfillAlpha: 1.0,\r\n\toffsetDelta: -0.5,\r\n\r\n\t// blur\r\n\tblur: 10,\r\n\tblurQuality: 8,\r\n\tblurX: 8,\r\n\tblurY: 8,\r\n\r\n\t// stroke\r\n\tstrokeWidth: 1,\r\n\tstrokeColor: 0x000000,\r\n\tstrokeAlpha: 1.0,\r\n\tshapeClosed: true,\r\n\r\n\t// select\r\n\tselectFill: true,\r\n\tselectFillColor: 0xff6600,\r\n\tselectFillAlpha: 1.0,\r\n\tselectStrokeWidth: 1.0,\r\n\tselectStrokeColor: 0x000000,\r\n\tselectStrokeAlpha: 1.0,\r\n\r\n\t// hover\r\n\thoverFill: true,\r\n\thoverFillColor: 0xff6600,\r\n\thoverFillAlpha: 1.0,\r\n\thoverStrokeWidth: 1.0,\r\n\thoverStrokeColor: 0x000000,\r\n\thoverStrokeAlpha: 1.0,\r\n\r\n\t// alarm\r\n\talarmFill: true,\r\n\talarmFillColor: 0xff6600,\r\n\talarmFillAlpha: 0.5,\r\n\talarmStrokeWidth: 1.0,\r\n\talarmStrokeColor: 0x000000,\r\n\talarmStrokeAlpha: 1.0,\r\n\r\n\t// label gizmo\r\n\tlabelGizmoVisible: true,\r\n\tlabelGizmoZIndex: LayerType.LabelZIndex,\r\n\tlabelGizmoInteractive: true,\r\n\tlabelGizmoButtonMode: true,\r\n\tlabelGizmoCursor: \"default\" as Cursor,\r\n\tlabelGizmoPosition: \"Bottom\" as Position,\r\n\tlabelGizmoRotation: false,\r\n\tlabelGizmoPositionOffsetX: 0,\r\n\tlabelGizmoPositionOffsetY: 10,\r\n\r\n\t// label2 gizmo\r\n\tlabel2GizmoVisible: true,\r\n\tlabel2GizmoZIndex: LayerType.Label2ZIndex,\r\n\tlabel2GizmoInteractive: true,\r\n\tlabel2GizmoButtonMode: true,\r\n\tlabel2GizmoCursor: \"default\" as Cursor,\r\n\tlabel2GizmoPosition: \"Top\" as Position,\r\n\tlabel2GizmoRotation: false,\r\n\tlabel2GizmoPositionOffsetX: 0,\r\n\tlabel2GizmoPositionOffsetY: 20,\r\n\r\n\t// editor gizmo\r\n\teditorGizmoVisible: true,\r\n\teditorGizmoZIndex: LayerType.EditorZIndex,\r\n\teditorGizmoInteractive: true,\r\n\teditorGizmoButtonMode: true,\r\n\teditorGizmoRotation: false,\r\n\teditorGizmoCursor: \"default\" as Cursor,\r\n\r\n\talignGizmoVisible: false,\r\n\talignGizmoZIndex: 0,\r\n\talignGizmoInteractive: false,\r\n\talignGizmoButtonMode: false,\r\n\talignGizmoRotation: false,\r\n\talignGizmoCursor: \"default\",\r\n\r\n\tdimensionGizmoVisible: false,\r\n\tdimensionGizmoZIndex: LayerType.DimensionGizmoZIndex,\r\n\tdimensionGizmoInteractive: false,\r\n\tdimensionGizmoButtonMode: false,\r\n\tdimensionGizmoRotation: false,\r\n\tdimensionGizmoCursor: \"default\",\r\n};\r\n","// export const Events: Record<string, string> = {\r\n// \tChange: 'change',\r\n// \tDataChange: 'data.change',\r\n// \tPropertyChange: 'property.change',\r\n// \tStyleChange: 'style.change'\r\n// };\r\n\r\n/**\r\n * Events\r\n */\r\nexport enum Events {\r\n\tChange = 'change',\r\n\tDirty = 'dirty',\r\n\tUnDirty = 'unDirty',\r\n\tDataChange = 'data.change',\r\n\tAttributeChange = 'attribute.change',\r\n\tStyleChange = 'style.change',\r\n\tClientChange = 'client.change',\r\n\tChildrenChange = 'children.change',\r\n\tChildrenChangeAdd = 'children.change.add',\r\n\tChildrenChangeRemove = 'children.change.remove',\r\n\tChildrenChangeClear = 'children.change.clear'\r\n}\r\n","export interface Rect {\r\n\tkey: string | number;\r\n\tleft: number;\r\n\ttop: number;\r\n\twidth: number;\r\n\theight: number;\r\n\trotate?: number;\r\n\t[x: string]: any;\r\n}\r\n\r\nexport interface BoundingRect {\r\n\tleft: number;\r\n\ttop: number;\r\n\tright: number;\r\n\tbottom: number;\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\nexport type LineType = \"horizontal\" | \"vertical\";\r\n\r\n// horizontal/vertical  top/center/bottom left/center/right\r\nexport type VRefLinePosition = \"vl\" | \"vc\" | \"vr\";\r\nexport type HRefLinePosition = \"ht\" | \"hc\" | \"hb\";\r\nexport type RefLinePosition = VRefLinePosition | HRefLinePosition;\r\n\r\nexport interface RefLineMeta<T extends Rect = Rect> {\r\n\ttype: LineType;\r\n\tposition: RefLinePosition;\r\n\toffset: number;\r\n\tstart: number;\r\n\tend: number;\r\n\trect: T;\r\n\tadsorbOnly?: boolean;\r\n}\r\n\r\nexport interface MatchedLine<T extends Rect = Rect> {\r\n\ttype: LineType;\r\n\tleft: number;\r\n\ttop: number;\r\n\tsize: number;\r\n\trefLineMetaList: RefLineMeta<T>[];\r\n}\r\n\r\nexport interface LineGroup<T extends Rect = Rect> {\r\n\tmin: number;\r\n\tmax: number;\r\n\toffset: number;\r\n\trefLineMetaList: RefLineMeta<T>[];\r\n}\r\n\r\nexport interface Delta {\r\n\tleft: number;\r\n\ttop: number;\r\n}\r\n\r\nexport enum MOVE_DIR {\r\n\tMOVE_TOP,\r\n\tMOVE_RIGHT,\r\n\tMOVE_BOTTOM,\r\n\tMOVE_LEFT,\r\n\tNONE,\r\n}\r\n\r\nexport interface AdsorbLine {\r\n\tkey: string;\r\n\ttype: LineType;\r\n\toffset: number;\r\n}\r\n\r\nexport type AdsorbVLine = Omit<AdsorbLine, \"type\">;\r\nexport type AdsorbHLine = Omit<AdsorbLine, \"type\">;\r\nexport type Cursor =\r\n\t| \"auto\"\r\n\t| \"default\"\r\n\t| \"none\"\r\n\t| \"context-menu\"\r\n\t| \"help\"\r\n\t| \"pointer\"\r\n\t| \"progress\"\r\n\t| \"wait\"\r\n\t| \"cell\"\r\n\t| \"crosshair\"\r\n\t| \"text\"\r\n\t| \"vertical-text\"\r\n\t| \"alias\"\r\n\t| \"copy\"\r\n\t| \"move\"\r\n\t| \"no-drop\"\r\n\t| \"not-allowed\"\r\n\t| \"e-resize\"\r\n\t| \"n-resize\"\r\n\t| \"ne-resize\"\r\n\t| \"nw-resize\"\r\n\t| \"s-resize\"\r\n\t| \"se-resize\"\r\n\t| \"sw-resize\"\r\n\t| \"w-resize\"\r\n\t| \"ns-resize\"\r\n\t| \"ew-resize\"\r\n\t| \"nesw-resize\"\r\n\t| \"col-resize\"\r\n\t| \"nwse-resize\"\r\n\t| \"row-resize\"\r\n\t| \"all-scroll\"\r\n\t| \"zoom-in\"\r\n\t| \"zoom-out\"\r\n\t| \"grab\"\r\n\t| \"grabbing\";\r\nexport type DireactionX = \"left\" | \"right\" | \"none\";\r\nexport type DireactionY = \"up\" | \"down\" | \"none\";\r\n","import {\r\n\tLineType,\r\n\tRect,\r\n\tRefLineMeta,\r\n\tBoundingRect,\r\n\tRefLinePosition,\r\n\tDelta,\r\n\tMOVE_DIR,\r\n\tMatchedLine,\r\n} from \"./types\";\r\n\r\nexport function toNumber(v: number, numDigits = 0) {\r\n\treturn +v.toFixed(numDigits);\r\n}\r\n\r\nexport function deg2rad(deg: number) {\r\n\treturn deg * (Math.PI / 180);\r\n}\r\n\r\n/**\r\n * \r\n * @param x x\r\n * @param y y\r\n * @param cx x\r\n * @param cy y\r\n * @param deg \r\n * @return [x2,y2]  \r\n * @example: coordinateRotation(100,100, 150,150, 30)\r\n */\r\nexport function coordinateRotation(\r\n\tx: number,\r\n\ty: number,\r\n\tcx: number,\r\n\tcy: number,\r\n\tdeg: number\r\n) {\r\n\t// \r\n\tconst rad = deg * (Math.PI / 180);\r\n\t// cx,cy\r\n\tconst x1 = x - cx;\r\n\tconst y1 = y - cy;\r\n\r\n\t// \r\n\tconst x2 = x1 * Math.cos(rad) - y1 * Math.sin(rad);\r\n\tconst y2 = x1 * Math.sin(rad) + y1 * Math.cos(rad);\r\n\r\n\t// \r\n\treturn [x2 + cx, y2 + cy];\r\n}\r\n\r\n/**\r\n * \r\n * @param rect\r\n */\r\nexport function getBoundingRectCoordinate(\r\n\trect: Pick<Rect, \"left\" | \"top\" | \"width\" | \"height\" | \"rotate\">\r\n): [number, number, number, number] {\r\n\tlet { width, height, left, top, rotate = 0 } = rect;\r\n\r\n\tif (rotate % 360 === 0) {\r\n\t\treturn [left, top, left + width, top + height];\r\n\t}\r\n\r\n\tconst cx = left + width / 2;\r\n\tconst cy = top + height / 2;\r\n\r\n\tconst topLeft = coordinateRotation(left, top, cx, cy, rotate);\r\n\tconst topRight = coordinateRotation(left + width, top, cx, cy, rotate);\r\n\tconst bottomLeft = coordinateRotation(left, top + height, cx, cy, rotate);\r\n\tconst bottomRight = coordinateRotation(\r\n\t\tleft + width,\r\n\t\ttop + height,\r\n\t\tcx,\r\n\t\tcy,\r\n\t\trotate\r\n\t);\r\n\r\n\tconst xX = [topLeft[0], topRight[0], bottomLeft[0], bottomRight[0]];\r\n\tconst yY = [topLeft[1], topRight[1], bottomLeft[1], bottomRight[1]];\r\n\r\n\tconst xMin = Math.min(...xX);\r\n\tconst yMin = Math.min(...yY);\r\n\tconst xMax = Math.max(...xX);\r\n\tconst yMax = Math.max(...yY);\r\n\r\n\treturn [xMin, yMin, xMax, yMax];\r\n}\r\n\r\n/**\r\n * \r\n * @param rect\r\n */\r\nexport function getBoundingRect(\r\n\trect: Pick<Rect, \"left\" | \"top\" | \"width\" | \"height\" | \"rotate\">\r\n): BoundingRect {\r\n\tconst coords = getBoundingRectCoordinate(rect);\r\n\r\n\tconst xMin = coords[0];\r\n\tconst yMin = coords[1];\r\n\tconst xMax = coords[2];\r\n\tconst yMax = coords[3];\r\n\r\n\treturn {\r\n\t\tleft: xMin,\r\n\t\ttop: yMin,\r\n\t\tright: xMax,\r\n\t\tbottom: yMax,\r\n\t\twidth: xMax - xMin,\r\n\t\theight: yMax - yMin,\r\n\t};\r\n}\r\n\r\n// 6\r\n// //  //\r\nexport function getRectRefLines<T extends Rect = Rect>(\r\n\trect: T\r\n): RefLineMeta<T>[] {\r\n\tconst lines: RefLineMeta<T>[] = [];\r\n\r\n\tconst boundingRect = getBoundingRect(rect);\r\n\r\n\tconst width = boundingRect.width;\r\n\tconst height = boundingRect.height;\r\n\r\n\tconst mx = boundingRect.left + (width === 1 ? 0 : boundingRect.width / 2);\r\n\tconst my = boundingRect.top + (height === 1 ? 0 : boundingRect.height / 2);\r\n\r\n\treturn [\r\n\t\t{\r\n\t\t\ttype: \"vertical\",\r\n\t\t\tposition: \"vl\",\r\n\t\t\toffset: boundingRect.left,\r\n\t\t\tstart: boundingRect.top,\r\n\t\t\tend: boundingRect.bottom,\r\n\t\t\trect,\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: \"vertical\",\r\n\t\t\tposition: \"vc\",\r\n\t\t\toffset: mx,\r\n\t\t\tstart: boundingRect.top,\r\n\t\t\tend: boundingRect.bottom,\r\n\t\t\trect,\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: \"vertical\",\r\n\t\t\tposition: \"vr\",\r\n\t\t\toffset: width === 1 ? boundingRect.left : boundingRect.right,\r\n\t\t\tstart: boundingRect.top,\r\n\t\t\tend: boundingRect.bottom,\r\n\t\t\trect,\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: \"horizontal\",\r\n\t\t\tposition: \"ht\",\r\n\t\t\toffset: boundingRect.top,\r\n\t\t\tstart: boundingRect.left,\r\n\t\t\tend: boundingRect.right,\r\n\t\t\trect,\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: \"horizontal\",\r\n\t\t\tposition: \"hc\",\r\n\t\t\toffset: my,\r\n\t\t\tstart: boundingRect.left,\r\n\t\t\tend: boundingRect.right,\r\n\t\t\trect,\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: \"horizontal\",\r\n\t\t\tposition: \"hb\",\r\n\t\t\toffset: height === 1 ? boundingRect.top : boundingRect.bottom,\r\n\t\t\tstart: boundingRect.left,\r\n\t\t\tend: boundingRect.right,\r\n\t\t\trect,\r\n\t\t},\r\n\t];\r\n}\r\n\r\nexport function groupBy<T>(values: T[], getKey: (value: T) => string) {\r\n\tconst keys: string[] = [];\r\n\tconst group: Record<string, T[]> = Object.create(null);\r\n\r\n\tvalues.forEach((value) => {\r\n\t\tconst key = getKey(value);\r\n\t\tif (!group[key]) {\r\n\t\t\tgroup[key] = [];\r\n\t\t\tkeys.push(key);\r\n\t\t}\r\n\t\tgroup[key].push(value);\r\n\t});\r\n\r\n\treturn {\r\n\t\tgroup,\r\n\t\tkeys,\r\n\t};\r\n}\r\n\r\nexport function find<T>(values: T[], predicate: (value: T) => boolean) {\r\n\tfor (let i = 0; i < values.length; i++) {\r\n\t\tif (predicate(values[i])) {\r\n\t\t\treturn values[i];\r\n\t\t}\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\nexport function getLineTypeFromPosition(position: RefLinePosition): LineType {\r\n\tconst map: Record<RefLinePosition, LineType> = {\r\n\t\tvl: \"vertical\",\r\n\t\tvc: \"vertical\",\r\n\t\tvr: \"vertical\",\r\n\t\tht: \"horizontal\",\r\n\t\thc: \"horizontal\",\r\n\t\thb: \"horizontal\",\r\n\t};\r\n\r\n\treturn map[position];\r\n}\r\n\r\nexport function getMoveDir(delta: Delta) {\r\n\tif (delta.left > 0) {\r\n\t\treturn MOVE_DIR.MOVE_LEFT;\r\n\t}\r\n\tif (delta.left < 0) {\r\n\t\treturn MOVE_DIR.MOVE_RIGHT;\r\n\t}\r\n\tif (delta.top < 0) {\r\n\t\treturn MOVE_DIR.MOVE_TOP;\r\n\t}\r\n\tif (delta.top > 0) {\r\n\t\treturn MOVE_DIR.MOVE_BOTTOM;\r\n\t}\r\n\r\n\treturn MOVE_DIR.NONE;\r\n}\r\n\r\n/**\r\n * \r\n * @param type\r\n * @param refLineMetaList\r\n * @param opts\r\n * @returns\r\n */\r\nexport function mergeRefLineMeta<T extends Rect>(\r\n\ttype: LineType,\r\n\trefLineMetaList: RefLineMeta<T>[],\r\n\topts?: {\r\n\t\tstart?: number;\r\n\t\tend?: number;\r\n\t}\r\n): MatchedLine<T> {\r\n\tconst isVertical = type === \"vertical\";\r\n\r\n\tif (!refLineMetaList.length) {\r\n\t\treturn {\r\n\t\t\ttype,\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t\tsize: 0,\r\n\t\t\trefLineMetaList: [],\r\n\t\t};\r\n\t}\r\n\r\n\tconst offset = refLineMetaList[0].offset;\r\n\r\n\tconst start = Math.min(\r\n\t\t...refLineMetaList.map((rLine) => rLine.start),\r\n\t\topts?.start == undefined ? Infinity : opts.start\r\n\t);\r\n\tconst end = Math.max(\r\n\t\t...refLineMetaList.map((rLine) => rLine.end),\r\n\t\topts?.end == undefined ? -Infinity : opts.end\r\n\t);\r\n\r\n\tconst startPoint = isVertical ? [offset, start] : [start, offset];\r\n\r\n\treturn {\r\n\t\ttype,\r\n\t\tleft: startPoint[0],\r\n\t\ttop: startPoint[1],\r\n\t\tsize: end - start,\r\n\t\trefLineMetaList: [...refLineMetaList],\r\n\t};\r\n}\r\n\r\n/**\r\n * \r\n * @param line\r\n * @param matched\r\n * @returns\r\n */\r\nexport function getMatchedLine<T extends Rect>(\r\n\tline: RefLineMeta<T>,\r\n\tmatched: RefLineMeta<T>[]\r\n): MatchedLine<T> | null {\r\n\tif (!matched.length) return null;\r\n\r\n\tconst current = line.rect;\r\n\tconst boundingRect = getBoundingRect(current);\r\n\tconst isVertical = line.type === \"vertical\";\r\n\r\n\tconst refLineMetaList = matched; //.filter(rLine => rLine.rect.key !== current.key);\r\n\tif (!refLineMetaList.length) return null;\r\n\r\n\treturn mergeRefLineMeta(line.type, refLineMetaList, {\r\n\t\tstart: isVertical ? boundingRect.top : boundingRect.left,\r\n\t\tend: isVertical ? boundingRect.bottom : boundingRect.right,\r\n\t});\r\n}\r\n\r\nexport function isNil<T>(value: T) {\r\n\treturn value == null;\r\n}\r\n","import {\r\n\tRect,\r\n\tRefLineMeta,\r\n\tMatchedLine,\r\n\tLineType,\r\n\tLineGroup,\r\n\tRefLinePosition,\r\n\tDelta,\r\n\tAdsorbLine,\r\n\tAdsorbVLine,\r\n\tAdsorbHLine,\r\n\tDireactionX,\r\n\tDireactionY,\r\n} from \"./types\";\r\nimport {\r\n\ttoNumber as fixNumber,\r\n\tgetRectRefLines,\r\n\tgetBoundingRect,\r\n\tgroupBy,\r\n\tfind,\r\n\tgetLineTypeFromPosition,\r\n\tmergeRefLineMeta,\r\n\tgetMatchedLine,\r\n\tcoordinateRotation,\r\n\tisNil,\r\n} from \"./utils\";\r\n\r\nexport * from \"./types\";\r\n\r\nexport {\r\n\tfixNumber,\r\n\tcoordinateRotation,\r\n\tgetBoundingRect,\r\n\tgetRectRefLines,\r\n\tmergeRefLineMeta,\r\n};\r\n\r\nexport interface RefLineOpts<T extends Rect = Rect> {\r\n\trects: T[];\r\n\tcurrent?: T | string;\r\n\tlineFilter?: (line: RefLineMeta) => boolean;\r\n\t// \r\n\tadsorbVLines?: Omit<AdsorbLine, \"type\">[];\r\n\t// \r\n\tadsorbHLines?: Omit<AdsorbLine, \"type\">[];\r\n}\r\nexport class RefLine<T extends Rect = Rect> {\r\n\tprotected opts: Omit<RefLineOpts<T>, \"rects\" | \"current\"> = {};\r\n\tprivate seq: number = 1;\r\n\tprotected __rects: T[] = [];\r\n\tprotected _rects: T[] = [];\r\n\tprotected current: null | T = null;\r\n\tprotected _dirty: boolean = true;\r\n\t// \r\n\tprotected _vLines: LineGroup<T>[] = [];\r\n\tprotected _hLines: LineGroup<T>[] = [];\r\n\t//  offset : RefLineMeta\r\n\tprotected _vLineMap: Map<string, RefLineMeta<T>[]> = new Map();\r\n\tprotected _hLineMap: Map<string, RefLineMeta<T>[]> = new Map();\r\n\t// \r\n\tprotected _adsorbVLines: AdsorbVLine[] = [];\r\n\tprotected _adsorbHLines: AdsorbHLine[] = [];\r\n\tprotected _lineFilter: ((line: RefLineMeta) => boolean) | null = null;\r\n\r\n\tget rects() {\r\n\t\tif (this._dirty) {\r\n\t\t\tthis.initRefLines();\r\n\t\t}\r\n\r\n\t\treturn this._rects;\r\n\t}\r\n\r\n\tset rects(rects: T[]) {\r\n\t\tthis.__rects = rects;\r\n\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\tget vLines() {\r\n\t\tif (this._dirty) {\r\n\t\t\tthis.initRefLines();\r\n\t\t}\r\n\r\n\t\treturn this._vLines;\r\n\t}\r\n\r\n\tget hLines() {\r\n\t\tif (this._dirty) {\r\n\t\t\tthis.initRefLines();\r\n\t\t}\r\n\r\n\t\treturn this._hLines;\r\n\t}\r\n\r\n\tget vLineMap() {\r\n\t\tif (this._dirty) {\r\n\t\t\tthis.initRefLines();\r\n\t\t}\r\n\r\n\t\treturn this._vLineMap;\r\n\t}\r\n\r\n\tget hLineMap() {\r\n\t\tif (this._dirty) {\r\n\t\t\tthis.initRefLines();\r\n\t\t}\r\n\r\n\t\treturn this._hLineMap;\r\n\t}\r\n\r\n\tget adsorbVLines() {\r\n\t\treturn this._adsorbHLines;\r\n\t}\r\n\r\n\tset adsorbVLines(lines: AdsorbVLine[]) {\r\n\t\tthis._adsorbVLines = lines;\r\n\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\tget adsorbHLines() {\r\n\t\treturn this._adsorbHLines;\r\n\t}\r\n\r\n\tset adsorbHLines(lines: AdsorbHLine[]) {\r\n\t\tthis._adsorbHLines = lines;\r\n\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\tconstructor(opts?: RefLineOpts<T>) {\r\n\t\tthis.opts = opts || {};\r\n\t\tthis.__rects = opts?.rects || [];\r\n\t\tthis._lineFilter = opts?.lineFilter || null;\r\n\r\n\t\tthis._adsorbVLines = opts?.adsorbVLines || [];\r\n\t\tthis._adsorbHLines = opts?.adsorbHLines || [];\r\n\r\n\t\tif (opts?.current) {\r\n\t\t\tthis.setCurrent(opts.current);\r\n\t\t}\r\n\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\tgetRectByKey(key: string | number) {\r\n\t\treturn find(this.__rects, (rect) => rect.key === key);\r\n\t}\r\n\r\n\tgetOffsetRefLineMetaList(type: LineType, offset: number) {\r\n\t\toffset = fixNumber(offset, 0);\r\n\t\tconst lineMap = type === \"vertical\" ? this.vLineMap : this.hLineMap;\r\n\r\n\t\treturn lineMap.get(this.toLineMapKey(offset)) || [];\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @param rects\r\n\t */\r\n\tsetRects(rects: T[]) {\r\n\t\tthis.__rects = rects;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\tprotected getRect(rect: T | string): T | null {\r\n\t\tlet current: T | null;\r\n\t\tif (typeof rect === \"string\") {\r\n\t\t\tcurrent = this.getRectByKey(rect);\r\n\t\t} else {\r\n\t\t\tcurrent = rect;\r\n\t\t}\r\n\r\n\t\treturn current;\r\n\t}\r\n\r\n\tsetCurrent(current: T | string | null) {\r\n\t\tconst old = this.getCurrent();\r\n\t\tthis.current = current ? this.getRect(current) : null;\r\n\r\n\t\tif (old?.key !== this.current?.key) {\r\n\t\t\tthis._dirty = true;\r\n\t\t}\r\n\t}\r\n\r\n\tgetCurrent() {\r\n\t\treturn this.current;\r\n\t}\r\n\r\n\tsetLineFilter(filter: ((line: RefLineMeta) => boolean) | null) {\r\n\t\tthis._lineFilter = filter;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\tgetLineFilter() {\r\n\t\treturn this._lineFilter;\r\n\t}\r\n\r\n\tprotected toLineMapKey<S>(v: S) {\r\n\t\treturn v + \"\";\r\n\t}\r\n\r\n\tprotected getLineMapKey(line: { offset: number }) {\r\n\t\treturn this.toLineMapKey(fixNumber(line.offset, 0));\r\n\t}\r\n\r\n\tprotected isEnableLine(line: RefLineMeta<T>) {\r\n\t\t// \r\n\t\tif (line.adsorbOnly) return true;\r\n\r\n\t\tconst filter = this.getLineFilter();\r\n\t\tif (filter) {\r\n\t\t\treturn filter(line);\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected getRectRefLines(rect: T) {\r\n\t\tlet lines = getRectRefLines(rect);\r\n\r\n\t\tif (this.getLineFilter()) {\r\n\t\t\tlines = lines.filter((line) => this.isEnableLine(line));\r\n\t\t}\r\n\r\n\t\treturn lines;\r\n\t}\r\n\r\n\tprotected initRefLines() {\r\n\t\tconst current = this.getCurrent();\r\n\t\tlet vLines: RefLineMeta<T>[] = [];\r\n\t\tlet hLines: RefLineMeta<T>[] = [];\r\n\r\n\t\tthis._rects = current\r\n\t\t\t? this.__rects.filter((rect) => rect.key !== current.key)\r\n\t\t\t: [...this.__rects];\r\n\r\n\t\tthis._rects.forEach((rect) => {\r\n\t\t\tconst lines = this.getRectRefLines(rect);\r\n\r\n\t\t\tlines.forEach((line) => {\r\n\t\t\t\tconst mKey = this.getLineMapKey(line);\r\n\t\t\t\tif (line.type === \"vertical\") {\r\n\t\t\t\t\tvLines.push(line);\r\n\t\t\t\t\tconst matched: RefLineMeta<T>[] =\r\n\t\t\t\t\t\tthis._vLineMap.get(mKey) || [];\r\n\t\t\t\t\tmatched.push(line);\r\n\r\n\t\t\t\t\tthis._vLineMap.set(mKey, matched);\r\n\t\t\t\t} else {\r\n\t\t\t\t\thLines.push(line);\r\n\r\n\t\t\t\t\tconst matched: RefLineMeta<T>[] =\r\n\t\t\t\t\t\tthis._hLineMap.get(mKey) || [];\r\n\t\t\t\t\tmatched.push(line);\r\n\r\n\t\t\t\t\tthis._hLineMap.set(mKey, matched);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// \r\n\t\tthis._adsorbVLines.forEach((line) => {\r\n\t\t\tconst refLineMeta: RefLineMeta<T> = {\r\n\t\t\t\ttype: \"vertical\",\r\n\t\t\t\tposition: \"vl\",\r\n\t\t\t\toffset: line.offset,\r\n\t\t\t\tstart: line.offset,\r\n\t\t\t\tend: 0,\r\n\t\t\t\trect: {\r\n\t\t\t\t\tkey: \"v_\" + line.key,\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tleft: line.offset,\r\n\t\t\t\t\ttop: 0,\r\n\t\t\t\t} as T,\r\n\t\t\t\tadsorbOnly: true,\r\n\t\t\t};\r\n\t\t\tvLines.push(refLineMeta);\r\n\r\n\t\t\tconst mKey = this.getLineMapKey(line);\r\n\t\t\tconst matched: RefLineMeta<T>[] = this._vLineMap.get(mKey) || [];\r\n\t\t\tmatched.push(refLineMeta);\r\n\r\n\t\t\tthis._vLineMap.set(mKey, matched);\r\n\t\t});\r\n\t\tthis._adsorbHLines.forEach((line) => {\r\n\t\t\tconst refLineMeta: RefLineMeta<T> = {\r\n\t\t\t\ttype: \"horizontal\",\r\n\t\t\t\tposition: \"ht\",\r\n\t\t\t\toffset: line.offset,\r\n\t\t\t\tstart: line.offset,\r\n\t\t\t\tend: 0,\r\n\t\t\t\trect: {\r\n\t\t\t\t\tkey: \"h_\" + line.key,\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\ttop: line.offset,\r\n\t\t\t\t} as T,\r\n\t\t\t\tadsorbOnly: true,\r\n\t\t\t};\r\n\t\t\thLines.push(refLineMeta);\r\n\r\n\t\t\tconst mKey = this.getLineMapKey(line);\r\n\t\t\tconst matched: RefLineMeta<T>[] = this._hLineMap.get(mKey) || [];\r\n\t\t\tmatched.push(refLineMeta);\r\n\r\n\t\t\tthis._hLineMap.set(mKey, matched);\r\n\t\t});\r\n\r\n\t\tvLines = vLines.sort((a, b) => a.offset - b.offset);\r\n\t\thLines = hLines.sort((a, b) => a.offset - b.offset);\r\n\r\n\t\tlet vGroup = groupBy(vLines, (line) => this.getLineMapKey(line));\r\n\t\tlet hGroup = groupBy(hLines, (line) => this.getLineMapKey(line));\r\n\r\n\t\tthis._vLines = vGroup.keys.map((key) => {\r\n\t\t\tconst lines = vGroup.group[key];\r\n\t\t\treturn {\r\n\t\t\t\toffset: fixNumber(lines[0].offset, 0),\r\n\t\t\t\tmin: Math.min(...lines.map((line) => line.offset)),\r\n\t\t\t\tmax: Math.max(...lines.map((line) => line.offset)),\r\n\t\t\t\trefLineMetaList: lines,\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\tthis._hLines = hGroup.keys.map((key) => {\r\n\t\t\tconst lines = hGroup.group[key];\r\n\t\t\treturn {\r\n\t\t\t\toffset: fixNumber(lines[0].offset, 0),\r\n\t\t\t\tmin: Math.min(...lines.map((line) => line.offset)),\r\n\t\t\t\tmax: Math.max(...lines.map((line) => line.offset)),\r\n\t\t\t\trefLineMetaList: lines,\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\tthis._dirty = false;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param type\r\n\t * @param rect\r\n\t * @returns\r\n\t */\r\n\tmatchRefLines(type: LineType): MatchedLine<T>[] {\r\n\t\tconst current = this.getCurrent();\r\n\t\tif (!current) return [];\r\n\r\n\t\tconst isVertical = type === \"vertical\";\r\n\t\tconst lineMap = isVertical ? this.vLineMap : this.hLineMap;\r\n\r\n\t\tconst matchedLines: MatchedLine<T>[] = [];\r\n\r\n\t\tif (!current) return matchedLines;\r\n\r\n\t\tconst cLines = this.getRectRefLines(current);\r\n\r\n\t\tcLines.forEach((line) => {\r\n\t\t\tif (line.type !== type) return;\r\n\r\n\t\t\tconst mKey = this.getLineMapKey(line);\r\n\r\n\t\t\tconst lines = lineMap.get(mKey) || [];\r\n\r\n\t\t\tconst matchedLine = getMatchedLine(\r\n\t\t\t\tline,\r\n\t\t\t\tlines.filter((line) => !line.adsorbOnly) // \r\n\t\t\t);\r\n\r\n\t\t\tif (matchedLine) {\r\n\t\t\t\tmatchedLines.push(matchedLine);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn matchedLines;\r\n\t}\r\n\r\n\t/**\r\n\t * offset(xy)offsetoffset()\r\n\t * @param type\r\n\t * @param offset\r\n\t * @returns\r\n\t */\r\n\tgetNearestOffsetFromOffset(\r\n\t\ttype: LineType,\r\n\t\toffset: number\r\n\t): [[number, number] | null, [number, number] | null] {\r\n\t\tconst isVertical = type === \"vertical\";\r\n\t\tconst lines = isVertical ? this.vLines : this.hLines;\r\n\r\n\t\tlet prev: number = -Infinity;\r\n\t\tlet prevDist: number = Infinity;\r\n\t\tlet next: number = Infinity;\r\n\t\tlet nextDist: number = Infinity;\r\n\r\n\t\tlines.forEach((line) => {\r\n\t\t\tconst d = Math.abs(line.min - offset);\r\n\t\t\tif (line.min < offset && d >= 0.5) {\r\n\t\t\t\tprev = Math.max(line.min, prev);\r\n\t\t\t\tprevDist = Math.min(d, prevDist);\r\n\t\t\t}\r\n\r\n\t\t\tif (line.min > offset && d >= 0.5) {\r\n\t\t\t\tnext = Math.min(line.min, next);\r\n\t\t\t\tnextDist = Math.min(d, nextDist);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn [\r\n\t\t\tprev !== -Infinity ? [prev, prevDist] : null,\r\n\t\t\tnext !== Infinity ? [next, nextDist] : null,\r\n\t\t];\r\n\t}\r\n\t/**\r\n\t * \r\n\t * @param position\r\n\t * @returns\r\n\t */\r\n\thasMatchedRefLine(position: RefLinePosition) {\r\n\t\tconst current = this.getCurrent();\r\n\t\tif (!current) return false;\r\n\r\n\t\tconst lines = this.getRectRefLines(current);\r\n\t\tconst line = find(lines, (line) => line.position === position);\r\n\r\n\t\tif (!line) return false;\r\n\t\tconst mKey = this.getLineMapKey(line);\r\n\r\n\t\tconst lineMap =\r\n\t\t\tgetLineTypeFromPosition(position) === \"vertical\"\r\n\t\t\t\t? this.vLineMap\r\n\t\t\t\t: this.hLineMap;\r\n\r\n\t\tconst matched = lineMap.get(mKey);\r\n\r\n\t\tif (!matched) return false;\r\n\r\n\t\treturn !!matched.length;\r\n\t}\r\n\r\n\t/**\r\n\t * alias getVRefLines\r\n\t * @returns\r\n\t */\r\n\tmatchVRefLines() {\r\n\t\treturn this.matchRefLines(\"vertical\");\r\n\t}\r\n\r\n\tgetVRefLines() {\r\n\t\treturn this.matchRefLines(\"vertical\");\r\n\t}\r\n\r\n\t/**\r\n\t * alias getHRefLines\r\n\t * @returns\r\n\t */\r\n\tmatchHRefLines() {\r\n\t\treturn this.matchRefLines(\"horizontal\");\r\n\t}\r\n\r\n\tgetHRefLines() {\r\n\t\treturn this.matchRefLines(\"horizontal\");\r\n\t}\r\n\r\n\t/**\r\n\t * alias getAllRefLines\r\n\t * @returns\r\n\t */\r\n\tmatchAllRefLines() {\r\n\t\treturn [...this.matchVRefLines(), ...this.matchHRefLines()];\r\n\t}\r\n\r\n\tgetAllRefLines() {\r\n\t\treturn [...this.matchVRefLines(), ...this.matchHRefLines()];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param type\r\n\t * @param offset\r\n\t * @param delta\r\n\t * @param adsorbDistance\r\n\t * @returns\r\n\t */\r\n\tgetOffsetAdsorbDelta(\r\n\t\ttype: LineType,\r\n\t\toffset: number,\r\n\t\tdelta: number,\r\n\t\tadsorbDistance = 5\r\n\t) {\r\n\t\tadsorbDistance = Math.abs(adsorbDistance);\r\n\r\n\t\tif (adsorbDistance < 1) return delta;\r\n\r\n\t\tconst hasMatchedLine = this.getOffsetRefLineMetaList(\r\n\t\t\ttype,\r\n\t\t\toffset\r\n\t\t).length;\r\n\r\n\t\tconst n = this.getNearestOffsetFromOffset(type, offset);\r\n\r\n\t\tconst isMoveTopOrLeft = delta < 0;\r\n\r\n\t\tconst useIndex = isMoveTopOrLeft ? 0 : 1;\r\n\t\tconst nearestOffset = n[useIndex];\r\n\r\n\t\tconst value: number = nearestOffset ? nearestOffset[0] : 0;\r\n\t\tconst dist: number = nearestOffset ? nearestOffset[1] : 0;\r\n\r\n\t\tif (nearestOffset && dist <= adsorbDistance) {\r\n\t\t\tadsorbDistance = dist;\r\n\t\t} else {\r\n\t\t\tadsorbDistance += 1;\r\n\t\t}\r\n\r\n\t\tif (hasMatchedLine) {\r\n\t\t\tif (Math.abs(delta) < adsorbDistance) {\r\n\t\t\t\tdelta = 0;\r\n\t\t\t} else if (Math.abs(delta) === 1 && adsorbDistance < 1) {\r\n\t\t\t\tdelta = adsorbDistance;\r\n\t\t\t}\r\n\t\t} else if (delta !== 0) {\r\n\t\t\tconst dist = value - (offset + delta);\r\n\r\n\t\t\tif (\r\n\t\t\t\tMath.abs(dist) < adsorbDistance &&\r\n\t\t\t\t(isMoveTopOrLeft ? dist <= 0 : dist >= 0)\r\n\t\t\t) {\r\n\t\t\t\tdelta += dist;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn delta;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param delta\r\n\t * @param adsorbDistance\r\n\t * @returns\r\n\t */\r\n\tgetAdsorbDelta(\r\n\t\tdelta: Delta,\r\n\t\tadsorbDistance: number,\r\n\t\tdir: {\r\n\t\t\tx: \"left\" | \"right\" | \"none\";\r\n\t\t\ty: \"up\" | \"down\" | \"none\";\r\n\t\t}\r\n\t): Delta {\r\n\t\tconst rect = this.getCurrent();\r\n\t\tif (!rect) return delta;\r\n\r\n\t\tconst dirX = dir?.x || \"none\";\r\n\t\tconst dirY = dir?.y || \"none\";\r\n\r\n\t\tadsorbDistance = Math.abs(adsorbDistance || 5);\r\n\t\tconst origAdsorbDistance = adsorbDistance;\r\n\r\n\t\tconst newDelta = {\r\n\t\t\t...delta,\r\n\t\t};\r\n\r\n\t\tif (adsorbDistance < 1) return newDelta;\r\n\r\n\t\tconst refLineMetaList = getRectRefLines(rect);\r\n\t\tconst lineStatus = [\r\n\t\t\tthis.isEnableLine(refLineMetaList[0]),\r\n\t\t\tthis.isEnableLine(refLineMetaList[1]),\r\n\t\t\tthis.isEnableLine(refLineMetaList[2]),\r\n\t\t\tthis.isEnableLine(refLineMetaList[3]),\r\n\t\t\tthis.isEnableLine(refLineMetaList[4]),\r\n\t\t\tthis.isEnableLine(refLineMetaList[5]),\r\n\t\t];\r\n\r\n\t\tconst hasMatchedVRefLine =\r\n\t\t\tthis.hasMatchedRefLine(\"vl\") ||\r\n\t\t\tthis.hasMatchedRefLine(\"vc\") ||\r\n\t\t\tthis.hasMatchedRefLine(\"vr\");\r\n\r\n\t\tconst hasMatchedHRefLine =\r\n\t\t\tthis.hasMatchedRefLine(\"ht\") ||\r\n\t\t\tthis.hasMatchedRefLine(\"hc\") ||\r\n\t\t\tthis.hasMatchedRefLine(\"hb\");\r\n\r\n\t\tif (delta.left !== 0 && dirX !== \"none\") {\r\n\t\t\tadsorbDistance = origAdsorbDistance;\r\n\t\t\tconst currentOffsetList = [\r\n\t\t\t\trefLineMetaList[0].offset,\r\n\t\t\t\trefLineMetaList[1].offset,\r\n\t\t\t\trefLineMetaList[2].offset,\r\n\t\t\t];\r\n\t\t\tconst n1 = this.getNearestOffsetFromOffset(\r\n\t\t\t\t\"vertical\",\r\n\t\t\t\trefLineMetaList[0].offset\r\n\t\t\t);\r\n\t\t\tconst n2 = this.getNearestOffsetFromOffset(\r\n\t\t\t\t\"vertical\",\r\n\t\t\t\trefLineMetaList[1].offset\r\n\t\t\t);\r\n\t\t\tconst n3 = this.getNearestOffsetFromOffset(\r\n\t\t\t\t\"vertical\",\r\n\t\t\t\trefLineMetaList[2].offset\r\n\t\t\t);\r\n\r\n\t\t\tconst isMoveLeft = dirX === \"left\";\r\n\r\n\t\t\tconst values: number[] = [Infinity, Infinity, Infinity];\r\n\t\t\tconst distValues: number[] = [Infinity, Infinity, Infinity];\r\n\t\t\tconst useIndex = isMoveLeft ? 0 : 1;\r\n\t\t\tif (lineStatus[0] && n1[useIndex]) {\r\n\t\t\t\tvalues[0] = n1[useIndex]![0];\r\n\t\t\t\tdistValues[0] = n1[useIndex]![1];\r\n\t\t\t}\r\n\t\t\tif (lineStatus[1] && n2[useIndex]) {\r\n\t\t\t\tvalues[1] = n2[useIndex]![0];\r\n\t\t\t\tdistValues[1] = n2[useIndex]![1];\r\n\t\t\t}\r\n\t\t\tif (lineStatus[2] && n3[useIndex]) {\r\n\t\t\t\tvalues[2] = n3[useIndex]![0];\r\n\t\t\t\tdistValues[2] = n3[useIndex]![1];\r\n\t\t\t}\r\n\t\t\tconst minDist = Math.min(...distValues);\r\n\t\t\tconst minIndex = distValues.indexOf(minDist);\r\n\t\t\tconst minOffset = values[minIndex];\r\n\r\n\t\t\tif (minDist <= adsorbDistance) {\r\n\t\t\t\tadsorbDistance = minDist;\r\n\t\t\t} else {\r\n\t\t\t\tadsorbDistance += 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (hasMatchedVRefLine) {\r\n\t\t\t\tif (isMoveLeft && delta.left > 0) {\r\n\t\t\t\t\tnewDelta.left = 0;\r\n\t\t\t\t} else if (!isMoveLeft && delta.left < 0) {\r\n\t\t\t\t\tnewDelta.left = 0;\r\n\t\t\t\t} else if (Math.abs(delta.left) < adsorbDistance) {\r\n\t\t\t\t\tnewDelta.left = 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst currentOffset = currentOffsetList[minIndex];\r\n\t\t\t\tconst dist = minOffset - (currentOffset + delta.left);\r\n\r\n\t\t\t\tif (isMoveLeft && delta.left > 0) {\r\n\t\t\t\t\tnewDelta.left = 0;\r\n\t\t\t\t} else if (!isMoveLeft && delta.left < 0) {\r\n\t\t\t\t\tnewDelta.left = 0;\r\n\t\t\t\t} else if (\r\n\t\t\t\t\tMath.abs(dist) < adsorbDistance &&\r\n\t\t\t\t\t(isMoveLeft ? dist <= 0 : dist >= 0)\r\n\t\t\t\t) {\r\n\t\t\t\t\tnewDelta.left = dist + delta.left;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (delta.top !== 0 && dirY !== \"none\") {\r\n\t\t\tadsorbDistance = origAdsorbDistance;\r\n\t\t\tconst currentOffsetList = [\r\n\t\t\t\trefLineMetaList[3].offset,\r\n\t\t\t\trefLineMetaList[4].offset,\r\n\t\t\t\trefLineMetaList[5].offset,\r\n\t\t\t];\r\n\t\t\tconst n1 = this.getNearestOffsetFromOffset(\r\n\t\t\t\t\"horizontal\",\r\n\t\t\t\trefLineMetaList[3].offset\r\n\t\t\t);\r\n\t\t\tconst n2 = this.getNearestOffsetFromOffset(\r\n\t\t\t\t\"horizontal\",\r\n\t\t\t\trefLineMetaList[4].offset\r\n\t\t\t);\r\n\t\t\tconst n3 = this.getNearestOffsetFromOffset(\r\n\t\t\t\t\"horizontal\",\r\n\t\t\t\trefLineMetaList[5].offset\r\n\t\t\t);\r\n\r\n\t\t\tconst isMoveTop = dirY === \"up\";\r\n\r\n\t\t\tconst values: number[] = [Infinity, Infinity, Infinity];\r\n\t\t\tconst distValues: number[] = [Infinity, Infinity, Infinity];\r\n\t\t\tconst useIndex = isMoveTop ? 0 : 1;\r\n\t\t\tif (lineStatus[3] && n1[useIndex]) {\r\n\t\t\t\tvalues[0] = n1[useIndex]![0];\r\n\t\t\t\tdistValues[0] = n1[useIndex]![1];\r\n\t\t\t}\r\n\t\t\tif (lineStatus[4] && n2[useIndex]) {\r\n\t\t\t\tvalues[1] = n2[useIndex]![0];\r\n\t\t\t\tdistValues[1] = n2[useIndex]![1];\r\n\t\t\t}\r\n\t\t\tif (lineStatus[5] && n3[useIndex]) {\r\n\t\t\t\tvalues[2] = n3[useIndex]![0];\r\n\t\t\t\tdistValues[2] = n3[useIndex]![1];\r\n\t\t\t}\r\n\t\t\tconst minDist = Math.min(...distValues);\r\n\t\t\tconst minIndex = distValues.indexOf(minDist);\r\n\t\t\tconst minOffset = values[minIndex];\r\n\r\n\t\t\tif (minDist <= adsorbDistance) {\r\n\t\t\t\tadsorbDistance = minDist;\r\n\t\t\t} else {\r\n\t\t\t\tadsorbDistance += 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (hasMatchedHRefLine) {\r\n\t\t\t\tif (isMoveTop && delta.top > 0) {\r\n\t\t\t\t\tnewDelta.top = 0;\r\n\t\t\t\t} else if (!isMoveTop && delta.top < 0) {\r\n\t\t\t\t\tnewDelta.top = 0;\r\n\t\t\t\t} else if (Math.abs(delta.top) < adsorbDistance) {\r\n\t\t\t\t\tnewDelta.top = 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst currentOffset = currentOffsetList[minIndex];\r\n\t\t\t\tconst dist = minOffset - (currentOffset + delta.top);\r\n\r\n\t\t\t\tif (isMoveTop && delta.top > 0) {\r\n\t\t\t\t\tnewDelta.top = 0;\r\n\t\t\t\t} else if (!isMoveTop && delta.top < 0) {\r\n\t\t\t\t\tnewDelta.top = 0;\r\n\t\t\t\t} else if (\r\n\t\t\t\t\tMath.abs(dist) < adsorbDistance &&\r\n\t\t\t\t\t(isMoveTop ? dist <= 0 : dist >= 0)\r\n\t\t\t\t) {\r\n\t\t\t\t\tnewDelta.top = dist + delta.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn newDelta;\r\n\t}\r\n\r\n\tadsorbCreator({\r\n\t\tpageX,\r\n\t\tpageY,\r\n\t\tcurrent = this.getCurrent(),\r\n\t\tdistance = 5,\r\n\t\tdisableAdsorb = false,\r\n\t\tscale,\r\n\t}: {\r\n\t\tpageX: number;\r\n\t\tpageY: number;\r\n\t\tcurrent?: T | null;\r\n\t\tdistance?: number;\r\n\t\tdisableAdsorb?: boolean;\r\n\t\tscale?: number;\r\n\t}) {\r\n\t\tif (!current) {\r\n\t\t\tthrow new Error(\"[refline.js] current rect does not exist!\");\r\n\t\t}\r\n\r\n\t\tlet currentRect: T = {\r\n\t\t\t...current,\r\n\t\t};\r\n\t\tconst startX = pageX;\r\n\t\tconst startY = pageY;\r\n\t\tconst startLeft = currentRect.left;\r\n\t\tconst startTop = currentRect.top;\r\n\t\tconst _scale = scale || 1;\r\n\t\tconst defaultDisableAdsorb = disableAdsorb;\r\n\r\n\t\t// 0\r\n\t\tlet lastX = pageX;\r\n\t\tlet lastY = pageY;\r\n\t\tlet lastDirX: DireactionX = \"none\",\r\n\t\t\tlastDirY: DireactionY = \"none\";\r\n\r\n\t\treturn (data: {\r\n\t\t\tpageX?: number;\r\n\t\t\tpageY?: number;\r\n\t\t\tcurrent?: T;\r\n\t\t\tdistance?: number;\r\n\t\t\tdisableAdsorb?: boolean;\r\n\t\t\tscale?: number;\r\n\t\t\t// pageXpageYscale\r\n\t\t\toffsetX?: number;\r\n\t\t\toffsetY?: number;\r\n\t\t}) => {\r\n\t\t\tlet disableAdsorb = defaultDisableAdsorb;\r\n\t\t\tif (data.current) {\r\n\t\t\t\tcurrentRect = {\r\n\t\t\t\t\t...data.current,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (!isNil(data.distance)) {\r\n\t\t\t\tdistance = data.distance as number;\r\n\t\t\t}\r\n\r\n\t\t\tif (!isNil(data.disableAdsorb)) {\r\n\t\t\t\tdisableAdsorb = data.disableAdsorb as boolean;\r\n\t\t\t}\r\n\r\n\t\t\tconst currentX = isNil(data.pageX)\r\n\t\t\t\t? startX\r\n\t\t\t\t: (data.pageX as number);\r\n\t\t\tconst currentY = isNil(data.pageY)\r\n\t\t\t\t? startY\r\n\t\t\t\t: (data.pageY as number);\r\n\t\t\tconst scale = isNil(data.scale) ? _scale : (data.scale as number);\r\n\t\t\tconst dir = {\r\n\t\t\t\tx: \"none\",\r\n\t\t\t\ty: \"none\",\r\n\t\t\t} as {\r\n\t\t\t\tx: DireactionX;\r\n\t\t\t\ty: DireactionY;\r\n\t\t\t};\r\n\r\n\t\t\tif (!isNil(data.pageX)) {\r\n\t\t\t\tif (currentX === lastX) {\r\n\t\t\t\t\tdir.x = lastDirX;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdir.x = currentX < lastX ? \"left\" : \"right\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlastDirX = dir.x;\r\n\t\t\t}\r\n\t\t\tif (!isNil(data.pageY)) {\r\n\t\t\t\tif (currentY === lastY) {\r\n\t\t\t\t\tdir.y = lastDirY;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdir.y = currentY < lastY ? \"up\" : \"down\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlastDirY = dir.y;\r\n\t\t\t}\r\n\r\n\t\t\tconst offsetX = isNil(data.offsetX)\r\n\t\t\t\t? (currentX - startX) / scale\r\n\t\t\t\t: (data.offsetX as number);\r\n\t\t\tconst offsetY = isNil(data.offsetY)\r\n\t\t\t\t? (currentY - startY) / scale\r\n\t\t\t\t: (data.offsetY as number);\r\n\r\n\t\t\tconst left = startLeft + offsetX;\r\n\t\t\tconst top = startTop + offsetY;\r\n\r\n\t\t\tlet delta = {\r\n\t\t\t\tleft: left - currentRect.left,\r\n\t\t\t\ttop: top - currentRect.top,\r\n\t\t\t};\r\n\r\n\t\t\tif (!isNil(data.pageX) && currentX === lastX) {\r\n\t\t\t\tdelta.left = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (!isNil(data.pageY) && currentY === lastY) {\r\n\t\t\t\tdelta.top = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\t!isNil(data.pageX) &&\r\n\t\t\t\t!isNil(data.pageY) &&\r\n\t\t\t\tcurrentX === lastX &&\r\n\t\t\t\tcurrentY === lastY\r\n\t\t\t) {\r\n\t\t\t\tdisableAdsorb = true;\r\n\t\t\t}\r\n\r\n\t\t\tconst raw = delta;\r\n\r\n\t\t\tif (!disableAdsorb) {\r\n\t\t\t\tthis.setCurrent(currentRect);\r\n\t\t\t\tdelta = this.getAdsorbDelta(delta, distance || 5, dir);\r\n\t\t\t}\r\n\r\n\t\t\tcurrentRect.left += delta.left;\r\n\t\t\tcurrentRect.top += delta.top;\r\n\r\n\t\t\tlastX = currentX;\r\n\t\t\tlastY = currentY;\r\n\r\n\t\t\treturn {\r\n\t\t\t\traw,\r\n\t\t\t\tdelta,\r\n\t\t\t\toffset: {\r\n\t\t\t\t\tleft: currentRect.left - startLeft,\r\n\t\t\t\t\ttop: currentRect.top - startTop,\r\n\t\t\t\t},\r\n\t\t\t\trect: {\r\n\t\t\t\t\t...currentRect,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport function createRefLine<T extends Rect = Rect>(opts: RefLineOpts<T>) {\r\n\treturn new RefLine(opts);\r\n}\r\n\r\nexport default RefLine;\r\n","// export const Events: Record<string, string> = {\r\n// \tChange: 'change',\r\n// \tDataChange: 'data.change',\r\n// \tPropertyChange: 'property.change',\r\n// \tStyleChange: 'style.change'\r\n// };\r\n\r\n/**\r\n * Events\r\n */\r\nexport enum KeyboardEvents {\r\n\tKeyDown = \"KeyDown\",\r\n\tKeyUp = \"KeyUp\",\r\n\tCtrlKey = \"CtrlKey\",\r\n\tCtrlKeyDown = \"CtrlKeyDown\",\r\n\tCtrlKeyUp = \"CtrlKeyUp\",\r\n\tShiftKey = \"ShiftKey\",\r\n\tShiftKeyDown = \"ShiftKeyDown\",\r\n\tShiftKeyUp = \"ShiftKeyUp\",\r\n\tAltKey = \"AltKey\",\r\n\tAltKeyDown = \"AltKeyDown\",\r\n\tAltKeyUp = \"AltKeyUp\",\r\n}\r\n\r\nexport enum InteractionEvents {\r\n\tDoubleClick = \"DoubleClick\",\r\n\tClick = \"Click\",\r\n\tScale = \"Scale\",\r\n\tDrag = \"Drag\",\r\n\tMove = \"Move\",\r\n\tHover = \"Hover\",\r\n\tSleep = \"Sleep\",\r\n\tDragStart = \"DragStart\",\r\n\tDragging = \"Dragging\",\r\n\tDragEnd = \"DragEnd\",\r\n\tRotateStart = \"RotateStart\",\r\n\tRotating = \"Rotating\",\r\n\tRotateEnd = \"RotateEnd\",\r\n\tUnableResize = \"UnableResize\",\r\n\tResizeStart = \"ResizeStart\",\r\n\tResizing = \"Resizing\",\r\n\tResizeEnd = \"ResizeEnd\",\r\n}\r\n","import { EventEmitter } from \"eventemitter3\";\r\nimport { mat2, mat2d, vec2 } from \"gl-matrix\";\r\nimport { isNil, isEqual, isNull, isNumberEqual, isNumber } from \"@antv/util\";\r\nimport { aabb, guide, sortCCW } from \"../utils\";\r\nimport { IElement } from \"./interfaces/IElement\";\r\nimport { DEFAULT_STYLE_PROPS } from \"./styles\";\r\nimport {\r\n\tAnchor,\r\n\tAnchorType,\r\n\tBaseClientProps,\r\n\tBaseStyleProps,\r\n\tElementType,\r\n\tSHAPE,\r\n\tUI2D,\r\n\tUI3D,\r\n} from \"./types\";\r\nimport { Events } from \"../events\";\r\nimport { IIcon } from \"./interfaces\";\r\nimport { AABB, OBB, DEG_TO_RAD } from \"../shapes\";\r\nimport { RefLine } from \"../refline\";\r\nimport { clone, cloneDeep } from \"lodash\";\r\nimport path2 from \"@jscad/modeling/src/geometries/path2\";\r\nimport { Vec2 } from \"@jscad/modeling/src/maths/types\";\r\nimport { offset } from \"@jscad/modeling/src/operations/expansions\";\r\nimport geom2 from \"@jscad/modeling/src/geometries/geom2\";\r\n\r\n/**\r\n * Element Config\r\n */\r\nexport interface ElementProps<StyleProps = any, ClientProps = any> {\r\n\ttype?: SHAPE | string;\r\n\tid?: string;\r\n\tname?: string;\r\n\tname2?: string;\r\n\tchildren?: Map<string, Element>;\r\n\tparent?: Element;\r\n\tstyles?: StyleProps;\r\n\tclients?: ClientProps;\r\n\tx?: number; // \r\n\ty?: number; //  \r\n\tcenter?: number[];\r\n\tscale?: number;\r\n\tanchor?: number[];\r\n\tvisible?: boolean;\r\n\tmovable?: boolean;\r\n\thovered?: boolean;\r\n\tdragging?: boolean;\r\n\tselected?: boolean;\r\n\ticons?: IIcon[];\r\n\tdebug?: boolean;\r\n\tui2d?: string;\r\n\tui3d?: string;\r\n\twidth?: number;\r\n\theight?: number;\r\n\tsize?: number[];\r\n\tangle?: number;\r\n\timage?: string;\r\n\tmode?: ElementType;\r\n}\r\n\r\nexport interface GridHelperProps {\r\n\tele: Element;\r\n\tp: number;\r\n\ttype: 0; // x:0(left),1(center),2(right); y:0(top), 1(center), 2(bottom)\r\n}\r\n\r\n/**\r\n * data model\r\n * @extends EventEmitter\r\n * @see https://www.npmjs.com/package/eventemitter3\r\n */\r\nexport class Element<\r\n\tStyleProps extends BaseStyleProps = any,\r\n\tClientProps extends BaseClientProps = any\r\n\t>\r\n\textends EventEmitter\r\n\timplements IElement<StyleProps, ClientProps>\r\n{\r\n\tprops: ElementProps<StyleProps, ClientProps>;\r\n\t_id: string = guide();\r\n\ttype?: SHAPE | string;\r\n\tname?: string;\r\n\tname2?: string;\r\n\tx: number = 0;\r\n\ty: number = 0;\r\n\tcenter: number[] = [0, 0];\r\n\tangle: number = 0;\r\n\tscale: number = 1;\r\n\tanchor: number[] = [0, 0];\r\n\tvisible: boolean = true;\r\n\tmovable: boolean = true;\r\n\thovered: boolean = false;\r\n\tselected: boolean = false;\r\n\tdragging: boolean = false;\r\n\trotating: boolean = false;\r\n\tresizing: boolean = false;\r\n\tisEditing: boolean = false;\r\n\tisAlarm: boolean = false;\r\n\tmode: ElementType = ElementType.Show;\r\n\t_children: Map<string, Element> = new Map();\r\n\t_styles: StyleProps = {} as StyleProps;\r\n\t_clients: ClientProps = {} as ClientProps;\r\n\t_attributes: Element = {} as Element;\r\n\tstyles: StyleProps = {} as StyleProps;\r\n\tclients: ClientProps = {} as ClientProps;\r\n\tattributes: Element = {} as Element;\r\n\ticons: IIcon[] = [];\r\n\tdebug?: boolean = true;\r\n\tui2d?: string = UI2D.NodeUI;\r\n\tui3d?: string = UI3D.CubeUI;\r\n\twidth: number = 0;\r\n\theight: number = 0;\r\n\tsize: number[] = [0, 0];\r\n\timage: string = \"\"; // default image\r\n\tparent?: Element;\r\n\t_points: number[][] = [];\r\n\t_obb: OBB = new OBB([]);\r\n\t_aabb: AABB = new AABB();\r\n\t_matrix: mat2d = mat2d.create();\r\n\t_grids?: { x: GridHelperProps[]; y: GridHelperProps[] } = { x: [], y: [] }; // \r\n\trects?: {\r\n\t\tkey: string;\r\n\t\tleft: number;\r\n\t\ttop: number;\r\n\t\twidth: number;\r\n\t\theight: number;\r\n\t\trotate: number;\r\n\t}[] = []; // rects\r\n\trefLine = new RefLine({\r\n\t\trects: [],\r\n\t\tcurrent: {\r\n\t\t\tkey: \"\",\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t\twidth: 0,\r\n\t\t\theight: 0,\r\n\t\t\trotate: 0,\r\n\t\t},\r\n\t});\r\n\tupdater: any;\r\n\r\n\tconstructor(props?: ElementProps<StyleProps, ClientProps>) {\r\n\t\tsuper();\r\n\t\tthis.props = props || {};\r\n\t\tif (this.props.styles) {\r\n\t\t\tthis.props.styles = {\r\n\t\t\t\t...DEFAULT_STYLE_PROPS,\r\n\t\t\t\t...this.props.styles,\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis._id = props?.id || this._id;\r\n\t\tthis.type = props?.type || SHAPE.Element;\r\n\t\tthis.name = props?.name || \"\";\r\n\t\tthis.name2 = props?.name2 || \"\";\r\n\t\tthis.image = props?.image || \"\";\r\n\t\tthis.angle = props?.angle || 0;\r\n\t\tthis.width = props?.width || 32;\r\n\t\tthis.height = props?.height || 32;\r\n\t\tthis.x = props?.x || 0;\r\n\t\tthis.y = props?.y || 0;\r\n\t\tthis.center = [this.x, this.y];\r\n\t\tthis.anchor = [this.x, this.y];\r\n\t\tthis.size = [this.width, this.height];\r\n\t\tthis.visible = props?.visible === undefined ? true : !!props?.visible;\r\n\t\tthis.movable = props?.movable === undefined ? true : !!props?.movable;\r\n\t\tthis.hovered = props?.hovered === undefined ? false : !!props?.hovered;\r\n\t\tthis.selected =\r\n\t\t\tprops?.selected === undefined ? false : !!props?.selected;\r\n\t\tthis.dragging =\r\n\t\t\tprops?.dragging === undefined ? false : !!props?.dragging;\r\n\t\tthis.mode = props?.mode || ElementType.Show;\r\n\t\tthis.icons = props?.icons || [];\r\n\t\tthis.debug = props?.debug === undefined ? false : !!props?.debug;\r\n\t\tthis.ui2d = props?.ui2d || UI2D.NodeUI;\r\n\t\tthis.ui3d = props?.ui3d || UI3D.CubeUI;\r\n\t\tthis._matrix = this._angleToMatrix(this.angle);\r\n\t\tif (!this._grids) {\r\n\t\t\tthis._grids = { x: [], y: [] };\r\n\t\t}\r\n\t\t// style Proxy\r\n\t\tthis.styles = new Proxy<StyleProps>(this._styles, {\r\n\t\t\tget: (_, prop) => {\r\n\t\t\t\treturn this.getStyle(prop as keyof StyleProps);\r\n\t\t\t},\r\n\t\t\tset: (_, prop, value) => {\r\n\t\t\t\tthis.setStyle(prop as keyof StyleProps, value);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\t// client Proxy\r\n\t\tthis.clients = new Proxy<ClientProps>(this._clients, {\r\n\t\t\tget: (_, prop) => {\r\n\t\t\t\treturn this.getClient(prop as keyof ClientProps);\r\n\t\t\t},\r\n\t\t\tset: (_, prop, value) => {\r\n\t\t\t\tthis.setClient(prop as keyof ClientProps, value);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis._styles = (this.props.styles as StyleProps) || {\r\n\t\t\t...DEFAULT_STYLE_PROPS,\r\n\t\t};\r\n\t\tthis._clients = (this.props.clients as ClientProps) || {};\r\n\r\n\t\treturn new Proxy(this, {\r\n\t\t\tget: (_: any, prop) => {\r\n\t\t\t\tconst value = _[prop];\r\n\t\t\t\treturn isNull(value) ? undefined : value;\r\n\t\t\t},\r\n\t\t\tset: (_: any, prop, value) => {\r\n\t\t\t\tconst oldValue = _[prop];\r\n\t\t\t\tif (isNumber(value)) {\r\n\t\t\t\t\tif (isNumberEqual(_[prop], value)) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// console.log(_[prop], value);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (isEqual(_[prop], value)) return true;\r\n\t\t\t\t}\r\n\t\t\t\t_[prop] = value;\r\n\t\t\t\tif (prop === \"center\") {\r\n\t\t\t\t\t_[\"x\"] = value[0];\r\n\t\t\t\t\t_[\"y\"] = value[1];\r\n\t\t\t\t\tthis._updatePoints();\r\n\t\t\t\t} else if (prop === \"angle\") {\r\n\t\t\t\t\tthis._updateRotate(oldValue, value);\r\n\t\t\t\t}\r\n\t\t\t\tconst newValue = value;\r\n\t\t\t\tthis.emit(Events.AttributeChange, {\r\n\t\t\t\t\tsource: this,\r\n\t\t\t\t\tprop,\r\n\t\t\t\t\toldValue,\r\n\t\t\t\t\tnewValue,\r\n\t\t\t\t});\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\tprotected _updatePoints() { }\r\n\r\n\tprotected _updateSize() {\r\n\t\tif (!this._points) return;\r\n\t\tconst bounds = AABB.fromPoints(this._points);\r\n\t\tthis.x = bounds.x + bounds.width / 2;\r\n\t\tthis.y = bounds.y + bounds.height / 2;\r\n\t\tthis.center = [this.x, this.y];\r\n\t\tthis.width = bounds.width;\r\n\t\tthis.height = bounds.height;\r\n\t\tthis.size = [bounds.width, bounds.height];\r\n\t\tthis._matrix = this._angleToMatrix(this.angle);\r\n\t}\r\n\r\n\tprotected _updateRotate(oldAngle?: number, newAngle?: number) {\r\n\t\tthis._matrix = this._angleToMatrix(this.angle);\r\n\t}\r\n\r\n\t/**\r\n\t * set style\r\n\t * @param key [StyleProps] Stylekey\r\n\t * @param value [StyleProps] Stylevalue\r\n\t * @param force [boolean]\r\n\t */\r\n\tsetStyle<Key extends keyof StyleProps>(\r\n\t\tkey: Key,\r\n\t\tvalue: StyleProps[Key],\r\n\t\tforce = false\r\n\t) {\r\n\t\tconst oldValue = this._styles[key];\r\n\t\tif (isEqual(oldValue, value)) return;\r\n\t\tthis._styles[key] = value;\r\n\t\tconst newValue = value;\r\n\t\tthis.emit(Events.StyleChange, {\r\n\t\t\tsource: this,\r\n\t\t\tkey,\r\n\t\t\toldValue,\r\n\t\t\tnewValue,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * get style value by key\r\n\t * @param key [StyleProps]\r\n\t * @returns\r\n\t */\r\n\tgetStyle(key: keyof StyleProps): StyleProps[keyof StyleProps] | undefined {\r\n\t\tconst value = this._styles[key];\r\n\t\treturn isNil(value) ? undefined : value;\r\n\t}\r\n\r\n\t/**\r\n\t * remove style by key\r\n\t * @param key\r\n\t */\r\n\tremoveStyle(key: keyof StyleProps): void {\r\n\t\tdelete this._styles[key];\r\n\t}\r\n\r\n\t/**\r\n\t * set client data\r\n\t * @param key\r\n\t * @param value\r\n\t * @param force\r\n\t */\r\n\tsetClient<Key extends keyof ClientProps>(\r\n\t\tkey: Key,\r\n\t\tvalue: ClientProps[Key],\r\n\t\tforce = false\r\n\t) {\r\n\t\tconst oldValue = this._clients[key];\r\n\t\tif (isEqual(oldValue, value)) return;\r\n\t\tthis._clients[key] = value;\r\n\t\tconst newValue = value;\r\n\t\tthis.emit(Events.ClientChange, {\r\n\t\t\tsource: this,\r\n\t\t\tkey,\r\n\t\t\toldValue,\r\n\t\t\tnewValue,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * get client data\r\n\t * @param key\r\n\t * @returns\r\n\t */\r\n\tgetClient(\r\n\t\tkey: keyof ClientProps\r\n\t): ClientProps[keyof ClientProps] | undefined {\r\n\t\tconst value = this._clients[key];\r\n\t\treturn isNil(value) ? undefined : value;\r\n\t}\r\n\r\n\t/**\r\n\t * remove client\r\n\t * @param key\r\n\t */\r\n\tremoveClient(key: keyof ClientProps): void {\r\n\t\tdelete this._clients[key];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tdestroy(): void { }\r\n\r\n\t/**\r\n\t *\r\n\t * @param dx\r\n\t * @param dy\r\n\t */\r\n\ttranslation(dx: number, dy: number) {\r\n\t\tthis.center = [this.center[0] + dx, this.center[1] + dy];\r\n\t\tconst matrix = this._angleToMatrix(this.angle);\r\n\t\tthis._matrix = matrix;\r\n\t}\r\n\r\n\t/**\r\n\t * id\r\n\t */\r\n\tget id(): string {\r\n\t\treturn this._id;\r\n\t}\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tpublic getAABB(): AABB {\r\n\t\treturn this._aabb;\r\n\t}\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tpublic getInnerAABB(): AABB {\r\n\t\treturn this._aabb;\r\n\t}\r\n\r\n\t/**\r\n\t * get OBB\r\n\t * @returns\r\n\t */\r\n\tpublic getOBB(): OBB {\r\n\t\treturn this._obb;\r\n\t}\r\n\r\n\t/**\r\n\t * getBoundingBox\r\n\t */\r\n\tpublic getBoundingBox(\r\n\t\tpadding?:\r\n\t\t\t| number\r\n\t\t\t| { top: number; right: number; bottom: number; left: number }\r\n\t): AABB {\r\n\t\treturn new AABB(0, 0, 0, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * get Debug Points\r\n\t */\r\n\tpublic getHitArea(\r\n\t\tpadding?:\r\n\t\t\t| number\r\n\t\t\t| { top: number; right: number; bottom: number; left: number }\r\n\t): number[][] {\r\n\t\treturn [];\r\n\t}\r\n\r\n\t/**\r\n\t * angle to matrix\r\n\t * @returns\r\n\t */\r\n\tprotected _angleToMatrix(angle: number = this.angle): mat2d {\r\n\t\tconst center = this.center;\r\n\t\tconst a = Math.sin(angle * DEG_TO_RAD);\r\n\t\tconst b = Math.cos(angle * DEG_TO_RAD);\r\n\t\tconst tx = center[0] * (1 - b) + center[1] * a;\r\n\t\tconst ty = center[1] * (1 - b) - center[0] * a;\r\n\t\tconst matrix = mat2d.fromValues(b, a, -a, b, tx, ty);\r\n\t\treturn matrix;\r\n\t}\r\n\r\n\t/**\r\n\t * gridrect\r\n\t */\r\n\tpublic gatherRects(elements: Element[]) {\r\n\t\tthis.rects = [];\r\n\t\telements.forEach((element: Element) => {\r\n\t\t\tif (element.id !== this.id) {\r\n\t\t\t\tthis.rects?.push({\r\n\t\t\t\t\tkey: element.id,\r\n\t\t\t\t\tleft: element.x - element.width / 2,\r\n\t\t\t\t\ttop: element.y - element.height / 2,\r\n\t\t\t\t\twidth: element.width,\r\n\t\t\t\t\theight: element.height,\r\n\t\t\t\t\trotate: element.angle,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst adsorbHLines = [\r\n\t\t\t{\r\n\t\t\t\tkey: \"a\",\r\n\t\t\t\toffset: 100,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tkey: \"b\",\r\n\t\t\t\toffset: 400,\r\n\t\t\t},\r\n\t\t];\r\n\t\tconst adsorbVLines = adsorbHLines;\r\n\t\tthis.refLine = new RefLine({\r\n\t\t\trects: this.rects,\r\n\t\t\t// adsorbHLines,\r\n\t\t\t// adsorbVLines,\r\n\t\t\t// lineFilter: line => {\r\n\t\t\t// console.log(line);\r\n\t\t\t// \tif (line.position === \"hc\" || line.position === \"vc\") return false;\r\n\t\t\t// \treturn true;\r\n\t\t\t// },\r\n\t\t\tcurrent: {\r\n\t\t\t\tkey: this.id,\r\n\t\t\t\tleft: this.x - this.width / 2,\r\n\t\t\t\ttop: this.y - this.height / 2,\r\n\t\t\t\twidth: this.width,\r\n\t\t\t\theight: this.height,\r\n\t\t\t\trotate: this.angle,\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.updater = this.refLine.adsorbCreator({\r\n\t\t\tpageX: this.x,\r\n\t\t\tpageY: this.y,\r\n\t\t\tdistance: 24,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @returns\r\n\t */\r\n\tpublic getCenter() {\r\n\t\treturn {\r\n\t\t\tx: this.x,\r\n\t\t\ty: this.y,\r\n\t\t};\r\n\t}\r\n\r\n\tpublic get points(): number[][] {\r\n\t\treturn this._points;\r\n\t}\r\n\r\n\tpublic set points(points: number[][]) {\r\n\t\tconst oldValue = this._points;\r\n\t\tthis._points = points;\r\n\t\tconst newValue = points;\r\n\t\tthis._updatePoints();\r\n\t\tthis._updateSize();\r\n\t\tthis._matrix = this._angleToMatrix(this.angle);\r\n\t\tthis.emit(Events.AttributeChange, {\r\n\t\t\tsource: this,\r\n\t\t\tprops: \"points\",\r\n\t\t\toldValue,\r\n\t\t\tnewValue,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * add point\r\n\t * @param point\r\n\t * @returns\r\n\t */\r\n\taddPoint(point: number[]) {\r\n\t\tif (!point) return;\r\n\t\tconst oldValue = this._points;\r\n\t\tthis._points.push(point);\r\n\t\tconst newValue = this._points;\r\n\t\tthis.emit(Events.AttributeChange, {\r\n\t\t\tsource: this,\r\n\t\t\toldValue,\r\n\t\t\tnewValue,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t *  remove point by index\r\n\t * @param index {number}\r\n\t */\r\n\tremovePoint(index: number) {\r\n\t\tconst oldValue = clone(this._points);\r\n\t\tdelete this._points[index];\r\n\t\tconst newValue = this._points;\r\n\t\tthis.emit(Events.AttributeChange, {\r\n\t\t\tsource: this,\r\n\t\t\toldValue,\r\n\t\t\tnewValue,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * remove last point\r\n\t * @returns\r\n\t */\r\n\tremoveLastPoint() {\r\n\t\tconst points = this._points;\r\n\t\tif (!points) return;\r\n\t\tconst oldValue = clone(points);\r\n\t\tpoints.pop();\r\n\t\tconst newValue = clone(points);\r\n\t\tthis._updatePoints();\r\n\t\tthis.emit(Events.AttributeChange, {\r\n\t\t\tsource: this,\r\n\t\t\toldValue,\r\n\t\t\tnewValue,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * update points\r\n\t * @param index {number | number[]}\r\n\t * @param point {number[] | number[][]}\r\n\t */\r\n\tupdatePoint(index: number | number[], point: number[] | number[][]) {\r\n\t\tif (index instanceof Array) {\r\n\t\t\tconst oldValue = clone(this._points);\r\n\t\t\tindex.forEach((i: number) => {\r\n\t\t\t\tthis._points[i] = (point as number[][])[i];\r\n\t\t\t});\r\n\t\t\tconst newValue = this._points;\r\n\t\t\tthis._updateSize();\r\n\t\t\tthis.emit(Events.AttributeChange, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\toldValue,\r\n\t\t\t\tnewValue,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconst oldValue = this._points[index as number];\r\n\t\t\tthis._points[index as number] = point as number[];\r\n\t\t\tconst newValue = point;\r\n\t\t\tthis._updateSize();\r\n\t\t\tthis.emit(Events.AttributeChange, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\toldValue,\r\n\t\t\t\tnewValue,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\ttranslatePoint(index: number | number[], d: number[] | number[][]) {\r\n\t\tif (index instanceof Array) {\r\n\t\t\tconst oldValue = clone(this._points);\r\n\t\t\tindex.forEach((i: number, ii: number) => {\r\n\t\t\t\tthis._points[i][0] += (d as number[][])[ii][0];\r\n\t\t\t\tthis._points[i][1] += (d as number[][])[ii][1];\r\n\t\t\t});\r\n\t\t\tconst newValue = this._points;\r\n\t\t\tthis._updateSize();\r\n\t\t\tthis.emit(Events.AttributeChange, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\toldValue,\r\n\t\t\t\tnewValue,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconst oldValue = this._points[index as number];\r\n\t\t\tthis._points[index as number][0] += (d as number[])[0];\r\n\t\t\tthis._points[index as number][1] += (d as number[])[1];\r\n\t\t\tconst newValue = this._points[index as number];\r\n\t\t\tthis._updateSize();\r\n\t\t\tthis.emit(Events.AttributeChange, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\toldValue,\r\n\t\t\t\tnewValue,\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis._matrix = this._angleToMatrix(this.angle);\r\n\t}\r\n\r\n\tscaled(scale: number, anchor: Anchor = AnchorType.Center) {\r\n\t\tlet anchorVector = vec2.fromValues(this.x, this.y);\r\n\t\tswitch (anchor) {\r\n\t\t\tcase AnchorType.Center:\r\n\t\t\t\tanchorVector = vec2.fromValues(this.x, this.y);\r\n\t\t\t\tbreak;\r\n\t\t\tcase AnchorType.Top:\r\n\t\t\t\tanchorVector = vec2.fromValues(\r\n\t\t\t\t\tthis.x,\r\n\t\t\t\t\tthis.y - this.height / 2\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase AnchorType.Right:\r\n\t\t\t\tanchorVector = vec2.fromValues(this.x + this.width / 2, this.y);\r\n\t\t\t\tbreak;\r\n\t\t\tcase AnchorType.Bottom:\r\n\t\t\t\tanchorVector = vec2.fromValues(\r\n\t\t\t\t\tthis.x,\r\n\t\t\t\t\tthis.y + this.height / 2\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase AnchorType.Left:\r\n\t\t\t\tanchorVector = vec2.fromValues(this.x - this.width / 2, this.y);\r\n\t\t\t\tbreak;\r\n\t\t\tcase AnchorType.TopLeft:\r\n\t\t\t\tanchorVector = vec2.fromValues(\r\n\t\t\t\t\tthis.x - this.width / 2,\r\n\t\t\t\t\tthis.y - this.height / 2\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase AnchorType.TopRight:\r\n\t\t\t\tanchorVector = vec2.fromValues(\r\n\t\t\t\t\tthis.x + this.width / 2,\r\n\t\t\t\t\tthis.y - this.height / 2\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase AnchorType.BottomRight:\r\n\t\t\t\tanchorVector = vec2.fromValues(\r\n\t\t\t\t\tthis.x + this.width / 2,\r\n\t\t\t\t\tthis.y + this.height / 2\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase AnchorType.BottomLeft:\r\n\t\t\t\tanchorVector = vec2.fromValues(\r\n\t\t\t\t\tthis.x - this.width / 2,\r\n\t\t\t\t\tthis.y + this.height / 2\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tthis._points.forEach((point: number[]) => {\r\n\t\t\tlet v = vec2.create();\r\n\t\t\tvec2.scale(\r\n\t\t\t\tv,\r\n\t\t\t\tvec2.fromValues(\r\n\t\t\t\t\tpoint[0] - anchorVector[0],\r\n\t\t\t\t\tpoint[1] - anchorVector[1]\r\n\t\t\t\t),\r\n\t\t\t\tscale\r\n\t\t\t);\r\n\t\t\tvec2.add(v, anchorVector, v);\r\n\t\t\tpoint[0] = v[0];\r\n\t\t\tpoint[1] = v[1];\r\n\t\t});\r\n\t\tthis._updateSize();\r\n\t\tthis._updatePoints();\r\n\t}\r\n\r\n\t// translatePointByIndex([from, to]: number[], dx: number, dy: number) {\r\n\t// \tthis._points[from][0] += dx;\r\n\t// \tthis._points[from][1] += dy;\r\n\t// \tthis._points[to][0] += dx;\r\n\t// \tthis._points[to][1] += dy;\r\n\t// \tthis._updateSize();\r\n\t// \tthis.emit(Events.AttributeChange, {\r\n\t// \t\tsource: this\r\n\t// \t});\r\n\t// }\r\n\r\n\t// updatePointByIndex(index: number, point: number[]) {\r\n\t// \tif (!point) return;\r\n\t// \tconst oldValue = this._points[index];\r\n\t// \tthis._points[index] = point;\r\n\t// \tconst newValue = point;\r\n\t// \tthis._updateSize();\r\n\t// \tthis.emit(Events.AttributeChange, {\r\n\t// \t\tsource: this,\r\n\t// \t\toldValue,\r\n\t// \t\tnewValue\r\n\t// \t});\r\n\t// }\r\n\r\n\tupdateLastPoint(point: number[]) {\r\n\t\tif (!point) return;\r\n\t\tconst index = this._points.length - 1;\r\n\t\tif (index >= 0) {\r\n\t\t\tthis.updatePoint(index, point);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param type\r\n\t * @returns\r\n\t */\r\n\tgetEditorPoints(type: string = \"resize\"): number[][] {\r\n\t\tif (type === \"resize\") {\r\n\t\t\treturn this._points;\r\n\t\t} else if (type === \"scale\") {\r\n\t\t\treturn this._points;\r\n\t\t}\r\n\t\treturn this._points;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param element\r\n\t */\r\n\taddChild(element: Element) {\r\n\t\tthis._children?.set(element.id, element);\r\n\t\telement.parent = this;\r\n\t\tthis.emit(Events.ChildrenChangeAdd, {\r\n\t\t\tsource: this,\r\n\t\t\tprop: \"children\",\r\n\t\t\toldValue: undefined,\r\n\t\t\tnewValue: element,\r\n\t\t});\r\n\t}\r\n\r\n\tremoveChild(element: Element) {\r\n\t\tif (this._children.get(element.id)) {\r\n\t\t\telement.parent = undefined;\r\n\t\t\tthis._children.delete(element.id);\r\n\t\t\tthis.emit(Events.ChildrenChangeRemove, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tprop: \"children\",\r\n\t\t\t\toldValue: undefined,\r\n\t\t\t\tnewValue: element,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetChildren(): Map<string, Element> {\r\n\t\treturn this._children;\r\n\t}\r\n\r\n\tgetChildById(id: string): Element | undefined {\r\n\t\treturn this._children.get(id);\r\n\t}\r\n\r\n\tclearChildren() {\r\n\t\tconst oldValue = clone(this._children);\r\n\t\tthis._children.clear();\r\n\t\tconst newValue = this._children;\r\n\t\tthis.emit(Events.ChildrenChangeRemove, {\r\n\t\t\tsource: this,\r\n\t\t\tprop: \"children\",\r\n\t\t\toldValue,\r\n\t\t\tnewValue,\r\n\t\t});\r\n\t}\r\n\r\n\tgetRotatedPoints(): number[][] {\r\n\t\tconst points = clone(this._points);\r\n\t\t// rotate\r\n\t\tconst matrix = this._angleToMatrix(this.angle);\r\n\t\tconst newPoints: number[][] = [];\r\n\t\tfor (let i = 0, n = points.length; i < n; i++) {\r\n\t\t\tconst out = vec2.create();\r\n\t\t\tconst point = points[i];\r\n\t\t\tconst pp = vec2.transformMat2d(\r\n\t\t\t\tout,\r\n\t\t\t\tvec2.fromValues(point[0], point[1]),\r\n\t\t\t\tmat2d.clone(matrix)\r\n\t\t\t);\r\n\t\t\tnewPoints[i] = [pp[0], pp[1]];\r\n\t\t}\r\n\t\treturn newPoints;\r\n\t}\r\n\r\n\tgetOffsetPoints(\r\n\t\tdelta: number = 0,\r\n\t\tcorners: \"edge\" | \"chamfer\" | \"round\" | undefined = \"chamfer\",\r\n\t\tsegments: number = 0\r\n\t): number[][] {\r\n\t\t// if (delta <= 0) return [];\r\n\t\tconst points = this.points;\r\n\t\tif (points.length < 3) return [];\r\n\r\n\t\tlet linePath2 = path2.fromPoints({ closed: true }, points as Vec2[]);\r\n\t\t// chamfer\r\n\t\tlet offsetLinePath1 = offset(\r\n\t\t\t{ delta: delta, corners: corners, segments: segments },\r\n\t\t\tlinePath2\r\n\t\t);\r\n\t\tlet offsetPoints1 = path2.toPoints(offsetLinePath1);\r\n\t\t// offsetPoints1 = sortCCW(offsetPoints1) as Vec2[];\r\n\t\treturn offsetPoints1;\r\n\t}\r\n\r\n\tgetInnerPoints() {\r\n\t\tconst offset = this.styles.offsetDelta || 0;\r\n\t\tconst innerPoints = this.getOffsetPoints(offset) as number[][];\r\n\t\treturn innerPoints;\r\n\t}\r\n\r\n\tpublic toSides(): number[][][] {\r\n\t\tconst points = this._points;\r\n\t\tconst geom = geom2.fromPoints(points as Vec2[]);\r\n\t\treturn geom2.toSides(geom);\r\n\t}\r\n\r\n\tserialize() {\r\n\t\treturn {\r\n\t\t\tid: this._id,\r\n\t\t\ttype: this.type,\r\n\t\t\tname: this.name,\r\n\t\t\tname2: this.name2,\r\n\t\t\timage: this.image,\r\n\t\t\tpoints: this.points,\r\n\t\t\tsize: this.size,\r\n\t\t\tcenter: this.center,\r\n\t\t\tangle: this.angle,\r\n\t\t\tmode: ElementType.Show,\r\n\t\t\tmovable: this.movable,\r\n\t\t\tvisible: this.visible,\r\n\t\t\tselected: this.selected,\r\n\t\t\thovered: this.hovered,\r\n\t\t\tattributes: this.attributes,\r\n\t\t\tgeometries: {},\r\n\t\t\tclients: this._clients,\r\n\t\t\tstyles: this._styles,\r\n\t\t};\r\n\t}\r\n\r\n\tdeserialize(json: any) { }\r\n\tisRectangle(): AABB | boolean {\r\n\t\treturn false;\r\n\t}\r\n}\r\n","export function guide(): string {\r\n\tconst tS4 = function () {\r\n\t\treturn Math.floor((1 + Math.random()) * 0x10000)\r\n\t\t\t.toString(16)\r\n\t\t\t.substring(1);\r\n\t};\r\n\treturn tS4() + tS4() + '-' + tS4() + '-' + tS4() + '-' + tS4() + '-' + tS4() + tS4() + tS4();\r\n}\r\n\r\nexport function s4() {\r\n\treturn (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\r\n}\r\n\r\nexport function s8() {\r\n\treturn s4() + s4();\r\n}\r\n","import { mat2d, vec2 } from \"gl-matrix\";\r\nimport { geometries, primitives } from \"@jscad/modeling\";\r\nimport { Geom2 } from \"@jscad/modeling/src/geometries/types\";\r\nimport { Element, ElementProps } from \"./Element\";\r\nimport { BaseClientProps, BaseStyleProps, SHAPE, UI2D, UI3D } from \"./types\";\r\nimport { AABB, OBB } from \"../shapes\";\r\n\r\n/**\r\n * Display object props\r\n */\r\nexport interface NodeProps<StyleProps = any, ClientProps = any>\r\n\textends ElementProps { }\r\n\r\n/**\r\n * Display object: Node\r\n */\r\nexport class Node<\r\n\tStyleProps extends BaseStyleProps = any,\r\n\tClientProps extends BaseClientProps = any\r\n\t> extends Element<StyleProps, ClientProps> {\r\n\tconstructor(props?: NodeProps<StyleProps, ClientProps>) {\r\n\t\tsuper({\r\n\t\t\ttype: SHAPE.Node,\r\n\t\t\t...props,\r\n\t\t});\r\n\t\tthis._updatePoints();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param padding  {number | { top: number, right: number, bottom: number, left: number }} \r\n\t * @returns\r\n\t */\r\n\tpublic getBoundingBox(\r\n\t\tpadding?:\r\n\t\t\t| number\r\n\t\t\t| { top: number; right: number; bottom: number; left: number }\r\n\t): AABB {\r\n\t\tconst aabb = this.getAABB().clone();\r\n\t\tlet rect = new AABB(aabb.x, aabb.y, aabb.width, aabb.height);\r\n\t\tif (padding && typeof padding === \"number\") {\r\n\t\t\trect.x -= padding;\r\n\t\t\trect.y -= padding;\r\n\t\t\trect.width += 2 * padding;\r\n\t\t\trect.height += 2 * padding;\r\n\t\t} else if (padding && typeof padding === \"object\") {\r\n\t\t\trect.x -= padding.left || 0;\r\n\t\t\trect.y -= padding.top || 0;\r\n\t\t\trect.width += (padding.left || 0) + (padding.right || 0);\r\n\t\t\trect.height += (padding.top || 0) + (padding.bottom || 0);\r\n\t\t}\r\n\t\treturn rect;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\t_updatePoints() {\r\n\t\tconst rect: Geom2 = primitives.rectangle({\r\n\t\t\tcenter: [this.x, this.y],\r\n\t\t\tsize: [this.width, this.height],\r\n\t\t});\r\n\t\tconst points = geometries.geom2.toPoints(rect);\r\n\t\tif (this.angle !== 0) {\r\n\t\t\tconst matrix = this._angleToMatrix(this.angle);\r\n\t\t\tthis._matrix = matrix;\r\n\t\t\tconst newPoints: number[][] = [];\r\n\t\t\tfor (let i = 0, n = points.length; i < n; i++) {\r\n\t\t\t\tconst out = vec2.create();\r\n\t\t\t\tconst point = points[i];\r\n\t\t\t\tconst pp = vec2.transformMat2d(\r\n\t\t\t\t\tout,\r\n\t\t\t\t\tvec2.fromValues(point[0], point[1]),\r\n\t\t\t\t\tmat2d.clone(matrix)\r\n\t\t\t\t);\r\n\t\t\t\tnewPoints[i] = [pp[0], pp[1]];\r\n\t\t\t}\r\n\t\t\tthis._points = newPoints;\r\n\t\t} else {\r\n\t\t\tthis._points = points;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tpublic getAABB(): AABB {\r\n\t\tthis._updatePoints();\r\n\t\tconst aabb = AABB.fromPoints(this._points);\r\n\t\treturn aabb;\r\n\t}\r\n\r\n\t/**\r\n\t * get OBB\r\n\t * @returns\r\n\t */\r\n\tpublic getOBB(\r\n\t\tpadding?:\r\n\t\t\t| number\r\n\t\t\t| { top: number; right: number; bottom: number; left: number }\r\n\t): OBB {\r\n\t\tconst points: number[][] = [];\r\n\t\tthis._points.map((point: any) => {\r\n\t\t\tpoints.push([point[0], point[1]]);\r\n\t\t});\r\n\t\tconst obb = new OBB(points);\r\n\t\treturn obb;\r\n\t}\r\n}\r\n","import { mat2d, vec2 } from \"gl-matrix\";\r\nimport { Element, ElementProps } from \"./Element\";\r\nimport { BaseClientProps, BaseStyleProps, SHAPE, UI2D } from \"./types\";\r\nimport { AABB, DEG_TO_RAD, OBB } from \"../shapes\";\r\nimport primitives from \"@jscad/modeling/src/primitives\";\r\nimport { Line } from \"./Line\";\r\nimport { Geom2 } from \"@jscad/modeling/src/geometries/types\";\r\nimport geometries from \"@jscad/modeling/src/geometries\";\r\n\r\n/**\r\n * Shape object props\r\n */\r\nexport interface ShapeProps<StyleProps = any, ClientProps = any>\r\n\textends ElementProps {\r\n\tpoints?: number[][];\r\n}\r\n\r\n/**\r\n * Shape object: Shape\r\n */\r\nexport class Shape<\r\n\tStyleProps extends BaseStyleProps = any,\r\n\tClientProps extends BaseClientProps = any\r\n\t> extends Element<StyleProps, ClientProps> {\r\n\tconstructor(props?: ShapeProps<StyleProps, ClientProps>) {\r\n\t\tsuper({\r\n\t\t\ttype: SHAPE.Shape,\r\n\t\t\t...props,\r\n\t\t});\r\n\t\tthis.ui2d = UI2D.ShapeUI;\r\n\t\tthis._points = props?.points || [];\r\n\t\tconst bounds = AABB.fromPoints(this._points);\r\n\t\tthis.x = bounds.x + bounds.width / 2;\r\n\t\tthis.y = bounds.y + bounds.height / 2;\r\n\t\tthis.center = [this.x, this.y];\r\n\t\t// this._updateRotate(this.angle, this.angle);\r\n\t\tthis._updateSize();\r\n\t\tthis._matrix = this._angleToMatrix(this.angle);\r\n\t}\r\n\r\n\tprotected _updateRotate(\r\n\t\toldAngle: number = 0,\r\n\t\tnewAngle: number = this.angle\r\n\t): void {\r\n\t\tconst points = this._points;\r\n\t\t// reverse\r\n\t\tconst oldMatrix = this._angleToMatrix(-1 * oldAngle);\r\n\t\tconst oldPoints: number[][] = [];\r\n\t\tfor (let i = 0, n = points.length; i < n; i++) {\r\n\t\t\tconst out = vec2.create();\r\n\t\t\tconst point = points[i];\r\n\t\t\tconst pp = vec2.transformMat2d(\r\n\t\t\t\tout,\r\n\t\t\t\tvec2.fromValues(point[0], point[1]),\r\n\t\t\t\tmat2d.clone(oldMatrix)\r\n\t\t\t);\r\n\t\t\toldPoints[i] = [pp[0], pp[1]];\r\n\t\t}\r\n\t\t// rotate\r\n\t\tconst newMatrix = this._angleToMatrix(newAngle);\r\n\t\tconst newPoints: number[][] = [];\r\n\t\tfor (let i = 0, n = oldPoints.length; i < n; i++) {\r\n\t\t\tconst out = vec2.create();\r\n\t\t\tconst point = oldPoints[i];\r\n\t\t\tconst pp = vec2.transformMat2d(\r\n\t\t\t\tout,\r\n\t\t\t\tvec2.fromValues(point[0], point[1]),\r\n\t\t\t\tmat2d.clone(newMatrix)\r\n\t\t\t);\r\n\t\t\tnewPoints[i] = [pp[0], pp[1]];\r\n\t\t}\r\n\t\tthis._points = newPoints;\r\n\t\tthis._matrix = newMatrix;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param padding  {number | { top: number, right: number, bottom: number, left: number }} \r\n\t * @returns\r\n\t */\r\n\tpublic getBoundingBox(\r\n\t\tpadding?:\r\n\t\t\t| number\r\n\t\t\t| { top: number; right: number; bottom: number; left: number }\r\n\t): AABB {\r\n\t\tconst aabb = this.getAABB().clone();\r\n\t\tlet rect = new AABB(aabb.x, aabb.y, aabb.width, aabb.height);\r\n\t\tif (padding && typeof padding === \"number\") {\r\n\t\t\trect.x -= padding;\r\n\t\t\trect.y -= padding;\r\n\t\t\trect.width += 2 * padding;\r\n\t\t\trect.height += 2 * padding;\r\n\t\t} else if (padding && typeof padding === \"object\") {\r\n\t\t\trect.x -= padding.left || 0;\r\n\t\t\trect.y -= padding.top || 0;\r\n\t\t\trect.width += (padding.left || 0) + (padding.right || 0);\r\n\t\t\trect.height += (padding.top || 0) + (padding.bottom || 0);\r\n\t\t}\r\n\t\treturn rect;\r\n\t}\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tpublic getAABB(): AABB {\r\n\t\tconst aabb = AABB.fromPoints(this._points);\r\n\t\tthis._aabb = aabb;\r\n\t\treturn aabb;\r\n\t}\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tpublic getInnerAABB(): AABB {\r\n\t\tconst offset = this.styles.offsetDelta || 0;\r\n\t\tconst innerPoints = this.getOffsetPoints(offset) as number[][];\r\n\t\tconst aabb = AABB.fromPoints(innerPoints);\r\n\t\tthis._aabb = aabb;\r\n\t\treturn aabb;\r\n\t}\r\n\r\n\t/**\r\n\t * get OBB\r\n\t * @returns\r\n\t */\r\n\tpublic getOBB(): OBB {\r\n\t\tthis._aabb = this.getAABB();\r\n\t\tconst obb = new OBB(this._points);\r\n\t\tthis._obb = obb;\r\n\t\treturn this._obb;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @returns\r\n\t */\r\n\tpublic getCenter() {\r\n\t\tconst aabb = this.getAABB();\r\n\t\treturn {\r\n\t\t\tx: aabb.x + aabb.width / 2,\r\n\t\t\ty: aabb.y + aabb.height / 2,\r\n\t\t};\r\n\t}\r\n\r\n\ttranslation(dx: number, dy: number) {\r\n\t\tconst oldValue = this._points;\r\n\t\tconst points: number[][] = [];\r\n\t\toldValue.forEach((old: number[]) => {\r\n\t\t\tpoints.push([old[0] + dx, old[1] + dy]);\r\n\t\t});\r\n\t\tthis._points = points;\r\n\t\tthis._updateSize();\r\n\t\tthis._matrix = this._angleToMatrix(this.angle);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tpublic splitPolygon(\r\n\t\tline: Line,\r\n\t\tpoints: number[][],\r\n\t\talong: boolean = false\r\n\t): {\r\n\t\tintersectionCount: number;\r\n\t\tpolygons: number[][][];\r\n\t} {\r\n\t\tconst from = line.from,\r\n\t\t\tto = line.to;\r\n\t\tif (!line)\r\n\t\t\treturn {\r\n\t\t\t\tintersectionCount: 0,\r\n\t\t\t\tpolygons: [],\r\n\t\t\t};\r\n\r\n\t\tconst self = this;\r\n\t\tconst poly1: number[][] = [];\r\n\t\tconst poly2: number[][] = [];\r\n\r\n\t\tlet checkPoint = false;\r\n\t\tlet intersectionCount = 0;\r\n\t\tif (!along) {\r\n\t\t\tlet linePoints: number[][] = [\r\n\t\t\t\t[from[0], from[1]],\r\n\t\t\t\t[to[0], to[1]],\r\n\t\t\t];\r\n\r\n\t\t\tfor (let i = 0; i < points.length; i++) {\r\n\t\t\t\tlet polygonPoints =\r\n\t\t\t\t\ti == points.length - 1\r\n\t\t\t\t\t\t? [points[i], points[0]]\r\n\t\t\t\t\t\t: [points[i], points[i + 1]];\r\n\t\t\t\tlet t = self.getT(linePoints, polygonPoints);\r\n\t\t\t\tlet u = self.getU(linePoints, polygonPoints);\r\n\t\t\t\tif (0 <= t && t <= 1 && 0 <= u && u <= 1) {\r\n\t\t\t\t\tintersectionCount++;\r\n\t\t\t\t\tcheckPoint = !checkPoint;\r\n\t\t\t\t\tpoly2.push(self.getIntersection(linePoints, t));\r\n\t\t\t\t\tif (intersectionCount == 1) {\r\n\t\t\t\t\t\tpoly1.push(points[i]);\r\n\t\t\t\t\t\tpoly2.push(points[i + 1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpoly1.push(self.getIntersection(linePoints, t));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcheckPoint\r\n\t\t\t\t\t\t? poly2.push(points[i + 1])\r\n\t\t\t\t\t\t: poly1.push(points[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst offset = -1 * line.styles.offsetDelta;\r\n\t\t\tconst alongPoints = line.getAlongPoints(offset);\r\n\t\t\tlet linePoints: number[][] = [\r\n\t\t\t\t[alongPoints.from[0], alongPoints.from[1]],\r\n\t\t\t\t[alongPoints.to[0], alongPoints.to[1]],\r\n\t\t\t];\r\n\t\t\tfor (let i = 0; i < points.length; i++) {\r\n\t\t\t\tlet polygonPoints =\r\n\t\t\t\t\ti == points.length - 1\r\n\t\t\t\t\t\t? [points[i], points[0]]\r\n\t\t\t\t\t\t: [points[i], points[i + 1]];\r\n\t\t\t\tlet t = self.getT(linePoints, polygonPoints);\r\n\t\t\t\tlet u = self.getU(linePoints, polygonPoints);\r\n\t\t\t\tif (0 <= t && t <= 1 && 0 <= u && u <= 1) {\r\n\t\t\t\t\tintersectionCount++;\r\n\t\t\t\t\tcheckPoint = !checkPoint;\r\n\t\t\t\t\tpoly2.push(self.getIntersection(linePoints, t));\r\n\t\t\t\t\tif (intersectionCount == 1) {\r\n\t\t\t\t\t\tpoly1.push(points[i]);\r\n\t\t\t\t\t\tpoly2.push(points[i + 1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpoly1.push(self.getIntersection(linePoints, t));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcheckPoint\r\n\t\t\t\t\t\t? poly2.push(points[i + 1])\r\n\t\t\t\t\t\t: poly1.push(points[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tintersectionCount: intersectionCount,\r\n\t\t\tpolygons: [poly1, poly2],\r\n\t\t};\r\n\t}\r\n\tgetT(l1: number[][], l2: number[][]) {\r\n\t\treturn (\r\n\t\t\t((l1[0][0] - l2[0][0]) * (l2[0][1] - l2[1][1]) -\r\n\t\t\t\t(l1[0][1] - l2[0][1]) * (l2[0][0] - l2[1][0])) /\r\n\t\t\t((l1[0][0] - l1[1][0]) * (l2[0][1] - l2[1][1]) -\r\n\t\t\t\t(l1[0][1] - l1[1][1]) * (l2[0][0] - l2[1][0]))\r\n\t\t);\r\n\t}\r\n\tgetU(l1: number[][], l2: number[][]) {\r\n\t\treturn -(\r\n\t\t\t((l1[0][0] - l1[1][0]) * (l1[0][1] - l2[0][1]) -\r\n\t\t\t\t(l1[0][1] - l1[1][1]) * (l1[0][0] - l2[0][0])) /\r\n\t\t\t((l1[0][0] - l1[1][0]) * (l2[0][1] - l2[1][1]) -\r\n\t\t\t\t(l1[0][1] - l1[1][1]) * (l2[0][0] - l2[1][0]))\r\n\t\t);\r\n\t}\r\n\tgetIntersection(l1: number[][], t: number) {\r\n\t\treturn [\r\n\t\t\tl1[0][0] + t * (l1[1][0] - l1[0][0]),\r\n\t\t\tl1[0][1] + t * (l1[1][1] - l1[0][1]),\r\n\t\t];\r\n\t}\r\n\r\n\t/**\r\n\t * angle to matrix\r\n\t * @returns\r\n\t */\r\n\tstatic angleToMatrix(center: number[], angle: number = 0): mat2d {\r\n\t\tconst a = Math.sin(angle * DEG_TO_RAD);\r\n\t\tconst b = Math.cos(angle * DEG_TO_RAD);\r\n\t\tconst tx = center[0] * (1 - b) + center[1] * a;\r\n\t\tconst ty = center[1] * (1 - b) - center[0] * a;\r\n\t\tconst matrix = mat2d.fromValues(b, a, -a, b, tx, ty);\r\n\t\treturn matrix;\r\n\t}\r\n\r\n\tstatic fromNode(center: number[], size: number[], attributes?: any): Shape {\r\n\t\tconst rect: Geom2 = primitives.rectangle({\r\n\t\t\tcenter: [center[0], center[1]],\r\n\t\t\tsize: [size[0], size[1]],\r\n\t\t});\r\n\t\tconst points = geometries.geom2.toPoints(rect);\r\n\t\tconst shape = new Shape({\r\n\t\t\tpoints,\r\n\t\t\t...attributes,\r\n\t\t});\r\n\t\treturn shape;\r\n\t}\r\n}\r\n","import { mat2d, vec2 } from \"gl-matrix\";\r\nimport { Element, ElementProps } from \"./Element\";\r\nimport { BaseClientProps, BaseStyleProps, SHAPE, UI2D } from \"./types\";\r\nimport { AABB, OBB } from \"../shapes\";\r\nimport { expand, offset } from \"@jscad/modeling/src/operations/expansions\";\r\nimport path2 from \"@jscad/modeling/src/geometries/path2\";\r\nimport geom2 from \"@jscad/modeling/src/geometries/geom2\";\r\nimport { Vec2 } from \"@jscad/modeling/src/maths/vec2\";\r\n\r\n/**\r\n * Shape object props\r\n */\r\nexport interface ShapeLineProps<StyleProps = any, ClientProps = any>\r\n\textends ElementProps {\r\n\tpoints?: number[][];\r\n\tdash?: number[];\r\n}\r\n\r\n/**\r\n * Shape object: Shape\r\n */\r\nexport class ShapeLine<\r\n\tStyleProps extends BaseStyleProps = any,\r\n\tClientProps extends BaseClientProps = any\r\n\t> extends Element<StyleProps, ClientProps> {\r\n\tdash?: number[];\r\n\tconstructor(props?: ShapeLineProps<StyleProps, ClientProps>) {\r\n\t\tsuper({\r\n\t\t\ttype: SHAPE.ShapeLine,\r\n\t\t\t...props,\r\n\t\t});\r\n\t\tthis.ui2d = UI2D.ShapeLineUI;\r\n\t\tthis._points = props?.points || [];\r\n\t\tthis.dash = props?.dash;\r\n\t\tthis._updateSize();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param padding  {number | { top: number, right: number, bottom: number, left: number }} \r\n\t * @returns\r\n\t */\r\n\tpublic getBoundingBox(\r\n\t\tpadding?:\r\n\t\t\t| number\r\n\t\t\t| { top: number; right: number; bottom: number; left: number }\r\n\t): AABB {\r\n\t\tconst aabb = this.getAABB().clone();\r\n\t\tlet rect = new AABB(aabb.x, aabb.y, aabb.width, aabb.height);\r\n\t\tif (padding && typeof padding === \"number\") {\r\n\t\t\trect.x -= padding;\r\n\t\t\trect.y -= padding;\r\n\t\t\trect.width += 2 * padding;\r\n\t\t\trect.height += 2 * padding;\r\n\t\t} else if (padding && typeof padding === \"object\") {\r\n\t\t\trect.x -= padding.left || 0;\r\n\t\t\trect.y -= padding.top || 0;\r\n\t\t\trect.width += (padding.left || 0) + (padding.right || 0);\r\n\t\t\trect.height += (padding.top || 0) + (padding.bottom || 0);\r\n\t\t}\r\n\t\treturn rect;\r\n\t}\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tpublic getAABB(): AABB {\r\n\t\tconst aabb = AABB.fromPoints(this._points);\r\n\t\tthis._aabb = aabb;\r\n\t\treturn aabb;\r\n\t}\r\n\r\n\t/**\r\n\t * get OBB\r\n\t * @returns\r\n\t */\r\n\tpublic getOBB(): OBB {\r\n\t\tthis._aabb = this.getAABB();\r\n\t\tconst obb = new OBB(this._points);\r\n\t\tthis._obb = obb;\r\n\t\treturn this._obb;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param padding\r\n\t * @returns\r\n\t */\r\n\tpublic getHitArea(\r\n\t\tpadding?:\r\n\t\t\t| number\r\n\t\t\t| { top: number; right: number; bottom: number; left: number }\r\n\t): number[][] {\r\n\t\tthis._aabb = this.getAABB();\r\n\t\tconst matrix = this._matrix;\r\n\t\tconst points: number[][] = [];\r\n\t\tthis._points.map((point: any) => {\r\n\t\t\tconst out = vec2.create();\r\n\t\t\tconst pp = vec2.transformMat2d(\r\n\t\t\t\tout,\r\n\t\t\t\tvec2.fromValues(point[0], point[1]),\r\n\t\t\t\tmat2d.clone(matrix)\r\n\t\t\t);\r\n\t\t\tpoints.push([pp[0], pp[1]]);\r\n\t\t});\r\n\t\tconst obb = new OBB(points);\r\n\t\tthis._obb = obb;\r\n\t\tif (padding) {\r\n\t\t\tif (padding && typeof padding === \"number\") {\r\n\t\t\t\tif (points.length < 3) return [];\r\n\t\t\t\tconst linePath2 = path2.fromPoints(\r\n\t\t\t\t\t{ closed: false },\r\n\t\t\t\t\tpoints as Vec2[]\r\n\t\t\t\t);\r\n\t\t\t\tconst expandedPathGeom2 = expand(\r\n\t\t\t\t\t{ delta: padding, corners: \"edge\", segments: 8 },\r\n\t\t\t\t\tlinePath2\r\n\t\t\t\t);\r\n\t\t\t\tconst expandedPoints = geom2.toPoints(expandedPathGeom2);\r\n\t\t\t\tconst result: number[][] = [];\r\n\t\t\t\texpandedPoints.forEach((point: number[]) => {\r\n\t\t\t\t\tresult.push([point[0], point[1]]);\r\n\t\t\t\t});\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @returns\r\n\t */\r\n\tpublic getCenter() {\r\n\t\tconst aabb = this.getAABB();\r\n\t\treturn {\r\n\t\t\tx: aabb.x + aabb.width / 2,\r\n\t\t\ty: aabb.y + aabb.height / 2,\r\n\t\t};\r\n\t}\r\n\r\n\ttranslation(dx: number, dy: number) {\r\n\t\tconst oldValue = this._points;\r\n\t\tconst points: number[][] = [];\r\n\t\toldValue.forEach((old: number[]) => {\r\n\t\t\tpoints.push([old[0] + dx, old[1] + dy]);\r\n\t\t});\r\n\t\tthis._points = points;\r\n\t\tthis._updateSize();\r\n\t}\r\n}\r\n","import cloneDeep from 'lodash/cloneDeep';\r\nexport interface ICommandDescriptor {\r\n\tprovider?: (options?: unknown) => unknown;\r\n\tmaxLength?: number;\r\n}\r\nexport interface ICommandEventDescriptor {\r\n\taction: string;\r\n\tposition: number;\r\n\tcurrent: unknown;\r\n\thistory: unknown;\r\n\tscope: MementoManager;\r\n}\r\n\r\n/**\r\n * @class\r\n * @description\r\n * Implementing undo/redo Function with Memento Pattern , where you capture the whole current state.\r\n * It's easy to implement, but memory-inefficient since you need to store similar copies of the whole state.\r\n */\r\nexport class MementoManager {\r\n\tprivate _maxLength = 100;\r\n\tprivate _history: unknown[] = [];\r\n\tprivate _position = -1;\r\n\tprivate _initialState: unknown = undefined;\r\n\tprivate _isExceeded = false;\r\n\tprivate _suspendSave = false;\r\n\tprivate _onUpdate: (event?: ICommandEventDescriptor) => unknown = () => 0;\r\n\tprivate _onBeforeSave: (event?: ICommandEventDescriptor) => unknown = () => 0;\r\n\tprivate _onMaxLength: (event?: ICommandEventDescriptor) => void = () => 0;\r\n\tprivate _provider: (event?: unknown) => unknown = () => 0;\r\n\r\n\t/**\r\n\t *\r\n\t * @param options {ICommandDescriptor}\r\n\t * @param options.provider {Function}\r\n\t * @param options.maxLength {Function}\r\n\t */\r\n\tconstructor(options?: ICommandDescriptor) {\r\n\t\tif (options && options.provider) {\r\n\t\t\tthis._provider = options.provider;\r\n\t\t}\r\n\t\tthis._maxLength = options?.maxLength || 100;\r\n\t\tthis._initiliaze();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @private\r\n\t */\r\n\t_initiliaze(): void {\r\n\t\tthis._initialState = undefined;\r\n\t\tthis._history = [];\r\n\t\tthis._isExceeded = false;\r\n\t\tthis._position = -1;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @private\r\n\t * @returns {void}\r\n\t */\r\n\t_checkMaxLength(): void {\r\n\t\tif (this._history.length > this._maxLength) {\r\n\t\t\tthis._history = this._history.slice(1, this._history.length);\r\n\t\t\tif (!this._isExceeded) {\r\n\t\t\t\tthis._onMaxLength({\r\n\t\t\t\t\taction: 'max',\r\n\t\t\t\t\tposition: this._position,\r\n\t\t\t\t\tcurrent: this.current(),\r\n\t\t\t\t\thistory: this.history(),\r\n\t\t\t\t\tscope: this\r\n\t\t\t\t});\r\n\t\t\t\tthis._isExceeded = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._isExceeded = false;\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param item\r\n\t * @param beforeSave\r\n\t * @returns {boolean|*}\r\n\t * @private\r\n\t * @ignore\r\n\t */\r\n\t_rejectSave(item: unknown, beforeSave: unknown): boolean {\r\n\t\treturn this._isEqual(item, this.current()) || beforeSave === false || this._suspendSave;\r\n\t}\r\n\r\n\t/**\r\n\t * check a === b\r\n\t * @param a\r\n\t * @param b\r\n\t * @returns {boolean}\r\n\t * @ignore\r\n\t */\r\n\t_isEqual(a: unknown, b: unknown): boolean {\r\n\t\tif (a === b) return true;\r\n\r\n\t\t/**\r\n\t\t * compare two map is equal\r\n\t\t * @param map1\r\n\t\t * @param map2\r\n\t\t * @returns {boolean}\r\n\t\t * @private\r\n\t\t * @ignore\r\n\t\t */\r\n\t\tconst compareMaps = (\r\n\t\t\tmap1: Map<string, Record<string, unknown>>,\r\n\t\t\tmap2: Map<string, Record<string, unknown>>\r\n\t\t): boolean => {\r\n\t\t\tlet value;\r\n\t\t\tif (map1.size !== map2.size) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tfor (const [key, val] of map1) {\r\n\t\t\t\tvalue = map2.get(key);\r\n\t\t\t\t// in cases of an undefined value, make sure the key\r\n\t\t\t\t// actually exists on the object so there are no false positives\r\n\t\t\t\tif (value !== val || (value === undefined && !map2.has(key))) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\tconst arrA = Array.isArray(a),\r\n\t\t\tarrB = Array.isArray(b);\r\n\t\tlet i, length, key;\r\n\r\n\t\tif (arrA && arrB) {\r\n\t\t\tlength = a.length;\r\n\t\t\tif (length != b.length) return false;\r\n\t\t\tfor (i = 0; i < length; i++) if (!this._isEqual(a[i], b[i])) return false;\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (arrA != arrB) return false;\r\n\r\n\t\tconst dateA = a instanceof Date,\r\n\t\t\tdateB = b instanceof Date;\r\n\t\tif (dateA != dateB) return false;\r\n\t\tif (dateA && dateB) return a.getTime() == b.getTime();\r\n\r\n\t\tconst regexpA = a instanceof RegExp,\r\n\t\t\tregexpB = b instanceof RegExp;\r\n\t\tif (regexpA != regexpB) return false;\r\n\t\tif (regexpA && regexpB) return a.toString() == b.toString();\r\n\r\n\t\tif (a instanceof Map && b instanceof Map) {\r\n\t\t\treturn compareMaps(a, b);\r\n\t\t} else if (a instanceof Object && b instanceof Object) {\r\n\t\t\tconst keys = Object.keys(a);\r\n\t\t\tlength = keys.length;\r\n\r\n\t\t\tif (length !== Object.keys(b).length) return false;\r\n\r\n\t\t\tfor (i = 0; i < length; i++) if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\r\n\r\n\t\t\tfor (i = 0; i < length; i++) {\r\n\t\t\t\tkey = keys[i];\r\n\t\t\t\tif (!this._isEqual((a as any)[key], (b as any)[key])) return false;\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Check if undo is available\r\n\t * @returns {boolean}\r\n\t */\r\n\tcanUndo(): boolean {\r\n\t\treturn this._position > 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @Check if redo is available\r\n\t * @returns {boolean}\r\n\t */\r\n\tcanRedo(): boolean {\r\n\t\treturn this._position < this._history.length - 1;\r\n\t}\r\n\r\n\t/**\r\n\t * ignore\r\n\t * @param callback\r\n\t * @private\r\n\t */\r\n\tstatic callbackError(callback: () => void) {\r\n\t\tif (typeof callback !== 'function') throw new TypeError('callback must be a function');\r\n\t}\r\n\r\n\t/**\r\n\t * Import external history\r\n\t * @param history {Array}\r\n\t * @returns {MementoManager}\r\n\t */\r\n\timport(history = []): MementoManager {\r\n\t\tif (!Array.isArray(history)) throw new TypeError('Items must be an array');\r\n\t\tthis._initiliaze();\r\n\t\tthis._history = history;\r\n\t\tthis._position = this._history.length - 1;\r\n\t\tthis._initialState = history[0];\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *  get history\r\n\t * @returns {unknown[]}\r\n\t */\r\n\thistory(): unknown[] {\r\n\t\treturn this._history;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param value\r\n\t * @returns {MementoManager}\r\n\t */\r\n\tsave(value: unknown): MementoManager {\r\n\t\tlet item = value;\r\n\t\tif (typeof item === 'undefined' && typeof this._provider === 'function') {\r\n\t\t\titem = this._provider();\r\n\t\t}\r\n\t\tconst beforeSave = this._onBeforeSave({\r\n\t\t\taction: 'beforesave',\r\n\t\t\tposition: this._position,\r\n\t\t\thistory: this._history,\r\n\t\t\tcurrent: this.current(),\r\n\t\t\tscope: this\r\n\t\t});\r\n\t\titem = beforeSave || item;\r\n\t\tif (this._rejectSave(item, beforeSave)) return this;\r\n\t\tif (this._position < this._history.length - 1) {\r\n\t\t\tthis._history = this._history.slice(0, this._position + 1);\r\n\t\t}\r\n\t\tif (typeof item !== 'undefined') {\r\n\t\t\tif (item instanceof Map) {\r\n\t\t\t\tthis._history.push(cloneDeep(item));\r\n\t\t\t} else {\r\n\t\t\t\tthis._history.push(JSON.parse(JSON.stringify(item)));\r\n\t\t\t}\r\n\r\n\t\t\tif (this._initialState === undefined) {\r\n\t\t\t\tthis._initialState = item;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._checkMaxLength();\r\n\t\tthis._position = this._history.length - 1;\r\n\t\tthis._onUpdate({\r\n\t\t\taction: 'save',\r\n\t\t\tposition: this._position,\r\n\t\t\tcurrent: this.current(),\r\n\t\t\thistory: this.history(),\r\n\t\t\tscope: this\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param state\r\n\t * @returns {MementoManager}\r\n\t */\r\n\tsuspendSave(state = true): MementoManager {\r\n\t\tthis._suspendSave = state;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {boolean}\r\n\t */\r\n\tallowedSave(): boolean {\r\n\t\treturn !this._suspendSave;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {MementoManager}\r\n\t */\r\n\tclear(): MementoManager {\r\n\t\tthis._initiliaze();\r\n\t\tthis._onUpdate({\r\n\t\t\taction: 'clear',\r\n\t\t\tposition: this._position,\r\n\t\t\tcurrent: null,\r\n\t\t\thistory: this.history(),\r\n\t\t\tscope: this\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback\r\n\t * @returns {MementoManager}\r\n\t */\r\n\tundo(callback: (current: unknown) => void): MementoManager {\r\n\t\tif (this.canUndo()) {\r\n\t\t\tthis._position--;\r\n\t\t\tif (typeof callback === 'function') {\r\n\t\t\t\tcallback(this.current());\r\n\t\t\t}\r\n\t\t\tthis._onUpdate({\r\n\t\t\t\taction: 'undo',\r\n\t\t\t\tposition: this._position,\r\n\t\t\t\tcurrent: this.current(),\r\n\t\t\t\thistory: this.history(),\r\n\t\t\t\tscope: this\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback\r\n\t * @returns {MementoManager}\r\n\t */\r\n\tredo(callback: (current: unknown) => void): MementoManager {\r\n\t\tif (this.canRedo()) {\r\n\t\t\tthis._position++;\r\n\t\t\tif (typeof callback === 'function') callback(this.current());\r\n\t\t\tthis._onUpdate({\r\n\t\t\t\taction: 'redo',\r\n\t\t\t\tposition: this._position,\r\n\t\t\t\tcurrent: this.current(),\r\n\t\t\t\thistory: this.history(),\r\n\t\t\t\tscope: this\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * get current position\r\n\t * @returns {number}\r\n\t */\r\n\tget position(): number {\r\n\t\treturn this._position;\r\n\t}\r\n\t/**\r\n\t *\r\n\t * @returns {*}\r\n\t */\r\n\tcurrent(): unknown {\r\n\t\treturn this._history.length ? this._history[this._position] : null;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {number}\r\n\t */\r\n\tcount(): number {\r\n\t\treturn this._history.length ? this._history.length - 1 : 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @param value {number}\r\n\t * @description {set max length}\r\n\t */\r\n\tpublic set maxLength(value: number) {\r\n\t\tthis._maxLength = value;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {unknown}\r\n\t */\r\n\tinitialState(): unknown {\r\n\t\treturn this._initialState;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback\r\n\t * @returns {MementoManager}\r\n\t */\r\n\tonUpdate(callback: (event?: ICommandEventDescriptor) => unknown): MementoManager {\r\n\t\tMementoManager.callbackError(callback);\r\n\t\tthis._onUpdate = callback;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback\r\n\t * @returns {MementoManager}\r\n\t */\r\n\tonMaxLength(callback: (event?: ICommandEventDescriptor) => void): MementoManager {\r\n\t\tMementoManager.callbackError(callback);\r\n\t\tthis._onMaxLength = callback;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback\r\n\t * @returns {MementoManager}\r\n\t */\r\n\tonBeforeSave(callback: (event?: ICommandEventDescriptor) => void): MementoManager {\r\n\t\tMementoManager.callbackError(callback);\r\n\t\tthis._onBeforeSave = callback;\r\n\t\treturn this;\r\n\t}\r\n}","import cloneDeep from 'lodash/cloneDeep';\r\nexport interface CommandDescriptor {\r\n\tuuid: string;\r\n\tundo: () => unknown;\r\n\tredo: () => unknown;\r\n}\r\n\r\nexport interface IMementoEventDescriptor {\r\n\tcursor: number;\r\n\taction: string;\r\n\tcurrent: unknown;\r\n\tcommands: unknown[];\r\n\tscope: CommandManager;\r\n}\r\n\r\n/**\r\n *\r\n */\r\n/**\r\n * @class\r\n * @description\r\n * The Command Pattern, where you capture commands/actions that affect the state (the current action and it's inverse action). Harder to implement since for for each undoable action\r\n * in your application you must explicitly code it's inverse action, but it's far more memory-efficient since you only store the actions that affect the state.\r\n */\r\nexport class CommandManager {\r\n\tprivate _commands: unknown[] = [];\r\n\tprivate _cursor = -1;\r\n\tprivate _suspended = false;\r\n\tprivate _limit = 100;\r\n\tprivate _batch: CommandDescriptor[] | undefined = undefined;\r\n\r\n\tprivate _onUpdate: (event?: IMementoEventDescriptor) => unknown = () => 0;\r\n\tprivate _onBeforeAdd: (event?: IMementoEventDescriptor) => unknown = () => 0;\r\n\tprivate _onLimited: (event?: IMementoEventDescriptor) => void = () => 0;\r\n\tprivate _onSuspended: (event?: IMementoEventDescriptor) => void = () => 0;\r\n\tprivate _provider: (event?: unknown) => unknown = () => 0;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tconstructor() {\r\n\t\tconsole.log('init Command Manager');\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param command {CommandDescriptor | CommandDescriptor[]}\r\n\t * @returns {void}\r\n\t */\r\n\tpublic add(command: CommandDescriptor | CommandDescriptor[]): void {\r\n\t\tconst batch = this._batch;\r\n\t\tconst commands = this._commands;\r\n\t\tthis._onBeforeAdd({\r\n\t\t\tcursor: this._cursor,\r\n\t\t\taction: 'beforeAdd',\r\n\t\t\tcurrent: this.current(),\r\n\t\t\tcommands: this._commands,\r\n\t\t\tscope: this\r\n\t\t});\r\n\t\tif (this._suspended) {\r\n\t\t\tthis._onSuspended({\r\n\t\t\t\tcursor: this._cursor,\r\n\t\t\t\taction: 'suspended',\r\n\t\t\t\tcurrent: this.current(),\r\n\t\t\t\tcommands: this._commands,\r\n\t\t\t\tscope: this\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (batch && !(command instanceof Array)) {\r\n\t\t\tbatch.push(command);\r\n\t\t} else {\r\n\t\t\tif (this._cursor !== commands.length - 1) {\r\n\t\t\t\tcommands.splice(this._cursor + 1, commands.length);\r\n\t\t\t}\r\n\t\t\tif (this._limit !== 0 && commands.length === this._limit) {\r\n\t\t\t\tthis._onLimited({\r\n\t\t\t\t\taction: 'limit',\r\n\t\t\t\t\tcursor: this._cursor,\r\n\t\t\t\t\tcurrent: this.current(),\r\n\t\t\t\t\tcommands: this._commands,\r\n\t\t\t\t\tscope: this\r\n\t\t\t\t});\r\n\t\t\t\tcommands.splice(0, 1);\r\n\t\t\t}\r\n\r\n\t\t\tcommands.push(command);\r\n\r\n\t\t\tthis._cursor = commands.length - 1;\r\n\r\n\t\t\tthis._onUpdate({\r\n\t\t\t\taction: 'add',\r\n\t\t\t\tcursor: this._cursor,\r\n\t\t\t\tcurrent: this.current(),\r\n\t\t\t\tcommands: this._commands,\r\n\t\t\t\tscope: this\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback {function}\r\n\t * @returns {CommandManager}\r\n\t */\r\n\tpublic undo(callback?: (current: unknown) => void): CommandManager {\r\n\t\tconst commands = this._commands;\r\n\t\tif (!this.canUndo()) {\r\n\t\t\tconsole.log('can not undo!');\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tconst command = commands[this._cursor--];\r\n\t\tthis._suspended = true;\r\n\t\tif (command instanceof Array) {\r\n\t\t\tfor (let c = command.length, i = c - 1; i >= 0; i--) {\r\n\t\t\t\t(command[i] as CommandManager).undo();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t(command as CommandManager).undo();\r\n\t\t}\r\n\t\tthis._suspended = false;\r\n\r\n\t\tif (callback && typeof callback === 'function') {\r\n\t\t\tcallback(this.current());\r\n\t\t}\r\n\r\n\t\tthis._onUpdate({\r\n\t\t\taction: 'undo',\r\n\t\t\tcursor: this._cursor,\r\n\t\t\tcurrent: this.current(),\r\n\t\t\tcommands: this._commands,\r\n\t\t\tscope: this\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback {function}\r\n\t * @returns {CommandManager}\r\n\t */\r\n\tpublic redo(callback?: (current: unknown) => void): CommandManager {\r\n\t\tconst commands = this._commands;\r\n\t\tif (!this.canRedo()) {\r\n\t\t\tconsole.log('can not redo!');\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tconst command = commands[++this._cursor];\r\n\t\tthis._suspended = true;\r\n\t\tif (command instanceof Array) {\r\n\t\t\tcommand.forEach((item: CommandDescriptor) => {\r\n\t\t\t\titem.redo();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t(command as CommandManager).redo();\r\n\t\t}\r\n\t\tthis._suspended = false;\r\n\t\tif (typeof callback === 'function') callback(this.current());\r\n\t\tthis._onUpdate({\r\n\t\t\taction: 'redo',\r\n\t\t\tcursor: this._cursor,\r\n\t\t\tcurrent: this.current(),\r\n\t\t\tcommands: this._commands,\r\n\t\t\tscope: this\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * ignore\r\n\t * @param callback {function}\r\n\t * @private\r\n\t */\r\n\tstatic callbackError(callback: () => void) {\r\n\t\tif (typeof callback !== 'function') throw new TypeError('callback must be a function');\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback {function}\r\n\t * @returns {CommandManager}\r\n\t */\r\n\tonUpdate(callback: (event?: IMementoEventDescriptor) => unknown): CommandManager {\r\n\t\tCommandManager.callbackError(callback);\r\n\t\tthis._onUpdate = callback;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback {function}\r\n\t * @returns {CommandManager}\r\n\t */\r\n\tonLimited(callback: (event?: IMementoEventDescriptor) => void): CommandManager {\r\n\t\tCommandManager.callbackError(callback);\r\n\t\tthis._onLimited = callback;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback {function}\r\n\t * @returns {CommandManager}\r\n\t */\r\n\tonSuspended(callback: (event?: IMementoEventDescriptor) => void): CommandManager {\r\n\t\tCommandManager.callbackError(callback);\r\n\t\tthis._onSuspended = callback;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback {function}\r\n\t * @returns {CommandManager}\r\n\t */\r\n\tonBeforeAdd(callback: (event?: IMementoEventDescriptor) => void): CommandManager {\r\n\t\tCommandManager.callbackError(callback);\r\n\t\tthis._onBeforeAdd = callback;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {boolean}\r\n\t */\r\n\tpublic canUndo(): boolean {\r\n\t\treturn this._cursor >= 0;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {boolean}\r\n\t */\r\n\tpublic canRedo(): boolean {\r\n\t\treturn this._cursor < this._commands.length - 1;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {number}\r\n\t */\r\n\tpublic size(): number {\r\n\t\treturn this._commands.length;\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tpublic get cursor(): number {\r\n\t\treturn this._cursor;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {CommandManager}\r\n\t */\r\n\tpublic clear(): CommandManager {\r\n\t\tthis._commands = [];\r\n\t\tthis._cursor = -1;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {*}\r\n\t */\r\n\tpublic current(): unknown {\r\n\t\treturn this._commands[this._cursor];\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {*}\r\n\t */\r\n\tpublic get commands(): unknown[] {\r\n\t\treturn this._commands;\r\n\t}\r\n\r\n\t/**\r\n\t * @param limit {number}\r\n\t */\r\n\tpublic set limit(limit: number) {\r\n\t\tthis._limit = limit;\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tpublic get limit(): number {\r\n\t\treturn this._limit;\r\n\t}\r\n\r\n\tpublic get suspended(): boolean {\r\n\t\treturn this._suspended;\r\n\t}\r\n\r\n\tpublic set suspended(suspended: boolean) {\r\n\t\tthis._suspended = suspended;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param state {boolean}\r\n\t * @returns {CommandManager}\r\n\t */\r\n\tpublic suspendAdd(state = true): CommandManager {\r\n\t\tthis._suspended = state;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {boolean}\r\n\t */\r\n\tpublic allowedAdd(): boolean {\r\n\t\treturn !this._suspended;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {CommandManager}\r\n\t */\r\n\tpublic startBatch(): CommandManager {\r\n\t\tif (!this._batch) {\r\n\t\t\tthis._batch = [];\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns  {CommandManager}\r\n\t */\r\n\tpublic endBatch(): CommandManager {\r\n\t\tif (this._batch) {\r\n\t\t\tconst batch: CommandDescriptor[] = cloneDeep(this._batch);\r\n\t\t\tthis._batch = undefined;\r\n\t\t\tif (batch.length > 0) {\r\n\t\t\t\tthis.add(batch);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback {function}\r\n\t * @param scope {*}\r\n\t * @returns {CommandManager}\r\n\t */\r\n\tpublic batch(callback: () => unknown, scope: unknown): CommandManager {\r\n\t\tthis.startBatch();\r\n\t\tcallback && callback.call(scope);\r\n\t\tthis.endBatch();\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {boolean}\r\n\t */\r\n\tpublic isBatching(): boolean {\r\n\t\treturn !!this._batch;\r\n\t}\r\n}\r\n","import { BaseClientProps, BaseStyleProps, SHAPE } from \"../elements/types\";\r\nimport { Node, NodeProps } from \"../elements\";\r\nimport { Edge } from \"./Edge\";\r\nimport { Events } from \"../events\";\r\n\r\n/**\r\n * Display object props\r\n */\r\nexport interface VertexProps<StyleProps = any, ClientProps = any>\r\n\textends NodeProps { }\r\n\r\n/**\r\n * Display object: Node\r\n */\r\nexport class Vertex<\r\n\tStyleProps extends BaseStyleProps = any,\r\n\tClientProps extends BaseClientProps = any\r\n\t> extends Node<StyleProps, ClientProps> {\r\n\t_edges: Set<Edge> = new Set();\r\n\t_fromEdges: Set<Edge> = new Set();\r\n\t_toEdges: Set<Edge> = new Set();\r\n\r\n\tconstructor(props?: VertexProps<StyleProps, ClientProps>) {\r\n\t\tsuper({\r\n\t\t\ttype: SHAPE.Node,\r\n\t\t\t...props,\r\n\t\t});\r\n\t\tthis.width = 16;\r\n\t\tthis.height = 16;\r\n\t\tthis.image =\r\n\t\t\t\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg==\";\r\n\t\tthis._updatePoints();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param dx\r\n\t * @param dy\r\n\t */\r\n\ttranslation(dx: number, dy: number) {\r\n\t\tsuper.translation(dx, dy);\r\n\t\tconst edges = this.edges;\r\n\t\tedges.forEach((edge: Edge) => {\r\n\t\t\tconst from = edge.from;\r\n\t\t\tif (from?.id === this.id) {\r\n\t\t\t\tedge.emit(Events.AttributeChange, {\r\n\t\t\t\t\tsource: edge,\r\n\t\t\t\t\tprop: \"_from\",\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconst to = edge.to;\r\n\t\t\tif (to?.id === this.id) {\r\n\t\t\t\tedge.emit(Events.AttributeChange, {\r\n\t\t\t\t\tsource: edge,\r\n\t\t\t\t\tprop: \"_to\",\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst parent = this.parent;\r\n\t\tif (parent) {\r\n\t\t\tparent.emit(Events.AttributeChange, {\r\n\t\t\t\tsource: parent,\r\n\t\t\t\tprop: \"child\",\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\taddToEdge(edge: Edge) {\r\n\t\tthis._toEdges.add(edge);\r\n\t}\r\n\r\n\taddFromEdge(edge: Edge) {\r\n\t\tthis._fromEdges.add(edge);\r\n\t}\r\n\r\n\tdeleteEdge(edge: Edge) {\r\n\t\tthis._fromEdges.delete(edge);\r\n\t\tthis._toEdges.delete(edge);\r\n\t}\r\n\r\n\tget edges() {\r\n\t\tthis._edges = new Set([...this._fromEdges, ...this._toEdges]);\r\n\t\treturn this._edges;\r\n\t}\r\n\r\n\tgetFromEdges() {\r\n\t\treturn this._fromEdges;\r\n\t}\r\n\r\n\tgetToEdges() {\r\n\t\treturn this._toEdges;\r\n\t}\r\n\r\n\tgetEdgeById(id: string) {\r\n\t\tconst edges = this.edges;\r\n\t\tconsole.log(edges);\r\n\t}\r\n\r\n\t/**\r\n\t * clear edge\r\n\t */\r\n\tclearEdge() {\r\n\t\tthis._fromEdges.clear();\r\n\t\tthis._toEdges.clear();\r\n\t\tthis._edges.clear();\r\n\t}\r\n}\r\n","import geom2 from \"@jscad/modeling/src/geometries/geom2\";\r\nimport path2 from \"@jscad/modeling/src/geometries/path2\";\r\nimport { Vec2 } from \"@jscad/modeling/src/maths/types\";\r\nimport { offset } from \"@jscad/modeling/src/operations/expansions\";\r\nimport { hull } from \"@jscad/modeling/src/operations/hulls\";\r\nimport { mat2d, vec2 } from \"gl-matrix\";\r\nimport {\r\n\tBaseClientProps,\r\n\tBaseStyleProps,\r\n\tNodeProps,\r\n\tNode,\r\n\tSHAPE,\r\n\tUI2D,\r\n\tElementType,\r\n\tLayerType,\r\n} from \"../elements\";\r\nimport { Events } from \"../events\";\r\nimport { AABB, OBB } from \"../shapes\";\r\nimport { sortCCW } from \"../utils\";\r\nimport { Vertex } from \"./Vertex\";\r\n\r\n/**\r\n * Shape object props\r\n */\r\nexport interface EdgeProps<StyleProps = any, ClientProps = any>\r\n\textends NodeProps<StyleProps, ClientProps> {\r\n\tfrom: Vertex;\r\n\tto: Vertex;\r\n}\r\n\r\n/**\r\n * Line object: Line\r\n */\r\nexport class Edge<\r\n\tStyleProps extends BaseStyleProps = any,\r\n\tClientProps extends BaseClientProps = any\r\n\t> extends Node<StyleProps, ClientProps> {\r\n\t_from?: Vertex;\r\n\t_to?: Vertex;\r\n\tconstructor(props?: EdgeProps<StyleProps, ClientProps>) {\r\n\t\tsuper({\r\n\t\t\ttype: SHAPE.Edge,\r\n\t\t\t...props,\r\n\t\t\tstyles: {\r\n\t\t\t\tzIndex: LayerType.BottomZIndex,\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.ui2d = UI2D.EdgeUI;\r\n\t\tthis.from = props?.from;\r\n\t\tthis.to = props?.to;\r\n\t\tthis._updatePoints();\r\n\t\tthis._updateSize();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\t_updatePoints() {\r\n\t\tconst from = this._from,\r\n\t\t\tto = this._to;\r\n\t\tif (!from || !to) return;\r\n\t\tconst points = [from.center, to.center];\r\n\t\tif (this.angle !== 0) {\r\n\t\t\tconst matrix = this._angleToMatrix();\r\n\t\t\tthis._matrix = matrix;\r\n\t\t\tconst newPoints: number[][] = [];\r\n\t\t\tfor (let i = 0, n = points.length; i < n; i++) {\r\n\t\t\t\tconst out = vec2.create();\r\n\t\t\t\tconst point = points[i];\r\n\t\t\t\tconst pp = vec2.transformMat2d(\r\n\t\t\t\t\tout,\r\n\t\t\t\t\tvec2.fromValues(point[0], point[1]),\r\n\t\t\t\t\tmat2d.clone(matrix)\r\n\t\t\t\t);\r\n\t\t\t\tnewPoints[i] = [pp[0], pp[1]];\r\n\t\t\t}\r\n\t\t\tthis._points = newPoints;\r\n\t\t} else {\r\n\t\t\tthis._points = points;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @returns\r\n\t */\r\n\tpublic getCenter() {\r\n\t\tconst aabb = this.getAABB();\r\n\t\treturn {\r\n\t\t\tx: aabb.x + aabb.width / 2,\r\n\t\t\ty: aabb.y + aabb.height / 2,\r\n\t\t};\r\n\t}\r\n\r\n\ttranslation(dx: number, dy: number) {\r\n\t\t// const oldValue = this._points;\r\n\t\t// const points: number[][] = [];\r\n\t\t// oldValue.forEach((old: number[]) => {\r\n\t\t// \tpoints.push([old[0] + dx, old[1] + dy]);\r\n\t\t// });\r\n\t\t// this._from[0] += dx;\r\n\t\t// this._from[1] += dy;\r\n\t\t// this._to[0] += dx;\r\n\t\t// this._to[1] += dy;\r\n\t\t// this._points = points;\r\n\t\t// const bounds = AABB.fromPoints(this._points);\r\n\t\t// this.x = bounds.x + bounds.width / 2;\r\n\t\t// this.y = bounds.y + bounds.height / 2;\r\n\t\t// this.center = [this.x, this.y];\r\n\t\t// const matrix = this._angleToMatrix();\r\n\t\t// this._matrix = matrix;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param padding\r\n\t * @returns\r\n\t */\r\n\tpublic getHitArea(\r\n\t\tpadding?:\r\n\t\t\t| number\r\n\t\t\t| { top: number; right: number; bottom: number; left: number }\r\n\t): number[][] {\r\n\t\tthis._aabb = this.getAABB();\r\n\t\tconst matrix = this._matrix;\r\n\t\tconst points: number[][] = [];\r\n\t\tthis._points.map((point: any) => {\r\n\t\t\tconst out = vec2.create();\r\n\t\t\tconst pp = vec2.transformMat2d(\r\n\t\t\t\tout,\r\n\t\t\t\tvec2.fromValues(point[0], point[1]),\r\n\t\t\t\tmat2d.clone(matrix)\r\n\t\t\t);\r\n\t\t\tpoints.push([pp[0], pp[1]]);\r\n\t\t});\r\n\t\tconst obb = new OBB(points);\r\n\t\tthis._obb = obb;\r\n\t\tif (padding) {\r\n\t\t\tif (padding && typeof padding === \"number\") {\r\n\t\t\t\tif (points.length < 2) return [];\r\n\t\t\t\tconst result: number[][] = [];\r\n\t\t\t\tlet linePath2 = path2.fromPoints(\r\n\t\t\t\t\t{ closed: false },\r\n\t\t\t\t\tpoints as Vec2[]\r\n\t\t\t\t);\r\n\t\t\t\tlet offsetLinePath1 = offset(\r\n\t\t\t\t\t{ delta: padding, corners: \"edge\", segments: 8 },\r\n\t\t\t\t\tlinePath2\r\n\t\t\t\t);\r\n\t\t\t\tlet offsetPoints1 = path2.toPoints(offsetLinePath1);\r\n\t\t\t\toffsetPoints1.forEach((point: number[]) => {\r\n\t\t\t\t\tresult.push([point[0], point[1]]);\r\n\t\t\t\t});\r\n\t\t\t\tlet offsetLinePath2 = offset(\r\n\t\t\t\t\t{ delta: -padding, corners: \"edge\", segments: 8 },\r\n\t\t\t\t\tlinePath2\r\n\t\t\t\t);\r\n\t\t\t\tlet offsetPoints2 = path2.toPoints(offsetLinePath2);\r\n\t\t\t\toffsetPoints2.forEach((point: number[]) => {\r\n\t\t\t\t\tresult.push([point[0], point[1]]);\r\n\t\t\t\t});\r\n\t\t\t\tif (result.length === 4) {\r\n\t\t\t\t\tconst geometry = hull(geom2.fromPoints(result as Vec2[]));\r\n\t\t\t\t\tconst hullPoints = geom2.toPoints(geometry);\r\n\t\t\t\t\treturn hullPoints;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn sortCCW(result);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [];\r\n\t}\r\n\r\n\tset from(vertex: Vertex | undefined) {\r\n\t\tif (!vertex) return;\r\n\t\tconst oldValue = this._from;\r\n\t\tthis._from = vertex;\r\n\t\tconst newValue = vertex;\r\n\t\tvertex.addToEdge(this);\r\n\t\tthis._updatePoints();\r\n\t\tthis._updateSize();\r\n\t\tthis.emit(Events.AttributeChange, {\r\n\t\t\tsource: this,\r\n\t\t\tprops: \"_from\",\r\n\t\t\toldValue,\r\n\t\t\tnewValue,\r\n\t\t});\r\n\t}\r\n\r\n\tget from(): Vertex | undefined {\r\n\t\treturn this._from;\r\n\t}\r\n\r\n\tset to(vertex: Vertex | undefined) {\r\n\t\tif (!vertex) return;\r\n\t\tconst oldValue = this._to;\r\n\t\tthis._to = vertex;\r\n\t\tvertex.addFromEdge(this);\r\n\t\tconst newValue = vertex;\r\n\t\tthis._updatePoints();\r\n\t\tthis._updateSize();\r\n\t\tthis.emit(Events.AttributeChange, {\r\n\t\t\tsource: this,\r\n\t\t\tprops: \"_to\",\r\n\t\t\toldValue,\r\n\t\t\tnewValue,\r\n\t\t});\r\n\t}\r\n\r\n\tget to(): Vertex | undefined {\r\n\t\treturn this._to;\r\n\t}\r\n\r\n\tgetAlongPoints(delta: number = 0): {\r\n\t\tp0: number[];\r\n\t\tp1: number[];\r\n\t} {\r\n\t\tconst from = this._from,\r\n\t\t\tto = this._to;\r\n\t\tif (!from || !to)\r\n\t\t\treturn {\r\n\t\t\t\tp0: [0, 0],\r\n\t\t\t\tp1: [0, 0],\r\n\t\t\t};\r\n\t\t// const from = this._from,\r\n\t\t// \tto = this._to;\r\n\t\tconst p0 = from.center,\r\n\t\t\tp1 = to.center;\r\n\r\n\t\tconst v = vec2.fromValues(p1[0] - p0[0], p1[1] - p0[1]);\r\n\t\tconst tan = (p1[1] - p0[1]) / (p1[0] - p0[0]);\r\n\t\tconst direction = p1[0] - p0[0] > 0 ? 1 : -1;\r\n\t\treturn {\r\n\t\t\tp0: [p0[0] - direction * delta, p0[1] - direction * delta * tan],\r\n\t\t\tp1: [p1[0] + direction * delta, p1[1] + direction * delta * tan],\r\n\t\t};\r\n\t}\r\n\r\n\tprotected _updateSize() {\r\n\t\t// if (!this._points) return;\r\n\t\t// const bounds = AABB.fromPoints(this._points);\r\n\t\t// this.x = bounds.x + bounds.width / 2;\r\n\t\t// this.y = bounds.y + bounds.height / 2;\r\n\t\t// this.center = [this.x, this.y];\r\n\t\t// this.width = bounds.width;\r\n\t\t// this.height = bounds.height;\r\n\t\t// this.size = [bounds.width, bounds.height];\r\n\t\t// this._matrix = this._angleToMatrix(this.angle);\r\n\t\t// this._from = this._points[0];\r\n\t\t// this._to = this._points[1];\r\n\t}\r\n\r\n\tserialize() {\r\n\t\treturn {\r\n\t\t\tid: this._id,\r\n\t\t\ttype: this.type,\r\n\t\t\tname: this.name,\r\n\t\t\tname2: this.name2,\r\n\t\t\timage: this.image,\r\n\t\t\tpoints: this.points,\r\n\t\t\tsize: this.size,\r\n\t\t\tcenter: this.center,\r\n\t\t\tangle: this.angle,\r\n\t\t\tmode: ElementType.Show,\r\n\t\t\tmovable: this.movable,\r\n\t\t\tvisible: this.visible,\r\n\t\t\tselected: this.selected,\r\n\t\t\thovered: this.hovered,\r\n\t\t\tfrom: this._from,\r\n\t\t\tto: this._to,\r\n\t\t\tattributes: this.attributes,\r\n\t\t\tgeometries: {},\r\n\t\t\tclients: this._clients,\r\n\t\t\tstyles: this._styles,\r\n\t\t};\r\n\t}\r\n}\r\n","import geom2 from \"@jscad/modeling/src/geometries/geom2\";\r\nimport path2 from \"@jscad/modeling/src/geometries/path2\";\r\nimport { Vec2 } from \"@jscad/modeling/src/maths/types\";\r\nimport { expand } from \"@jscad/modeling/src/operations/expansions\";\r\nimport { hull } from \"@jscad/modeling/src/operations/hulls\";\r\nimport {\r\n\tBaseClientProps,\r\n\tBaseStyleProps,\r\n\tShape,\r\n\tSHAPE,\r\n\tShapeProps,\r\n\tUI2D,\r\n\tElement,\r\n\tLayerType,\r\n} from \"../elements\";\r\n\r\n/**\r\n * Shape object props\r\n */\r\nexport interface GroupProps<StyleProps = any, ClientProps = any>\r\n\textends ShapeProps { }\r\n\r\n/**\r\n * Shape object: Shape\r\n */\r\nexport class Group<\r\n\tStyleProps extends BaseStyleProps = any,\r\n\tClientProps extends BaseClientProps = any\r\n\t> extends Shape<StyleProps, ClientProps> {\r\n\tconstructor(props?: GroupProps<StyleProps, ClientProps>) {\r\n\t\tsuper({\r\n\t\t\ttype: SHAPE.Group,\r\n\t\t\t...props,\r\n\t\t});\r\n\t\tthis.ui2d = UI2D.GroupUI;\r\n\t}\r\n\r\n\tpublic get points(): number[][] {\r\n\t\tconst children = this._children;\r\n\t\tlet points: number[][] = [];\r\n\t\tchildren.forEach((child: Element) => {\r\n\t\t\tpoints.push(child.center);\r\n\t\t});\r\n\t\tif (points.length >= 3) {\r\n\t\t\tconst geometry1 = geom2.fromPoints(points as Vec2[]);\r\n\t\t\tconst geometry2 = hull(geometry1);\r\n\t\t\tconst hullPoints = geom2.toPoints(geometry2);\r\n\t\t\tconst linePath2 = path2.fromPoints(\r\n\t\t\t\t{ closed: false },\r\n\t\t\t\tpoints as Vec2[]\r\n\t\t\t);\r\n\t\t\tconst expandedPathGeom2 = expand(\r\n\t\t\t\t{ delta: 20, corners: \"round\", segments: 20 },\r\n\t\t\t\tlinePath2\r\n\t\t\t);\r\n\t\t\tconst expandedPoints = geom2.toPoints(expandedPathGeom2);\r\n\t\t\tconst result: number[][] = [];\r\n\t\t\texpandedPoints.forEach((point: number[]) => {\r\n\t\t\t\tresult.push([point[0], point[1]]);\r\n\t\t\t});\r\n\t\t\tthis._points = result;\r\n\t\t} else {\r\n\t\t\tthis._points = points;\r\n\t\t}\r\n\t\treturn this._points;\r\n\t}\r\n}\r\n","import { mat2d, vec2 } from \"gl-matrix\";\r\nimport {\r\n\tGraphics,\r\n\tInteractionEvent,\r\n\tMatrix,\r\n\tPoint,\r\n\tPolygon,\r\n\tRAD_TO_DEG,\r\n\tRectangle,\r\n\tText,\r\n} from \"pixi.js\";\r\nimport { Element, Node, SHAPE, Shape, ShapeLine } from \"@blood4/modeling\";\r\nimport { PixiRenderer } from \"../../PixiRenderer\";\r\nimport { UI } from \"../../ui\";\r\nimport { DefaultInteraction } from \"../../interaction/DefaultInteraction\";\r\nimport { InteractionEvents } from \"../../events\";\r\n\r\n// resize direction\r\nexport enum ResizeDirectionType {\r\n\tCenter = \"Center\",\r\n\tTop = \"Top\",\r\n\tBottom = \"Bottom\",\r\n\tLeft = \"Left\",\r\n\tRight = \"Right\",\r\n\tTopLeft = \"TopLeft\",\r\n\tTopRight = \"TopRight\",\r\n\tBottomLeft = \"BottomLeft\",\r\n\tBottomRight = \"BottomRight\",\r\n}\r\n\r\nconst _directionsMap = new Map();\r\n_directionsMap.set(\"0.5\", ResizeDirectionType.Top);\r\n_directionsMap.set(\"1.5\", ResizeDirectionType.Right);\r\n_directionsMap.set(\"2.5\", ResizeDirectionType.Bottom);\r\n_directionsMap.set(\"3.5\", ResizeDirectionType.Left);\r\n_directionsMap.set(\"0\", ResizeDirectionType.TopLeft);\r\n_directionsMap.set(\"1\", ResizeDirectionType.TopRight);\r\n_directionsMap.set(\"2\", ResizeDirectionType.BottomRight);\r\n_directionsMap.set(\"3\", ResizeDirectionType.BottomLeft);\r\n\r\nexport class DragSpot extends Graphics {\r\n\tprotected _element: Element;\r\n\tprotected _index: number;\r\n\tprotected _angle: number;\r\n\tprotected _shape: string = \"roundedRect\";\r\n\tprotected _renderer: PixiRenderer<any>;\r\n\tprotected _center: number[] = [0, 0];\r\n\tprotected _points?: number[][];\r\n\tprotected _fillColor = 0xcdcdcd;\r\n\tprotected _text?: Text;\r\n\tmode: string = \"resize\"; // resize , scale, point\r\n\r\n\t_mousedownEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseupEvent!: (evt: InteractionEvent) => void;\r\n\t_mousemoveEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseoutEvent!: (evt: InteractionEvent) => void;\r\n\r\n\t_hitTarget?: UI;\r\n\t_isDragging = false;\r\n\t_mousePoint?: Point = undefined;\r\n\t_ctrlDown: boolean = false;\r\n\t_doubleClickedTimeout: NodeJS.Timeout | null = null;\r\n\t_originSize?: number[];\r\n\t_originCenter?: number[];\r\n\r\n\tconstructor(\r\n\t\telement: Element,\r\n\t\trenderer: PixiRenderer<any>,\r\n\t\tcenter: number[],\r\n\t\tindex: number,\r\n\t\tangle: number = 0,\r\n\t\tshape: string = \"roundedRect\" // circle\r\n\t) {\r\n\t\tsuper();\r\n\t\tthis._zIndex = 999;\r\n\t\tthis._element = element;\r\n\t\tthis._renderer = renderer;\r\n\t\tthis._center = center;\r\n\t\tthis._index = index;\r\n\t\tthis._angle = angle;\r\n\t\tthis._shape = shape;\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t\tthis.interactive = true;\r\n\t\tthis.buttonMode = true;\r\n\r\n\t\tthis.mount();\r\n\t}\r\n\r\n\tpublic mount(): void {\r\n\t\t// console.log('drag spot mount');\r\n\t\tthis._mousedownEvent = this.handle_mousedown.bind(this);\r\n\t\tthis._mouseupEvent = this.handle_mouseup.bind(this);\r\n\t\tthis._mousemoveEvent = this.handle_mousemove.bind(this);\r\n\t\tthis._mouseoutEvent = this.handle_mouseout.bind(this);\r\n\t\tthis.on(\"mousedown\", this._mousedownEvent);\r\n\t\tthis.on(\"mouseup\", this._mouseupEvent);\r\n\t\t// this.on('mouseout', this._mouseoutEvent);\r\n\t\t// this.on('mousemove', this._mousemoveEvent);\r\n\t\tthis._text = new Text(\"Length: \", {\r\n\t\t\tfontFamily: \"PingFangSC-Regular, PingFang SC\",\r\n\t\t\tfontSize: 6,\r\n\t\t\tfill: 0x000000,\r\n\t\t\talign: \"center\",\r\n\t\t\tfontWeight: \"100\",\r\n\t\t});\r\n\r\n\t\tthis._text.resolution = 2;\r\n\t\tthis._text.anchor.set(this._element.x || 0, this._element.y || 0);\r\n\t\tthis._text.text = `${this._index}-${this._angle}`;\r\n\t\tthis._text.zIndex = 999;\r\n\t\t// this._text.angle = this._angle * RAD_TO_DEG;\r\n\t\t// this.addChild(this._text);\r\n\t}\r\n\r\n\tpublic unmount(): void {\r\n\t\t// console.log('drag spot unmount');\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tthis.off(\"mousedown\", this._mousedownEvent);\r\n\t\tthis.off(\"mouseup\", this._mouseupEvent);\r\n\t\tthis.off(\"mousemove\", this._mousemoveEvent);\r\n\t\tif (viewport) {\r\n\t\t\tviewport.off(\"mousemove\", this._mousemoveEvent);\r\n\t\t}\r\n\t\tthis.clear();\r\n\t\tif (this._text) {\r\n\t\t\tthis.removeChild(this._text);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * _invalidate\r\n\t */\r\n\tpublic _invalidate(): void {\r\n\t\t// console.log('_invalidate');\r\n\t\t// this.unmount();\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * validate\r\n\t */\r\n\tpublic _validate(): void {\r\n\t\t// console.log('_validate');\r\n\t\tthis._updateStyles();\r\n\t\tthis._validateImpl();\r\n\t}\r\n\r\n\tprotected _validateImpl(): void {\r\n\t\tthis._draw();\r\n\t}\r\n\r\n\t/**\r\n\t * update Styles\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tthis.visible = element.selected;\r\n\t\tif (\r\n\t\t\telement.type === SHAPE.AlignLine ||\r\n\t\t\telement.type === SHAPE.Line ||\r\n\t\t\telement.type === SHAPE.ShapeLine\r\n\t\t) {\r\n\t\t\tthis.cursor = \"move\";\r\n\t\t\tconst center = this._center,\r\n\t\t\t\tscaled = this._renderer.getScaled();\r\n\t\t\tlet size = ((scaled < 1 ? 6 / scaled : 6) * 1.5) / 2;\r\n\t\t\tconst path: number[] = [\r\n\t\t\t\tcenter[0] - size,\r\n\t\t\t\tcenter[1] - size,\r\n\t\t\t\tcenter[0] - size,\r\n\t\t\t\tcenter[1] + size,\r\n\t\t\t\tcenter[0] + size,\r\n\t\t\t\tcenter[1] + size,\r\n\t\t\t\tcenter[0] + size,\r\n\t\t\t\tcenter[1] - size,\r\n\t\t\t];\r\n\t\t\tthis.hitArea = new Polygon(path);\r\n\t\t} else if (element.type === SHAPE.Domain) {\r\n\t\t\tif (this._text) {\r\n\t\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\t\tthis._text.getLocalBounds(rect);\r\n\t\t\t\tthis._text.x = this._center[0];\r\n\t\t\t\tthis._text.y = this._center[1];\r\n\t\t\t\tthis._text.anchor.set(0.5, 0.5);\r\n\t\t\t\tthis._text.text = `${this._index}-${(\r\n\t\t\t\t\tthis._angle * RAD_TO_DEG\r\n\t\t\t\t).toFixed(0)}`;\r\n\t\t\t\t// this._text.angle = this._angle * RAD_TO_DEG;\r\n\t\t\t\t// this.x = this._center[0];\r\n\t\t\t\t// this.y = this._center[1];\r\n\t\t\t}\r\n\t\t\tif (this.mode === \"resize\") {\r\n\t\t\t\tconst angle = this._angle * RAD_TO_DEG;\r\n\t\t\t\tif (angle >= 0 && angle <= 15) {\r\n\t\t\t\t\tthis.cursor = \"ns-resize\";\r\n\t\t\t\t} else if (angle > 15 && angle <= 75) {\r\n\t\t\t\t\tthis.cursor = \"nesw-resize\";\r\n\t\t\t\t} else if (angle > 75 && angle <= 90) {\r\n\t\t\t\t\tthis.cursor = \"ew-resize\";\r\n\t\t\t\t} else if (angle > -90 && angle <= -75) {\r\n\t\t\t\t\tthis.cursor = \"ew-resize\";\r\n\t\t\t\t} else if (angle > -75 && angle <= -15) {\r\n\t\t\t\t\tthis.cursor = \"nwse-resize\";\r\n\t\t\t\t} else if (angle > -15 && angle <= 0) {\r\n\t\t\t\t\tthis.cursor = \"ns-resize\";\r\n\t\t\t\t}\r\n\t\t\t} else if (this.mode === \"scale\") {\r\n\t\t\t\tconst index = this._index;\r\n\t\t\t\tif (index === 0) {\r\n\t\t\t\t\tthis.cursor = \"nwse-resize\";\r\n\t\t\t\t} else if (index === 1) {\r\n\t\t\t\t\tthis.cursor = \"nesw-resize\";\r\n\t\t\t\t} else if (index === 2) {\r\n\t\t\t\t\tthis.cursor = \"nwse-resize\";\r\n\t\t\t\t} else if (index === 3) {\r\n\t\t\t\t\tthis.cursor = \"nesw-resize\";\r\n\t\t\t\t} else if (index === 0.5) {\r\n\t\t\t\t\tthis.cursor = \"ns-resize\";\r\n\t\t\t\t} else if (index === 0.5 || index === 2.5) {\r\n\t\t\t\t\tthis.cursor = \"ns-resize\";\r\n\t\t\t\t} else if (index === 1.5 || index === 3.5) {\r\n\t\t\t\t\tthis.cursor = \"ew-resize\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _draw() {\r\n\t\tthis.clear();\r\n\t\tthis._drawBody();\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tpublic _drawBody(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tif (!element.selected) return;\r\n\t\tconst angle = this._angle;\r\n\t\tconst center = this._center;\r\n\t\tconst a = Math.sin(angle);\r\n\t\tconst b = Math.cos(angle);\r\n\t\tconst tx = center[0] * (1 - b) + center[1] * a;\r\n\t\tconst ty = center[1] * (1 - b) - center[0] * a;\r\n\t\tconst matrix = mat2d.fromValues(b, a, -a, b, tx, ty);\r\n\t\tthis.setMatrix(\r\n\t\t\tnew Matrix(\r\n\t\t\t\tmatrix[0],\r\n\t\t\t\tmatrix[1],\r\n\t\t\t\tmatrix[2],\r\n\t\t\t\tmatrix[3],\r\n\t\t\t\tmatrix[4],\r\n\t\t\t\tmatrix[5]\r\n\t\t\t)\r\n\t\t);\r\n\t\tconst scaled = this._renderer.getScaled();\r\n\r\n\t\tlet size = scaled < 1 ? 6 / scaled : 6;\r\n\t\tswitch (this._shape) {\r\n\t\t\tcase \"rect\":\r\n\t\t\t\tthis.lineStyle(0.6, 0x000000, 0.25);\r\n\t\t\t\tthis.beginFill(0xffffff, 1.0);\r\n\t\t\t\tthis.drawRect(\r\n\t\t\t\t\tthis._center[0] - size / 2,\r\n\t\t\t\t\tthis._center[1] - size / 2,\r\n\t\t\t\t\tsize,\r\n\t\t\t\t\tsize\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"circle\":\r\n\t\t\t\tif (this._hitTarget) {\r\n\t\t\t\t\tsize = scaled < 1 ? 3 / scaled : 3;\r\n\t\t\t\t\tthis.lineStyle(1.5, 0x737373, 1.0);\r\n\t\t\t\t\tthis.beginFill(0xffffff, 1.0);\r\n\t\t\t\t\tthis.drawCircle(this._center[0], this._center[1], size);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsize = scaled < 1 ? 2.5 / scaled : 2.5;\r\n\t\t\t\t\tthis.lineStyle(1, 0xa6a6a6, 1.0);\r\n\t\t\t\t\tthis.beginFill(0xffffff, 1.0);\r\n\t\t\t\t\tthis.drawCircle(this._center[0], this._center[1], size);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"roundedRect\":\r\n\t\t\t\tconst isEditable = this._renderer.isEditable(element);\r\n\t\t\t\tif (isEditable) {\r\n\t\t\t\t\tthis.lineStyle(0.6, 0x000000, 0.25);\r\n\t\t\t\t\tthis.beginFill(0xffffff, 1.0);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.lineStyle(0.6, 0xcdcdcd, 0.25);\r\n\t\t\t\t\tthis.beginFill(0xcdcdcd, 1.0);\r\n\t\t\t\t}\r\n\t\t\t\tthis.drawRoundedRect(\r\n\t\t\t\t\tthis._center[0] - size / 2,\r\n\t\t\t\t\tthis._center[1] - size / 2,\r\n\t\t\t\t\tsize,\r\n\t\t\t\t\tsize,\r\n\t\t\t\t\t1\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.endFill();\r\n\t\tthis.setMatrix(new Matrix());\r\n\t\t/* const bounds = this.getLocalBounds();\r\n\t\tthis.lineStyle(1.0, 0xff0000, 1.0);\r\n\t\tthis.beginFill(0xff0000, 1.0);\r\n\t\tthis.drawRect(bounds.x, bounds.y, bounds.width, bounds.height);\r\n\t\tthis.endFill(); */\r\n\t}\r\n\r\n\t/**\r\n\t * set fill color\r\n\t */\r\n\tpublic set fillColor(color: number) {\r\n\t\tthis._fillColor = color;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tpublic set center(center: number[]) {\r\n\t\tthis._center = center;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tpublic setAngle(angle: number) {\r\n\t\tthis._angle = angle;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tpublic set points(points: number[][]) {\r\n\t\tthis._points = points;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tpublic update() {\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t}\r\n\r\n\t/**\r\n\t * handle zoomed\r\n\t * @param e\r\n\t */\r\n\thandle_zoomed(evt: InteractionEvent) { }\r\n\r\n\t/**\r\n\t * handle panned\r\n\t * @param e\r\n\t */\r\n\thandle_panned(evt: InteractionEvent) { }\r\n\r\n\tisCtrlDown(evt: KeyboardEvent) {\r\n\t\treturn evt.ctrlKey || evt.metaKey;\r\n\t}\r\n\r\n\t/**\r\n\t * mouse down\r\n\t * @param e\r\n\t */\r\n\thandle_mousedown(evt: InteractionEvent): void {\r\n\t\tevt.stopPropagation();\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tconst hitTarget = renderer.renderer.plugins.interaction.hitTest(\r\n\t\t\tevt.data.global\r\n\t\t);\r\n\t\tthis._hitTarget = hitTarget;\r\n\t\tif (hitTarget instanceof DragSpot) {\r\n\t\t\tthis.__dragStart(evt);\r\n\t\t\tviewport.on(\"mousemove\", this._mousemoveEvent);\r\n\t\t\tviewport.on(\"mouseout\", this._mouseoutEvent);\r\n\t\t\tevt.stopPropagation();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * mouse up\r\n\t * @param e\r\n\t */\r\n\thandle_mouseup(evt: InteractionEvent): void {\r\n\t\t// console.log('handle_mouseup');\r\n\t\tthis.__dragEnd(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * mouse move\r\n\t * @param e\r\n\t */\r\n\thandle_mousemove(evt: InteractionEvent): void {\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tthis.__dragMove(evt);\r\n\t\tevt.stopPropagation();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseout(evt: InteractionEvent): void {\r\n\t\tthis.__dragEnd(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * drag start\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragStart(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (this._isDragging) return;\r\n\t\tif (hitTarget instanceof DragSpot) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param p\r\n\t * @param center\r\n\t * @param angle\r\n\t * @returns\r\n\t */\r\n\tprivate _reversPoint(\r\n\t\tp: number[],\r\n\t\tcenter: number[],\r\n\t\tangle: number\r\n\t): number[] {\r\n\t\tangle *= -1;\r\n\t\tlet cos = Math.cos((angle * Math.PI) / 180);\r\n\t\tlet sin = Math.sin((angle * Math.PI) / 180);\r\n\t\tlet x = p[0] - center[0];\r\n\t\tlet y = p[1] - center[1];\r\n\r\n\t\tlet newX = x * cos - y * sin;\r\n\t\tlet newY = x * sin + y * cos;\r\n\r\n\t\tp[0] = newX + center[0];\r\n\t\tp[1] = newY + center[1];\r\n\t\treturn p;\r\n\t}\r\n\r\n\t/**\r\n\t * drag Move\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragMove(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tif (!hitTarget || !hitTarget.parent) return;\r\n\t\tconst position = evt.data.getLocalPosition(hitTarget.parent);\r\n\t\tif (!this._isDragging && this._mousePoint) {\r\n\t\t\tif (\r\n\t\t\t\tMath.abs(position.x - this._mousePoint.x) >= 0.1 ||\r\n\t\t\t\tMath.abs(position.y - this._mousePoint.y) >= 0.1\r\n\t\t\t) {\r\n\t\t\t\tconst element = hitTarget._element;\r\n\t\t\t\tconst interactionManager = this._renderer.interactionManager;\r\n\t\t\t\tconst currentInteraction =\r\n\t\t\t\t\tinteractionManager.getCurrentInteraction();\r\n\t\t\t\tconst renderer = this._renderer;\r\n\t\t\t\tconst viewport = renderer.viewport;\r\n\t\t\t\tif (!renderer || !viewport) return;\r\n\t\t\t\tconst isEditable = renderer.isEditable(element);\r\n\t\t\t\tif (isEditable) {\r\n\t\t\t\t\tthis._isDragging = true;\r\n\t\t\t\t\tthis._originSize = [element.width, element.height];\r\n\t\t\t\t\tthis._originCenter = [element.x, element.y];\r\n\t\t\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\t\t\tif (currentInteraction instanceof DefaultInteraction) {\r\n\t\t\t\t\t\tcurrentInteraction.emit(InteractionEvents.ResizeStart, {\r\n\t\t\t\t\t\t\tsource: this,\r\n\t\t\t\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\t\t\t\tindex: this._index,\r\n\t\t\t\t\t\t\tposition: [position.x, position.y],\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (currentInteraction instanceof DefaultInteraction) {\r\n\t\t\t\t\t\tcurrentInteraction.emit(\r\n\t\t\t\t\t\t\tInteractionEvents.UnableResize,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tsource: this,\r\n\t\t\t\t\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!this._isDragging || !this._mousePoint) return;\r\n\t\tif (this.mode === \"resize\") {\r\n\t\t\tthis._handleResize(evt);\r\n\t\t} else if (this.mode === \"scale\") {\r\n\t\t\tthis._handleScale(evt);\r\n\t\t}\r\n\t}\r\n\r\n\t_handleResize(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\t// console.log('DragSpot __dragMove');\r\n\t\tif (\r\n\t\t\t!hitTarget ||\r\n\t\t\t!this._originSize ||\r\n\t\t\t!this._originCenter ||\r\n\t\t\t!this._mousePoint\r\n\t\t)\r\n\t\t\treturn;\r\n\r\n\t\tconst element = hitTarget._element;\r\n\t\tif (element.type === SHAPE.Node) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tconst dx = position.x - this._mousePoint.x,\r\n\t\t\t\tdy = position.y - this._mousePoint.y;\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\r\n\t\t\tconst element = hitTarget._element;\r\n\t\t\tconst direction = _directionsMap.get(`${this._index}`);\r\n\t\t\tlet from =\r\n\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t? (element.points.length + this._index - 1) %\r\n\t\t\t\t\telement.points.length\r\n\t\t\t\t\t: (element.points.length + this._index - 0.5) %\r\n\t\t\t\t\telement.points.length,\r\n\t\t\t\tto =\r\n\t\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t\t? (element.points.length + this._index + 1) %\r\n\t\t\t\t\t\telement.points.length\r\n\t\t\t\t\t\t: (element.points.length + this._index + 0.5) %\r\n\t\t\t\t\t\telement.points.length,\r\n\t\t\t\tcurrent =\r\n\t\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t\t? this._index % element.points.length\r\n\t\t\t\t\t\t: (this._index + 0.5) % element.points.length;\r\n\r\n\t\t\tconst angle = element.angle;\r\n\t\t\tconst point = this._reversPoint(\r\n\t\t\t\t[position.x, position.y],\r\n\t\t\t\t[this._originCenter[0], this._originCenter[1]],\r\n\t\t\t\tangle\r\n\t\t\t);\r\n\t\t\tconst scaleX =\r\n\t\t\t\tMath.abs((point[0] - this._originCenter[0]) * 2) /\r\n\t\t\t\telement.width;\r\n\t\t\tconst scaleY =\r\n\t\t\t\tMath.abs((point[1] - this._originCenter[1]) * 2) /\r\n\t\t\t\telement.height;\r\n\r\n\t\t\tswitch (direction) {\r\n\t\t\t\tcase ResizeDirectionType.Right:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Bottom:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Left:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Top:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopRight:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomRight:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomLeft:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopLeft:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t// evt.stopPropagation();\r\n\t\t} else if (\r\n\t\t\telement.type === SHAPE.Shape ||\r\n\t\t\telement.type === SHAPE.Domain\r\n\t\t) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tconst dx = position.x - this._mousePoint.x,\r\n\t\t\t\tdy = position.y - this._mousePoint.y;\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\r\n\t\t\tconst element = hitTarget._element;\r\n\t\t\tlet from =\r\n\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t? (element.points.length + this._index - 1) %\r\n\t\t\t\t\telement.points.length\r\n\t\t\t\t\t: (element.points.length + this._index - 0.5) %\r\n\t\t\t\t\telement.points.length,\r\n\t\t\t\tto =\r\n\t\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t\t? (element.points.length + this._index + 1) %\r\n\t\t\t\t\t\telement.points.length\r\n\t\t\t\t\t\t: (element.points.length + this._index + 0.5) %\r\n\t\t\t\t\t\telement.points.length;\r\n\r\n\t\t\tconst fromPoint = element.points[from],\r\n\t\t\t\ttoPoint = element.points[to];\r\n\t\t\tconst a = vec2.fromValues(\r\n\t\t\t\tfromPoint[0] - toPoint[0],\r\n\t\t\t\tfromPoint[1] - toPoint[1]\r\n\t\t\t);\r\n\t\t\tlet b = vec2.fromValues(-a[1], a[0]);\r\n\t\t\tvec2.normalize(b, b);\r\n\t\t\tconst c = vec2.fromValues(dx, dy);\r\n\t\t\tconst d = vec2.dot(c, b);\r\n\t\t\tconst r = vec2.create();\r\n\t\t\tvec2.scale(r, b, d);\r\n\t\t\telement.translatePoint(\r\n\t\t\t\t[from, to],\r\n\t\t\t\t[\r\n\t\t\t\t\t[r[0], r[1]],\r\n\t\t\t\t\t[r[0], r[1]],\r\n\t\t\t\t]\r\n\t\t\t);\r\n\t\t\tif (!element.resizing) {\r\n\t\t\t\telement.resizing = true;\r\n\t\t\t}\r\n\t\t} else if (\r\n\t\t\telement.type === SHAPE.ShapeLine ||\r\n\t\t\telement.type === SHAPE.Line ||\r\n\t\t\telement.type === SHAPE.AlignLine\r\n\t\t) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tconst dx = position.x - this._mousePoint.x,\r\n\t\t\t\tdy = position.y - this._mousePoint.y;\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\t\tconst element = hitTarget._element;\r\n\t\t\telement.translatePoint([this._index], [[dx, dy]]);\r\n\t\t}\r\n\t\tconst interactionManager = renderer.interactionManager;\r\n\t\tconst current = interactionManager.getCurrentInteraction();\r\n\t\tif (current instanceof DefaultInteraction) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tcurrent.emit(InteractionEvents.Resizing, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\tindex: this._index,\r\n\t\t\t\tposition: [position.x, position.y],\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t_handleScale(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (!this._isDragging) return;\r\n\r\n\t\tif (\r\n\t\t\t!hitTarget ||\r\n\t\t\t!this._originSize ||\r\n\t\t\t!this._originCenter ||\r\n\t\t\t!this._mousePoint\r\n\t\t)\r\n\t\t\treturn;\r\n\t\tconst element = hitTarget._element;\r\n\r\n\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\tlet dx = position.x - this._mousePoint.x,\r\n\t\t\tdy = position.y - this._mousePoint.y;\r\n\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\tconst direction = _directionsMap.get(`${this._index}`);\r\n\t\tlet from =\r\n\t\t\tthis._index % 1 === 0\r\n\t\t\t\t? (element.points.length + this._index - 1) %\r\n\t\t\t\telement.points.length\r\n\t\t\t\t: (element.points.length + this._index - 0.5) %\r\n\t\t\t\telement.points.length,\r\n\t\t\tto =\r\n\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t? (element.points.length + this._index + 1) %\r\n\t\t\t\t\telement.points.length\r\n\t\t\t\t\t: (element.points.length + this._index + 0.5) %\r\n\t\t\t\t\telement.points.length,\r\n\t\t\tcurrent =\r\n\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t? this._index % element.points.length\r\n\t\t\t\t\t: (this._index + 0.5) % element.points.length;\r\n\t\t// const angle = element.angle;\r\n\t\t// const point = this._reversPoint(\r\n\t\t// \t[position.x, position.y],\r\n\t\t// \t[this._originCenter[0], this._originCenter[1]],\r\n\t\t// \tangle\r\n\t\t// );\r\n\r\n\t\tif (element instanceof Node) {\r\n\t\t\tswitch (direction) {\r\n\t\t\t\tcase ResizeDirectionType.Right:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Bottom:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Left:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Top:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopRight:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomRight:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomLeft:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopLeft:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t// evt.stopPropagation();\r\n\t\t} else if (element instanceof Shape) {\r\n\t\t\t// const origin = [\r\n\t\t\t// \tthis._originCenter[0] + this._originSize[0] / 2,\r\n\t\t\t// \tthis._originCenter[1] + this._originSize[1] / 2\r\n\t\t\t// ];\r\n\t\t\t// const distance = vec2.distance(\r\n\t\t\t// \tvec2.fromValues(position.x, position.y),\r\n\t\t\t// \tvec2.fromValues(origin[0], origin[1])\r\n\t\t\t// );\r\n\t\t\tlet size = element.size;\r\n\t\t\tlet diagonal = Math.sqrt(size[0] * size[0] + size[1] * size[1]),\r\n\t\t\t\tdiagonal3 = 1,\r\n\t\t\t\tscale = 1;\r\n\t\t\tswitch (direction) {\r\n\t\t\t\tcase ResizeDirectionType.Right:\r\n\t\t\t\t\tscale = (dx + size[0]) / size[0];\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.Left);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Bottom:\r\n\t\t\t\t\tscale = (dy + size[1]) / size[1];\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.Top);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Left:\r\n\t\t\t\t\tscale = (-dx + size[0]) / size[0];\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.Right);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Top:\r\n\t\t\t\t\tscale = (-dy + size[1]) / size[1];\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.Bottom);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopRight:\r\n\t\t\t\t\tdiagonal3 = Math.sqrt(\r\n\t\t\t\t\t\t(dx + size[0]) * (dx + size[0]) +\r\n\t\t\t\t\t\t(-dy + size[1]) * (-dy + size[1])\r\n\t\t\t\t\t);\r\n\t\t\t\t\tscale = diagonal3 / diagonal;\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.BottomLeft);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomRight:\r\n\t\t\t\t\tdiagonal3 = Math.sqrt(\r\n\t\t\t\t\t\t(dx + size[0]) * (dx + size[0]) +\r\n\t\t\t\t\t\t(dy + size[1]) * (dy + size[1])\r\n\t\t\t\t\t);\r\n\t\t\t\t\tscale = diagonal3 / diagonal;\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.TopLeft);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomLeft:\r\n\t\t\t\t\tdiagonal3 = Math.sqrt(\r\n\t\t\t\t\t\t(-dx + size[0]) * (-dx + size[0]) +\r\n\t\t\t\t\t\t(dy + size[1]) * (dy + size[1])\r\n\t\t\t\t\t);\r\n\t\t\t\t\tscale = diagonal3 / diagonal;\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.TopRight);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopLeft:\r\n\t\t\t\t\tdiagonal3 = Math.sqrt(\r\n\t\t\t\t\t\t(-dx + size[0]) * (-dx + size[0]) +\r\n\t\t\t\t\t\t(-dy + size[1]) * (-dy + size[1])\r\n\t\t\t\t\t);\r\n\t\t\t\t\tscale = diagonal3 / diagonal;\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.BottomRight);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (!element.resizing) {\r\n\t\t\t\telement.resizing = true;\r\n\t\t\t}\r\n\t\t} else if (element instanceof ShapeLine) {\r\n\t\t}\r\n\t\tconst interactionManager = renderer.interactionManager;\r\n\t\tconst currentInteraction = interactionManager.getCurrentInteraction();\r\n\t\tif (currentInteraction instanceof DefaultInteraction) {\r\n\t\t\tcurrentInteraction.emit(InteractionEvents.Resizing, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * drag End\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragEnd(evt: InteractionEvent) {\r\n\t\tif (this._isDragging) {\r\n\t\t\tthis._isDragging = false;\r\n\t\t\tthis._originSize = undefined;\r\n\t\t\tthis._originCenter = undefined;\r\n\t\t\tthis.off(\"mousemove\", this._mousemoveEvent);\r\n\t\t\t// evt.stopPropagation();\r\n\t\t\tconst hitTarget = this._hitTarget;\r\n\t\t\tconst renderer = this._renderer;\r\n\t\t\tconst viewport = renderer.viewport;\r\n\t\t\tif (!viewport || !renderer) return;\r\n\t\t\tif (hitTarget && hitTarget._element) {\r\n\t\t\t\thitTarget._element.resizing = false;\r\n\t\t\t\tconst interactionManager = this._renderer.interactionManager;\r\n\t\t\t\tconst currentInteraction =\r\n\t\t\t\t\tinteractionManager.getCurrentInteraction();\r\n\t\t\t\tif (currentInteraction instanceof DefaultInteraction) {\r\n\t\t\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\t\t\tcurrentInteraction.emit(InteractionEvents.ResizeEnd, {\r\n\t\t\t\t\t\tsource: this,\r\n\t\t\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\t\t\tindex: this._index,\r\n\t\t\t\t\t\tposition: [position.x, position.y],\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._mousePoint = undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * key down event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keydown(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keyup(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t}\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_contextmenu(e: any): void {\r\n\t\te.preventDefault();\r\n\t\tthis.__dragEnd(e);\r\n\t}\r\n\r\n\tprotected translate(dx: number, dy: number) {\r\n\t\tthis._center[0] += dx;\r\n\t\tthis._center[1] += dy;\r\n\t\tthis.update();\r\n\t}\r\n}\r\n","import * as PIXI from \"pixi.js\";\r\nimport { GridOptions } from \"./type\";\r\n\r\n/**\r\n * Ruled graph paper, PIXI.Sprite instance able to be\r\n * added to the display list via `addChild()`.\r\n */\r\nexport class Grid extends PIXI.Sprite {\r\n\tprivate _dirty: boolean = true;\r\n\tprivate _backgroundFillAlpha: number = 1;\r\n\tprivate _backgroundFillColor: number = 0x0;\r\n\tprivate _backgroundVisible: boolean = false;\r\n\tprivate _graphHeight: number = 1000;\r\n\tprivate _graphWidth: number = 1000;\r\n\tprivate _intermediateGridSize: number = 50;\r\n\tprivate _intermediateGridVisible: boolean = true;\r\n\tprivate _intermediateStrokeAlpha: number = 1.0;\r\n\tprivate _intermediateStrokeColor: number = 0x313131;\r\n\tprivate _intermediateStrokeWeight: number = 1;\r\n\tprivate _majorGridSize: number = 100;\r\n\tprivate _majorGridVisible: boolean = true;\r\n\tprivate _majorStrokeAlpha: number = 1.0;\r\n\tprivate _majorStrokeColor: number = 0x424242;\r\n\tprivate _majorStrokeWeight: number = 2;\r\n\tprivate _minorGridSize: number = 10;\r\n\tprivate _minorGridVisible: boolean = true;\r\n\tprivate _minorStrokeAlpha: number = 1.0;\r\n\tprivate _minorStrokeColor: number = 0x2a2a2a;\r\n\tprivate _minorStrokeWeight: number = 0.25;\r\n\tprivate readonly _graphics: PIXI.Graphics;\r\n\tprivate _reflines: any[] = [];\r\n\r\n\t//------------------------------\r\n\t//  properties\r\n\t//------------------------------\r\n\r\n\t/**\r\n\t * Opacity of the background fill, if `backgroundVisible` is set to `true`.\r\n\t */\r\n\tpublic get backgroundFillAlpha(): number {\r\n\t\treturn this._backgroundFillAlpha;\r\n\t}\r\n\r\n\tpublic set backgroundFillAlpha(value) {\r\n\t\tif (this._backgroundFillAlpha === value) return;\r\n\r\n\t\tthis._backgroundFillAlpha = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Color the background, if `backgroundVisible` is set to `true`.\r\n\t */\r\n\tpublic get backgroundFillColor(): number {\r\n\t\treturn this._backgroundFillColor;\r\n\t}\r\n\r\n\tpublic set backgroundFillColor(value) {\r\n\t\tif (this._backgroundFillColor === value) return;\r\n\r\n\t\tthis._backgroundFillColor = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Whether background is visible.\r\n\t */\r\n\tpublic get backgroundVisible(): boolean {\r\n\t\treturn this._backgroundVisible;\r\n\t}\r\n\r\n\tpublic set backgroundVisible(value) {\r\n\t\tif (this._backgroundVisible === value) return;\r\n\r\n\t\tthis._backgroundVisible = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Height of the graph, in pixels.\r\n\t */\r\n\tpublic get graphHeight(): number {\r\n\t\treturn this._graphHeight;\r\n\t}\r\n\r\n\tpublic set graphHeight(value) {\r\n\t\tif (this._graphHeight === value) return;\r\n\r\n\t\tthis._graphHeight = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Width of the graph, in pixels.\r\n\t */\r\n\tpublic get graphWidth(): number {\r\n\t\treturn this._graphWidth;\r\n\t}\r\n\r\n\tpublic set graphWidth(value) {\r\n\t\tif (this._graphWidth === value) return;\r\n\r\n\t\tthis._graphWidth = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Grid size of intermediate lines between major and minor rules.\r\n\t */\r\n\tpublic get intermediateGridSize(): number {\r\n\t\treturn this._intermediateGridSize;\r\n\t}\r\n\r\n\tpublic set intermediateGridSize(value) {\r\n\t\tif (this._intermediateGridSize === value) return;\r\n\r\n\t\tthis._intermediateGridSize = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Whether intermediate grid rule is visible.\r\n\t */\r\n\tpublic get intermediateGridVisible(): boolean {\r\n\t\treturn this._intermediateGridVisible;\r\n\t}\r\n\r\n\tpublic set intermediateGridVisible(value) {\r\n\t\tif (this._intermediateGridVisible === value) return;\r\n\r\n\t\tthis._intermediateGridVisible = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Opacity of intermediate rule stroke.\r\n\t */\r\n\tpublic get intermediateStrokeAlpha(): number {\r\n\t\treturn this._intermediateStrokeAlpha;\r\n\t}\r\n\r\n\tpublic set intermediateStrokeAlpha(value) {\r\n\t\tif (this._intermediateStrokeAlpha === value) return;\r\n\r\n\t\tthis._intermediateStrokeAlpha = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Color of intermediate rule stroke.\r\n\t */\r\n\tpublic get intermediateStrokeColor(): number {\r\n\t\treturn this._intermediateStrokeColor;\r\n\t}\r\n\r\n\tpublic set intermediateStrokeColor(value) {\r\n\t\tif (this._intermediateStrokeColor === value) return;\r\n\r\n\t\tthis._intermediateStrokeColor = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Weight of intermediate rule stroke.\r\n\t */\r\n\tpublic get intermediateStrokeWeight(): number {\r\n\t\treturn this._intermediateStrokeWeight;\r\n\t}\r\n\r\n\tpublic set intermediateStrokeWeight(value) {\r\n\t\tif (this._intermediateStrokeWeight === value) return;\r\n\r\n\t\tthis._intermediateStrokeWeight = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Grid size of major line rule.\r\n\t */\r\n\tpublic get majorGridSize(): number {\r\n\t\treturn this._majorGridSize;\r\n\t}\r\n\r\n\tpublic set majorGridSize(value) {\r\n\t\tif (this._majorGridSize === value) return;\r\n\r\n\t\tthis._majorGridSize = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Whether major grid rule is visible.\r\n\t */\r\n\tpublic get majorGridVisible(): boolean {\r\n\t\treturn this._majorGridVisible;\r\n\t}\r\n\r\n\tpublic set majorGridVisible(value) {\r\n\t\tif (this._majorGridVisible === value) return;\r\n\r\n\t\tthis._majorGridVisible = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Opacity of major rule stroke.\r\n\t */\r\n\tpublic get majorStrokeAlpha(): number {\r\n\t\treturn this._majorStrokeAlpha;\r\n\t}\r\n\r\n\tpublic set majorStrokeAlpha(value) {\r\n\t\tif (this._majorStrokeAlpha === value) return;\r\n\r\n\t\tthis._majorStrokeAlpha = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Color of major rule stroke.\r\n\t */\r\n\tpublic get majorStrokeColor(): number {\r\n\t\treturn this._majorStrokeColor;\r\n\t}\r\n\r\n\tpublic set majorStrokeColor(value) {\r\n\t\tif (this._majorStrokeColor === value) return;\r\n\r\n\t\tthis._majorStrokeColor = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Weight of major rule stroke.\r\n\t */\r\n\tpublic get majorStrokeWeight(): number {\r\n\t\treturn this._majorStrokeWeight;\r\n\t}\r\n\r\n\tpublic set majorStrokeWeight(value) {\r\n\t\tif (this._majorStrokeWeight === value) return;\r\n\r\n\t\tthis._majorStrokeWeight = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Grid size of minor line rule.\r\n\t */\r\n\tpublic get minorGridSize(): number {\r\n\t\treturn this._minorGridSize;\r\n\t}\r\n\r\n\tpublic set minorGridSize(value) {\r\n\t\tif (this._minorGridSize === value) return;\r\n\r\n\t\tthis._minorGridSize = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Whether minor grid rule is visible.\r\n\t */\r\n\tpublic get minorGridVisible(): boolean {\r\n\t\treturn this._minorGridVisible;\r\n\t}\r\n\r\n\tpublic set minorGridVisible(value) {\r\n\t\tif (this._minorGridVisible === value) return;\r\n\r\n\t\tthis._minorGridVisible = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Opacity of minor rule stroke.\r\n\t */\r\n\tpublic get minorStrokeAlpha(): number {\r\n\t\treturn this._minorStrokeAlpha;\r\n\t}\r\n\r\n\tpublic set minorStrokeAlpha(value) {\r\n\t\tif (this._minorStrokeAlpha === value) return;\r\n\r\n\t\tthis._minorStrokeAlpha = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Color of minor rule stroke.\r\n\t */\r\n\tpublic get minorStrokeColor(): number {\r\n\t\treturn this._minorStrokeColor;\r\n\t}\r\n\r\n\tpublic set minorStrokeColor(value) {\r\n\t\tif (this._minorStrokeColor === value) return;\r\n\r\n\t\tthis._minorStrokeColor = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Weight of minor rule stroke.\r\n\t */\r\n\tpublic get minorStrokeWeight(): number {\r\n\t\treturn this._minorStrokeWeight;\r\n\t}\r\n\r\n\tpublic set minorStrokeWeight(value) {\r\n\t\tif (this._minorStrokeWeight === value) return;\r\n\r\n\t\tthis._minorStrokeWeight = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\tpublic get reflines(): any[] {\r\n\t\treturn this._reflines;\r\n\t}\r\n\r\n\tpublic set reflines(value: any[]) {\r\n\t\tif (this._reflines === value) return;\r\n\t\tthis._reflines = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t//------------------------------\r\n\t//  methods\r\n\t//------------------------------\r\n\r\n\t/**\r\n\t * @constructor\r\n\t */\r\n\tconstructor(options: Partial<GridOptions> = {}) {\r\n\t\tsuper();\r\n\r\n\t\tthis.set(options);\r\n\r\n\t\tthis._graphics = new PIXI.Graphics();\r\n\t\tthis.addChild(this._graphics);\r\n\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Apply graph options\r\n\t * @param {GridOptions} options - Options to be applied\r\n\t */\r\n\tpublic set(options: Partial<GridOptions> = {}) {\r\n\t\tObject.assign(this, options);\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * On invalidation, rendering operations to redraw.\r\n\t *\r\n\t * @override\r\n\t * @param {PIXI.Rectangle} renderer\r\n\t */\r\n\tpublic render(renderer: PIXI.Renderer) {\r\n\t\tsuper.render(renderer);\r\n\r\n\t\tif (!this._dirty) return;\r\n\t\tthis._dirty = false;\r\n\t\tthis._graphics.clear();\r\n\t\tthis.renderBackground();\r\n\t\tthis.renderMinorGrid();\r\n\t\tthis.renderIntermediateGrid();\r\n\t\tthis.renderMajorGrid();\r\n\t\tthis.renderRefLines();\r\n\t}\r\n\r\n\tprivate renderRefLines() {\r\n\t\t// console.log('renderRefLines', this._reflines);\r\n\t\tconst reflines = this._reflines;\r\n\t\treflines.map((refline: any, index: number) => {\r\n\t\t\tconst { left, top, size } = refline;\r\n\t\t\tif (refline.type === \"horizontal\") {\r\n\t\t\t\tthis._graphics.lineStyle(1, 0xff0000, 1);\r\n\t\t\t\tthis._graphics.moveTo(left, top);\r\n\t\t\t\tthis._graphics.lineTo(left + size, top);\r\n\t\t\t\tthis._graphics.closePath();\r\n\t\t\t} else if (refline.type === \"vertical\") {\r\n\t\t\t\tthis._graphics.lineStyle(1, 0x00ff00, 1);\r\n\t\t\t\tthis._graphics.moveTo(left, top);\r\n\t\t\t\tthis._graphics.lineTo(left, top + size);\r\n\t\t\t\tthis._graphics.closePath();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Render the background fill\r\n\t * @private\r\n\t */\r\n\tprivate renderBackground() {\r\n\t\tconst {\r\n\t\t\t_backgroundFillAlpha,\r\n\t\t\t_backgroundFillColor,\r\n\t\t\t_graphHeight,\r\n\t\t\t_graphWidth,\r\n\t\t\t_backgroundVisible,\r\n\t\t\t_graphics,\r\n\t\t} = this;\r\n\r\n\t\tif (!_backgroundVisible) return;\r\n\r\n\t\t_graphics.beginFill(_backgroundFillColor, _backgroundFillAlpha);\r\n\t\t_graphics.drawRect(0, 0, _graphWidth, _graphHeight);\r\n\t\t_graphics.endFill();\r\n\t}\r\n\r\n\t/**\r\n\t * Render intermediate grid rule.\r\n\t * @private\r\n\t */\r\n\tprivate renderIntermediateGrid() {\r\n\t\tconst {\r\n\t\t\t_graphHeight,\r\n\t\t\t_graphWidth,\r\n\t\t\t_intermediateGridSize,\r\n\t\t\t_intermediateStrokeAlpha,\r\n\t\t\t_intermediateStrokeColor,\r\n\t\t\t_intermediateStrokeWeight,\r\n\t\t\t_majorGridSize,\r\n\t\t\t_majorGridVisible,\r\n\t\t\t_intermediateGridVisible,\r\n\t\t\t_graphics,\r\n\t\t} = this;\r\n\r\n\t\tif (!_intermediateGridVisible) return;\r\n\r\n\t\t_graphics.lineStyle(\r\n\t\t\t_intermediateStrokeWeight,\r\n\t\t\t_intermediateStrokeColor,\r\n\t\t\t_intermediateStrokeAlpha\r\n\t\t);\r\n\r\n\t\tfor (let i = 0; i < _graphHeight; i += _intermediateGridSize) {\r\n\t\t\tif (_majorGridVisible && i % _majorGridSize === 0) continue;\r\n\t\t\t_graphics.moveTo(0, i);\r\n\t\t\t_graphics.lineTo(_graphWidth, i);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < _graphWidth; i += _intermediateGridSize) {\r\n\t\t\tif (_majorGridVisible && i % _majorGridSize === 0) continue;\r\n\t\t\t_graphics.moveTo(i, 0);\r\n\t\t\t_graphics.lineTo(i, _graphHeight);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Render major grid rule.\r\n\t * @private\r\n\t */\r\n\tprivate renderMajorGrid() {\r\n\t\tconst {\r\n\t\t\t_graphHeight,\r\n\t\t\t_graphWidth,\r\n\t\t\t_majorGridSize,\r\n\t\t\t_majorStrokeAlpha,\r\n\t\t\t_majorStrokeColor,\r\n\t\t\t_majorStrokeWeight,\r\n\t\t\t_majorGridVisible,\r\n\t\t\t_graphics,\r\n\t\t} = this;\r\n\r\n\t\tif (!_majorGridVisible) return;\r\n\r\n\t\t_graphics.lineStyle(\r\n\t\t\t_majorStrokeWeight,\r\n\t\t\t_majorStrokeColor,\r\n\t\t\t_majorStrokeAlpha\r\n\t\t);\r\n\r\n\t\tfor (let i = 0; i <= _graphHeight; i += _majorGridSize) {\r\n\t\t\t_graphics.moveTo(0, i);\r\n\t\t\t_graphics.lineTo(_graphWidth, i);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i <= _graphWidth; i += _majorGridSize) {\r\n\t\t\t_graphics.moveTo(i, 0);\r\n\t\t\t_graphics.lineTo(i, _graphHeight);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Render minor grid rule.\r\n\t * @private\r\n\t */\r\n\tprivate renderMinorGrid() {\r\n\t\tconst {\r\n\t\t\t_graphHeight,\r\n\t\t\t_graphWidth,\r\n\t\t\t_intermediateGridSize,\r\n\t\t\t_majorGridSize,\r\n\t\t\t_minorGridSize,\r\n\t\t\t_minorStrokeAlpha,\r\n\t\t\t_minorStrokeColor,\r\n\t\t\t_minorStrokeWeight,\r\n\t\t\t_intermediateGridVisible,\r\n\t\t\t_majorGridVisible,\r\n\t\t\t_minorGridVisible,\r\n\t\t\t_graphics,\r\n\t\t} = this;\r\n\r\n\t\tif (!_minorGridVisible) return;\r\n\r\n\t\t_graphics.lineStyle(\r\n\t\t\t_minorStrokeWeight,\r\n\t\t\t_minorStrokeColor,\r\n\t\t\t_minorStrokeAlpha\r\n\t\t);\r\n\r\n\t\tfor (let i = 0; i < _graphHeight; i += _minorGridSize) {\r\n\t\t\tif (_majorGridVisible && i % _majorGridSize === 0) continue;\r\n\t\t\tif (_intermediateGridVisible && i % _intermediateGridSize === 0)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t_graphics.moveTo(0, i);\r\n\t\t\t_graphics.lineTo(_graphWidth, i);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < _graphWidth; i += _minorGridSize) {\r\n\t\t\tif (_majorGridVisible && i % _majorGridSize === 0) continue;\r\n\t\t\tif (_intermediateGridVisible && i % _intermediateGridSize === 0)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t_graphics.moveTo(i, 0);\r\n\t\t\t_graphics.lineTo(i, _graphHeight);\r\n\t\t}\r\n\t}\r\n}\r\n","import { GridOptions } from \"./type\";\r\n\r\nexport class GridStyle {\r\n\t/**\r\n\t * Blueprint style graph paper\r\n\t */\r\n\tpublic static blueprint(): GridOptions {\r\n\t\treturn {\r\n\t\t\tbackgroundFillAlpha: 1,\r\n\t\t\tbackgroundFillColor: 0x234283,\r\n\t\t\tbackgroundVisible: true,\r\n\t\t\tintermediateGridVisible: false,\r\n\t\t\tmajorGridSize: 100,\r\n\t\t\tmajorGridVisible: true,\r\n\t\t\tmajorStrokeAlpha: 0.5,\r\n\t\t\tmajorStrokeColor: 0xbfe0ec,\r\n\t\t\tmajorStrokeWeight: 2,\r\n\t\t\tminorGridSize: 10,\r\n\t\t\tminorGridVisible: true,\r\n\t\t\tminorStrokeAlpha: 0.1,\r\n\t\t\tminorStrokeColor: 0xbfe0ec,\r\n\t\t\tminorStrokeWeight: 1,\r\n\t\t} as GridOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Dark (default) style graph paper\r\n\t */\r\n\tpublic static dark(): GridOptions {\r\n\t\treturn {\r\n\t\t\tbackgroundFillAlpha: 1,\r\n\t\t\tbackgroundFillColor: 0x0,\r\n\t\t\tbackgroundVisible: false,\r\n\t\t\tintermediateGridSize: 50,\r\n\t\t\tintermediateGridVisible: true,\r\n\t\t\tintermediateStrokeAlpha: 1.0,\r\n\t\t\tintermediateStrokeColor: 0x313131,\r\n\t\t\tintermediateStrokeWeight: 1,\r\n\t\t\tmajorGridSize: 100,\r\n\t\t\tmajorGridVisible: true,\r\n\t\t\tmajorStrokeAlpha: 1.0,\r\n\t\t\tmajorStrokeColor: 0x424242,\r\n\t\t\tmajorStrokeWeight: 2,\r\n\t\t\tminorGridSize: 10,\r\n\t\t\tminorGridVisible: true,\r\n\t\t\tminorStrokeAlpha: 1,\r\n\t\t\tminorStrokeColor: 0x2a2a2a,\r\n\t\t\tminorStrokeWeight: 0.25,\r\n\t\t} as GridOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Engineering style graph paper\r\n\t */\r\n\tpublic static engineering(): GridOptions {\r\n\t\treturn {\r\n\t\t\tbackgroundFillAlpha: 1,\r\n\t\t\tbackgroundFillColor: 0xfbfbd9,\r\n\t\t\tbackgroundVisible: true,\r\n\t\t\tintermediateGridVisible: false,\r\n\t\t\tmajorGridSize: 100,\r\n\t\t\tmajorGridVisible: true,\r\n\t\t\tmajorStrokeAlpha: 0.5,\r\n\t\t\tmajorStrokeColor: 0x40a040,\r\n\t\t\tmajorStrokeWeight: 2,\r\n\t\t\tminorGridSize: 10,\r\n\t\t\tminorGridVisible: true,\r\n\t\t\tminorStrokeAlpha: 0.1,\r\n\t\t\tminorStrokeColor: 0x60e080,\r\n\t\t\tminorStrokeWeight: 1,\r\n\t\t} as GridOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Quad style graph paper\r\n\t */\r\n\tpublic static quad(): GridOptions {\r\n\t\treturn {\r\n\t\t\tbackgroundFillAlpha: 1,\r\n\t\t\tbackgroundFillColor: 0xcee6f0,\r\n\t\t\tbackgroundVisible: true,\r\n\t\t\tintermediateGridVisible: false,\r\n\t\t\tmajorGridSize: 100,\r\n\t\t\tmajorGridVisible: true,\r\n\t\t\tmajorStrokeAlpha: 0.4,\r\n\t\t\tmajorStrokeColor: 0x75a2a5,\r\n\t\t\tmajorStrokeWeight: 2,\r\n\t\t\tminorGridSize: 25,\r\n\t\t\tminorGridVisible: true,\r\n\t\t\tminorStrokeAlpha: 0.4,\r\n\t\t\tminorStrokeColor: 0xb3ced5,\r\n\t\t\tminorStrokeWeight: 1,\r\n\t\t} as GridOptions;\r\n\t}\r\n}\r\n","import EventEmitter from \"eventemitter3\";\r\nimport { Graphics, InteractionEvent, Point } from \"pixi.js\";\r\nimport { Element } from \"@blood4/modeling\";\r\nimport { KeyboardEvents } from \"../events\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\n\r\nexport class BaseGizmo extends Graphics {\r\n\tprotected _renderer?: PixiRenderer<any>;\r\n\tprotected _element: Element;\r\n\tprotected _mouseDownEvent: any;\r\n\tprotected _mouseUpEvent: any;\r\n\tprotected _mouseMoveEvent: any;\r\n\tprotected _mouseOverEvent: any;\r\n\tprotected _mouseOutEvent: any;\r\n\tprotected _mousePoint: Point = new Point(0, 0);\r\n\t_keydownEvent!: (evt: KeyboardEvent) => void;\r\n\t_keyupEvent!: (evt: KeyboardEvent) => void;\r\n\t_ctrlDown: boolean = false;\r\n\t_shiftDown: boolean = false;\r\n\t_altDown: boolean = false;\r\n\t_eventEmitter: EventEmitter = new EventEmitter();\r\n\r\n\tprotected _isDragging = false;\r\n\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper();\r\n\t\tthis.interactive = true;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis._element = element;\r\n\t\tthis._renderer = renderer;\r\n\t\tthis.zIndex = element.styles.zIndex + 1;\r\n\t\tthis.visible = element.visible;\r\n\t\tthis.cursor = element.styles.cursor;\r\n\t}\r\n\r\n\t/**\r\n\t * set up interaction event\r\n\t */\r\n\tpublic mount(): void {\r\n\t\tthis._mouseDownEvent = this.handle_mousedown.bind(this);\r\n\t\t// this._mouseUpEvent = this.handle_mouseup.bind(this);\r\n\t\t// this._mouseMoveEvent = this.handle_mousemove.bind(this);\r\n\t\t// this.on('mousedown', this._mouseDownEvent);\r\n\t\t// this.on('mouseup', this._mouseUpEvent);\r\n\t\t// this.on('mousemove', this._mouseMoveEvent);\r\n\t}\r\n\r\n\t/**\r\n\t * tear down interaction event\r\n\t */\r\n\tpublic unmount(): void {\r\n\t\t// this.off('mousedown', this._mouseDownEvent);\r\n\t\t// this.off('mouseup', this._mouseUpEvent);\r\n\t\t// this.off('mousemove', this._mouseMoveEvent);\r\n\t}\r\n\r\n\t/**\r\n\t * _invalidate\r\n\t */\r\n\tpublic _invalidate(): void {\r\n\t\t// console.log('_invalidate');\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * validate\r\n\t */\r\n\tpublic _validate(): void {\r\n\t\t// console.log('_validate');\r\n\t\tthis._updateStyles();\r\n\t\tthis._validateImpl();\r\n\t}\r\n\r\n\tprotected _validateImpl(): void {\r\n\t\tthis._draw();\r\n\t}\r\n\r\n\t/**\r\n\t * update Styles\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\t// const element: Element = this.element;\r\n\t\t// if (element instanceof Node) {\r\n\t\t// \tconst bounds = element.getBounds();\r\n\t\t// \tthis.pivot.x = bounds.x + bounds.width / 2;\r\n\t\t// \tthis.pivot.y = bounds.y + bounds.height / 2;\r\n\t\t// \tthis.x = bounds.x + bounds.width / 2;\r\n\t\t// \tthis.y = bounds.y + bounds.height / 2;\r\n\t\t// \t// this.angle = -element.angle;\r\n\t\t// }\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns\r\n\t */\r\n\tpublic update(): void {\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t}\r\n\r\n\tprotected _draw() {\r\n\t\tthis.clear();\r\n\t\tconst element = this._element;\r\n\t\tif (!element || !element.visible) return;\r\n\t\t// const matrix = element._matrix,\r\n\t\t// \tangle = element.angle;\r\n\t\t// if (angle !== 0) {\r\n\t\t// \tthis.setMatrix(new Matrix(matrix[0], matrix[1], matrix[2], matrix[3], matrix[4], matrix[5]));\r\n\t\t// }\r\n\t\tthis._drawBody();\r\n\t\tif (this._element && this._element.debug) {\r\n\t\t\tthis._drawAABB();\r\n\t\t}\r\n\r\n\t\t// if (angle !== 0) {\r\n\t\t// \tthis.setMatrix(new Matrix());\r\n\t\t// }\r\n\t}\r\n\r\n\t/**\r\n\t * draw body\r\n\t */\r\n\tprotected _drawBody() { }\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tprotected _drawAABB() {\r\n\t\t// const aabb = this.getBounds();\r\n\t\t// this.lineStyle(1, 0xff0000, 1.0);\r\n\t\t// this.beginFill(0xff0000, 0.2);\r\n\t\t// this.drawRect(aabb.x, aabb.y, aabb.width, aabb.height);\r\n\t\t// this.endFill();\r\n\t}\r\n\t/**\r\n\t * handle mouse down event\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_mousedown(evt: InteractionEvent) {\r\n\t\tevt.stopPropagation();\r\n\t\tconst ui2d = evt.currentTarget as BaseGizmo;\r\n\t\tconst element = ui2d._element;\r\n\t\tif (element.movable) {\r\n\t\t\tthis.__dragStart(evt);\r\n\t\t\t// if (evt !== undefined) {\r\n\t\t\t//     evt.stopPropagation();\r\n\t\t\t// }\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * handle mouse up event\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseup(evt: InteractionEvent) {\r\n\t\tthis.__dragEnd(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * handle mouse move event\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_mousemove(evt: InteractionEvent) {\r\n\t\t// console.log(e.type);\r\n\t\tthis.__dragMove(evt);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseout(evt: InteractionEvent): void {\r\n\t\tthis.__dragEnd(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * drag start\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragStart(evt: InteractionEvent) { }\r\n\r\n\t/**\r\n\t * drag End\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragEnd(evt: InteractionEvent) { }\r\n\r\n\t/**\r\n\t * drag Move\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragMove(evt: InteractionEvent) { }\r\n\r\n\t/**\r\n\t * destory\r\n\t */\r\n\tpublic destroy(): void { }\r\n\r\n\t/**\r\n\t * key down event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keydown(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\t// control key\r\n\t\tconst oldCtrlDown = this._ctrlDown;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t\tconst newCtrlDown = this._ctrlDown;\r\n\t\tif (oldCtrlDown !== newCtrlDown) {\r\n\t\t\tthis._eventEmitter.emit(KeyboardEvents.CtrlKeyDown, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldCtrlDown,\r\n\t\t\t\tnewCtrlDown,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// control key\r\n\t\tconst oldShiftDown = this._shiftDown;\r\n\t\tthis._shiftDown = this.isShiftDown(evt);\r\n\t\tconst newShiftDown = this._shiftDown;\r\n\t\tif (oldShiftDown !== newShiftDown) {\r\n\t\t\tthis._eventEmitter.emit(KeyboardEvents.ShiftKey, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldShiftDown,\r\n\t\t\t\tnewShiftDown,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// control key\r\n\t\tconst oldAltDown = this._altDown;\r\n\t\tthis._altDown = this.isAltDown(evt);\r\n\t\tconst newAltDown = this._altDown;\r\n\t\tif (oldAltDown !== newAltDown) {\r\n\t\t\tthis._eventEmitter.emit(KeyboardEvents.AltKey, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldAltDown,\r\n\t\t\t\tnewAltDown,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keyup(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\t// control key\r\n\t\tconst oldCtrlDown = this._ctrlDown;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t\tconst newCtrlDown = this._ctrlDown;\r\n\t\tif (oldCtrlDown !== newCtrlDown) {\r\n\t\t\tthis._eventEmitter.emit(KeyboardEvents.CtrlKeyUp, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldCtrlDown,\r\n\t\t\t\tnewCtrlDown,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// control key\r\n\t\tconst oldShiftDown = this._shiftDown;\r\n\t\tthis._shiftDown = this.isShiftDown(evt);\r\n\t\tconst newShiftDown = this._shiftDown;\r\n\t\tif (oldShiftDown !== newShiftDown) {\r\n\t\t\tthis._eventEmitter.emit(KeyboardEvents.ShiftKey, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldShiftDown,\r\n\t\t\t\tnewShiftDown,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// control key\r\n\t\tconst oldAltDown = this._altDown;\r\n\t\tthis._altDown = this.isAltDown(evt);\r\n\t\tconst newAltDown = this._altDown;\r\n\t\tif (oldAltDown !== newAltDown) {\r\n\t\t\tthis._eventEmitter.emit(KeyboardEvents.AltKey, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldAltDown,\r\n\t\t\t\tnewAltDown,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tisCtrlDown(evt: KeyboardEvent) {\r\n\t\treturn evt.ctrlKey || evt.metaKey;\r\n\t}\r\n\r\n\tisShiftDown(evt: KeyboardEvent) {\r\n\t\treturn evt.shiftKey;\r\n\t}\r\n\r\n\tisAltDown(evt: KeyboardEvent) {\r\n\t\treturn evt.altKey;\r\n\t}\r\n}\r\n","import { Rectangle, Text } from \"pixi.js\";\r\nimport { Element, PositionType } from \"@blood4/modeling\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\nimport { BaseGizmo } from \"./BaseGizmo\";\r\n\r\nexport class LabelGizmo extends BaseGizmo {\r\n\tprivate _text?: Text;\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper(element, renderer);\r\n\t\tthis.interactive = true;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis._element = element;\r\n\t\tthis.zIndex = element.styles.labelGizmoZIndex;\r\n\t\tthis.visible = element.styles.labelGizmoVisible;\r\n\t\tthis.cursor = element.styles.labelGizmoCursor;\r\n\r\n\t\tif (element instanceof Element) {\r\n\t\t\tthis._text = new Text(\"Length: \", {\r\n\t\t\t\tfontFamily: \"PingFangSC-Regular, PingFang SC\",\r\n\t\t\t\tfontSize: 12,\r\n\t\t\t\tfill: 0x000000,\r\n\t\t\t\talign: \"center\",\r\n\t\t\t\tfontWeight: \"600\",\r\n\t\t\t});\r\n\t\t\tthis._text.resolution = 2;\r\n\t\t\tthis._text.anchor.set(0.5, 0.5);\r\n\t\t\tthis._text.text = `${element.name}`;\r\n\t\t\tthis.addChild(this._text);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * update Styles\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tconst element: Element = this._element;\r\n\t\tif (!element) return;\r\n\r\n\t\tif (this._text) {\r\n\t\t\tconst aabb = element.getAABB();\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\tthis._text.getLocalBounds(rect);\r\n\t\t\tthis._text.x = 0;\r\n\t\t\tthis._text.y = 0;\r\n\t\t\tthis._text.anchor.set(0.5, 0.5);\r\n\t\t\tthis._text.text = `${element.name}`;\r\n\t\t\tif (element.styles.labelGizmoRotation) {\r\n\t\t\t\tthis._text.angle = element.angle;\r\n\t\t\t}\r\n\t\t\t/* const scale = this._renderer?.getScaled() || 1;\r\n\t\t\tthis._text.scale.x = 1 / scale > 1 ? 1 / scale : 1;\r\n\t\t\tthis._text.scale.y = 1 / scale > 1 ? 1 / scale : 1; */\r\n\t\t\tconst position =\r\n\t\t\t\telement.styles.labelGizmoPosition || PositionType.Center;\r\n\t\t\tswitch (position) {\r\n\t\t\t\tcase PositionType.Center:\r\n\t\t\t\t\tthis.x = element.center[0];\r\n\t\t\t\t\tthis.y = element.center[1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.Top:\r\n\t\t\t\t\tthis.x = element.center[0];\r\n\t\t\t\t\tthis.y = aabb.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.Bottom:\r\n\t\t\t\t\tthis.x = element.center[0];\r\n\t\t\t\t\tthis.y = aabb.y + aabb.height;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.Left:\r\n\t\t\t\t\tthis.x = aabb.x;\r\n\t\t\t\t\tthis.y = aabb.y + aabb.height / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.Right:\r\n\t\t\t\t\tthis.x = aabb.x + aabb.width;\r\n\t\t\t\t\tthis.y = aabb.y + aabb.height / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.TopLeft:\r\n\t\t\t\t\tthis.x = aabb.x;\r\n\t\t\t\t\tthis.y = aabb.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.TopRight:\r\n\t\t\t\t\tthis.x = aabb.x + aabb.width;\r\n\t\t\t\t\tthis.y = aabb.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.BottomLeft:\r\n\t\t\t\t\tthis.x = aabb.x;\r\n\t\t\t\t\tthis.y = aabb.y + aabb.height;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.BottomRight:\r\n\t\t\t\t\tthis.x = aabb.x + aabb.width;\r\n\t\t\t\t\tthis.y = aabb.y + aabb.height;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tconst offsetX = element.styles.labelGizmoPositionOffsetX;\r\n\t\t\tconst offsetY = element.styles.labelGizmoPositionOffsetY;\r\n\t\t\tthis.x += offsetX;\r\n\t\t\tthis.y += offsetY;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tprotected _drawBody(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tthis.clear();\r\n\t\tif (this._text) {\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\tthis._text.getLocalBounds(rect);\r\n\t\t\tif (element.debug) {\r\n\t\t\t\tthis.beginFill(0xff0000, 0.5);\r\n\t\t\t\tthis.lineStyle(1, 0x0099cc, 1.0);\r\n\t\t\t\tthis.drawRect(\r\n\t\t\t\t\t0 - rect.width / 2,\r\n\t\t\t\t\t0 - rect.height / 2,\r\n\t\t\t\t\trect.width,\r\n\t\t\t\t\trect.height\r\n\t\t\t\t);\r\n\t\t\t\tthis.endFill();\r\n\t\t\t}\r\n\t\t\t// const scale: number = this._viewer2d?.viewport.scaled || 1.0;\r\n\t\t\t// this._text.style = new PIXI.TextStyle({\r\n\t\t\t// \tfontSize: 14 / scale\r\n\t\t\t// });\r\n\t\t\t// this._text.style.fontSize = 14/scale;\r\n\t\t\t// this._text.rotation = element.angle * DEG_TO_RAD;\r\n\t\t}\r\n\t}\r\n}\r\n","import { Rectangle, Text } from \"pixi.js\";\r\nimport { Element, PositionType } from \"@blood4/modeling\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\nimport { BaseGizmo } from \"./BaseGizmo\";\r\n\r\nexport class Label2Gizmo extends BaseGizmo {\r\n\tprivate _text?: Text;\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper(element, renderer);\r\n\t\tthis.interactive = true;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis._element = element;\r\n\t\tthis.zIndex = element.styles.label2GizmoZIndex;\r\n\t\tthis.visible = element.styles.label2GizmoVisible;\r\n\t\tthis.cursor = element.styles.label2GizmoCursor;\r\n\r\n\t\tif (element instanceof Element) {\r\n\t\t\tthis._text = new Text(\"Length: \", {\r\n\t\t\t\tfontFamily: \"PingFangSC-Regular, PingFang SC\",\r\n\t\t\t\tfontSize: 12,\r\n\t\t\t\tfill: 0x000000,\r\n\t\t\t\talign: \"center\",\r\n\t\t\t\tfontWeight: \"600\",\r\n\t\t\t});\r\n\t\t\tthis._text.resolution = 2;\r\n\t\t\tthis._text.anchor.set(0.5, 0.5);\r\n\t\t\tthis._text.text = `${element.name2}`;\r\n\t\t\tthis.addChild(this._text);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * update Styles\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tconst element: Element = this._element;\r\n\t\tif (!element) return;\r\n\r\n\t\tif (this._text) {\r\n\t\t\tconst aabb = element.getAABB();\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\tthis._text.getLocalBounds(rect);\r\n\t\t\tthis._text.x = 0;\r\n\t\t\tthis._text.y = 0;\r\n\t\t\tthis._text.anchor.set(0.5, 0.5);\r\n\t\t\tthis._text.text = `${element.name2}`;\r\n\t\t\tif (element.styles.label2GizmoRotation) {\r\n\t\t\t\tthis._text.angle = element.angle;\r\n\t\t\t}\r\n\t\t\t/* const scale = this._renderer?.getScaled() || 1;\r\n\t\t\tthis._text.scale.x = 1 / scale > 1 ? 1 / scale : 1;\r\n\t\t\tthis._text.scale.y = 1 / scale > 1 ? 1 / scale : 1; */\r\n\t\t\tconst position =\r\n\t\t\t\telement.styles.label2GizmoPosition || PositionType.Center;\r\n\t\t\tswitch (position) {\r\n\t\t\t\tcase PositionType.Center:\r\n\t\t\t\t\tthis.x = element.center[0];\r\n\t\t\t\t\tthis.y = element.center[1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.Top:\r\n\t\t\t\t\tthis.x = element.center[0];\r\n\t\t\t\t\tthis.y = aabb.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.Bottom:\r\n\t\t\t\t\tthis.x = element.center[0];\r\n\t\t\t\t\tthis.y = aabb.y + aabb.height;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.Left:\r\n\t\t\t\t\tthis.x = aabb.x;\r\n\t\t\t\t\tthis.y = aabb.y + aabb.height / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.Right:\r\n\t\t\t\t\tthis.x = aabb.x + aabb.width;\r\n\t\t\t\t\tthis.y = aabb.y + aabb.height / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.TopLeft:\r\n\t\t\t\t\tthis.x = aabb.x;\r\n\t\t\t\t\tthis.y = aabb.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.TopRight:\r\n\t\t\t\t\tthis.x = aabb.x + aabb.width;\r\n\t\t\t\t\tthis.y = aabb.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.BottomLeft:\r\n\t\t\t\t\tthis.x = aabb.x;\r\n\t\t\t\t\tthis.y = aabb.y + aabb.height;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase PositionType.BottomRight:\r\n\t\t\t\t\tthis.x = aabb.x + aabb.width;\r\n\t\t\t\t\tthis.y = aabb.y + aabb.height;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tconst offsetX = element.styles.label2GizmoPositionOffsetX;\r\n\t\t\tconst offsetY = element.styles.label2GizmoPositionOffsetY;\r\n\t\t\tthis.x += offsetX;\r\n\t\t\tthis.y += offsetY;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tprotected _drawBody(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tthis.clear();\r\n\t\tif (this._text) {\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\tthis._text.getLocalBounds(rect);\r\n\t\t\tif (element.debug) {\r\n\t\t\t\tthis.beginFill(0xff0000, 0.5);\r\n\t\t\t\tthis.lineStyle(1, 0x0099cc, 1.0);\r\n\t\t\t\tthis.drawRect(\r\n\t\t\t\t\t0 - rect.width / 2,\r\n\t\t\t\t\t0 - rect.height / 2,\r\n\t\t\t\t\trect.width,\r\n\t\t\t\t\trect.height\r\n\t\t\t\t);\r\n\t\t\t\tthis.endFill();\r\n\t\t\t}\r\n\t\t\t// const scale: number = this._viewer2d?.viewport.scaled || 1.0;\r\n\t\t\t// this._text.style = new PIXI.TextStyle({\r\n\t\t\t// \tfontSize: 14 / scale\r\n\t\t\t// });\r\n\t\t\t// this._text.style.fontSize = 14/scale;\r\n\t\t\t// this._text.rotation = element.angle * DEG_TO_RAD;\r\n\t\t}\r\n\t}\r\n}\r\n","import { mat2d, vec2 } from \"gl-matrix\";\r\nimport {\r\n\tGraphics,\r\n\tInteractionEvent,\r\n\tMatrix,\r\n\tPoint,\r\n\tRectangle,\r\n\tText,\r\n} from \"pixi.js\";\r\nimport { Element, Node, SHAPE, Shape, ShapeLine } from \"@blood4/modeling\";\r\nimport { PixiRenderer } from \"../../PixiRenderer\";\r\nimport { UI } from \"../../ui\";\r\n\r\n// resize direction\r\nexport enum ResizeDirectionType {\r\n\tCenter = \"Center\",\r\n\tTop = \"Top\",\r\n\tBottom = \"Bottom\",\r\n\tLeft = \"Left\",\r\n\tRight = \"Right\",\r\n\tTopLeft = \"TopLeft\",\r\n\tTopRight = \"TopRight\",\r\n\tBottomLeft = \"BottomLeft\",\r\n\tBottomRight = \"BottomRight\",\r\n}\r\n\r\nconst _directionsMap = new Map();\r\n_directionsMap.set(\"0.5\", ResizeDirectionType.Top);\r\n_directionsMap.set(\"1.5\", ResizeDirectionType.Right);\r\n_directionsMap.set(\"2.5\", ResizeDirectionType.Bottom);\r\n_directionsMap.set(\"3.5\", ResizeDirectionType.Left);\r\n_directionsMap.set(\"0\", ResizeDirectionType.TopLeft);\r\n_directionsMap.set(\"1\", ResizeDirectionType.TopRight);\r\n_directionsMap.set(\"2\", ResizeDirectionType.BottomRight);\r\n_directionsMap.set(\"3\", ResizeDirectionType.BottomLeft);\r\n\r\nexport class AlignSpot extends Graphics {\r\n\tprotected _element: Element;\r\n\tprotected _from: number[];\r\n\tprotected _to: number[];\r\n\tprotected _index: number;\r\n\tprotected _angle: number;\r\n\tprotected _shape: string = \"roundedRect\";\r\n\tprotected _renderer: PixiRenderer<any>;\r\n\tprotected _center: number[] = [0, 0];\r\n\tprotected _points?: number[][];\r\n\tprotected _fillColor = 0x7c7c7c;\r\n\tprotected _fillAlpha = 0.1;\r\n\tprotected _text?: Text;\r\n\tprotected _size: number = 4;\r\n\tmode: string = \"align\"; // align, resize , scale, point\r\n\t_mousedownEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseupEvent!: (evt: InteractionEvent) => void;\r\n\t_mousemoveEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseoverEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseoutEvent!: (evt: InteractionEvent) => void;\r\n\r\n\t_hitTarget?: UI;\r\n\t_isDragging = false;\r\n\t_mousePoint: Point = new Point(0, 0);\r\n\t_ctrlDown: boolean = false;\r\n\t_doubleClickedTimeout: NodeJS.Timeout | null = null;\r\n\t_originSize?: number[];\r\n\t_originCenter?: number[];\r\n\r\n\tconstructor(\r\n\t\telement: Element,\r\n\t\tfrom: number[],\r\n\t\tto: number[],\r\n\t\trenderer: PixiRenderer<any>,\r\n\t\tindex: number,\r\n\t\tshape: string = \"roundedRect\" // circle\r\n\t) {\r\n\t\tsuper();\r\n\t\tthis._zIndex = 999;\r\n\t\tthis._element = element;\r\n\t\tthis._renderer = renderer;\r\n\t\tthis._index = index;\r\n\t\tthis._shape = shape;\r\n\t\tthis._from = from || [0, 0];\r\n\t\tthis._to = to || [0, 0];\r\n\r\n\t\tthis._size = vec2.distance(\r\n\t\t\tvec2.fromValues(from[0], from[1]),\r\n\t\t\tvec2.fromValues(to[0], to[1])\r\n\t\t);\r\n\r\n\t\tconst v = vec2.fromValues(to[0] - from[0], to[1] - from[1]);\r\n\t\tconst angle = vec2.angle(v, vec2.fromValues(v[0], 0));\r\n\t\tthis._angle = v[0] * v[1] >= 0 ? angle : -angle;\r\n\r\n\t\tconst center = [(from[0] + to[0]) / 2, (from[1] + to[1]) / 2];\r\n\t\tthis._center = center;\r\n\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t\tthis.interactive = true;\r\n\t\tthis.buttonMode = false;\r\n\t\tthis.mount();\r\n\t}\r\n\r\n\tpublic mount(): void {\r\n\t\t// console.log('drag spot mount');\r\n\t\tthis._mousedownEvent = this.handle_mousedown.bind(this);\r\n\t\tthis._mouseupEvent = this.handle_mouseup.bind(this);\r\n\t\tthis._mousemoveEvent = this.handle_mousemove.bind(this);\r\n\t\tthis._mouseoverEvent = this.handle_mouseover.bind(this);\r\n\t\tthis._mouseoutEvent = this.handle_mouseout.bind(this);\r\n\r\n\t\tthis.on(\"mousedown\", this._mousedownEvent);\r\n\t\tthis.on(\"mouseup\", this._mouseupEvent);\r\n\t\t// this.on('mousemove', this._mousemoveEvent);\r\n\t\tthis.on(\"mouseover\", this._mouseoverEvent);\r\n\t\tthis.on(\"mouseout\", this._mouseoutEvent);\r\n\t\tthis._text = new Text(\"Length: \", {\r\n\t\t\tfontFamily: \"PingFangSC-Regular, PingFang SC\",\r\n\t\t\tfontSize: 6,\r\n\t\t\tfill: 0x000000,\r\n\t\t\talign: \"center\",\r\n\t\t\tfontWeight: \"100\",\r\n\t\t});\r\n\t\tthis._text.resolution = 2;\r\n\t\tthis._text.anchor.set(this._element.x || 0, this._element.y || 0);\r\n\t\tthis._text.text = `${this._index}`;\r\n\t\tthis._text.zIndex = 999;\r\n\t\t// this._text.angle = this._angle * RAD_TO_DEG;\r\n\t\t// this.addChild(this._text);\r\n\t}\r\n\r\n\tpublic unmount(): void {\r\n\t\t// console.log('drag spot unmount');\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tthis.off(\"mousedown\", this._mousedownEvent);\r\n\t\tthis.off(\"mouseup\", this._mouseupEvent);\r\n\t\tthis.off(\"mousemove\", this._mousemoveEvent);\r\n\t\tthis.off(\"mouseover\", this._mouseoverEvent);\r\n\t\tthis.off(\"mouseout\", this._mouseoutEvent);\r\n\t\tif (viewport) {\r\n\t\t\tviewport.off(\"mousemove\", this._mousemoveEvent);\r\n\t\t}\r\n\t\tthis.clear();\r\n\t\tif (this._text) {\r\n\t\t\tthis.removeChild(this._text);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * _invalidate\r\n\t */\r\n\tpublic _invalidate(): void {\r\n\t\t// console.log('_invalidate');\r\n\t\t// this.unmount();\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * validate\r\n\t */\r\n\tpublic _validate(): void {\r\n\t\t// console.log('_validate');\r\n\t\tconst from = this._from,\r\n\t\t\tto = this._to;\r\n\t\tthis._from = from || [0, 0];\r\n\t\tthis._to = to || [0, 0];\r\n\r\n\t\tthis._size = vec2.distance(\r\n\t\t\tvec2.fromValues(from[0], from[1]),\r\n\t\t\tvec2.fromValues(to[0], to[1])\r\n\t\t);\r\n\r\n\t\tconst v = vec2.fromValues(to[0] - from[0], to[1] - from[1]);\r\n\t\tconst angle = vec2.angle(v, vec2.fromValues(v[0], 0));\r\n\t\tthis._angle = v[0] * v[1] >= 0 ? angle : -angle;\r\n\r\n\t\tconst center = [(from[0] + to[0]) / 2, (from[1] + to[1]) / 2];\r\n\t\tthis._center = center;\r\n\r\n\t\tthis._updateStyles();\r\n\t\tthis._validateImpl();\r\n\t}\r\n\r\n\tprotected _validateImpl(): void {\r\n\t\tthis._draw();\r\n\t}\r\n\r\n\t/**\r\n\t * update Styles\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tif (this._text) {\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\tthis._text.getLocalBounds(rect);\r\n\t\t\tthis._text.x = this._center[0];\r\n\t\t\tthis._text.y = this._center[1];\r\n\t\t\tthis._text.anchor.set(0.5, 0.5);\r\n\t\t\tthis._text.text = `${this._index}`;\r\n\t\t\t// this._text.angle = this._angle * RAD_TO_DEG;\r\n\t\t\t// this.x = this._center[0];\r\n\t\t\t// this.y = this._center[1];\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _draw() {\r\n\t\tthis.clear();\r\n\t\tthis._drawBody();\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tpublic _drawBody(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tconst angle = this._angle;\r\n\t\tconst center = this._center;\r\n\t\tconst a = Math.sin(angle);\r\n\t\tconst b = Math.cos(angle);\r\n\t\tconst tx = center[0] * (1 - b) + center[1] * a;\r\n\t\tconst ty = center[1] * (1 - b) - center[0] * a;\r\n\t\tconst matrix = mat2d.fromValues(b, a, -a, b, tx, ty);\r\n\t\tthis.setMatrix(\r\n\t\t\tnew Matrix(\r\n\t\t\t\tmatrix[0],\r\n\t\t\t\tmatrix[1],\r\n\t\t\t\tmatrix[2],\r\n\t\t\t\tmatrix[3],\r\n\t\t\t\tmatrix[4],\r\n\t\t\t\tmatrix[5]\r\n\t\t\t)\r\n\t\t);\r\n\t\tconst scaled = this._renderer.getScaled();\r\n\r\n\t\tlet height = scaled < 1 ? 2 / scaled : 2;\r\n\t\tlet width = this._size;\r\n\t\tswitch (this._shape) {\r\n\t\t\tcase \"rect\":\r\n\t\t\t\tthis.beginFill(this._fillColor, this._fillAlpha);\r\n\t\t\t\tthis.drawRect(\r\n\t\t\t\t\tthis._center[0] - width / 2,\r\n\t\t\t\t\tthis._center[1] - height / 2,\r\n\t\t\t\t\twidth,\r\n\t\t\t\t\theight\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"circle\":\r\n\t\t\t\tlet size = scaled < 1 ? 3 / scaled : 3;\r\n\t\t\t\tif (this._hitTarget) {\r\n\t\t\t\t\tsize = scaled < 1 ? 3 / scaled : 3;\r\n\t\t\t\t\tthis.lineStyle(1.5, 0x737373, 1.0);\r\n\t\t\t\t\tthis.beginFill(0xffffff, 1.0);\r\n\t\t\t\t\tthis.drawCircle(this._center[0], this._center[1], size);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsize = scaled < 1 ? 2.5 / scaled : 2.5;\r\n\t\t\t\t\tthis.lineStyle(1, 0xa6a6a6, 1.0);\r\n\t\t\t\t\tthis.beginFill(0xffffff, 1.0);\r\n\t\t\t\t\tthis.drawCircle(this._center[0], this._center[1], size);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"roundedRect\":\r\n\t\t\t\tthis.lineStyle(0.6, 0x000000, 0.25);\r\n\t\t\t\tthis.beginFill(0xffffff, 1.0);\r\n\t\t\t\tthis.drawRoundedRect(\r\n\t\t\t\t\tthis._center[0] - width / 2,\r\n\t\t\t\t\tthis._center[1] - height / 2,\r\n\t\t\t\t\twidth,\r\n\t\t\t\t\theight,\r\n\t\t\t\t\t1\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.endFill();\r\n\t\tthis.setMatrix(new Matrix());\r\n\t\t/* const bounds = this.getLocalBounds();\r\n\t\tthis.lineStyle(1.0, 0xff0000, 1.0);\r\n\t\tthis.beginFill(0xff0000, 1.0);\r\n\t\tthis.drawRect(bounds.x, bounds.y, bounds.width, bounds.height);\r\n\t\tthis.endFill(); */\r\n\t}\r\n\r\n\t/**\r\n\t * set fill color\r\n\t */\r\n\tpublic set fillColor(color: number) {\r\n\t\tthis._fillColor = color;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tpublic set center(center: number[]) {\r\n\t\tthis._center = center;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tpublic setAngle(angle: number) {\r\n\t\tthis._angle = angle;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tpublic set points(points: number[][]) {\r\n\t\tthis._points = points;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tpublic update() {\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t}\r\n\r\n\t/**\r\n\t * handle zoomed\r\n\t * @param e\r\n\t */\r\n\thandle_zoomed(evt: InteractionEvent) {\r\n\t\t// console.log(evt)\r\n\t}\r\n\r\n\t/**\r\n\t * handle panned\r\n\t * @param e\r\n\t */\r\n\thandle_panned(evt: InteractionEvent) {\r\n\t\t// console.log(evt)\r\n\t}\r\n\r\n\tisCtrlDown(evt: KeyboardEvent) {\r\n\t\treturn evt.ctrlKey || evt.metaKey;\r\n\t}\r\n\r\n\t/**\r\n\t * mouse down\r\n\t * @param e\r\n\t */\r\n\thandle_mousedown(evt: InteractionEvent): void {\r\n\t\t// console.log('handle_mousedown');\r\n\t\tevt.stopPropagation();\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tconst hitTarget = renderer.renderer.plugins.interaction.hitTest(\r\n\t\t\tevt.data.global\r\n\t\t);\r\n\t\tthis._hitTarget = hitTarget;\r\n\t\tif (hitTarget instanceof AlignSpot) {\r\n\t\t\t// this.__dragStart(evt);\r\n\t\t\t// viewport.on('mousemove', this._mousemoveEvent);\r\n\t\t}\r\n\t\tif (this._doubleClickedTimeout) {\r\n\t\t\tclearTimeout(this._doubleClickedTimeout);\r\n\t\t\tthis._doubleClickedTimeout = null;\r\n\t\t} else {\r\n\t\t\tthis._handleAlignOption();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * mouse up\r\n\t * @param e\r\n\t */\r\n\thandle_mouseup(evt: InteractionEvent): void {\r\n\t\tthis._doubleClickedTimeout = setTimeout(() => {\r\n\t\t\tthis._doubleClickedTimeout = null;\r\n\t\t}, 300);\r\n\t\t// this.__dragEnd(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * mouse move\r\n\t * @param e\r\n\t */\r\n\thandle_mousemove(evt: InteractionEvent): void {\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\t// this.__dragMove(evt);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseout(evt: InteractionEvent): void {\r\n\t\tthis._fillColor = 0x7c7c7c;\r\n\t\tthis._fillAlpha = 0.1;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseover(evt: InteractionEvent): void {\r\n\t\tthis._fillColor = 0x3477fc;\r\n\t\tthis._fillAlpha = 1.0;\r\n\t}\r\n\r\n\t/**\r\n\t * drag start\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragStart(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (this._isDragging) return;\r\n\t\tif (hitTarget instanceof AlignSpot) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\t\tthis._isDragging = true;\r\n\t\t\tconst element = hitTarget._element;\r\n\t\t\tthis._originSize = [element.width, element.height];\r\n\t\t\tthis._originCenter = [element.x, element.y];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param p\r\n\t * @param center\r\n\t * @param angle\r\n\t * @returns\r\n\t */\r\n\tprivate _reversPoint(\r\n\t\tp: number[],\r\n\t\tcenter: number[],\r\n\t\tangle: number\r\n\t): number[] {\r\n\t\tangle *= -1;\r\n\t\tlet cos = Math.cos((angle * Math.PI) / 180);\r\n\t\tlet sin = Math.sin((angle * Math.PI) / 180);\r\n\t\tlet x = p[0] - center[0];\r\n\t\tlet y = p[1] - center[1];\r\n\r\n\t\tlet newX = x * cos - y * sin;\r\n\t\tlet newY = x * sin + y * cos;\r\n\r\n\t\tp[0] = newX + center[0];\r\n\t\tp[1] = newY + center[1];\r\n\t\treturn p;\r\n\t}\r\n\r\n\t/**\r\n\t * drag Move\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragMove(evt: InteractionEvent) {\r\n\t\tif (this.mode === \"align\") {\r\n\t\t\tthis._handleAlign(evt);\r\n\t\t} else if (this.mode === \"resize\") {\r\n\t\t\tthis._handleResize(evt);\r\n\t\t} else if (this.mode === \"scale\") {\r\n\t\t\tthis._handleScale(evt);\r\n\t\t}\r\n\t}\r\n\r\n\t_handleAlign(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (!this._isDragging) return;\r\n\t\tif (!hitTarget || !this._originSize || !this._originCenter) return;\r\n\t\tconst element = hitTarget._element;\r\n\t\tif (element.type === SHAPE.Node) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tconst dx = position.x - this._mousePoint.x,\r\n\t\t\t\tdy = position.y - this._mousePoint.y;\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\r\n\t\t\tconst element = hitTarget._element;\r\n\t\t\tconst direction = _directionsMap.get(`${this._index}`);\r\n\t\t\tlet from =\r\n\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t? (element.points.length + this._index - 1) %\r\n\t\t\t\t\telement.points.length\r\n\t\t\t\t\t: (element.points.length + this._index - 0.5) %\r\n\t\t\t\t\telement.points.length,\r\n\t\t\t\tto =\r\n\t\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t\t? (element.points.length + this._index + 1) %\r\n\t\t\t\t\t\telement.points.length\r\n\t\t\t\t\t\t: (element.points.length + this._index + 0.5) %\r\n\t\t\t\t\t\telement.points.length,\r\n\t\t\t\tcurrent =\r\n\t\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t\t? this._index % element.points.length\r\n\t\t\t\t\t\t: (this._index + 0.5) % element.points.length;\r\n\r\n\t\t\tconst angle = element.angle;\r\n\t\t\tconst point = this._reversPoint(\r\n\t\t\t\t[position.x, position.y],\r\n\t\t\t\t[this._originCenter[0], this._originCenter[1]],\r\n\t\t\t\tangle\r\n\t\t\t);\r\n\t\t\tconst scaleX =\r\n\t\t\t\tMath.abs((point[0] - this._originCenter[0]) * 2) /\r\n\t\t\t\telement.width;\r\n\t\t\tconst scaleY =\r\n\t\t\t\tMath.abs((point[1] - this._originCenter[1]) * 2) /\r\n\t\t\t\telement.height;\r\n\r\n\t\t\tswitch (direction) {\r\n\t\t\t\tcase ResizeDirectionType.Right:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Bottom:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Left:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Top:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopRight:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomRight:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomLeft:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopLeft:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t// evt.stopPropagation();\r\n\t\t} else if (\r\n\t\t\telement.type === SHAPE.Shape ||\r\n\t\t\telement.type === SHAPE.Domain\r\n\t\t) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tconst dx = position.x - this._mousePoint.x,\r\n\t\t\t\tdy = position.y - this._mousePoint.y;\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\r\n\t\t\tconst element = hitTarget._element;\r\n\t\t\tlet from =\r\n\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t? (element.points.length + this._index - 1) %\r\n\t\t\t\t\telement.points.length\r\n\t\t\t\t\t: (element.points.length + this._index - 0.5) %\r\n\t\t\t\t\telement.points.length,\r\n\t\t\t\tto =\r\n\t\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t\t? (element.points.length + this._index + 1) %\r\n\t\t\t\t\t\telement.points.length\r\n\t\t\t\t\t\t: (element.points.length + this._index + 0.5) %\r\n\t\t\t\t\t\telement.points.length;\r\n\t\t\t// const angle = element.angle;\r\n\t\t\t// const point = this._reversPoint(\r\n\t\t\t// \t[position.x, position.y],\r\n\t\t\t// \t[this._originCenter[0], this._originCenter[1]],\r\n\t\t\t// \tangle\r\n\t\t\t// );\r\n\t\t\tconst fromPoint = element.points[from],\r\n\t\t\t\ttoPoint = element.points[to];\r\n\t\t\tconst a = vec2.fromValues(\r\n\t\t\t\tfromPoint[0] - toPoint[0],\r\n\t\t\t\tfromPoint[1] - toPoint[1]\r\n\t\t\t);\r\n\t\t\tlet b = vec2.fromValues(-a[1], a[0]);\r\n\t\t\tvec2.normalize(b, b);\r\n\t\t\tconst c = vec2.fromValues(dx, dy);\r\n\t\t\tconst d = vec2.dot(c, b);\r\n\t\t\tconst r = vec2.create();\r\n\t\t\tvec2.scale(r, b, d);\r\n\t\t\telement.translatePoint(\r\n\t\t\t\t[from, to],\r\n\t\t\t\t[\r\n\t\t\t\t\t[r[0], r[1]],\r\n\t\t\t\t\t[r[0], r[1]],\r\n\t\t\t\t]\r\n\t\t\t);\r\n\t\t} else if (\r\n\t\t\telement.type === SHAPE.ShapeLine ||\r\n\t\t\telement.type === SHAPE.Line ||\r\n\t\t\telement.type === SHAPE.AlignLine\r\n\t\t) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tconst dx = position.x - this._mousePoint.x,\r\n\t\t\t\tdy = position.y - this._mousePoint.y;\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\t\tconst element = hitTarget._element;\r\n\t\t\telement.translatePoint([this._index], [[dx, dy]]);\r\n\t\t}\r\n\t}\r\n\r\n\t_handleResize(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (!this._isDragging) return;\r\n\t\tif (!hitTarget || !this._originSize || !this._originCenter) return;\r\n\t\tconst element = hitTarget._element;\r\n\t\tif (element.type === SHAPE.Node) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tconst dx = position.x - this._mousePoint.x,\r\n\t\t\t\tdy = position.y - this._mousePoint.y;\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\r\n\t\t\tconst element = hitTarget._element;\r\n\t\t\tconst direction = _directionsMap.get(`${this._index}`);\r\n\t\t\tlet from =\r\n\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t? (element.points.length + this._index - 1) %\r\n\t\t\t\t\telement.points.length\r\n\t\t\t\t\t: (element.points.length + this._index - 0.5) %\r\n\t\t\t\t\telement.points.length,\r\n\t\t\t\tto =\r\n\t\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t\t? (element.points.length + this._index + 1) %\r\n\t\t\t\t\t\telement.points.length\r\n\t\t\t\t\t\t: (element.points.length + this._index + 0.5) %\r\n\t\t\t\t\t\telement.points.length,\r\n\t\t\t\tcurrent =\r\n\t\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t\t? this._index % element.points.length\r\n\t\t\t\t\t\t: (this._index + 0.5) % element.points.length;\r\n\r\n\t\t\tconst angle = element.angle;\r\n\t\t\tconst point = this._reversPoint(\r\n\t\t\t\t[position.x, position.y],\r\n\t\t\t\t[this._originCenter[0], this._originCenter[1]],\r\n\t\t\t\tangle\r\n\t\t\t);\r\n\t\t\tconst scaleX =\r\n\t\t\t\tMath.abs((point[0] - this._originCenter[0]) * 2) /\r\n\t\t\t\telement.width;\r\n\t\t\tconst scaleY =\r\n\t\t\t\tMath.abs((point[1] - this._originCenter[1]) * 2) /\r\n\t\t\t\telement.height;\r\n\r\n\t\t\tswitch (direction) {\r\n\t\t\t\tcase ResizeDirectionType.Right:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Bottom:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Left:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Top:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopRight:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomRight:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomLeft:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopLeft:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t// evt.stopPropagation();\r\n\t\t} else if (\r\n\t\t\telement.type === SHAPE.Shape ||\r\n\t\t\telement.type === SHAPE.Domain\r\n\t\t) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tconst dx = position.x - this._mousePoint.x,\r\n\t\t\t\tdy = position.y - this._mousePoint.y;\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\r\n\t\t\tconst element = hitTarget._element;\r\n\t\t\tlet from =\r\n\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t? (element.points.length + this._index - 1) %\r\n\t\t\t\t\telement.points.length\r\n\t\t\t\t\t: (element.points.length + this._index - 0.5) %\r\n\t\t\t\t\telement.points.length,\r\n\t\t\t\tto =\r\n\t\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t\t? (element.points.length + this._index + 1) %\r\n\t\t\t\t\t\telement.points.length\r\n\t\t\t\t\t\t: (element.points.length + this._index + 0.5) %\r\n\t\t\t\t\t\telement.points.length;\r\n\t\t\t// const angle = element.angle;\r\n\t\t\t// const point = this._reversPoint(\r\n\t\t\t// \t[position.x, position.y],\r\n\t\t\t// \t[this._originCenter[0], this._originCenter[1]],\r\n\t\t\t// \tangle\r\n\t\t\t// );\r\n\t\t\tconst fromPoint = element.points[from],\r\n\t\t\t\ttoPoint = element.points[to];\r\n\t\t\tconst a = vec2.fromValues(\r\n\t\t\t\tfromPoint[0] - toPoint[0],\r\n\t\t\t\tfromPoint[1] - toPoint[1]\r\n\t\t\t);\r\n\t\t\tlet b = vec2.fromValues(-a[1], a[0]);\r\n\t\t\tvec2.normalize(b, b);\r\n\t\t\tconst c = vec2.fromValues(dx, dy);\r\n\t\t\tconst d = vec2.dot(c, b);\r\n\t\t\tconst r = vec2.create();\r\n\t\t\tvec2.scale(r, b, d);\r\n\t\t\telement.translatePoint(\r\n\t\t\t\t[from, to],\r\n\t\t\t\t[\r\n\t\t\t\t\t[r[0], r[1]],\r\n\t\t\t\t\t[r[0], r[1]],\r\n\t\t\t\t]\r\n\t\t\t);\r\n\t\t} else if (\r\n\t\t\telement.type === SHAPE.ShapeLine ||\r\n\t\t\telement.type === SHAPE.Line ||\r\n\t\t\telement.type === SHAPE.AlignLine\r\n\t\t) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tconst dx = position.x - this._mousePoint.x,\r\n\t\t\t\tdy = position.y - this._mousePoint.y;\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\t\tconst element = hitTarget._element;\r\n\t\t\telement.translatePoint([this._index], [[dx, dy]]);\r\n\t\t}\r\n\t}\r\n\t_handleScale(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (!this._isDragging) return;\r\n\t\tif (!hitTarget || !this._originSize || !this._originCenter) return;\r\n\t\tconst element = hitTarget._element;\r\n\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\tlet dx = position.x - this._mousePoint.x,\r\n\t\t\tdy = position.y - this._mousePoint.y;\r\n\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\tconst direction = _directionsMap.get(`${this._index}`);\r\n\t\tlet from =\r\n\t\t\tthis._index % 1 === 0\r\n\t\t\t\t? (element.points.length + this._index - 1) %\r\n\t\t\t\telement.points.length\r\n\t\t\t\t: (element.points.length + this._index - 0.5) %\r\n\t\t\t\telement.points.length,\r\n\t\t\tto =\r\n\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t? (element.points.length + this._index + 1) %\r\n\t\t\t\t\telement.points.length\r\n\t\t\t\t\t: (element.points.length + this._index + 0.5) %\r\n\t\t\t\t\telement.points.length,\r\n\t\t\tcurrent =\r\n\t\t\t\tthis._index % 1 === 0\r\n\t\t\t\t\t? this._index % element.points.length\r\n\t\t\t\t\t: (this._index + 0.5) % element.points.length;\r\n\t\t// const angle = element.angle;\r\n\t\t// const point = this._reversPoint(\r\n\t\t// \t[position.x, position.y],\r\n\t\t// \t[this._originCenter[0], this._originCenter[1]],\r\n\t\t// \tangle\r\n\t\t// );\r\n\r\n\t\tif (element instanceof Node) {\r\n\t\t\tswitch (direction) {\r\n\t\t\t\tcase ResizeDirectionType.Right:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Bottom:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Left:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Top:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopRight:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomRight:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomLeft:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopLeft:\r\n\t\t\t\t\telement.translatePoint(\r\n\t\t\t\t\t\t[from, current, to],\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t[dx, 0],\r\n\t\t\t\t\t\t\t[dx, dy],\r\n\t\t\t\t\t\t\t[0, dy],\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t// evt.stopPropagation();\r\n\t\t} else if (element instanceof Shape) {\r\n\t\t\t// const origin = [\r\n\t\t\t// \tthis._originCenter[0] + this._originSize[0] / 2,\r\n\t\t\t// \tthis._originCenter[1] + this._originSize[1] / 2\r\n\t\t\t// ];\r\n\t\t\t// const distance = vec2.distance(\r\n\t\t\t// \tvec2.fromValues(position.x, position.y),\r\n\t\t\t// \tvec2.fromValues(origin[0], origin[1])\r\n\t\t\t// );\r\n\t\t\t// console.log(origin, position, distance);\r\n\t\t\tlet size = element.size;\r\n\t\t\tlet diagonal = Math.sqrt(size[0] * size[0] + size[1] * size[1]),\r\n\t\t\t\tdiagonal3 = 1,\r\n\t\t\t\tscale = 1;\r\n\t\t\tswitch (direction) {\r\n\t\t\t\tcase ResizeDirectionType.Right:\r\n\t\t\t\t\tscale = (dx + size[0]) / size[0];\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.Left);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Bottom:\r\n\t\t\t\t\tscale = (dy + size[1]) / size[1];\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.Top);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Left:\r\n\t\t\t\t\tscale = (-dx + size[0]) / size[0];\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.Right);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.Top:\r\n\t\t\t\t\tscale = (-dy + size[1]) / size[1];\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.Bottom);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopRight:\r\n\t\t\t\t\tdiagonal3 = Math.sqrt(\r\n\t\t\t\t\t\t(dx + size[0]) * (dx + size[0]) +\r\n\t\t\t\t\t\t(-dy + size[1]) * (-dy + size[1])\r\n\t\t\t\t\t);\r\n\t\t\t\t\tscale = diagonal3 / diagonal;\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.BottomLeft);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomRight:\r\n\t\t\t\t\tdiagonal3 = Math.sqrt(\r\n\t\t\t\t\t\t(dx + size[0]) * (dx + size[0]) +\r\n\t\t\t\t\t\t(dy + size[1]) * (dy + size[1])\r\n\t\t\t\t\t);\r\n\t\t\t\t\tscale = diagonal3 / diagonal;\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.TopLeft);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.BottomLeft:\r\n\t\t\t\t\tdiagonal3 = Math.sqrt(\r\n\t\t\t\t\t\t(-dx + size[0]) * (-dx + size[0]) +\r\n\t\t\t\t\t\t(dy + size[1]) * (dy + size[1])\r\n\t\t\t\t\t);\r\n\t\t\t\t\tscale = diagonal3 / diagonal;\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.TopRight);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResizeDirectionType.TopLeft:\r\n\t\t\t\t\tdiagonal3 = Math.sqrt(\r\n\t\t\t\t\t\t(-dx + size[0]) * (-dx + size[0]) +\r\n\t\t\t\t\t\t(-dy + size[1]) * (-dy + size[1])\r\n\t\t\t\t\t);\r\n\t\t\t\t\tscale = diagonal3 / diagonal;\r\n\t\t\t\t\telement.scaled(scale, ResizeDirectionType.BottomRight);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} else if (element instanceof ShapeLine) {\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * drag End\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragEnd(evt: InteractionEvent) {\r\n\t\tif (this._isDragging) {\r\n\t\t\tthis._isDragging = false;\r\n\t\t\tthis._originSize = undefined;\r\n\t\t\tthis._originCenter = undefined;\r\n\t\t\tthis.off(\"mousemove\", this._mousemoveEvent);\r\n\t\t\t// evt.stopPropagation();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * key down event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keydown(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keyup(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t}\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_contextmenu(e: any): void {\r\n\t\te.preventDefault();\r\n\t\tthis.__dragEnd(e);\r\n\t}\r\n\r\n\tprotected translate(dx: number, dy: number) {\r\n\t\tthis._center[0] += dx;\r\n\t\tthis._center[1] += dy;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tpublic setSize(size: number) {\r\n\t\tthis._size = size;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tprivate _handleAlignOption() { }\r\n\r\n\t/**\r\n\t *\r\n\t * @param from\r\n\t */\r\n\tpublic setFrom(from: number[]) {\r\n\t\tthis._from = from;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param to\r\n\t */\r\n\tpublic setTo(to: number[]) {\r\n\t\tthis._to = to;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param from\r\n\t * @param to\r\n\t */\r\n\tpublic setFromTo(from: number[], to: number[]) {\r\n\t\tthis._from = from;\r\n\t\tthis._to = to;\r\n\t\tthis.update();\r\n\t}\r\n}\r\n","import { mat2d, vec2 } from \"gl-matrix\";\r\nimport {\r\n\tDEG_TO_RAD,\r\n\tGraphics,\r\n\tInteractionEvent,\r\n\tPoint,\r\n\tRAD_TO_DEG,\r\n\tRectangle,\r\n\tText,\r\n} from \"pixi.js\";\r\nimport { Element } from \"@blood4/modeling\";\r\nimport { PixiRenderer } from \"../../PixiRenderer\";\r\nimport { UI } from \"../../ui\";\r\n\r\n// resize direction\r\nexport enum ResizeDirectionType {\r\n\tCenter = \"Center\",\r\n\tTop = \"Top\",\r\n\tBottom = \"Bottom\",\r\n\tLeft = \"Left\",\r\n\tRight = \"Right\",\r\n\tTopLeft = \"TopLeft\",\r\n\tTopRight = \"TopRight\",\r\n\tBottomLeft = \"BottomLeft\",\r\n\tBottomRight = \"BottomRight\",\r\n}\r\n\r\nconst _directionsMap = new Map();\r\n_directionsMap.set(\"0.5\", ResizeDirectionType.Top);\r\n_directionsMap.set(\"1.5\", ResizeDirectionType.Right);\r\n_directionsMap.set(\"2.5\", ResizeDirectionType.Bottom);\r\n_directionsMap.set(\"3.5\", ResizeDirectionType.Left);\r\n_directionsMap.set(\"0\", ResizeDirectionType.TopLeft);\r\n_directionsMap.set(\"1\", ResizeDirectionType.TopRight);\r\n_directionsMap.set(\"2\", ResizeDirectionType.BottomRight);\r\n_directionsMap.set(\"3\", ResizeDirectionType.BottomLeft);\r\n\r\nexport class DimensionSpot extends Graphics {\r\n\tprotected _element: Element;\r\n\tprotected _from: {\r\n\t\tp1: number[];\r\n\t\tp2: number[][];\r\n\t};\r\n\tprotected _to: {\r\n\t\tp1: number[];\r\n\t\tp2: number[][];\r\n\t};\r\n\tprotected _index: number;\r\n\tprotected _angle: number = 0;\r\n\tprotected _renderer: PixiRenderer<any>;\r\n\tprotected _center: number[] = [0, 0];\r\n\tprotected _fillColor = 0x7c7c7c;\r\n\tprotected _fillAlpha = 0.1;\r\n\tprotected _text?: Text;\r\n\tprotected _size: number = 4;\r\n\r\n\t_mousedownEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseupEvent!: (evt: InteractionEvent) => void;\r\n\t_mousemoveEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseoverEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseoutEvent!: (evt: InteractionEvent) => void;\r\n\r\n\t_hitTarget?: UI;\r\n\t_isDragging = false;\r\n\t_mousePoint: Point = new Point(0, 0);\r\n\t_doubleClickedTimeout: NodeJS.Timeout | null = null;\r\n\r\n\tconstructor(\r\n\t\telement: Element,\r\n\t\tfrom: {\r\n\t\t\tp1: number[];\r\n\t\t\tp2: number[][];\r\n\t\t},\r\n\t\tto: {\r\n\t\t\tp1: number[];\r\n\t\t\tp2: number[][];\r\n\t\t},\r\n\t\trenderer: PixiRenderer<any>,\r\n\t\tindex: number\r\n\t) {\r\n\t\tsuper();\r\n\t\tthis._zIndex = 999;\r\n\t\tthis._element = element;\r\n\t\tthis._renderer = renderer;\r\n\t\tthis._index = index;\r\n\t\tthis._from = from;\r\n\t\tthis._to = to;\r\n\r\n\t\t// this._size = Number(\r\n\t\t// \tvec2.distance(vec2.fromValues(from.p1[0], from.p1[1]), vec2.fromValues(to.p1[0], to.p1[1])).toFixed(0)\r\n\t\t// );\r\n\r\n\t\t// const v = vec2.fromValues(to.p1[0] - from.p1[0], to.p1[1] - from.p1[1]);\r\n\r\n\t\t// const angle = vec2.angle(v, vec2.fromValues(v[0], 0));\r\n\t\t// this._angle = v[0] * v[1] >= 0 ? angle : -angle;\r\n\r\n\t\t// this._center = [(from.p2[0][0] + from.p2[1][0]) / 2, (from.p2[0][1] + from.p2[1][1]) / 2];\r\n\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t\tthis.interactive = false;\r\n\t\tthis.buttonMode = false;\r\n\t\tthis.mount();\r\n\t}\r\n\r\n\tpublic mount(): void {\r\n\t\tthis._text = new Text(\"Length: \", {\r\n\t\t\tfontFamily: \"PingFangSC-Regular, PingFang SC\",\r\n\t\t\tfontSize: 11,\r\n\t\t\tfill: 0x000000,\r\n\t\t\talign: \"center\",\r\n\t\t\tfontWeight: \"400\",\r\n\t\t});\r\n\t\tthis._text.resolution = 2;\r\n\t\tthis._text.anchor.set(this._element.x || 0, this._element.y || 0);\r\n\t\t// this._text.text = `${this._index} - ${this._size} -${(this._angle * RAD_TO_DEG).toFixed(0)}`;\r\n\t\tthis._text.text = `${this._size.toFixed(0)}`;\r\n\t\tthis._text.zIndex = 999;\r\n\t\tthis._text.angle = this._angle * RAD_TO_DEG;\r\n\t\tthis.addChild(this._text);\r\n\t}\r\n\r\n\tpublic unmount(): void {\r\n\t\t// console.log('dimension spot unmount');\r\n\t\tthis.clear();\r\n\t\tif (this._text) {\r\n\t\t\tthis.removeChild(this._text);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * _invalidate\r\n\t */\r\n\tpublic _invalidate(): void {\r\n\t\t// console.log('_invalidate');\r\n\t\t// this.unmount();\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * validate\r\n\t */\r\n\tpublic _validate(): void {\r\n\t\t// console.log('_validate');\r\n\t\tconst from = this._from,\r\n\t\t\tto = this._to;\r\n\t\tthis._from = from;\r\n\t\tthis._to = to;\r\n\t\tif (!from || !to || !from.p1 || !to.p1) {\r\n\t\t\tthis.unmount();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._size = Number(\r\n\t\t\tvec2.distance(\r\n\t\t\t\tvec2.fromValues(from.p1[0], from.p1[1]),\r\n\t\t\t\tvec2.fromValues(to.p1[0], to.p1[1])\r\n\t\t\t)\r\n\t\t);\r\n\r\n\t\tconst v = vec2.fromValues(to.p1[0] - from.p1[0], to.p1[1] - from.p1[1]);\r\n\t\tconst angle = vec2.angle(v, vec2.fromValues(v[0], 0));\r\n\t\tthis._angle = v[0] * v[1] >= 0 ? angle : -angle;\r\n\t\tthis._center = [\r\n\t\t\t(from.p1[0] + to.p1[0]) / 2,\r\n\t\t\t(from.p1[1] + to.p1[1]) / 2,\r\n\t\t];\r\n\r\n\t\tthis._updateStyles();\r\n\t\tthis._validateImpl();\r\n\t}\r\n\r\n\tprotected _validateImpl(): void {\r\n\t\tthis._draw();\r\n\t}\r\n\r\n\t/**\r\n\t * update Styles\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tthis.interactive = element.styles.dimensionGizmoInteractive;\r\n\t\tthis.buttonMode = element.styles.dimensionGizmoButtonMode;\r\n\t\tthis.zIndex = element.styles.dimensionGizmoZIndex;\r\n\t\tif (this._text) {\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\tthis._text.getLocalBounds(rect);\r\n\t\t\tthis._text.x = this._center[0];\r\n\t\t\tthis._text.y = this._center[1];\r\n\t\t\tthis._text.anchor.set(0.5, 0.5);\r\n\t\t\t// this._text.text = `${this._index} - ${this._size} -${(this._angle * RAD_TO_DEG).toFixed(0)}`;\r\n\t\t\tthis._text.text = `${this._size.toFixed(0)}`;\r\n\t\t\tthis._text.angle = this._angle * RAD_TO_DEG;\r\n\t\t\tthis._text.zIndex = element.styles.dimensionGizmoZIndex + 1;\r\n\t\t\t// this.x = this._center[0];\r\n\t\t\t// this.y = this._center[1];\r\n\t\t}\r\n\t\tthis.visible = this._size > 20; // 100 mm\r\n\t}\r\n\r\n\tprotected _draw() {\r\n\t\tthis.clear();\r\n\t\tthis._drawBody();\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tpublic _drawBody(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\r\n\t\tconst from = this._from,\r\n\t\t\tto = this._to;\r\n\r\n\t\tconst fromV = vec2.fromValues(from.p1[0], from.p1[1]);\r\n\t\tconst toV = vec2.fromValues(to.p1[0], to.p1[1]);\r\n\t\tconst fromToV = vec2.fromValues(\r\n\t\t\tto.p1[0] - from.p1[0],\r\n\t\t\tto.p1[1] - from.p1[1]\r\n\t\t);\r\n\t\tconst fromToVN = vec2.create(); // normalize\r\n\t\tvec2.normalize(fromToVN, fromToV);\r\n\t\tconst fromRotateV = vec2.create();\r\n\t\tvec2.rotate(\r\n\t\t\tfromRotateV,\r\n\t\t\tfromToV,\r\n\t\t\tvec2.fromValues(0, 0),\r\n\t\t\t-90 * DEG_TO_RAD\r\n\t\t);\r\n\t\tvec2.normalize(fromRotateV, fromRotateV);\r\n\t\tconst fromRotateV_Center = vec2.create();\r\n\t\tvec2.scaleAndAdd(fromRotateV_Center, fromV, fromRotateV, 5);\r\n\t\tvec2.scaleAndAdd(fromRotateV, fromV, fromRotateV, 10);\r\n\t\tthis.lineStyle(0.4, 0xcdcdcd, 0.55);\r\n\t\tthis.moveTo(fromV[0], fromV[1]);\r\n\t\tthis.lineTo(fromRotateV[0], fromRotateV[1]);\r\n\t\tthis.closePath();\r\n\r\n\t\tconst toRotateV = vec2.create();\r\n\t\tvec2.rotate(\r\n\t\t\ttoRotateV,\r\n\t\t\tfromToV,\r\n\t\t\tvec2.fromValues(0, 0),\r\n\t\t\t-90 * DEG_TO_RAD\r\n\t\t);\r\n\t\tvec2.normalize(toRotateV, toRotateV);\r\n\t\tconst toRotateV_Center = vec2.create();\r\n\t\tvec2.scaleAndAdd(toRotateV_Center, toV, toRotateV, 5);\r\n\t\tvec2.scaleAndAdd(toRotateV, toV, toRotateV, 10);\r\n\t\tthis.lineStyle(0.4, 0xcdcdcd, 0.55);\r\n\t\tthis.moveTo(toV[0], toV[1]);\r\n\t\tthis.lineTo(toRotateV[0], toRotateV[1]);\r\n\t\tthis.closePath();\r\n\r\n\t\tthis.lineStyle(1, 0xcdcdcd, 0.55);\r\n\t\tthis.moveTo(fromRotateV_Center[0], fromRotateV_Center[1]);\r\n\t\tthis.lineTo(toRotateV_Center[0], toRotateV_Center[1]);\r\n\t\tthis.closePath();\r\n\r\n\t\tthis._center = [\r\n\t\t\t(fromRotateV_Center[0] + toRotateV_Center[0]) / 2,\r\n\t\t\t(fromRotateV_Center[1] + toRotateV_Center[1]) / 2,\r\n\t\t];\r\n\t\tif (this._text) {\r\n\t\t\tthis._text.x = this._center[0];\r\n\t\t\tthis._text.y = this._center[1];\r\n\t\t}\r\n\t\t// old\r\n\t\treturn;\r\n\t\tif (element.debug) {\r\n\t\t\t/* this.lineStyle(1, 0x000000, 1);\r\n\t\t\tthis.moveTo(from.p1[0], from.p1[1]);\r\n\t\t\tthis.lineTo(from.p2[0][0], from.p2[0][1]);\r\n\t\t\tthis.closePath();\r\n\t\t\tthis.lineStyle(1, 0x000000, 1);\r\n\t\t\tthis.moveTo(from.p1[0], from.p1[1]);\r\n\t\t\tthis.lineTo(from.p2[1][0], from.p2[1][1]);\r\n\t\t\tthis.closePath(); */\r\n\t\t\t// this.lineStyle(1, 0x0000ff, 1);\r\n\t\t\t// this.moveTo(to.p1[0], to.p1[1]);\r\n\t\t\t// this.lineTo(from.p2[2][0], from.p2[2][1]);\r\n\t\t\t// this.closePath();\r\n\t\t}\r\n\r\n\t\t// this.lineStyle(0.4, 0x000000, 0.55);\r\n\t\t// this.moveTo(from.p1[0], from.p1[1]);\r\n\t\t// this.lineTo(from.p2[0][0], from.p2[0][1]);\r\n\t\t// this.closePath();\r\n\r\n\t\tif (!from.p2 || !to.p2) return;\r\n\r\n\t\t//  |--------|\r\n\t\tthis.lineStyle(0.4, 0xcdcdcd, 0.55);\r\n\t\tthis.moveTo(from.p1[0], from.p1[1]);\r\n\t\tthis.lineTo(from.p2[0][0], from.p2[0][1]);\r\n\t\tthis.closePath();\r\n\r\n\t\tthis.lineStyle(0.4, 0xcdcdcd, 0.55);\r\n\t\tthis.moveTo(to.p1[0], to.p1[1]);\r\n\t\tthis.lineTo(from.p2[1][0], from.p2[1][1]);\r\n\t\tthis.closePath();\r\n\r\n\t\t//  ----------\r\n\t\tconst out1 = vec2.create();\r\n\t\tvec2.scaleAndAdd(\r\n\t\t\tout1,\r\n\t\t\tvec2.fromValues(from.p1[0], from.p1[1]),\r\n\t\t\tvec2.fromValues(\r\n\t\t\t\tfrom.p2[0][0] - from.p1[0],\r\n\t\t\t\tfrom.p2[0][1] - from.p1[1]\r\n\t\t\t),\r\n\t\t\t0.5\r\n\t\t);\r\n\t\t// this.lineStyle(0.4, 0xcdcdcd, 0.55);\r\n\t\t// this.moveTo(to.p1[0], to.p1[1]);\r\n\t\t// this.lineTo(from.p2[2][0], from.p2[2][1]);\r\n\t\t// this.closePath();\r\n\r\n\t\tconst out2 = vec2.create();\r\n\t\tvec2.scaleAndAdd(\r\n\t\t\tout2,\r\n\t\t\tvec2.fromValues(to.p1[0], to.p1[1]),\r\n\t\t\tvec2.fromValues(from.p2[1][0] - to.p1[0], from.p2[1][1] - to.p1[1]),\r\n\t\t\t0.5\r\n\t\t);\r\n\r\n\t\tthis.lineStyle(1, 0xcdcdcd, 0.55);\r\n\t\tthis.moveTo(out1[0], out1[1]);\r\n\t\tthis.lineTo(out2[0], out2[1]);\r\n\t\tthis.closePath();\r\n\r\n\t\tthis._center = [(out1[0] + out2[0]) / 2, (out1[1] + out2[1]) / 2];\r\n\r\n\t\t// const angle = this._angle;\r\n\t\t// const center = this._center;\r\n\t\t// const a = Math.sin(angle);\r\n\t\t// const b = Math.cos(angle);\r\n\t\t// const tx = center[0] * (1 - b) + center[1] * a;\r\n\t\t// const ty = center[1] * (1 - b) - center[0] * a;\r\n\t\t// const matrix = mat2d.fromValues(b, a, -a, b, tx, ty);\r\n\t\t// this.setMatrix(new Matrix(matrix[0], matrix[1], matrix[2], matrix[3], matrix[4], matrix[5]));\r\n\t\t// const scaled = this._renderer.getScaled();\r\n\t\t// let height = scaled < 1 ? 2 / scaled : 2;\r\n\t\t// let width = this._size;\r\n\t\t// this.beginFill(this._fillColor, this._fillAlpha);\r\n\t\t// this.drawRect(this._center[0] - width / 2, this._center[1] - height / 2, width, height);\r\n\t\t// this.endFill();\r\n\t\t// this.setMatrix(new Matrix());\r\n\t}\r\n\r\n\t/**\r\n\t * set fill color\r\n\t */\r\n\tpublic set fillColor(color: number) {\r\n\t\tthis._fillColor = color;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tpublic set center(center: number[]) {\r\n\t\tthis._center = center;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tpublic setAngle(angle: number) {\r\n\t\tthis._angle = angle;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tpublic update() {\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t}\r\n\r\n\t/**\r\n\t * handle zoomed\r\n\t * @param e\r\n\t */\r\n\thandle_zoomed(evt: InteractionEvent) {\r\n\t\t// console.log(evt)\r\n\t}\r\n\r\n\t/**\r\n\t * handle panned\r\n\t * @param e\r\n\t */\r\n\thandle_panned(evt: InteractionEvent) {\r\n\t\t// console.log(evt)\r\n\t}\r\n\r\n\tisCtrlDown(evt: KeyboardEvent) {\r\n\t\treturn evt.ctrlKey || evt.metaKey;\r\n\t}\r\n\r\n\t/**\r\n\t * mouse down\r\n\t * @param e\r\n\t */\r\n\thandle_mousedown(evt: InteractionEvent): void {\r\n\t\tevt.stopPropagation();\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tconst hitTarget = renderer.renderer.plugins.interaction.hitTest(\r\n\t\t\tevt.data.global\r\n\t\t);\r\n\t\tthis._hitTarget = hitTarget;\r\n\t\tif (hitTarget instanceof DimensionSpot) {\r\n\t\t}\r\n\t\tif (this._doubleClickedTimeout) {\r\n\t\t\tclearTimeout(this._doubleClickedTimeout);\r\n\t\t\tthis._doubleClickedTimeout = null;\r\n\t\t} else {\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * mouse up\r\n\t * @param e\r\n\t */\r\n\thandle_mouseup(evt: InteractionEvent): void {\r\n\t\tthis._doubleClickedTimeout = setTimeout(() => {\r\n\t\t\tthis._doubleClickedTimeout = null;\r\n\t\t}, 300);\r\n\t\t// this.__dragEnd(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * mouse move\r\n\t * @param e\r\n\t */\r\n\thandle_mousemove(evt: InteractionEvent): void {\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\t// this.__dragMove(evt);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseout(evt: InteractionEvent): void {\r\n\t\tthis._fillColor = 0x7c7c7c;\r\n\t\tthis._fillAlpha = 0.1;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseover(evt: InteractionEvent): void {\r\n\t\tthis._fillColor = 0x3477fc;\r\n\t\tthis._fillAlpha = 1.0;\r\n\t}\r\n\r\n\t/**\r\n\t * drag start\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragStart(evt: InteractionEvent) { }\r\n\r\n\t/**\r\n\t * drag Move\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragMove(evt: InteractionEvent) { }\r\n\r\n\t/**\r\n\t * drag End\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragEnd(evt: InteractionEvent) { }\r\n\r\n\t/**\r\n\t * key down event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keydown(evt: KeyboardEvent): void { }\r\n\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keyup(evt: KeyboardEvent): void { }\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_contextmenu(e: any): void {\r\n\t\te.preventDefault();\r\n\t\tthis.__dragEnd(e);\r\n\t}\r\n\r\n\tprotected translate(dx: number, dy: number) {\r\n\t\tthis._center[0] += dx;\r\n\t\tthis._center[1] += dy;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tpublic setSize(size: number) {\r\n\t\tthis._size = size;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param from\r\n\t */\r\n\tpublic setFrom(from: { p1: number[]; p2: number[][] }) {\r\n\t\tthis._from = from;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param to\r\n\t */\r\n\tpublic setTo(to: { p1: number[]; p2: number[][] }) {\r\n\t\tthis._to = to;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param from\r\n\t * @param to\r\n\t */\r\n\tpublic setFromTo(\r\n\t\tfrom: {\r\n\t\t\tp1: number[];\r\n\t\t\tp2: number[][];\r\n\t\t},\r\n\t\tto: {\r\n\t\t\tp1: number[];\r\n\t\t\tp2: number[][];\r\n\t\t}\r\n\t) {\r\n\t\tthis._from = from;\r\n\t\tthis._to = to;\r\n\t\tthis.update();\r\n\t}\r\n}\r\n","import { Element } from \"@blood4/modeling\";\r\nimport {\r\n\tSprite,\r\n\tTexture,\r\n\tInteractionEvent,\r\n\tPoint,\r\n\tGraphics,\r\n\tDEG_TO_RAD,\r\n\tMatrix,\r\n} from \"pixi.js\";\r\nimport { PixiRenderer } from \"../../PixiRenderer\";\r\nimport { InteractionEvents } from \"../../events\";\r\nimport { DefaultInteraction } from \"../../interaction/DefaultInteraction\";\r\n\r\nexport class RotateSpot extends Graphics {\r\n\tprotected _element: Element;\r\n\tprotected _renderer: PixiRenderer<any>;\r\n\tprotected _center: number[] = [0, 0];\r\n\tprotected _offset: number[] = [0, 0];\r\n\tprotected _fillColor = 0xcdcdcd;\r\n\tprotected _sprite?: Sprite;\r\n\tprotected _url: string;\r\n\r\n\t_mousedownEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseupEvent!: (evt: InteractionEvent) => void;\r\n\t_mousemoveEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseoutEvent!: (evt: InteractionEvent) => void;\r\n\r\n\t_hitTarget?: RotateSpot;\r\n\t_isDragging = false;\r\n\t_mousePoint?: Point = undefined;\r\n\t_ctrlDown: boolean = false;\r\n\t_doubleClickedTimeout: NodeJS.Timeout | null = null;\r\n\r\n\tconstructor(\r\n\t\telement: Element,\r\n\t\trenderer: PixiRenderer<any>,\r\n\t\tcenter: number[],\r\n\t\toffset: number[],\r\n\t\turl: string,\r\n\t\tname?: string\r\n\t) {\r\n\t\t// super(Texture.from(url));\r\n\t\tsuper();\r\n\t\tthis._element = element;\r\n\t\tthis._renderer = renderer;\r\n\t\tthis._center = center;\r\n\t\tthis._offset = offset;\r\n\t\tthis._url = url;\r\n\t\tthis.interactive = true;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.cursor = \"pointer\";\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t\tthis.mount();\r\n\t}\r\n\r\n\tpublic mount(): void {\r\n\t\t// console.log('drag spot mount');\r\n\t\tthis._mousedownEvent = this.handle_mousedown.bind(this);\r\n\t\tthis._mouseupEvent = this.handle_mouseup.bind(this);\r\n\t\tthis._mousemoveEvent = this.handle_mousemove.bind(this);\r\n\t\tthis._mouseoutEvent = this.handle_mouseout.bind(this);\r\n\t\tthis.on(\"mousedown\", this._mousedownEvent);\r\n\t\tthis.on(\"mouseup\", this._mouseupEvent);\r\n\t\t// this.on('mouseout', this._mouseoutEvent);\r\n\t\t// this.on('mousemove', this._mousemoveEvent);\r\n\t\tif (!this._sprite) {\r\n\t\t\tconst sprite = new Sprite(Texture.from(this._url));\r\n\t\t\tsprite.anchor.set(0.5);\r\n\t\t\tsprite.scale.set(0.5, 0.5);\r\n\t\t\tsprite.x = 0;\r\n\t\t\tsprite.y = 0;\r\n\t\t\tthis.addChild(sprite);\r\n\t\t\tthis._sprite = sprite;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic unmount(): void {\r\n\t\t// console.log('drag spot unmount');\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tthis.off(\"mousedown\", this._mousedownEvent);\r\n\t\tthis.off(\"mouseup\", this._mouseupEvent);\r\n\t\tthis.off(\"mousemove\", this._mousemoveEvent);\r\n\t\tif (viewport) {\r\n\t\t\tviewport.off(\"mousemove\", this._mousemoveEvent);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * _invalidate\r\n\t */\r\n\tpublic _invalidate(): void {\r\n\t\t// console.log('_invalidate');\r\n\t\t// this.unmount();\r\n\t}\r\n\r\n\t/**\r\n\t * validate\r\n\t */\r\n\tpublic _validate(): void {\r\n\t\t// console.log('_validate');\r\n\t\tthis._updateStyles();\r\n\t\tthis._validateImpl();\r\n\t}\r\n\r\n\tprotected _validateImpl(): void {\r\n\t\tthis._draw();\r\n\t}\r\n\r\n\t/**\r\n\t * update Styles\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tif (element.resizing) {\r\n\t\t\tthis.visible = false;\r\n\t\t} else {\r\n\t\t\tthis.visible = element.selected;\r\n\t\t}\r\n\t\tconst x = this._center[0] + this._offset[0];\r\n\t\tconst y = this._center[1] + this._offset[1];\r\n\t\tconst center = element.center;\r\n\t\tconst a = Math.sin(element.angle * DEG_TO_RAD);\r\n\t\tconst b = Math.cos(element.angle * DEG_TO_RAD);\r\n\t\tconst tx = center[0] * (1 - b) + center[1] * a;\r\n\t\tconst ty = center[1] * (1 - b) - center[0] * a;\r\n\t\tconst matrix = new Matrix(b, a, -a, b, tx, ty);\r\n\t\tconst out = matrix.apply(new Point(x, y));\r\n\t\tthis.x = out.x;\r\n\t\tthis.y = out.y;\r\n\t\tconst scale = this._renderer?.getScaled() || 1;\r\n\t\tthis.scale.x = 1 / scale;\r\n\t\tthis.scale.y = 1 / scale;\r\n\t}\r\n\r\n\tprotected _draw() {\r\n\t\tthis._drawBody();\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tpublic _drawBody(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\t// this.lineStyle(1.5, 0x737373, 1.0);\r\n\t\t// this.beginFill(0xffff00, 1.0);\r\n\t\t// this.drawCircle(0, 0, 10);\r\n\t}\r\n\r\n\t/**\r\n\t * set fill color\r\n\t */\r\n\tpublic set fillColor(color: number) {\r\n\t\tthis._fillColor = color;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tpublic set center(center: number[]) {\r\n\t\tthis._center = center;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tpublic update() {\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t}\r\n\r\n\t/**\r\n\t * handle zoomed\r\n\t * @param e\r\n\t */\r\n\thandle_zoomed(evt: InteractionEvent) { }\r\n\r\n\t/**\r\n\t * handle panned\r\n\t * @param e\r\n\t */\r\n\thandle_panned(evt: InteractionEvent) { }\r\n\r\n\tisCtrlDown(evt: KeyboardEvent) {\r\n\t\treturn evt.ctrlKey || evt.metaKey;\r\n\t}\r\n\r\n\t/**\r\n\t * mouse down\r\n\t * @param e\r\n\t */\r\n\thandle_mousedown(evt: InteractionEvent): void {\r\n\t\tevt.stopPropagation();\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tconst hitTarget = renderer.renderer.plugins.interaction.hitTest(\r\n\t\t\tevt.data.global\r\n\t\t);\r\n\t\tthis._hitTarget = hitTarget;\r\n\t\tif (hitTarget instanceof RotateSpot) {\r\n\t\t\tthis.__dragStart(evt);\r\n\t\t\tviewport.on(\"mousemove\", this._mousemoveEvent);\r\n\t\t\tviewport.on(\"mouseout\", this._mouseoutEvent);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * mouse up\r\n\t * @param e\r\n\t */\r\n\thandle_mouseup(evt: InteractionEvent): void {\r\n\t\tthis.__dragEnd(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * mouse move\r\n\t * @param e\r\n\t */\r\n\thandle_mousemove(evt: InteractionEvent): void {\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tthis.__dragMove(evt);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseout(evt: InteractionEvent): void {\r\n\t\tthis.__dragEnd(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * drag start\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragStart(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (this._isDragging) return;\r\n\t\tif (hitTarget instanceof RotateSpot) {\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\t\t// this._isDragging = true;\r\n\t\t\t// console.log('__dragStart', this._isDragging);\r\n\t\t\t// if (!hitTarget._element.rotating) {\r\n\t\t\t// \thitTarget._element.rotating = true;\r\n\t\t\t// }\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * drag Move\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragMove(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tif (!hitTarget || !hitTarget.parent) return;\r\n\t\tconst position = evt.data.getLocalPosition(hitTarget.parent);\r\n\t\tif (!this._isDragging && this._mousePoint) {\r\n\t\t\tif (\r\n\t\t\t\tMath.abs(position.x - this._mousePoint.x) >= 0.1 ||\r\n\t\t\t\tMath.abs(position.y - this._mousePoint.y) >= 0.1\r\n\t\t\t) {\r\n\t\t\t\tthis._isDragging = true;\r\n\t\t\t\tif (!hitTarget._element.rotating) {\r\n\t\t\t\t\thitTarget._element.rotating = true;\r\n\t\t\t\t}\r\n\t\t\t\tconst interactionManager = this._renderer.interactionManager;\r\n\t\t\t\tconst currentInteraction =\r\n\t\t\t\t\tinteractionManager.getCurrentInteraction();\r\n\t\t\t\tif (currentInteraction instanceof DefaultInteraction) {\r\n\t\t\t\t\tcurrentInteraction.emit(InteractionEvents.RotateStart, {\r\n\t\t\t\t\t\tsource: this,\r\n\t\t\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport || !this._isDragging || !this._mousePoint) return;\r\n\t\tif (hitTarget instanceof RotateSpot && hitTarget.parent.parent) {\r\n\t\t\tconst center = hitTarget.parent.parent.getGlobalPosition();\r\n\t\t\tconst element = hitTarget._element;\r\n\t\t\tconst angle = this._calculateAngle(\r\n\t\t\t\t[center.x, center.y],\r\n\t\t\t\t[evt.data.global.x, evt.data.global.y]\r\n\t\t\t);\r\n\t\t\telement.angle = -angle;\r\n\t\t\tconst interactionManager = renderer.interactionManager;\r\n\t\t\tconst current = interactionManager.getCurrentInteraction();\r\n\t\t\tif (current instanceof DefaultInteraction) {\r\n\t\t\t\tcurrent?.emit(InteractionEvents.Rotating, {\r\n\t\t\t\t\tsource: this,\r\n\t\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param center\r\n\t * @param point\r\n\t */\r\n\t_calculateAngle(center: number[], point: number[]) {\r\n\t\treturn -Math.round(\r\n\t\t\t(Math.atan2(center[0] - point[0], point[1] - center[1]) * 180) /\r\n\t\t\tMath.PI\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * drag End\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragEnd(evt: InteractionEvent) {\r\n\t\tif (this._isDragging) {\r\n\t\t\tthis._isDragging = false;\r\n\t\t\tthis.off(\"mousemove\", this._mousemoveEvent);\r\n\t\t\t// evt.stopPropagation();\r\n\t\t\tconst hitTarget = this._hitTarget;\r\n\t\t\tif (hitTarget && hitTarget._element) {\r\n\t\t\t\thitTarget._element.rotating = false;\r\n\t\t\t\tconst interactionManager = this._renderer.interactionManager;\r\n\t\t\t\tconst currentInteraction =\r\n\t\t\t\t\tinteractionManager.getCurrentInteraction();\r\n\t\t\t\tif (currentInteraction instanceof DefaultInteraction) {\r\n\t\t\t\t\tcurrentInteraction.emit(InteractionEvents.RotateEnd, {\r\n\t\t\t\t\t\tsource: this,\r\n\t\t\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._mousePoint = undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * key down event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keydown(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keyup(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t}\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_contextmenu(e: any): void {\r\n\t\te.preventDefault();\r\n\t\tthis.__dragEnd(e);\r\n\t}\r\n\r\n\tprotected translate(dx: number, dy: number) {\r\n\t\tthis._center[0] += dx;\r\n\t\tthis._center[1] += dy;\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tset offset(offset: number[]) {\r\n\t\tthis._offset = offset;\r\n\t\tthis.update();\r\n\t}\r\n}\r\n","import { vec2 } from \"gl-matrix\";\r\nimport { InteractionEvent } from \"pixi.js\";\r\nimport { Element, SHAPE } from \"@blood4/modeling\";\r\nimport { KeyboardEvents } from \"../events\";\r\nimport { DefaultInteraction } from \"../interaction/DefaultInteraction\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\nimport { BaseGizmo } from \"./BaseGizmo\";\r\nimport { DragSpot } from \"./spots\";\r\nimport { RotateSpot } from \"./spots/RotateSpot\";\r\n\r\nexport class EditorGizmo extends BaseGizmo {\r\n\tprivate _dragSpots: Map<string | number, DragSpot> = new Map();\r\n\tprivate _rotateSpot?: RotateSpot;\r\n\t_zoomedEvent!: (evt: InteractionEvent) => void;\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper(element, renderer);\r\n\t\tthis.interactive = true;\r\n\t\tthis.buttonMode = true;\r\n\t\tthis._element = element;\r\n\t\tthis.visible = element.selected;\r\n\t\tthis.zIndex = element.styles.editorGizmoZIndex;\r\n\t\tthis.visible = element.styles.editorGizmoVisible;\r\n\t\tthis.cursor = element.styles.editorGizmoCursor;\r\n\t\tthis.mount();\r\n\t\tthis._eventEmitter.on(KeyboardEvents.ShiftKey, (evt: any) => {\r\n\t\t\tthis.unmount();\r\n\t\t\tthis.mount();\r\n\t\t});\r\n\t\t// this._eventEmitter.on(KeyboardEvents.CtrlKeyDown, (evt: any) => {\r\n\t\t// \tif (this._dragSpots) {\r\n\t\t// \t\tthis._dragSpots.forEach((spot: DragSpot) => {\r\n\t\t// \t\t\tspot.unmount();\r\n\t\t// \t\t});\r\n\t\t// \t\tthis._dragSpots.clear();\r\n\t\t// \t}\r\n\t\t// });\r\n\t\t// this._eventEmitter.on(KeyboardEvents.CtrlKeyUp, (evt: any) => {\r\n\t\t// \tthis.unmount();\r\n\t\t// \tthis.mount();\r\n\t\t// });\r\n\t}\r\n\r\n\t/**\r\n\t * _invalidate\r\n\t */\r\n\tpublic _invalidate(): void {\r\n\t\t// console.log('_invalidate');\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * validate\r\n\t */\r\n\tpublic _validate(): void {\r\n\t\t// console.log('_validate');\r\n\t\tthis._updateStyles();\r\n\t\tthis._validateImpl();\r\n\t}\r\n\r\n\t/**\r\n\t * update Styles\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tconst element: Element = this._element;\r\n\t\tif (!element) return;\r\n\t\tthis.visible = element.selected;\r\n\t\tthis.zIndex = element.styles.editorGizmoZIndex;\r\n\t\tthis.visible = element.styles.editorGizmoVisible;\r\n\t\tthis.cursor = element.styles.editorGizmoCursor;\r\n\t\t// if (element.mode === ElementType.Show) {\r\n\t\t// \tthis.interactive = false;\r\n\t\t// \tthis.buttonMode = false;\r\n\t\t// } else {\r\n\t\t// \tthis.interactive = true;\r\n\t\t// \tthis.buttonMode = true;\r\n\t\t// }\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tprotected _drawBody(): void {\r\n\t\tconst element = this._element,\r\n\t\t\trenderer = this._renderer;\r\n\t\tif (!element || !renderer) return;\r\n\t\tthis.clear();\r\n\t\tconst interactionManager = renderer.interactionManager;\r\n\t\tconst current = interactionManager.getCurrentInteraction();\r\n\t\tif (!(current instanceof DefaultInteraction)) return;\r\n\t\tif (\r\n\t\t\telement.type === SHAPE.AlignLine ||\r\n\t\t\telement.type === SHAPE.Line ||\r\n\t\t\telement.type === SHAPE.ShapeLine\r\n\t\t) {\r\n\t\t\tconst points = element.points;\r\n\t\t\tif (points && this._dragSpots && this._dragSpots.size > 0) {\r\n\t\t\t\tthis._dragSpots.forEach(\r\n\t\t\t\t\t(dragSpot: DragSpot, key: string | number) => {\r\n\t\t\t\t\t\tconst point = points[Number(key)];\r\n\t\t\t\t\t\tdragSpot.center = point;\r\n\t\t\t\t\t\tdragSpot.mode = \"resize\";\r\n\t\t\t\t\t\tdragSpot.update();\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (current._shiftDown) {\r\n\t\t\t\t// AABB\r\n\t\t\t\tconst points = element.getAABB().points;\r\n\t\t\t\tif (points && this._dragSpots && this._dragSpots.size > 0) {\r\n\t\t\t\t\tconst path: number[] = [];\r\n\t\t\t\t\tpoints.forEach((point: any) => {\r\n\t\t\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.lineStyle(0.6, 0x3477fc, 0.5);\r\n\t\t\t\t\tthis.drawPolygon(path);\r\n\r\n\t\t\t\t\tthis._dragSpots.forEach(\r\n\t\t\t\t\t\t(dragSpot: DragSpot, key: string | number) => {\r\n\t\t\t\t\t\t\tconst point = points[Number(key)];\r\n\t\t\t\t\t\t\tif (point) {\r\n\t\t\t\t\t\t\t\tdragSpot.center = point;\r\n\t\t\t\t\t\t\t\tdragSpot.mode = \"scale\";\r\n\t\t\t\t\t\t\t\tdragSpot.update();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconst from = points[Number(key) - 0.5],\r\n\t\t\t\t\t\t\t\t\tto =\r\n\t\t\t\t\t\t\t\t\t\tpoints[\r\n\t\t\t\t\t\t\t\t\t\t(Number(key) - 0.5 + 1) %\r\n\t\t\t\t\t\t\t\t\t\tpoints.length\r\n\t\t\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t\tif (!from || !to) {\r\n\t\t\t\t\t\t\t\t\tthis.unmount();\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tconst center = [\r\n\t\t\t\t\t\t\t\t\t(from[0] + to[0]) / 2,\r\n\t\t\t\t\t\t\t\t\t(from[1] + to[1]) / 2,\r\n\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t\tdragSpot.center = center;\r\n\t\t\t\t\t\t\t\tdragSpot.mode = \"scale\";\r\n\t\t\t\t\t\t\t\tdragSpot.update();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tif (this._rotateSpot) {\r\n\t\t\t\t\tthis._rotateSpot.unmount();\r\n\t\t\t\t\tthis._rotateSpot.visible = false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst points = element.points;\r\n\t\t\t\t// , \r\n\t\t\t\tif (points && this._dragSpots && this._dragSpots.size > 0) {\r\n\t\t\t\t\tthis._dragSpots.forEach(\r\n\t\t\t\t\t\t(dragSpot: DragSpot, key: string | number) => {\r\n\t\t\t\t\t\t\tconst from = points[Number(key) - 0.5],\r\n\t\t\t\t\t\t\t\tto =\r\n\t\t\t\t\t\t\t\t\tpoints[\r\n\t\t\t\t\t\t\t\t\t(Number(key) - 0.5 + 1) % points.length\r\n\t\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\tif (!from || !to) {\r\n\t\t\t\t\t\t\t\tthis.unmount();\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst v = vec2.fromValues(\r\n\t\t\t\t\t\t\t\tto[0] - from[0],\r\n\t\t\t\t\t\t\t\tto[1] - from[1]\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tconst angle = vec2.angle(\r\n\t\t\t\t\t\t\t\tv,\r\n\t\t\t\t\t\t\t\tvec2.fromValues(v[0], 0)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tconst center = [\r\n\t\t\t\t\t\t\t\t(from[0] + to[0]) / 2,\r\n\t\t\t\t\t\t\t\t(from[1] + to[1]) / 2,\r\n\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\tdragSpot.center = center;\r\n\t\t\t\t\t\t\tdragSpot.mode = \"resize\";\r\n\t\t\t\t\t\t\tdragSpot.setAngle(v[0] * v[1] > 0 ? angle : -angle);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tif (this._rotateSpot) {\r\n\t\t\t\t\tconst size = element.size;\r\n\t\t\t\t\tthis._rotateSpot.center = [element.x, element.y];\r\n\t\t\t\t\tthis._rotateSpot.offset = [0, size[1] / 2 + 52 / 2];\r\n\t\t\t\t\tthis._rotateSpot.visible = !element.resizing;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * set up interaction event\r\n\t */\r\n\tpublic mount(): void {\r\n\t\tthis._keydownEvent = this.handle_keydown.bind(this);\r\n\t\tthis._keyupEvent = this.handle_keyup.bind(this);\r\n\t\tdocument.addEventListener(\"keydown\", this._keydownEvent);\r\n\t\tdocument.addEventListener(\"keyup\", this._keyupEvent);\r\n\r\n\t\t// console.log('mount editor gizmo');\r\n\t\tconst element = this._element,\r\n\t\t\trenderer = this._renderer;\r\n\t\tif (!element || !renderer) return;\r\n\t\tconst interactionManager = renderer.interactionManager;\r\n\t\tconst current = interactionManager.getCurrentInteraction();\r\n\r\n\t\tthis._zoomedEvent = this.handle_zoomed.bind(this);\r\n\t\trenderer.viewport?.on(\"zoomed\", this._zoomedEvent);\r\n\r\n\t\tif (!(current instanceof DefaultInteraction)) return;\r\n\t\tif (\r\n\t\t\telement.type === SHAPE.AlignLine ||\r\n\t\t\telement.type === SHAPE.Line ||\r\n\t\t\telement.type === SHAPE.ShapeLine\r\n\t\t) {\r\n\t\t\tconst points = element.points;\r\n\t\t\tif (points) {\r\n\t\t\t\tpoints.forEach((point: number[], index: number) => {\r\n\t\t\t\t\tconst dragSpot = new DragSpot(\r\n\t\t\t\t\t\telement,\r\n\t\t\t\t\t\trenderer,\r\n\t\t\t\t\t\tpoint,\r\n\t\t\t\t\t\tindex,\r\n\t\t\t\t\t\telement.angle,\r\n\t\t\t\t\t\t\"circle\"\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis._dragSpots.set(index, dragSpot);\r\n\t\t\t\t\tthis.addChild(dragSpot);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else if (element.type === SHAPE.Domain) {\r\n\t\t\tif (current._shiftDown) {\r\n\t\t\t\t// AABB\r\n\t\t\t\tconst points = element.getAABB().points;\r\n\t\t\t\tpoints.forEach((point: number[], index: number) => {\r\n\t\t\t\t\tconst dragSpot = new DragSpot(\r\n\t\t\t\t\t\telement,\r\n\t\t\t\t\t\trenderer,\r\n\t\t\t\t\t\tpoint,\r\n\t\t\t\t\t\tindex\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis._dragSpots.set(index, dragSpot);\r\n\t\t\t\t\tthis.addChild(dragSpot);\r\n\t\t\t\t\tconst from = point,\r\n\t\t\t\t\t\tto = points[(index + 1) % points.length];\r\n\t\t\t\t\tif (!from || !to) {\r\n\t\t\t\t\t\tthis.unmount();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst center = [\r\n\t\t\t\t\t\t(from[0] + to[0]) / 2,\r\n\t\t\t\t\t\t(from[1] + to[1]) / 2,\r\n\t\t\t\t\t];\r\n\t\t\t\t\tconst centerDragSpot = new DragSpot(\r\n\t\t\t\t\t\telement,\r\n\t\t\t\t\t\trenderer,\r\n\t\t\t\t\t\tcenter,\r\n\t\t\t\t\t\tindex + 0.5\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis._dragSpots.set(index + 0.5, centerDragSpot);\r\n\t\t\t\t\tthis.addChild(centerDragSpot);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tconst points = element.points;\r\n\t\t\t\t// , \r\n\t\t\t\tif (points) {\r\n\t\t\t\t\tpoints.forEach((point: number[], index: number) => {\r\n\t\t\t\t\t\tconst from = point,\r\n\t\t\t\t\t\t\tto = points[(index + 1) % points.length];\r\n\t\t\t\t\t\tif (!from || !to) {\r\n\t\t\t\t\t\t\tthis.unmount();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst v = vec2.fromValues(\r\n\t\t\t\t\t\t\tto[0] - from[0],\r\n\t\t\t\t\t\t\tto[1] - from[1]\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tconst angle = vec2.angle(v, vec2.fromValues(v[0], 0));\r\n\t\t\t\t\t\tconst center = [\r\n\t\t\t\t\t\t\t(from[0] + to[0]) / 2,\r\n\t\t\t\t\t\t\t(from[1] + to[1]) / 2,\r\n\t\t\t\t\t\t];\r\n\t\t\t\t\t\tconst centerDragSpot = new DragSpot(\r\n\t\t\t\t\t\t\telement,\r\n\t\t\t\t\t\t\trenderer,\r\n\t\t\t\t\t\t\tcenter,\r\n\t\t\t\t\t\t\tindex + 0.5,\r\n\t\t\t\t\t\t\tv[0] * v[1] >= 0 ? angle : -angle\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tthis._dragSpots.set(index + 0.5, centerDragSpot);\r\n\t\t\t\t\t\tthis.addChild(centerDragSpot);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._rotateSpot) {\r\n\t\t\t\t\tconst size = element.size;\r\n\t\t\t\t\tthis._rotateSpot = new RotateSpot(\r\n\t\t\t\t\t\telement,\r\n\t\t\t\t\t\trenderer,\r\n\t\t\t\t\t\t[element.x, element.y],\r\n\t\t\t\t\t\t[0, size[1] / 2 + 52 / 2],\r\n\t\t\t\t\t\t\"renderer/icons/ic_rotate.png\"\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis.addChild(this._rotateSpot);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t}\r\n\r\n\t/**\r\n\t * tear down interaction event\r\n\t */\r\n\tpublic unmount(): void {\r\n\t\t// console.log('unmount editor gizmo');\r\n\t\tthis._renderer?.viewport?.off(\"zoomed\", this._zoomedEvent);\r\n\t\tif (this._dragSpots) {\r\n\t\t\tthis._dragSpots.forEach((spot: DragSpot) => {\r\n\t\t\t\tthis.removeChild(spot);\r\n\t\t\t\tspot.unmount();\r\n\t\t\t});\r\n\t\t\tthis._dragSpots.clear();\r\n\t\t}\r\n\t\tif (this._rotateSpot) {\r\n\t\t\tthis._rotateSpot.unmount();\r\n\t\t}\r\n\r\n\t\t// document.removeEventListener('keydown', this._keydownEvent);\r\n\t\t// document.removeEventListener('keyup', this._keyupEvent);\r\n\t}\r\n\r\n\t/**\r\n\t * mouse up\r\n\t * @param e\r\n\t */\r\n\thandle_mouseup(evt: InteractionEvent): void {\r\n\t\t// console.log('handle_mouseup');\r\n\t\tif (this._dragSpots) {\r\n\t\t\tthis._dragSpots.forEach((spot: DragSpot) => {\r\n\t\t\t\tspot.handle_mouseup(evt);\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (this._rotateSpot) {\r\n\t\t\tthis._rotateSpot.handle_mouseup(evt);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * mouse up\r\n\t * @param e\r\n\t */\r\n\thandle_mouseout(evt: InteractionEvent): void {\r\n\t\t// console.log('handle_mouseout');\r\n\t\tif (this._dragSpots) {\r\n\t\t\tthis._dragSpots.forEach((spot: DragSpot) => {\r\n\t\t\t\tspot.handle_mouseout(evt);\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (this._rotateSpot) {\r\n\t\t\tthis._rotateSpot.handle_mouseout(evt);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * handle zoomed\r\n\t * @param e\r\n\t */\r\n\thandle_zoomed(evt: InteractionEvent) {\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t}\r\n}\r\n","import { InteractionEvent } from \"pixi.js\";\r\nimport { Element } from \"@blood4/modeling\";\r\nimport { KeyboardEvents } from \"../events\";\r\nimport { DefaultInteraction } from \"../interaction/DefaultInteraction\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\nimport { BaseGizmo } from \"./BaseGizmo\";\r\nimport { AlignSpot } from \"./spots\";\r\n\r\nexport class AlignGizmo extends BaseGizmo {\r\n\tprivate _alignSpots: Map<string | number, AlignSpot> = new Map();\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper(element, renderer);\r\n\t\tthis.interactive = true;\r\n\t\tthis.buttonMode = false;\r\n\t\tthis._element = element;\r\n\t\tthis.zIndex = element.styles.editorGizmoZIndex;\r\n\t\tthis.visible = element.styles.editorGizmoVisible;\r\n\t\tthis.mount();\r\n\t\tthis._eventEmitter.on(KeyboardEvents.CtrlKeyDown, (evt: any) => {\r\n\t\t\tthis.unmount();\r\n\t\t\tthis.mount();\r\n\t\t});\r\n\t\tthis._eventEmitter.on(KeyboardEvents.CtrlKeyUp, (evt: any) => {\r\n\t\t\tif (this._alignSpots) {\r\n\t\t\t\tthis._alignSpots.forEach((spot: AlignSpot) => {\r\n\t\t\t\t\tspot.unmount();\r\n\t\t\t\t});\r\n\t\t\t\tthis._alignSpots.clear();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * _invalidate\r\n\t */\r\n\tpublic _invalidate(): void {\r\n\t\t// console.log('_invalidate');\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * validate\r\n\t */\r\n\tpublic _validate(): void {\r\n\t\t// console.log('_validate');\r\n\t\tthis._updateStyles();\r\n\t\tthis._validateImpl();\r\n\t}\r\n\r\n\t/**\r\n\t * update Styles\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tconst element: Element = this._element;\r\n\t\tif (!element) return;\r\n\t\tthis.zIndex = element.styles.editorGizmoZIndex;\r\n\t\tthis.visible = element.styles.editorGizmoVisible;\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tprotected _drawBody(): void {\r\n\t\tconst element = this._element,\r\n\t\t\trenderer = this._renderer;\r\n\t\tif (!element || !renderer) return;\r\n\t\tthis.clear();\r\n\t\t// const interactionManager = renderer.interactionManager;\r\n\t\t// const current = interactionManager.getCurrentInteraction();\r\n\t\t// if (!(current instanceof DefaultInteraction)) return;\r\n\t\t// if (current._ctrlDown) {\r\n\t\t// \tconst points = element.points;\r\n\t\t// \t// , \r\n\t\t// \tif (points && this._alignSpots && this._alignSpots.size > 0) {\r\n\t\t// \t\tthis._alignSpots.forEach((spot: AlignSpot, key: string | number) => {\r\n\t\t// \t\t\tconst from = points[Number(key) - 0.5],\r\n\t\t// \t\t\t\tto = points[(Number(key) - 0.5 + 1) % points.length];\r\n\t\t// \t\t\tspot.setFromTo(from, to);\r\n\t\t// \t\t\tspot.visible = true;\r\n\t\t// \t\t});\r\n\t\t// \t}\r\n\t\t// } else if (this._alignSpots) {\r\n\t\t// \tthis._alignSpots.forEach((spot: AlignSpot, key: string | number) => {\r\n\t\t// \t\tspot.visible = false;\r\n\t\t// \t});\r\n\t\t// }\r\n\t\tconst points = element.points;\r\n\t\t// , \r\n\t\tif (points && this._alignSpots && this._alignSpots.size > 0) {\r\n\t\t\tthis._alignSpots.forEach(\r\n\t\t\t\t(spot: AlignSpot, key: string | number) => {\r\n\t\t\t\t\tconst from = points[Number(key) - 0.5],\r\n\t\t\t\t\t\tto = points[(Number(key) - 0.5 + 1) % points.length];\r\n\t\t\t\t\tspot.setFromTo(from, to);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * set up interaction event\r\n\t */\r\n\tpublic mount(): void {\r\n\t\tthis._keydownEvent = this.handle_keydown.bind(this);\r\n\t\tthis._keyupEvent = this.handle_keyup.bind(this);\r\n\t\tdocument.addEventListener(\"keydown\", this._keydownEvent);\r\n\t\tdocument.addEventListener(\"keyup\", this._keyupEvent);\r\n\t\t// console.log('mount align gizmo');\r\n\t\tconst element = this._element,\r\n\t\t\trenderer = this._renderer;\r\n\t\tif (!element || !renderer) return;\r\n\t\tconst interactionManager = renderer.interactionManager;\r\n\t\tconst current = interactionManager.getCurrentInteraction();\r\n\t\tif (!(current instanceof DefaultInteraction)) return;\r\n\t\tconst points = element.points;\r\n\t\t// , \r\n\t\tif (points) {\r\n\t\t\tpoints.forEach((point: number[], index: number) => {\r\n\t\t\t\tconst from = point,\r\n\t\t\t\t\tto = points[(index + 1) % points.length];\r\n\t\t\t\tconst spot = new AlignSpot(\r\n\t\t\t\t\telement,\r\n\t\t\t\t\tfrom,\r\n\t\t\t\t\tto,\r\n\t\t\t\t\trenderer,\r\n\t\t\t\t\tindex + 0.5,\r\n\t\t\t\t\t\"rect\"\r\n\t\t\t\t);\r\n\t\t\t\tthis._alignSpots.set(index + 0.5, spot);\r\n\t\t\t\tspot.visible = true;\r\n\t\t\t\tspot.mode = \"align\";\r\n\t\t\t\tthis.addChild(spot);\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t}\r\n\r\n\t/**\r\n\t * tear down interaction event\r\n\t */\r\n\tpublic unmount(): void {\r\n\t\t// console.log('unmount align gizmo');\r\n\t\tif (this._alignSpots) {\r\n\t\t\tthis._alignSpots.forEach((spot: AlignSpot) => {\r\n\t\t\t\tthis.removeChild(spot);\r\n\t\t\t\tspot.unmount();\r\n\t\t\t});\r\n\t\t\tthis._alignSpots.clear();\r\n\t\t}\r\n\t\tdocument.removeEventListener(\"keydown\", this._keydownEvent);\r\n\t\tdocument.removeEventListener(\"keyup\", this._keyupEvent);\r\n\t}\r\n\r\n\t/**\r\n\t * mouse up\r\n\t * @param e\r\n\t */\r\n\thandle_mouseup(evt: InteractionEvent): void {\r\n\t\tif (this._alignSpots) {\r\n\t\t\tthis._alignSpots.forEach((spot: AlignSpot) => {\r\n\t\t\t\tspot.handle_mouseup(evt);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n","import { InteractionEvent } from \"pixi.js\";\r\nimport { Element } from \"@blood4/modeling\";\r\nimport { DefaultInteraction } from \"../interaction/DefaultInteraction\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\nimport { BaseGizmo } from \"./BaseGizmo\";\r\nimport { DimensionSpot } from \"./spots\";\r\n\r\nexport class DimensionGizmo extends BaseGizmo {\r\n\tprivate _spots: Map<string | number, DimensionSpot> = new Map();\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper(element, renderer);\r\n\t\tthis._element = element;\r\n\t\tthis.interactive = element.styles.dimensionGizmoInteractive;\r\n\t\tthis.buttonMode = element.styles.dimensionGizmoButtonMode;\r\n\t\tthis.zIndex = element.styles.dimensionGizmoZIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * _invalidate\r\n\t */\r\n\tpublic _invalidate(): void {\r\n\t\t// console.log('_invalidate');\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * validate\r\n\t */\r\n\tpublic _validate(): void {\r\n\t\t// console.log('_validate');\r\n\t\tthis._updateStyles();\r\n\t\tthis._validateImpl();\r\n\t}\r\n\r\n\t/**\r\n\t * update Styles\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tconst element: Element = this._element;\r\n\t\tif (!element) return;\r\n\t\tthis.visible = element.selected;\r\n\t\tthis.interactive = element.styles.dimensionGizmoInteractive;\r\n\t\tthis.buttonMode = element.styles.dimensionGizmoButtonMode;\r\n\t\tthis.zIndex = element.styles.dimensionGizmoZIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tprotected _drawBody(): void {\r\n\t\tconst element = this._element,\r\n\t\t\trenderer = this._renderer;\r\n\t\tthis.clear();\r\n\t\tif (!element || !renderer || !this.visible) return;\r\n\t\t// const offsetPoints = element.getOffsetPoints(10, 'chamfer', 16) as number[][];\r\n\t\tconst points = element.points;\r\n\t\t/* const result: number[][][] = [];\r\n\t\tfor (let i = 0; i < offsetPoints.length; i += 2) {\r\n\t\t\tif (offsetPoints[i] && offsetPoints[i + 1]) {\r\n\t\t\t\tresult.push([\r\n\t\t\t\t\t[offsetPoints[i][0], offsetPoints[i][1]],\r\n\t\t\t\t\t[offsetPoints[i + 1][0], offsetPoints[i + 1][1]]\r\n\t\t\t\t]);\r\n\t\t\t}\r\n\t\t} */\r\n\t\t// , \r\n\t\tif (this._spots && this._spots.size > 0) {\r\n\t\t\tthis._spots.forEach((spot: DimensionSpot, key: string | number) => {\r\n\t\t\t\tconst f1 = points[Number(key) - 0.5];\r\n\t\t\t\tconst t1 = points[(Number(key) - 0.5 + 1) % points.length];\r\n\r\n\t\t\t\tconst from = {\r\n\t\t\t\t\tp1: f1,\r\n\t\t\t\t\tp2: [],\r\n\t\t\t\t},\r\n\t\t\t\t\tto = {\r\n\t\t\t\t\t\tp1: t1,\r\n\t\t\t\t\t\tp2: [],\r\n\t\t\t\t\t};\r\n\t\t\t\tspot.setFromTo(from, to);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tfor (let i = 0; i < points.length; i++) {\r\n\t\t\t\tconst f1 = points[i];\r\n\t\t\t\tconst t1 = points[(i + 1) % points.length];\r\n\t\t\t\tconst from = {\r\n\t\t\t\t\tp1: f1,\r\n\t\t\t\t\tp2: [],\r\n\t\t\t\t},\r\n\t\t\t\t\tto = {\r\n\t\t\t\t\t\tp1: t1,\r\n\t\t\t\t\t\tp2: [],\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\tconst spot = new DimensionSpot(\r\n\t\t\t\t\telement,\r\n\t\t\t\t\tfrom,\r\n\t\t\t\t\tto,\r\n\t\t\t\t\trenderer,\r\n\t\t\t\t\ti + 0.5\r\n\t\t\t\t);\r\n\t\t\t\tthis._spots.set(i + 0.5, spot);\r\n\t\t\t\tthis.addChild(spot);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (element.debug) {\r\n\t\t\t// points.forEach((point: number[]) => {\r\n\t\t\t// \tthis.beginFill(0x000000, 1.0);\r\n\t\t\t// \tthis.drawCircle(point[0], point[1], 2);\r\n\t\t\t// });\r\n\t\t\t// result.forEach((points: number[][]) => {\r\n\t\t\t// \tthis.beginFill(0x00ff00, 1.0);\r\n\t\t\t// \tthis.drawCircle(points[0][0], points[0][1], 2);\r\n\t\t\t// \tthis.beginFill(0x0000ff, 1.0);\r\n\t\t\t// \tthis.drawCircle(points[1][0], points[1][1], 2);\r\n\t\t\t// });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * set up interaction event\r\n\t */\r\n\tpublic mount(): void {\r\n\t\t// console.log('mount dimension gizmo');\r\n\t\tconst element = this._element,\r\n\t\t\trenderer = this._renderer;\r\n\t\tif (!element || !renderer) return;\r\n\r\n\t\tconst interactionManager = renderer.interactionManager;\r\n\t\tconst current = interactionManager.getCurrentInteraction();\r\n\t\tif (!(current instanceof DefaultInteraction)) return;\r\n\r\n\t\t// , \r\n\t\t// if (points) {\r\n\t\t// \tpoints.forEach((point: number[], index: number) => {\r\n\t\t// \t\tconst from = point,\r\n\t\t// \t\t\tto = points[(index + 1) % points.length];\r\n\t\t// \t\tconst spot = new DimensionSpot(element, from, to, renderer, index + 0.5);\r\n\t\t// \t\tthis._spots.set(index + 0.5, spot);\r\n\t\t// \t\tthis.addChild(spot);\r\n\t\t// \t});\r\n\t\t// }\r\n\t}\r\n\r\n\t/**\r\n\t * tear down interaction event\r\n\t */\r\n\tpublic unmount(): void {\r\n\t\t// console.log('unmount Dimension gizmo');\r\n\t\t// if (this._spots) {\r\n\t\t// \tthis._spots.forEach((spot: DimensionSpot) => {\r\n\t\t// \t\tspot.unmount();\r\n\t\t// \t\tthis.removeChild(spot);\r\n\t\t// \t});\r\n\t\t// \tthis._spots.clear();\r\n\t\t// }\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t}\r\n\r\n\t/**\r\n\t * mouse up\r\n\t * @param e\r\n\t */\r\n\thandle_mouseup(evt: InteractionEvent): void { }\r\n}\r\n","import { Graphics, Texture } from \"pixi.js\";\r\nimport { guide } from \"../utils\";\r\nimport { Element } from \"@blood4/modeling\";\r\nimport {\r\n\tAlignGizmo,\r\n\tBaseGizmo,\r\n\tDimensionGizmo,\r\n\tEditorGizmo,\r\n\tLabel2Gizmo,\r\n\tLabelGizmo,\r\n} from \"../gizmos\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\nimport { DefaultInteraction } from \"../interaction/DefaultInteraction\";\r\nimport { GlowFilter, OutlineFilter } from \"pixi-filters\";\r\n\r\nexport class UI extends Graphics {\r\n\t_id: string = guide();\r\n\t_element: Element;\r\n\t_renderer: PixiRenderer<any>;\r\n\t_imageCache?: HTMLImageElement;\r\n\t_textureCache?: Texture;\r\n\t_gizmos: Map<string, BaseGizmo> = new Map();\r\n\t_outlineFilterBlue = new OutlineFilter(2, 0x99ff99);\r\n\t_outlineFilterRed = new GlowFilter({\r\n\t\tdistance: 10,\r\n\t\touterStrength: 4,\r\n\t\tinnerStrength: 0,\r\n\t\tcolor: 0xff0000,\r\n\t\tquality: 1.0,\r\n\t\tknockout: false,\r\n\t});\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper();\r\n\t\tthis._element = element;\r\n\t\tthis._renderer = renderer;\r\n\t\tthis.visible = element.visible;\r\n\t\tthis.interactive = element.styles.interactive;\r\n\t\tthis.buttonMode = element.styles.buttonMode;\r\n\t\tthis.cursor = element.styles.cursor;\r\n\t\tthis.zIndex = element.styles.zIndex;\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t}\r\n\r\n\t/**\r\n\t * invalidate\r\n\t * @param checkGizmo\r\n\t */\r\n\tpublic _invalidate(checkGizmo?: boolean): void {\r\n\t\t// console.log('invalidate');\r\n\t}\r\n\r\n\t/**\r\n\t * validate\r\n\t */\r\n\tpublic _validate(checkGizmo?: boolean): void {\r\n\t\tthis._updateStyles();\r\n\t\tthis._checkGizmos();\r\n\t\tthis._validateImpl();\r\n\t}\r\n\r\n\tcalculateBounds(): void { }\r\n\r\n\t/**\r\n\t * update glod styles from view\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tthis.visible = element.visible;\r\n\t\tthis.interactive = element.styles.interactive;\r\n\t\tthis.buttonMode = element.styles.buttonMode;\r\n\t\tthis.cursor = element.styles.cursor;\r\n\t\tthis.zIndex = element.styles.zIndex;\r\n\t\tthis.getBounds();\r\n\t\tconst bounds = element.getAABB();\r\n\t\tthis.pivot.x = bounds.x + bounds.width / 2;\r\n\t\tthis.pivot.y = bounds.y + bounds.height / 2;\r\n\t\tthis.x = bounds.x + bounds.width / 2;\r\n\t\tthis.y = bounds.y + bounds.height / 2;\r\n\t\t// this.blendMode = BLEND_MODES.ADD;\r\n\t\t// this.filters = [new BloomFilter(2, 4, settings.FILTER_RESOLUTION, 5)];\r\n\t}\r\n\r\n\t/**\r\n\t * check all gizmos\r\n\t */\r\n\tprotected _checkGizmos(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tthis._checkLabelGizmo();\r\n\t\tthis._checkLabel2Gizmo();\r\n\t\tthis._checkEditorGizmo();\r\n\t\t// this._checkAlignGizmo();\r\n\t\tthis._checkDimensionGizmo();\r\n\t}\r\n\r\n\tprotected _checkLabelGizmo(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tconst name = element.name;\r\n\t\tlet gizmo = this._gizmos.get(\"labelGizmo\");\r\n\t\tif (name != null && name !== \"\") {\r\n\t\t\tif (!gizmo) {\r\n\t\t\t\tgizmo = new LabelGizmo(element, this._renderer);\r\n\t\t\t\tthis.addChild(gizmo);\r\n\t\t\t\tthis._gizmos.set(\"labelGizmo\", gizmo);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (gizmo) {\r\n\t\t\t\tthis.removeChild(gizmo);\r\n\t\t\t\tgizmo.unmount();\r\n\t\t\t\tthis._gizmos.delete(\"labelGizmo\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tprotected _checkLabel2Gizmo(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tconst name2 = element.name2;\r\n\t\tlet gizmo = this._gizmos.get(\"label2Gizmo\");\r\n\t\tif (name2 != null && name2 !== \"\") {\r\n\t\t\tif (!gizmo) {\r\n\t\t\t\tgizmo = new Label2Gizmo(element, this._renderer);\r\n\t\t\t\tthis.addChild(gizmo);\r\n\t\t\t\tthis._gizmos.set(\"label2Gizmo\", gizmo);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (gizmo) {\r\n\t\t\t\tthis.removeChild(gizmo);\r\n\t\t\t\tgizmo.unmount();\r\n\t\t\t\tthis._gizmos.delete(\"label2Gizmo\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _checkEditorGizmo(): void {\r\n\t\tconst element = this._element,\r\n\t\t\trenderer = this._renderer;\r\n\t\tif (!element || !renderer) return;\r\n\t\tlet gizmo = this._gizmos.get(\"editorGizmo\");\r\n\t\tif (element.selected && !element.dragging) {\r\n\t\t\tif (!gizmo) {\r\n\t\t\t\tgizmo = new EditorGizmo(element, this._renderer);\r\n\t\t\t\tthis.addChild(gizmo);\r\n\t\t\t\tthis._gizmos.set(\"editorGizmo\", gizmo);\r\n\t\t\t}\r\n\t\t} else if (\r\n\t\t\t(!element.selected || element.dragging || element.isEditing) &&\r\n\t\t\tgizmo\r\n\t\t) {\r\n\t\t\tthis.removeChild(gizmo);\r\n\t\t\tgizmo.unmount();\r\n\t\t\tthis._gizmos.delete(\"editorGizmo\");\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _checkAlignGizmo(): void {\r\n\t\tconst element = this._element,\r\n\t\t\trenderer = this._renderer;\r\n\t\tif (!element || !renderer) return;\r\n\t\tlet gizmo = this._gizmos.get(\"alignGizmo\");\r\n\t\tconst interactionManager = renderer.interactionManager;\r\n\t\tconst current = interactionManager.getCurrentInteraction();\r\n\t\t// DefaultInteraction\r\n\t\tif (current instanceof DefaultInteraction) {\r\n\t\t\tif (current._ctrlDown) {\r\n\t\t\t\tif (!gizmo) {\r\n\t\t\t\t\tgizmo = new AlignGizmo(element, this._renderer);\r\n\t\t\t\t\tthis.addChild(gizmo);\r\n\t\t\t\t\tthis._gizmos.set(\"alignGizmo\", gizmo);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (gizmo) {\r\n\t\t\t\t\tthis.removeChild(gizmo);\r\n\t\t\t\t\tgizmo.unmount();\r\n\t\t\t\t\tthis._gizmos.delete(\"alignGizmo\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _checkDimensionGizmo(): void {\r\n\t\tconst element = this._element,\r\n\t\t\trenderer = this._renderer;\r\n\t\tif (!element || !renderer) return;\r\n\t\tlet gizmo = this._gizmos.get(\"dimensionGizmo\");\r\n\t\tif (element.selected && !element.dragging) {\r\n\t\t\tif (!gizmo) {\r\n\t\t\t\tgizmo = new DimensionGizmo(element, this._renderer);\r\n\t\t\t\tthis.addChild(gizmo);\r\n\t\t\t\tthis._gizmos.set(\"dimensionGizmo\", gizmo);\r\n\t\t\t}\r\n\t\t} else if (\r\n\t\t\t(!element.selected || element.dragging || element.isEditing) &&\r\n\t\t\tgizmo\r\n\t\t) {\r\n\t\t\tthis.removeChild(gizmo);\r\n\t\t\tgizmo.unmount();\r\n\t\t\tthis._gizmos.delete(\"dimensionGizmo\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * validate implementation\r\n\t * 1. calculate boundingbox: body , gizmos\r\n\t */\r\n\tprotected _validateImpl(): void {\r\n\t\tthis._draw();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\t_draw() {\r\n\t\tthis.clear();\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element || !element.visible) return;\r\n\t\tif (!this._element || !this._element.visible) return;\r\n\t\tthis._drawBody();\r\n\t\tthis._drawOuter();\r\n\t\tthis._drawHover();\r\n\t\tthis._drawSelect();\r\n\t\tthis._drawGizmos();\r\n\t\tif (this._element && this._element.debug) {\r\n\t\t\tthis._drawBoundingBox();\r\n\t\t\tthis._drawAABB();\r\n\t\t\tthis._drawOBB();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *  BoundingBox\r\n\t */\r\n\tprotected _drawBoundingBox() { }\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tprotected _drawAABB() { }\r\n\r\n\t/**\r\n\t * OBB Bounds\r\n\t */\r\n\tprotected _drawOBB() { }\r\n\r\n\t/**\r\n\t * draw Body\r\n\t */\r\n\tprotected _drawBody(): void {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tif (element.selected) {\r\n\t\t\tthis.beginFill(0xff9966, 1.0);\r\n\t\t\tthis.lineStyle(1, 0x00ff00, 1.0);\r\n\t\t\tthis.drawEllipse(element.x, element.y, 20, 20);\r\n\t\t\tthis.endFill();\r\n\t\t} else {\r\n\t\t\tthis.beginFill(0x00ff00, 1.0);\r\n\t\t\tthis.lineStyle(1, 0x00ff00, 1.0);\r\n\t\t\tthis.drawEllipse(element.x, element.y, 20, 20);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _drawBorder(): void { }\r\n\r\n\t/**\r\n\t * Boundingbox\r\n\t * @returns\r\n\t */\r\n\tprotected _drawOuter(): void { }\r\n\r\n\tprotected _drawHover(): void {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tif (element.hovered) {\r\n\t\t\tconst points = element.points;\r\n\t\t\tthis.lineStyle(0.6, 0x3477fc, 1.0);\r\n\t\t\tconst path: number[] = [];\r\n\t\t\tpoints.forEach((point: number[]) => {\r\n\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.drawPolygon(path);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * _drawSelect: blur, grow\r\n\t * @returns\r\n\t */\r\n\tprotected _drawSelect(): void {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tif (element.selected) {\r\n\t\t\tconst points = element.points;\r\n\t\t\tif (element.dragging) {\r\n\t\t\t\tthis.beginFill(0x000000, 0.1);\r\n\t\t\t\tthis.lineStyle(0.6, 0x3477fc, 1.0);\r\n\t\t\t} else {\r\n\t\t\t\tthis.lineStyle(1, 0x3477fc, 1.0);\r\n\t\t\t}\r\n\t\t\tconst path: number[] = [];\r\n\t\t\tpoints.forEach((point: number[]) => {\r\n\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.drawPolygon(path);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * draw editor\r\n\t * @todo\r\n\t */\r\n\tprotected _drawEditor(): void { }\r\n\r\n\t/**\r\n\t * draw gizmos\r\n\t */\r\n\tprotected _drawGizmos(): void {\r\n\t\tif (this._gizmos) {\r\n\t\t\tthis._gizmos.forEach((gizmo) => {\r\n\t\t\t\tif (gizmo instanceof BaseGizmo) {\r\n\t\t\t\t\tgizmo.update();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns\r\n\t */\r\n\tpublic update(): void {\r\n\t\tthis._invalidate();\r\n\t\tthis._validate();\r\n\t}\r\n\r\n\tfilterOn() {\r\n\t\tthis.filters = [this._outlineFilterRed];\r\n\t}\r\n\r\n\tfilterOff() {\r\n\t\tthis.filters = [this._outlineFilterBlue];\r\n\t}\r\n\r\n\tasync loadImage(src: string) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst img = new Image();\r\n\t\t\timg.onload = () => resolve(img);\r\n\t\t\timg.onerror = (e) => reject(e);\r\n\t\t\timg.src = src;\r\n\t\t});\r\n\t}\r\n}\r\n","export function guide(): string {\r\n\tconst tS4 = function () {\r\n\t\treturn Math.floor((1 + Math.random()) * 0x10000)\r\n\t\t\t.toString(16)\r\n\t\t\t.substring(1);\r\n\t};\r\n\treturn tS4() + tS4() + '-' + tS4() + '-' + tS4() + '-' + tS4() + '-' + tS4() + tS4() + tS4();\r\n}\r\n\r\nexport function s4() {\r\n\treturn (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\r\n}\r\n\r\nexport function s8() {\r\n\treturn s4() + s4();\r\n}\r\n","import { Text, Rectangle, Matrix, Texture, BaseTexture } from \"pixi.js\";\r\nimport { Element, ElementType, FillType } from \"@blood4/modeling\";\r\nimport { UI } from \".\";\r\nimport { union } from \"../utils\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\n\r\nexport class NodeUI extends UI {\r\n\ttext?: Text;\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper(element, renderer);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * UIBounds,body gizmoicon and so on;\r\n\t * @returns\r\n\t */\r\n\tcalculateBounds(): void {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst boundingbox = element.getAABB();\r\n\t\tconst rect1 = new Rectangle(\r\n\t\t\tboundingbox.x,\r\n\t\t\tboundingbox.y,\r\n\t\t\tboundingbox.width,\r\n\t\t\tboundingbox.height\r\n\t\t);\r\n\t\tif (this.text) {\r\n\t\t\tconst text = this.text;\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\ttext.getLocalBounds(rect);\r\n\t\t\tunion(\r\n\t\t\t\trect1,\r\n\t\t\t\tnew Rectangle(text.x, text.y, rect.width, rect.height),\r\n\t\t\t\trect1\r\n\t\t\t);\r\n\t\t}\r\n\t\tthis._boundsRect = rect1;\r\n\t}\r\n\r\n\t/**\r\n\t * update global styles from view\r\n\t * @returns\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tsuper._updateStyles();\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t}\r\n\r\n\t/**\r\n\t *  BoundingBox\r\n\t */\r\n\tprotected _drawBoundingBox() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst rect: Rectangle = new Rectangle();\r\n\t\tif (this.text) {\r\n\t\t\tthis.text.getLocalBounds(rect);\r\n\t\t}\r\n\t\tconst boundingbox = element.getBoundingBox(10);\r\n\t\tthis.lineStyle(1, 0xff6666, 1.0);\r\n\t\tthis.beginFill(0x0000, 0.0);\r\n\t\tthis.drawRect(\r\n\t\t\tboundingbox.x,\r\n\t\t\tboundingbox.y,\r\n\t\t\tboundingbox.width,\r\n\t\t\tboundingbox.height\r\n\t\t);\r\n\t\tthis.endFill();\r\n\r\n\t\tconst boundingbox2 = this._boundsRect;\r\n\t\tthis.lineStyle(1, 0xff0033, 1.0);\r\n\t\tthis.beginFill(0x0000, 0.0);\r\n\t\tthis.drawRect(\r\n\t\t\tboundingbox2.x,\r\n\t\t\tboundingbox2.y,\r\n\t\t\tboundingbox2.width,\r\n\t\t\tboundingbox2.height\r\n\t\t);\r\n\t\tthis.endFill();\r\n\r\n\t\tif (this.text) {\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\tif (this.text) {\r\n\t\t\t\tthis.text.getLocalBounds(rect);\r\n\t\t\t}\r\n\t\t\tconst viewport: any = this.parent;\r\n\t\t\tconst scale = viewport.scaled || 1.0;\r\n\t\t\tthis.lineStyle(1, 0xffff66, 1.0);\r\n\t\t\tthis.beginFill(0x0000, 0.0);\r\n\t\t\tthis.drawRect(this.text.x, this.text.y, rect.width, rect.height);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tprotected _drawAABB() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst aabb = element.getAABB();\r\n\t\tthis.lineStyle(1, 0x00ff00, 1.0);\r\n\t\tthis.beginFill(0xffff00, 0.0);\r\n\t\tthis.drawRect(aabb.x, aabb.y, aabb.width, aabb.height);\r\n\t\tthis.endFill();\r\n\t}\r\n\r\n\t/**\r\n\t * OBB Bounds\r\n\t */\r\n\tprotected _drawOBB() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst obb = element.getOBB();\r\n\t\tconst points = obb.points;\r\n\t\tthis.lineStyle(1, 0xffff00, 1.0);\r\n\t\tthis.beginFill(0xffff00, 0.0);\r\n\t\tconst path: number[] = [];\r\n\t\tpoints.forEach((point: number[]) => {\r\n\t\t\tpath.push(point[0], point[1]);\r\n\t\t});\r\n\t\tthis.drawPolygon(path);\r\n\t}\r\n\r\n\t/**\r\n\t * draw Body\r\n\t */\r\n\tprotected _drawBody(): void {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\r\n\t\tconst points = element.points;\r\n\t\tif (!points || points.length === 0) return;\r\n\r\n\t\tconst path: number[] = [];\r\n\t\tpoints.forEach((point: any) => {\r\n\t\t\tpath.push(point[0], point[1]);\r\n\t\t});\r\n\t\tconst selected = element.selected;\r\n\t\tconst fill = selected ? element.styles.selectFill : element.styles.fill,\r\n\t\t\tfillColor = selected\r\n\t\t\t\t? element.styles.selectFillColor\r\n\t\t\t\t: element.styles.fillColor,\r\n\t\t\tfillAlpha = selected\r\n\t\t\t\t? element.styles.selectFillAlpha\r\n\t\t\t\t: element.styles.fillAlpha,\r\n\t\t\tfillImage = element.styles.fillImage,\r\n\t\t\tfillVector = element.styles.fillVector,\r\n\t\t\tfillType = element.styles.fillType,\r\n\t\t\tstrokeColor = element.styles.strokeColor,\r\n\t\t\tstrokeWidth = element.styles.strokeWidth,\r\n\t\t\tstrokeAlpha = element.styles.strokeAlpha,\r\n\t\t\tclosed = element.styles.shapeClosed;\r\n\r\n\t\tif (!fill) return;\r\n\t\tconst box2d = element.getAABB();\r\n\t\tif (element.image) {\r\n\t\t\tif (!this._imageCache) {\r\n\t\t\t\tthis.loadImage(element.image)\r\n\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\tif (res instanceof HTMLImageElement) {\r\n\t\t\t\t\t\t\tthis._imageCache = res;\r\n\t\t\t\t\t\t\tthis.update();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((e) => { });\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (\r\n\t\t\tfillType === FillType.Default ||\r\n\t\t\tfillType === FillType.ImageVector\r\n\t\t) {\r\n\t\t\tif (fillVector) {\r\n\t\t\t\tthis.lineStyle(strokeWidth, strokeColor, strokeAlpha);\r\n\t\t\t\tthis.beginFill(fillColor, fillAlpha);\r\n\t\t\t\tthis.drawPolygon(path);\r\n\t\t\t\tthis.endFill();\r\n\t\t\t}\r\n\r\n\t\t\tif (fillImage && this._imageCache) {\r\n\t\t\t\t// this.lineStyle(strokeWidth, strokeColor, strokeAlpha);\r\n\t\t\t\tthis.beginFill(fillColor, fillAlpha);\r\n\t\t\t\tlet matrix = new Matrix();\r\n\t\t\t\tmatrix = matrix\r\n\t\t\t\t\t.translate(-box2d.x, -box2d.y)\r\n\t\t\t\t\t.scale(\r\n\t\t\t\t\t\tthis._imageCache.width / box2d.width,\r\n\t\t\t\t\t\tthis._imageCache.height / box2d.height\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\tif (!this._textureCache) {\r\n\t\t\t\t\tconst texture = new Texture(\r\n\t\t\t\t\t\tnew BaseTexture(this._imageCache)\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis._textureCache = texture;\r\n\t\t\t\t}\r\n\t\t\t\tthis.fill.visible = fillImage;\r\n\t\t\t\tthis.fill.texture = this._textureCache;\r\n\t\t\t\tthis.fill.matrix = matrix;\r\n\t\t\t\tthis.fill.color = 0xffffff;\r\n\t\t\t\tthis.drawPolygon(path);\r\n\t\t\t\tthis.endFill();\r\n\t\t\t}\r\n\t\t} else if (fillType === FillType.VectorImage) {\r\n\t\t\tif (fillImage && this._imageCache) {\r\n\t\t\t\tlet matrix = new Matrix();\r\n\t\t\t\tmatrix = matrix\r\n\t\t\t\t\t.translate(-box2d.x, -box2d.y)\r\n\t\t\t\t\t.scale(\r\n\t\t\t\t\t\tthis._imageCache.width / box2d.width,\r\n\t\t\t\t\t\tthis._imageCache.height / box2d.height\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\tif (!this._textureCache) {\r\n\t\t\t\t\tconst texture = new Texture(\r\n\t\t\t\t\t\tnew BaseTexture(this._imageCache)\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis._textureCache = texture;\r\n\t\t\t\t}\r\n\t\t\t\tthis.fill.visible = fillImage;\r\n\t\t\t\tthis.fill.texture = this._textureCache;\r\n\t\t\t\tthis.fill.matrix = matrix;\r\n\t\t\t\tthis.fill.color = 0xffffff;\r\n\t\t\t\tthis.drawPolygon(path);\r\n\t\t\t\tthis.endFill();\r\n\t\t\t}\r\n\t\t\tif (fillVector) {\r\n\t\t\t\tthis.lineStyle(strokeWidth, strokeColor, strokeAlpha);\r\n\t\t\t\tthis.beginFill(fillColor, fillAlpha);\r\n\t\t\t\tthis.drawPolygon(path);\r\n\t\t\t\tthis.endFill();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tclosed && this.closePath();\r\n\t}\r\n}\r\n","import { Point, Rectangle } from 'pixi.js';\r\n\r\n/**\r\n *\r\n * @param points\r\n * @returns\r\n */\r\nexport function aabb(points: Point[]): Rectangle {\r\n\tconst aabb = new Rectangle(0, 0, 0, 0);\r\n\tif (!points || points.length === 0) return aabb;\r\n\tconst count = points.length;\r\n\tlet point = points[0];\r\n\taabb.x = point.x;\r\n\taabb.y = point.y;\r\n\r\n\tfor (let i = 1; i < count; i += 1) {\r\n\t\tpoint = points[i];\r\n\t\tconst x1 = Math.min(aabb.x, point.x);\r\n\t\tconst y1 = Math.min(aabb.y, point.y);\r\n\t\tconst x2 = Math.max(aabb.x + aabb.width, point.x);\r\n\t\tconst y2 = Math.max(aabb.y + aabb.height, point.y);\r\n\t\taabb.x = x1;\r\n\t\taabb.y = y1;\r\n\t\taabb.width = x2 - x1;\r\n\t\taabb.height = y2 - y1;\r\n\t}\r\n\treturn aabb;\r\n}\r\n\r\n/**\r\n * union rectangle\r\n * @param a\r\n * @param b\r\n * @param out\r\n * @returns\r\n */\r\nexport function union(a: Rectangle, b: Rectangle, out?: Rectangle): Rectangle {\r\n\tif (!out) {\r\n\t\t// eslint-disable-next-line no-param-reassign\r\n\t\t(out as any) = new Rectangle();\r\n\t}\r\n\r\n\tconst x1 = Math.min(a.x, b.x);\r\n\tconst x2 = Math.max(a.x + a.width, b.x + b.width);\r\n\tconst y1 = Math.min(a.y, b.y);\r\n\tconst y2 = Math.max(a.y + a.height, b.y + b.height);\r\n\r\n\tif (out) {\r\n\t\tout.x = x1;\r\n\t\tout.y = y1;\r\n\t\tout.width = x2 - x1;\r\n\t\tout.height = y2 - y1;\r\n\t\treturn out;\r\n\t}\r\n\treturn new Rectangle();\r\n}\r\n\r\n/**\r\n * If the area of the intersection between the Rectangles `b` and `a` is not zero,\r\n * returns the area of intersection as a Rectangle object. bwise, return an empty Rectangle\r\n * with its properties set to zero.\r\n * Rectangles without area (width or height equal to zero) can't intersect or be intersected\r\n * and will always return an empty rectangle with its properties set to zero.\r\n *\r\n * _Note: Only available with **@pixi/math-extras**._\r\n *\r\n * @method intersects\r\n * @memberof PIXI.Rectangle#\r\n * @param {Rectangle} b - The Rectangle to intersect with `a`.\r\n * @param {Rectangle} [out] - A Rectangle object in which to store the value,\r\n * optional (bwise will create a new Rectangle).\r\n * @returns {Rectangle} The intersection of `a` and `b`.\r\n */\r\nexport function intersection(a: Rectangle, b: Rectangle, out?: Rectangle): Rectangle {\r\n\tif (!out) {\r\n\t\t// eslint-disable-next-line no-param-reassign\r\n\t\t(out as any) = new Rectangle();\r\n\t}\r\n\tconst x0 = a.x < b.x ? b.x : a.x;\r\n\tconst x1 = a.right > b.right ? b.right : a.right;\r\n\tif (out) {\r\n\t\tif (x1 <= x0) {\r\n\t\t\tout.x = out.y = out.width = out.height = 0;\r\n\r\n\t\t\treturn out;\r\n\t\t}\r\n\r\n\t\tconst y0 = a.y < b.y ? b.y : a.y;\r\n\t\tconst y1 = a.bottom > b.bottom ? b.bottom : a.bottom;\r\n\r\n\t\tif (y1 <= y0) {\r\n\t\t\tout.x = out.y = out.width = out.height = 0;\r\n\r\n\t\t\treturn out;\r\n\t\t}\r\n\r\n\t\tout.x = x0;\r\n\t\tout.y = y0;\r\n\t\tout.width = x1 - x0;\r\n\t\tout.height = y1 - y0;\r\n\r\n\t\treturn out;\r\n\t}\r\n\treturn new Rectangle();\r\n}\r\n\r\n/**\r\n *\r\n * @param min\r\n * @param max\r\n * @param x\r\n * @returns\r\n */\r\nexport function clamp(min: number, max: number, x: number) {\r\n\treturn Math.min(Math.max(x, min), max);\r\n}\r\n\r\n/**\r\n * \r\n * @param points\r\n * @param point\r\n * @returns\r\n */\r\nexport function isPointInPolygon(points: Point[], point: Point): boolean {\r\n\tlet i = 0,\r\n\t\tj = 0,\r\n\t\tc = false,\r\n\t\tsize = points.length;\r\n\tfor (i = 0, j = size - 1; i < size; j = i++) {\r\n\t\tvar p1 = points[i];\r\n\t\tvar p2 = points[j];\r\n\t\tif (p1.y > point.y != p2.y > point.y && point.x < ((p2.x - p1.x) * (point.y - p1.y)) / (p2.y - p1.y) + p1.x) {\r\n\t\t\tc = !c;\r\n\t\t}\r\n\t}\r\n\treturn c;\r\n}\r\n\r\n/**\r\n * \r\n * @param points\r\n * @returns\r\n */\r\nexport function isRectangle(points: number[][]): boolean {\r\n\tif (points.length !== 4) {\r\n\t\treturn false;\r\n\t} else {\r\n\t\tconst d02 =\r\n\t\t\t(points[0][0] - points[2][0]) * (points[0][0] - points[2][0]) +\r\n\t\t\t(points[0][1] - points[2][1]) * (points[0][1] - points[2][1]);\r\n\t\tconst d13 =\r\n\t\t\t(points[1][0] - points[3][0]) * (points[1][0] - points[3][0]) +\r\n\t\t\t(points[1][1] - points[3][1]) * (points[1][1] - points[3][1]);\r\n\t\treturn Math.abs(d02 - d13) < 1;\r\n\t}\r\n}\r\n","import { Matrix, Text, Rectangle, Texture, BaseTexture } from \"pixi.js\";\r\nimport { Element, FillType, Shape } from \"@blood4/modeling\";\r\nimport { UI } from \".\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\n\r\nexport class ShapeUI extends UI {\r\n\ttext?: Text;\r\n\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper(element, renderer);\r\n\t}\r\n\r\n\t/**\r\n\t * update global styles from view\r\n\t * @returns\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tsuper._updateStyles();\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t}\r\n\r\n\t/**\r\n\t *  BoundingBox\r\n\t */\r\n\tprotected _drawBoundingBox() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst rect: Rectangle = new Rectangle();\r\n\t\tif (this.text) {\r\n\t\t\tthis.text.getLocalBounds(rect);\r\n\t\t}\r\n\t\tconst boundingbox = element.getBoundingBox(10);\r\n\t\tthis.lineStyle(1, 0xff6666, 1.0);\r\n\t\tthis.beginFill(0x0000, 0.0);\r\n\t\tthis.drawRect(\r\n\t\t\tboundingbox.x,\r\n\t\t\tboundingbox.y,\r\n\t\t\tboundingbox.width,\r\n\t\t\tboundingbox.height\r\n\t\t);\r\n\t\tthis.endFill();\r\n\r\n\t\tconst boundingbox2 = this._boundsRect;\r\n\t\tthis.lineStyle(1, 0xff0033, 1.0);\r\n\t\tthis.beginFill(0x0000, 0.0);\r\n\t\tthis.drawRect(\r\n\t\t\tboundingbox2.x,\r\n\t\t\tboundingbox2.y,\r\n\t\t\tboundingbox2.width,\r\n\t\t\tboundingbox2.height\r\n\t\t);\r\n\t\tthis.endFill();\r\n\r\n\t\tif (this.text) {\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\tif (this.text) {\r\n\t\t\t\tthis.text.getLocalBounds(rect);\r\n\t\t\t}\r\n\t\t\tconst viewport: any = this.parent;\r\n\t\t\tconst scale = viewport.scaled || 1.0;\r\n\t\t\tthis.lineStyle(1, 0xffff66, 1.0);\r\n\t\t\tthis.beginFill(0x0000, 0.0);\r\n\t\t\tthis.drawRect(this.text.x, this.text.y, rect.width, rect.height);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tprotected _drawAABB() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst aabb = element.getAABB();\r\n\t\tthis.lineStyle(1, 0x00ff00, 1.0);\r\n\t\tthis.beginFill(0xffff00, 0.0);\r\n\t\tthis.drawRect(aabb.x, aabb.y, aabb.width, aabb.height);\r\n\t\tthis.endFill();\r\n\t\tthis.lineStyle(1, 0x000000, 1.0);\r\n\t}\r\n\r\n\t/**\r\n\t * OBB Bounds\r\n\t */\r\n\tprotected _drawOBB() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst obb = element.getOBB();\r\n\t\tconst points = obb.points;\r\n\t\tthis.lineStyle(1, 0xffff00, 1.0);\r\n\t\tthis.beginFill(0xffff00, 0.0);\r\n\t\tconst path: number[] = [];\r\n\t\tpoints.forEach((point: number[]) => {\r\n\t\t\tpath.push(point[0], point[1]);\r\n\t\t});\r\n\t\tthis.drawPolygon(path);\r\n\t}\r\n\r\n\t/**\r\n\t * draw Body\r\n\t */\r\n\tprotected _drawBody(): void {\r\n\t\tconst element = this._element as Shape;\r\n\t\tif (!element) return;\r\n\t\tconst points = element.points;\r\n\t\tif (!points || points.length === 0) return;\r\n\t\tconst path: number[] = [];\r\n\t\tpoints.forEach((point: any) => {\r\n\t\t\tpath.push(point[0], point[1]);\r\n\t\t});\r\n\t\tconst selected = element.selected;\r\n\t\tconst fill = selected ? element.styles.selectFill : element.styles.fill,\r\n\t\t\tfillColor = selected\r\n\t\t\t\t? element.styles.selectFillColor\r\n\t\t\t\t: element.styles.fillColor,\r\n\t\t\tfillAlpha = selected\r\n\t\t\t\t? element.styles.selectFillAlpha\r\n\t\t\t\t: element.styles.fillAlpha,\r\n\t\t\tfillImage = element.styles.fillImage,\r\n\t\t\tfillVector = element.styles.fillVector,\r\n\t\t\tfillType = element.styles.fillType,\r\n\t\t\tstrokeColor = element.styles.strokeColor,\r\n\t\t\tstrokeWidth = element.styles.strokeWidth,\r\n\t\t\tstrokeAlpha = element.styles.strokeAlpha,\r\n\t\t\tclosed = element.styles.shapeClosed;\r\n\r\n\t\tif (!fill) return;\r\n\t\tconst box2d = element.getAABB();\r\n\t\tif (element.image) {\r\n\t\t\tif (!this._imageCache) {\r\n\t\t\t\tthis.loadImage(element.image)\r\n\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\tif (res instanceof HTMLImageElement) {\r\n\t\t\t\t\t\t\tthis._imageCache = res;\r\n\t\t\t\t\t\t\tthis.update();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((e) => { });\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (\r\n\t\t\tfillType === FillType.Default ||\r\n\t\t\tfillType === FillType.ImageVector\r\n\t\t) {\r\n\t\t\tif (fillVector) {\r\n\t\t\t\tthis.lineStyle(strokeWidth, strokeColor, strokeAlpha);\r\n\t\t\t\tthis.beginFill(fillColor, fillAlpha);\r\n\t\t\t\tthis.drawPolygon(path);\r\n\t\t\t\tthis.endFill();\r\n\t\t\t}\r\n\r\n\t\t\tif (fillImage && this._imageCache) {\r\n\t\t\t\tthis.lineStyle(strokeWidth, strokeColor, strokeAlpha);\r\n\t\t\t\tthis.beginFill(fillColor, fillAlpha);\r\n\t\t\t\tlet matrix = new Matrix();\r\n\t\t\t\tmatrix = matrix\r\n\t\t\t\t\t.translate(-box2d.x, -box2d.y)\r\n\t\t\t\t\t.scale(\r\n\t\t\t\t\t\tthis._imageCache.width / box2d.width,\r\n\t\t\t\t\t\tthis._imageCache.height / box2d.height\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\tif (!this._textureCache) {\r\n\t\t\t\t\tconst texture = new Texture(\r\n\t\t\t\t\t\tnew BaseTexture(this._imageCache)\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis._textureCache = texture;\r\n\t\t\t\t}\r\n\t\t\t\tthis.fill.visible = fillImage;\r\n\t\t\t\tthis.fill.texture = this._textureCache;\r\n\t\t\t\tthis.fill.matrix = matrix;\r\n\t\t\t\tthis.fill.color = 0xffffff;\r\n\t\t\t\tthis.drawPolygon(path);\r\n\t\t\t\tthis.endFill();\r\n\t\t\t}\r\n\t\t} else if (fillType === FillType.VectorImage) {\r\n\t\t\tif (fillImage && this._imageCache) {\r\n\t\t\t\tlet matrix = new Matrix();\r\n\t\t\t\tmatrix = matrix\r\n\t\t\t\t\t.translate(-box2d.x, -box2d.y)\r\n\t\t\t\t\t.scale(\r\n\t\t\t\t\t\tthis._imageCache.width / box2d.width,\r\n\t\t\t\t\t\tthis._imageCache.height / box2d.height\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\tif (!this._textureCache) {\r\n\t\t\t\t\tconst texture = new Texture(\r\n\t\t\t\t\t\tnew BaseTexture(this._imageCache)\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis._textureCache = texture;\r\n\t\t\t\t}\r\n\t\t\t\tthis.fill.visible = fillImage;\r\n\t\t\t\tthis.fill.texture = this._textureCache;\r\n\t\t\t\tthis.fill.matrix = matrix;\r\n\t\t\t\tthis.fill.color = 0xffffff;\r\n\t\t\t\tthis.drawPolygon(path);\r\n\t\t\t\tthis.endFill();\r\n\t\t\t}\r\n\t\t\tif (fillVector) {\r\n\t\t\t\tthis.lineStyle(strokeWidth, strokeColor, strokeAlpha);\r\n\t\t\t\tthis.beginFill(fillColor, fillAlpha);\r\n\t\t\t\tthis.drawPolygon(path);\r\n\t\t\t\tthis.endFill();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tclosed && this.closePath();\r\n\t}\r\n\r\n\tprotected _drawHover(): void {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst fill = !!element.styles.fill,\r\n\t\t\tfillColor = element.styles.fillColor,\r\n\t\t\tfillAlpha = element.styles.fillAlpha,\r\n\t\t\tfillImage = element.styles.fillImage,\r\n\t\t\tfillVector = element.styles.fillVector,\r\n\t\t\tfillType = element.styles.fillType,\r\n\t\t\tstrokeColor = element.styles.strokeColor,\r\n\t\t\tstrokeWidth = element.styles.strokeWidth,\r\n\t\t\tstrokeAlpha = element.styles.strokeAlpha,\r\n\t\t\tclosed = element.styles.shapeClosed,\r\n\t\t\thoverFill = element.styles.hoverFill,\r\n\t\t\thoverFillColor = element.styles.hoverFillColor,\r\n\t\t\thoverFillAlpha = element.styles.hoverFillAlpha,\r\n\t\t\thoverStrokeWidth = element.styles.hoverStrokeWidth,\r\n\t\t\thoverStrokeColor = element.styles.hoverStrokeColor,\r\n\t\t\thoverStrokeAlpha = element.styles.hoverStrokeAlpha;\r\n\r\n\t\tif (element.hovered && !element.selected) {\r\n\t\t\tconst points = element.points;\r\n\t\t\tthis.beginFill(hoverFillColor, hoverFillAlpha);\r\n\t\t\tthis.lineStyle(\r\n\t\t\t\thoverStrokeWidth,\r\n\t\t\t\thoverStrokeColor,\r\n\t\t\t\thoverStrokeWidth\r\n\t\t\t);\r\n\t\t\tconst path: number[] = [];\r\n\t\t\tpoints.forEach((point: number[]) => {\r\n\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.drawPolygon(path);\r\n\t\t}\r\n\t}\r\n}\r\n","import * as PIXI from \"pixi.js\";\r\n\r\n/** Define the dash: [dash length, gap size, dash size, gap size, ...] */\r\nexport type Dashes = number[];\r\n\r\nexport interface DashLineOptions {\r\n\tdash?: Dashes;\r\n\twidth?: number;\r\n\tcolor?: number;\r\n\talpha?: number;\r\n\tscale?: number;\r\n\tuseTexture?: boolean;\r\n\tuseDots?: boolean;\r\n\tcap?: PIXI.LINE_CAP;\r\n\tjoin?: PIXI.LINE_JOIN;\r\n\talignment?: number;\r\n}\r\n\r\nconst dashLineOptionsDefault: Partial<DashLineOptions> = {\r\n\tdash: [10, 5],\r\n\twidth: 1,\r\n\tcolor: 0xffffff,\r\n\talpha: 1,\r\n\tscale: 1,\r\n\tuseTexture: false,\r\n\talignment: 0.5,\r\n};\r\n\r\nexport class DashLine {\r\n\tgraphics: PIXI.Graphics;\r\n\r\n\t/** current length of the line */\r\n\tlineLength?: number;\r\n\r\n\t/** cursor location */\r\n\tcursor = new PIXI.Point();\r\n\r\n\t/** desired scale of line */\r\n\tscale = 1;\r\n\r\n\t// sanity check to ensure the lineStyle is still in use\r\n\tprivate activeTexture?: PIXI.Texture;\r\n\r\n\tprivate start?: PIXI.Point;\r\n\r\n\tprivate dashSize?: number;\r\n\tprivate dash: number[] | undefined;\r\n\r\n\tprivate useTexture: boolean | undefined;\r\n\r\n\t// cache of PIXI.Textures for dashed lines\r\n\tstatic dashTextureCache: Record<string, PIXI.Texture> = {};\r\n\r\n\t/**\r\n\t * Create a DashLine\r\n\t * @param graphics\r\n\t * @param [options]\r\n\t * @param [options.useTexture=false] - use the texture based render (useful for very large or very small dashed lines)\r\n\t * @param [options.dashes=[10,5] - an array holding the dash and gap (eg, [10, 5, 20, 5, ...])\r\n\t * @param [options.width=1] - width of the dashed line\r\n\t * @param [options.alpha=1] - alpha of the dashed line\r\n\t * @param [options.color=0xffffff] - color of the dashed line\r\n\t * @param [options.cap] - add a PIXI.LINE_CAP style to dashed lines (only works for useTexture: false)\r\n\t * @param [options.join] - add a PIXI.LINE_JOIN style to the dashed lines (only works for useTexture: false)\r\n\t * @param [options.alignment] - The alignment of any lines drawn (0.5 = middle, 1 = outer, 0 = inner)\r\n\t */\r\n\tconstructor(graphics: PIXI.Graphics, options: DashLineOptions = {}) {\r\n\t\tthis.graphics = graphics;\r\n\t\toptions = { ...dashLineOptionsDefault, ...options };\r\n\t\tthis.dash = options.dash;\r\n\t\tif (this.dash) {\r\n\t\t\tthis.dashSize = this.dash.reduce((a, b) => a + b);\r\n\t\t} else {\r\n\t\t\tthis.dashSize = 0;\r\n\t\t}\r\n\t\tthis.useTexture = options.useTexture;\r\n\t\tif (this.useTexture) {\r\n\t\t\tconst texture = DashLine.getTexture(options, this.dashSize);\r\n\t\t\tgraphics.lineTextureStyle({\r\n\t\t\t\twidth: (options.width || 0) * (options.scale || 1),\r\n\t\t\t\tcolor: options.color,\r\n\t\t\t\talpha: options.alpha,\r\n\t\t\t\ttexture,\r\n\t\t\t\talignment: options.alignment,\r\n\t\t\t});\r\n\t\t\tthis.activeTexture = texture;\r\n\t\t} else {\r\n\t\t\tthis.graphics.lineStyle({\r\n\t\t\t\twidth: (options.width || 0) * (options.scale || 1),\r\n\t\t\t\tcolor: options.color,\r\n\t\t\t\talpha: options.alpha,\r\n\t\t\t\tcap: options.cap,\r\n\t\t\t\tjoin: options.join,\r\n\t\t\t\talignment: options.alignment,\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.scale = options.scale || 1;\r\n\t}\r\n\r\n\tprivate static distance(\r\n\t\tx1: number,\r\n\t\ty1: number,\r\n\t\tx2: number,\r\n\t\ty2: number\r\n\t): number {\r\n\t\treturn Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\r\n\t}\r\n\r\n\tsetStyle(styles: DashLineOptions) {\r\n\t\tif (styles.dash) {\r\n\t\t\tthis.dash = styles.dash;\r\n\t\t\tif (this.dash) {\r\n\t\t\t\tthis.dashSize = this.dash.reduce((a, b) => a + b);\r\n\t\t\t} else {\r\n\t\t\t\tthis.dashSize = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (styles.useTexture) {\r\n\t\t\tthis.useTexture = styles.useTexture;\r\n\t\t\tconst texture = DashLine.getTexture(styles, this.dashSize || 0);\r\n\t\t\tthis.graphics.lineTextureStyle({\r\n\t\t\t\twidth: (styles.width || 0) * (styles.scale || 1),\r\n\t\t\t\tcolor: styles.color,\r\n\t\t\t\talpha: styles.alpha,\r\n\t\t\t\ttexture,\r\n\t\t\t\talignment: styles.alignment,\r\n\t\t\t});\r\n\t\t\tthis.activeTexture = texture;\r\n\t\t} else {\r\n\t\t\tthis.graphics.lineStyle({\r\n\t\t\t\twidth: (styles.width || 0) * (styles.scale || 1),\r\n\t\t\t\tcolor: styles.color,\r\n\t\t\t\talpha: styles.alpha,\r\n\t\t\t\tcap: styles.cap,\r\n\t\t\t\tjoin: styles.join,\r\n\t\t\t\talignment: styles.alignment,\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.scale = styles.scale || 1;\r\n\t}\r\n\r\n\tmoveTo(x: number, y: number): this {\r\n\t\tthis.lineLength = 0;\r\n\t\tthis.cursor.set(x, y);\r\n\t\tthis.start = new PIXI.Point(x, y);\r\n\t\tthis.graphics.moveTo(this.cursor.x, this.cursor.y);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tlineTo(x: number, y: number, closePath?: boolean): this {\r\n\t\tif (typeof this.lineLength === undefined) {\r\n\t\t\tthis.moveTo(0, 0);\r\n\t\t}\r\n\t\tconst length = DashLine.distance(this.cursor.x, this.cursor.y, x, y);\r\n\t\tconst angle = Math.atan2(y - this.cursor.y, x - this.cursor.x);\r\n\t\tif (\r\n\t\t\t!this.start ||\r\n\t\t\t!this.dash ||\r\n\t\t\tthis.lineLength === undefined ||\r\n\t\t\t!this.dashSize\r\n\t\t) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tconst closed = closePath && x === this.start.x && y === this.start.y;\r\n\t\tif (this.useTexture) {\r\n\t\t\tthis.graphics.moveTo(this.cursor.x, this.cursor.y);\r\n\t\t\tthis.adjustLineStyle(angle);\r\n\t\t\tif (closed && this.dash.length % 2 === 0) {\r\n\t\t\t\tconst gap = this.dash[this.dash.length - 1];\r\n\t\t\t\tthis.graphics.lineTo(\r\n\t\t\t\t\tx - Math.cos(angle) * gap,\r\n\t\t\t\t\ty - Math.sin(angle) * gap\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.graphics.lineTo(x, y);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst cos = Math.cos(angle);\r\n\t\t\tconst sin = Math.sin(angle);\r\n\t\t\tlet x0 = this.cursor.x;\r\n\t\t\tlet y0 = this.cursor.y;\r\n\r\n\t\t\t// find the first part of the dash for this line\r\n\t\t\tconst place = this.lineLength % (this.dashSize * this.scale);\r\n\t\t\tlet dashIndex: number = 0,\r\n\t\t\t\tdashStart: number = 0;\r\n\t\t\tlet dashX = 0;\r\n\t\t\tfor (let i = 0; i < this.dash.length; i++) {\r\n\t\t\t\tconst dashSize = this.dash[i] * this.scale;\r\n\t\t\t\tif (place < dashX + dashSize) {\r\n\t\t\t\t\tdashIndex = i;\r\n\t\t\t\t\tdashStart = place - dashX;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdashX += dashSize;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet remaining = length;\r\n\t\t\t// let count = 0\r\n\t\t\twhile (remaining > 0) {\r\n\t\t\t\t// && count++ < 1000) {\r\n\t\t\t\tconst dashSize = this.dash[dashIndex] * this.scale - dashStart;\r\n\t\t\t\tlet dist = remaining > dashSize ? dashSize : remaining;\r\n\t\t\t\tif (closed) {\r\n\t\t\t\t\tconst remainingDistance = DashLine.distance(\r\n\t\t\t\t\t\tx0 + cos * dist,\r\n\t\t\t\t\t\ty0 + sin * dist,\r\n\t\t\t\t\t\tthis.start.x,\r\n\t\t\t\t\t\tthis.start.y\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (remainingDistance <= dist) {\r\n\t\t\t\t\t\tif (dashIndex % 2 === 0) {\r\n\t\t\t\t\t\t\tconst lastDash =\r\n\t\t\t\t\t\t\t\tDashLine.distance(\r\n\t\t\t\t\t\t\t\t\tx0,\r\n\t\t\t\t\t\t\t\t\ty0,\r\n\t\t\t\t\t\t\t\t\tthis.start.x,\r\n\t\t\t\t\t\t\t\t\tthis.start.y\r\n\t\t\t\t\t\t\t\t) -\r\n\t\t\t\t\t\t\t\tthis.dash[this.dash.length - 1] * this.scale;\r\n\t\t\t\t\t\t\tx0 += cos * lastDash;\r\n\t\t\t\t\t\t\ty0 += sin * lastDash;\r\n\t\t\t\t\t\t\tthis.graphics.lineTo(x0, y0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tx0 += cos * dist;\r\n\t\t\t\ty0 += sin * dist;\r\n\t\t\t\tif (dashIndex % 2) {\r\n\t\t\t\t\tthis.graphics.moveTo(x0, y0);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.graphics.lineTo(x0, y0);\r\n\t\t\t\t}\r\n\t\t\t\tremaining -= dist;\r\n\r\n\t\t\t\tdashIndex++;\r\n\t\t\t\tdashIndex = dashIndex === this.dash.length ? 0 : dashIndex;\r\n\t\t\t\tdashStart = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.lineLength += length;\r\n\t\tthis.cursor.set(x, y);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclosePath() {\r\n\t\tif (this.start) {\r\n\t\t\tthis.lineTo(this.start.x, this.start.y, true);\r\n\t\t}\r\n\t}\r\n\r\n\tdrawCircle(x: number, y: number, radius: number, points = 80): this {\r\n\t\tconst interval = (Math.PI * 2) / points;\r\n\t\tlet angle = 0;\r\n\t\tconst first = [\r\n\t\t\tx + Math.cos(angle) * radius,\r\n\t\t\ty + Math.sin(angle) * radius,\r\n\t\t];\r\n\t\tthis.moveTo(first[0], first[1]);\r\n\t\tangle += interval;\r\n\t\tfor (let i = 1; i < points + 1; i++) {\r\n\t\t\tconst next =\r\n\t\t\t\ti === points\r\n\t\t\t\t\t? first\r\n\t\t\t\t\t: [\r\n\t\t\t\t\t\tx + Math.cos(angle) * radius,\r\n\t\t\t\t\t\ty + Math.sin(angle) * radius,\r\n\t\t\t\t\t];\r\n\t\t\tthis.lineTo(next[0], next[1]);\r\n\t\t\tangle += interval;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdrawEllipse(\r\n\t\tx: number,\r\n\t\ty: number,\r\n\t\tradiusX: number,\r\n\t\tradiusY: number,\r\n\t\tpoints = 80\r\n\t): this {\r\n\t\tconst interval = (Math.PI * 2) / points;\r\n\t\tlet first: { x: number; y: number } = {\r\n\t\t\tx: x - radiusX * Math.sin(0),\r\n\t\t\ty: y - radiusY * Math.cos(0),\r\n\t\t};\r\n\t\tfor (let i = interval; i < Math.PI * 2; i += interval) {\r\n\t\t\tconst x0 = x - radiusX * Math.sin(i);\r\n\t\t\tconst y0 = y - radiusY * Math.cos(i);\r\n\t\t\tif (i === 0) {\r\n\t\t\t\tthis.moveTo(x0, y0);\r\n\t\t\t\t// first = { x: x0, y: y0 }\r\n\t\t\t} else {\r\n\t\t\t\tthis.lineTo(x0, y0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.lineTo(first.x, first.y, true);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdrawPolygon(points: PIXI.Point[] | number[]): this {\r\n\t\tif (typeof points[0] === \"number\") {\r\n\t\t\tthis.moveTo(points[0] as number, points[1] as number);\r\n\t\t\tfor (let i = 2; i < points.length; i += 2) {\r\n\t\t\t\tthis.lineTo(\r\n\t\t\t\t\tpoints[i] as number,\r\n\t\t\t\t\tpoints[i + 1] as number,\r\n\t\t\t\t\ti === points.length - 2\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst point = points[0] as PIXI.Point;\r\n\t\t\tthis.moveTo(point.x, point.y);\r\n\t\t\tfor (let i = 1; i < points.length; i++) {\r\n\t\t\t\tconst point = points[i] as PIXI.Point;\r\n\t\t\t\tthis.lineTo(point.x, point.y, i === points.length - 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdrawRect(x: number, y: number, width: number, height: number): this {\r\n\t\tthis.moveTo(x, y)\r\n\t\t\t.lineTo(x + width, y)\r\n\t\t\t.lineTo(x + width, y + height)\r\n\t\t\t.lineTo(x, y + height)\r\n\t\t\t.lineTo(x, y, true);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// adjust the matrix for the dashed texture\r\n\tprivate adjustLineStyle(angle: number) {\r\n\t\tif (!this.lineLength) return;\r\n\t\tconst lineStyle = this.graphics.line;\r\n\t\tlineStyle.matrix = new PIXI.Matrix();\r\n\t\tif (angle) {\r\n\t\t\tlineStyle.matrix.rotate(angle);\r\n\t\t}\r\n\t\tif (this.scale !== 1) lineStyle.matrix.scale(this.scale, this.scale);\r\n\t\tconst textureStart = -this.lineLength;\r\n\t\tlineStyle.matrix.translate(\r\n\t\t\tthis.cursor.x + textureStart * Math.cos(angle),\r\n\t\t\tthis.cursor.y + textureStart * Math.sin(angle)\r\n\t\t);\r\n\t\tthis.graphics.lineStyle(lineStyle);\r\n\t}\r\n\r\n\t// creates or uses cached texture\r\n\tprivate static getTexture(\r\n\t\toptions: DashLineOptions,\r\n\t\tdashSize: number\r\n\t): PIXI.Texture | undefined {\r\n\t\tif (!options.dash || !options.width) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst key = options.dash.toString();\r\n\t\tif (DashLine.dashTextureCache[key]) {\r\n\t\t\treturn DashLine.dashTextureCache[key];\r\n\t\t}\r\n\t\tconst canvas = document.createElement(\"canvas\");\r\n\t\tcanvas.width = dashSize;\r\n\t\tcanvas.height = Math.ceil(options.width);\r\n\t\tconst context = canvas.getContext(\"2d\");\r\n\t\tif (!context) {\r\n\t\t\tconsole.warn(\"Did not get context from canvas\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcontext.strokeStyle = \"white\";\r\n\t\tcontext.globalAlpha = options.alpha || 1.0;\r\n\t\tcontext.lineWidth = options.width;\r\n\t\tlet x = 0;\r\n\t\tconst y = options.width / 2;\r\n\t\tcontext.moveTo(x, y);\r\n\t\tfor (let i = 0; i < options.dash.length; i += 2) {\r\n\t\t\tx += options.dash[i];\r\n\t\t\tcontext.lineTo(x, y);\r\n\t\t\tif (options.dash.length !== i + 1) {\r\n\t\t\t\tx += options.dash[i + 1];\r\n\t\t\t\tcontext.moveTo(x, y);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcontext.stroke();\r\n\t\tconst texture = (DashLine.dashTextureCache[key] =\r\n\t\t\tPIXI.Texture.from(canvas));\r\n\t\ttexture.baseTexture.scaleMode = PIXI.SCALE_MODES.NEAREST;\r\n\t\treturn texture;\r\n\t}\r\n\r\n\t/**\r\n\t * clear\r\n\t */\r\n\tclear() {\r\n\t\tthis.graphics?.clear();\r\n\t}\r\n}\r\n","import * as PIXI from \"pixi.js\";\r\nimport { GuideDataType, GuideOptions } from \"./type\";\r\nimport { DashLine } from \"../dashline\";\r\n\r\nexport class Guide extends PIXI.Graphics {\r\n\tprivate readonly _graphics: PIXI.Graphics;\r\n\tprivate _graphicsDash: DashLine;\r\n\tprivate _dirty: boolean = true;\r\n\tprivate _datas: GuideDataType[] = [];\r\n\r\n\tconstructor(options: Partial<GuideOptions> = {}) {\r\n\t\tsuper();\r\n\t\tthis.set(options);\r\n\t\tthis._graphics = new PIXI.Graphics();\r\n\t\tthis._graphicsDash = new DashLine(this, {\r\n\t\t\tdash: [1, 1],\r\n\t\t\twidth: 1,\r\n\t\t\tcolor: 0x000000,\r\n\t\t\talpha: 1.0,\r\n\t\t\tuseTexture: false,\r\n\t\t\tuseDots: true,\r\n\t\t});\r\n\t\tthis.addChild(this._graphics);\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\tpublic get datas(): GuideDataType[] {\r\n\t\treturn this._datas;\r\n\t}\r\n\r\n\tpublic set datas(value: GuideDataType[]) {\r\n\t\tif (this._datas === value) return;\r\n\t\tthis._datas = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Apply graph options\r\n\t * @param {GuideOptions} options - Options to be applied\r\n\t */\r\n\tpublic set(options: Partial<GuideOptions> = {}) {\r\n\t\tObject.assign(this, options);\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * On invalidation, rendering operations to redraw.\r\n\t *\r\n\t * @override\r\n\t * @param {PIXI.Rectangle} renderer\r\n\t */\r\n\tpublic render(renderer: PIXI.Renderer) {\r\n\t\tsuper.render(renderer);\r\n\t\tif (!this._dirty) return;\r\n\t\tthis._dirty = false;\r\n\t\tthis._graphics.clear();\r\n\t\tthis._graphicsDash.clear();\r\n\t\tthis.clear();\r\n\t\tthis.renderDatas();\r\n\t}\r\n\r\n\tprivate renderDatas() {\r\n\t\tconst datas = this._datas;\r\n\t\tdatas.forEach((data: GuideDataType, index: number) => {\r\n\t\t\tconst { from, to, type, dash } = data;\r\n\t\t\tif (dash) {\r\n\t\t\t\tthis._graphicsDash.setStyle({\r\n\t\t\t\t\tdash: dash || [1, 1],\r\n\t\t\t\t\twidth: 1,\r\n\t\t\t\t\tcolor: 0x011641,\r\n\t\t\t\t\talpha: 0.2,\r\n\t\t\t\t\tuseTexture: false,\r\n\t\t\t\t\tuseDots: true,\r\n\t\t\t\t\tscale: 1,\r\n\t\t\t\t\talignment: 0.5,\r\n\t\t\t\t});\r\n\t\t\t\tthis._graphicsDash.moveTo(from[0], from[1]);\r\n\t\t\t\tthis._graphicsDash.lineTo(to[0], to[1]);\r\n\t\t\t\tthis._graphicsDash.closePath();\r\n\t\t\t} else {\r\n\t\t\t\tthis._graphics.lineStyle(1, 0x011641, 0.2);\r\n\t\t\t\tthis._graphics.moveTo(from[0], from[1]);\r\n\t\t\t\tthis._graphics.lineTo(to[0], to[1]);\r\n\t\t\t\tthis._graphics.closePath();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","/**\r\n * Events Model\r\n */\r\nexport enum EventsModel {\r\n\tAdd = 'model.data.add',\r\n\tRemove = 'model.data.remove',\r\n\tClear = 'model.data.clear',\r\n\tBatchAdd = 'model.data.batchAdd'\r\n}\r\n\r\nexport interface EventsModelType<E> {\r\n\tsource: any;\r\n\tdata: E[] | [] | null;\r\n}\r\n","/**\r\n * Events Model\r\n */\r\nexport enum EventsSelection {\r\n\tChange = 'selection.data.change',\r\n\tSetSelection = 'selection.data.set',\r\n\tAppendSelection = 'selection.data.append',\r\n\tRemoveSelection = 'selection.data.remove',\r\n\tClearSelection = 'selection.data.clear',\r\n\tSelectionAll = 'selection.data.all'\r\n}\r\n","import * as PIXI from \"pixi.js\";\r\nimport { MatchedLine, RefLineDataType, RefLineOptions } from \"./type\";\r\nimport { DashLine } from \"../dashline\";\r\n\r\nexport class RefLine extends PIXI.Graphics {\r\n\tprivate readonly _graphics: PIXI.Graphics;\r\n\tprivate _graphicsDash: DashLine;\r\n\tprivate _dirty: boolean = true;\r\n\tprivate _datas: MatchedLine[] = [];\r\n\r\n\tconstructor(options: Partial<RefLineOptions> = {}) {\r\n\t\tsuper();\r\n\t\tthis.set(options);\r\n\t\tthis._graphics = new PIXI.Graphics();\r\n\t\tthis._graphicsDash = new DashLine(this, {\r\n\t\t\tdash: [1, 1],\r\n\t\t\twidth: 1,\r\n\t\t\tcolor: 0x000000,\r\n\t\t\talpha: 1.0,\r\n\t\t\tuseTexture: false,\r\n\t\t\tuseDots: true,\r\n\t\t});\r\n\t\tthis.addChild(this._graphics);\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\tpublic get datas(): MatchedLine[] {\r\n\t\treturn this._datas;\r\n\t}\r\n\r\n\tpublic set datas(value: MatchedLine[]) {\r\n\t\tif (this._datas === value) return;\r\n\t\tthis._datas = value;\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Apply graph options\r\n\t * @param {RefLineOptions} options - Options to be applied\r\n\t */\r\n\tpublic set(options: Partial<RefLineOptions> = {}) {\r\n\t\tObject.assign(this, options);\r\n\t\tthis._dirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * On invalidation, rendering operations to redraw.\r\n\t *\r\n\t * @override\r\n\t * @param {PIXI.Rectangle} renderer\r\n\t */\r\n\tpublic render(renderer: PIXI.Renderer) {\r\n\t\tsuper.render(renderer);\r\n\t\tif (!this._dirty) return;\r\n\t\tthis._dirty = false;\r\n\t\tthis._graphics.clear();\r\n\t\tthis.renderDatas();\r\n\t}\r\n\r\n\tprivate renderDatas() {\r\n\t\tconst datas = this._datas;\r\n\t\tif (false) {\r\n\t\t\t// this._graphicsDash.moveTo(from[0], from[1]);\r\n\t\t\t// this._graphicsDash.lineTo(to[0], to[1]);\r\n\t\t\tdatas.map((RefLine: any, index: number) => {\r\n\t\t\t\tconst { left, top, size } = RefLine;\r\n\t\t\t\tif (RefLine.type === \"horizontal\") {\r\n\t\t\t\t\tthis._graphicsDash.setStyle({\r\n\t\t\t\t\t\tdash: [2, 1],\r\n\t\t\t\t\t\twidth: 10,\r\n\t\t\t\t\t\tcolor: 0xff0000,\r\n\t\t\t\t\t\talpha: 1.0,\r\n\t\t\t\t\t\tuseTexture: false,\r\n\t\t\t\t\t\tuseDots: true,\r\n\t\t\t\t\t\tscale: 1,\r\n\t\t\t\t\t\talignment: 0.5,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis._graphicsDash.moveTo(left, top);\r\n\t\t\t\t\tthis._graphicsDash.lineTo(left + size, top);\r\n\t\t\t\t\tthis._graphicsDash.closePath();\r\n\t\t\t\t} else if (RefLine.type === \"vertical\") {\r\n\t\t\t\t\tthis._graphicsDash.setStyle({\r\n\t\t\t\t\t\tdash: [1, 1],\r\n\t\t\t\t\t\twidth: 1,\r\n\t\t\t\t\t\tcolor: 0xff0000,\r\n\t\t\t\t\t\talpha: 1.0,\r\n\t\t\t\t\t\tuseTexture: false,\r\n\t\t\t\t\t\tuseDots: true,\r\n\t\t\t\t\t\tscale: 1,\r\n\t\t\t\t\t\talignment: 0.5,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis._graphicsDash.moveTo(left, top);\r\n\t\t\t\t\tthis._graphicsDash.lineTo(left, top + size);\r\n\t\t\t\t\tthis._graphicsDash.closePath();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis._graphicsDash.closePath();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdatas.map((RefLine: any, index: number) => {\r\n\t\t\tconst { left, top, size } = RefLine;\r\n\t\t\tif (RefLine.type === \"horizontal\") {\r\n\t\t\t\tthis._graphics.lineStyle(1, 0xff0000, 1);\r\n\t\t\t\tthis._graphics.moveTo(left, top);\r\n\t\t\t\tthis._graphics.lineTo(left + size, top);\r\n\t\t\t\tthis._graphics.closePath();\r\n\t\t\t} else if (RefLine.type === \"vertical\") {\r\n\t\t\t\tthis._graphics.lineStyle(1, 0xff0000, 1);\r\n\t\t\t\tthis._graphics.moveTo(left, top);\r\n\t\t\t\tthis._graphics.lineTo(left, top + size);\r\n\t\t\t\tthis._graphics.closePath();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * clear\r\n\t * @returns\r\n\t */\r\n\tpublic clear(): this {\r\n\t\tthis._datas = [];\r\n\t\tthis._dirty = true;\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { Text, Rectangle, Polygon, DisplayObject } from \"pixi.js\";\r\nimport { Element, Line, OBB } from \"@blood4/modeling\";\r\nimport { UI } from \"./UI\";\r\nimport { DashLine } from \"../components\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\n\r\nexport class LineUI extends UI {\r\n\ttext?: Text;\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper(element, renderer);\r\n\t\t// const shadowFilter = new DropShadowFilter({\r\n\t\t// \trotation: 0,\r\n\t\t// \tdistance: 0,\r\n\t\t// \tcolor: 0xff0000,\r\n\t\t// \talpha: 1.0,\r\n\t\t// \tshadowOnly: false,\r\n\t\t// \tblur: 2,\r\n\t\t// \tquality: 7\r\n\t\t// });\r\n\t\t// this.filters = [shadowFilter];\r\n\t}\r\n\r\n\t/**\r\n\t * update global styles from view\r\n\t * @returns\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tsuper._updateStyles();\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst points = element.getHitArea(2);\r\n\t\tlet gizmo = this._gizmos.get(\"editorGizmo\");\r\n\t\tif (gizmo) {\r\n\t\t\tconst unionPoints: number[][] = points.map((point: number[]) => {\r\n\t\t\t\treturn [point[0], point[1]];\r\n\t\t\t});\r\n\t\t\tgizmo.children.forEach((child: DisplayObject) => {\r\n\t\t\t\tconst localBounds = child.getLocalBounds();\r\n\t\t\t\tunionPoints.push([localBounds.x, localBounds.y]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x,\r\n\t\t\t\t\tlocalBounds.y + localBounds.height,\r\n\t\t\t\t]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x + localBounds.width,\r\n\t\t\t\t\tlocalBounds.y + localBounds.height,\r\n\t\t\t\t]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x + localBounds.width,\r\n\t\t\t\t\tlocalBounds.y,\r\n\t\t\t\t]);\r\n\t\t\t});\r\n\t\t\tconst obb = new OBB(unionPoints);\r\n\t\t\tconst path: number[] = [];\r\n\t\t\tobb.points.forEach((point: number[]) => {\r\n\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.hitArea = new Polygon(path);\r\n\t\t} else {\r\n\t\t\tconst path: number[] = [];\r\n\t\t\tpoints.forEach((point: number[]) => {\r\n\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.hitArea = new Polygon(path);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *  BoundingBox\r\n\t */\r\n\tprotected _drawBoundingBox() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst rect: Rectangle = new Rectangle();\r\n\t\tif (this.text) {\r\n\t\t\tthis.text.getLocalBounds(rect);\r\n\t\t}\r\n\t\tconst boundingbox = element.getBoundingBox(10);\r\n\t\tthis.lineStyle(1, 0xff6666, 1.0);\r\n\t\tthis.beginFill(0x0000, 0.0);\r\n\t\tthis.drawRect(\r\n\t\t\tboundingbox.x,\r\n\t\t\tboundingbox.y,\r\n\t\t\tboundingbox.width,\r\n\t\t\tboundingbox.height\r\n\t\t);\r\n\t\tthis.endFill();\r\n\r\n\t\tconst boundingbox2 = this._boundsRect;\r\n\t\tthis.lineStyle(1, 0xff0033, 1.0);\r\n\t\tthis.beginFill(0x0000, 0.0);\r\n\t\tthis.drawRect(\r\n\t\t\tboundingbox2.x,\r\n\t\t\tboundingbox2.y,\r\n\t\t\tboundingbox2.width,\r\n\t\t\tboundingbox2.height\r\n\t\t);\r\n\t\tthis.endFill();\r\n\r\n\t\tif (this.text) {\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\tif (this.text) {\r\n\t\t\t\tthis.text.getLocalBounds(rect);\r\n\t\t\t}\r\n\t\t\tconst viewport: any = this.parent;\r\n\t\t\tconst scale = viewport.scaled || 1.0;\r\n\t\t\tthis.lineStyle(1, 0xffff66, 1.0);\r\n\t\t\tthis.beginFill(0x0000, 0.0);\r\n\t\t\tthis.drawRect(this.text.x, this.text.y, rect.width, rect.height);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tprotected _drawAABB() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst aabb = element.getAABB();\r\n\t\tthis.lineStyle(1, 0x00ff00, 1.0);\r\n\t\tthis.beginFill(0xffff00, 0.0);\r\n\t\tthis.drawRect(aabb.x, aabb.y, aabb.width, aabb.height);\r\n\t\tthis.endFill();\r\n\t\tthis.lineStyle(1, 0x000000, 1.0);\r\n\t\tthis.drawEllipse(\r\n\t\t\taabb.x + aabb.width / 2,\r\n\t\t\taabb.y + aabb.height / 2,\r\n\t\t\taabb.width / 2,\r\n\t\t\taabb.height / 2\r\n\t\t);\r\n\t\tthis.closePath();\r\n\t}\r\n\r\n\t/**\r\n\t * OBB Bounds\r\n\t */\r\n\tprotected _drawOBB() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst obb = element.getOBB();\r\n\t\tconst points = obb.points;\r\n\t\tthis.lineStyle(2, 0xffff00, 1.0);\r\n\t\tthis.beginFill(0xffff00, 0.0);\r\n\t\tconst path: number[] = [];\r\n\t\tpoints.forEach((point: number[]) => {\r\n\t\t\tpath.push(point[0], point[1]);\r\n\t\t});\r\n\t\tthis.drawPolygon(path);\r\n\t\tthis.closePath();\r\n\r\n\t\tif (element.debug) {\r\n\t\t\tconst points4 = element.getHitArea(2);\r\n\t\t\tthis.lineStyle(1, 0x99cc33, 1.0);\r\n\t\t\tthis.beginFill(0x99cc33, 0.1);\r\n\t\t\tconst path4: number[] = [];\r\n\t\t\tpoints4.forEach((point: number[]) => {\r\n\t\t\t\tpath4.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.drawPolygon(path4);\r\n\t\t}\r\n\t\tlet gizmo = this._gizmos.get(\"editorGizmo\");\r\n\t\tif (gizmo) {\r\n\t\t\tconst unionPoints: number[][] = points.map((point: number[]) => {\r\n\t\t\t\treturn [point[0], point[1]];\r\n\t\t\t});\r\n\t\t\tgizmo.children.forEach((child: DisplayObject) => {\r\n\t\t\t\tconst localBounds = child.getLocalBounds();\r\n\t\t\t\tunionPoints.push([localBounds.x, localBounds.y]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x,\r\n\t\t\t\t\tlocalBounds.y + localBounds.height,\r\n\t\t\t\t]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x + localBounds.width,\r\n\t\t\t\t\tlocalBounds.y + localBounds.height,\r\n\t\t\t\t]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x + localBounds.width,\r\n\t\t\t\t\tlocalBounds.y,\r\n\t\t\t\t]);\r\n\t\t\t});\r\n\t\t\tconst obb = new OBB(unionPoints);\r\n\t\t\tconst path: number[] = [];\r\n\t\t\tobb.points.forEach((point: number[]) => {\r\n\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.drawPolygon(path);\r\n\t\t} else {\r\n\t\t\tconst path: number[] = [];\r\n\t\t\tpoints.forEach((point: number[]) => {\r\n\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.drawPolygon(path);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * draw Body\r\n\t */\r\n\tprotected _drawBody(): void {\r\n\t\tconst element = this._element as Line;\r\n\r\n\t\tif (!element) return;\r\n\t\t// const points = element.points;\r\n\t\t// if(!points || points.length === 0) return;\r\n\r\n\t\t// const matrix = element._matrix, angle = element.angle;\r\n\t\t// if (angle !== 0) {\r\n\t\t// \tthis.setMatrix(new Matrix(matrix[0], matrix[1], matrix[2], matrix[3], matrix[4], matrix[5]));\r\n\t\t// }\r\n\t\t// if (element.selected) {\r\n\t\t// \tthis.lineStyle(1, 0x000000, 1.0);\r\n\t\t// \tthis.beginFill(0x66CC99, 0.6);\r\n\t\t// } else {\r\n\t\t// \tthis.lineStyle(1, 0x000000, 1.0);\r\n\t\t// \tthis.beginFill(0x99CC99, 0.6);\r\n\t\t// }\r\n\t\t// const path: number[] = [];\r\n\t\t// points.forEach((point: any) => {\r\n\t\t// \tpath.push(point[0], point[1]);\r\n\t\t// });\r\n\t\t// this.drawPolygon(path);\r\n\t\t// // this.drawEllipse(element.x, element.y, element.width / 2, element.height / 2);\r\n\t\t// this.endFill();\r\n\t\t// if (angle !== 0) {\r\n\t\t// \tthis.setMatrix(new Matrix());\r\n\t\t// }\r\n\t\tconst from = element.from,\r\n\t\t\tto = element.to;\r\n\r\n\t\tif (element.selected) {\r\n\t\t\tconst points4 = element.getHitArea(2);\r\n\t\t\tthis.lineStyle(1, 0x000000, 0.0);\r\n\t\t\tthis.beginFill(0x000000, 0.05);\r\n\t\t\tconst path4: number[] = [];\r\n\t\t\tpoints4.forEach((point: number[]) => {\r\n\t\t\t\tpath4.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.drawPolygon(path4);\r\n\t\t\tthis.lineStyle(\r\n\t\t\t\telement.styles.selectStrokeWidth || 1,\r\n\t\t\t\telement.styles.selectStrokeColor || 0x000000,\r\n\t\t\t\telement.styles.selectStrokeAlpha || 1.0\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tthis.lineStyle(\r\n\t\t\t\telement.styles.strokeWidth || 1,\r\n\t\t\t\telement.styles.strokeColor || 0x000000,\r\n\t\t\t\telement.styles.strokeAlpha || 1.0\r\n\t\t\t);\r\n\t\t}\r\n\t\tconst lineDash = element.dash;\r\n\t\tif (lineDash) {\r\n\t\t\tconst dash = new DashLine(this, {\r\n\t\t\t\tdash: lineDash,\r\n\t\t\t\twidth: element.styles.strokeWidth || 1,\r\n\t\t\t\tcolor: element.styles.strokeColor,\r\n\t\t\t\talpha: element.styles.strokeAlpha,\r\n\t\t\t\tuseTexture: false,\r\n\t\t\t\tuseDots: true,\r\n\t\t\t});\r\n\t\t\tdash.moveTo(from[0], from[1]).lineTo(to[0], to[1]);\r\n\t\t} else {\r\n\t\t\tthis.moveTo(from[0], from[1]);\r\n\t\t\tthis.lineTo(to[0], to[1]);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\r\n\t\tif (element.debug) {\r\n\t\t\tconst offset = -1 * element.styles.offsetDelta;\r\n\t\t\tconst alongPoints = element.getAlongPoints(offset);\r\n\t\t\tthis.lineStyle(1, 0xff0000, 1.0);\r\n\t\t\tthis.moveTo(alongPoints.from[0], alongPoints.from[1]);\r\n\t\t\tthis.lineTo(alongPoints.to[0], alongPoints.to[1]);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _drawSelect(): void {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst points = element.points;\r\n\t\tif (!points || points.length === 0) return;\r\n\t}\r\n\r\n\tprotected _drawHover(): void {\r\n\t\tconst element = this._element as Line;\r\n\t\tif (!element) return;\r\n\t\tif (element.hovered && !element.selected) {\r\n\t\t\tconst from = element.from,\r\n\t\t\t\tto = element.to,\r\n\t\t\t\tlineDash = element.dash;\r\n\r\n\t\t\tconst points4 = element.getHitArea(2);\r\n\t\t\tthis.lineStyle(1, 0x000000, 0.0);\r\n\t\t\tthis.beginFill(0x000000, 0.05);\r\n\t\t\tconst path4: number[] = [];\r\n\t\t\tpoints4.forEach((point: number[]) => {\r\n\t\t\t\tpath4.push(point[0], point[1]);\r\n\t\t\t});\r\n\r\n\t\t\tthis.drawPolygon(path4);\r\n\r\n\t\t\tthis.lineStyle(\r\n\t\t\t\telement.styles.hoverStrokeWidth || 1,\r\n\t\t\t\telement.styles.hoverStrokeColor || 0xff0000,\r\n\t\t\t\telement.styles.hoverStrokeAlpha || 1.0\r\n\t\t\t);\r\n\t\t\tif (lineDash) {\r\n\t\t\t\tconst dash = new DashLine(this, {\r\n\t\t\t\t\tdash: lineDash,\r\n\t\t\t\t\twidth: element.styles.strokeWidth || 1,\r\n\t\t\t\t\tcolor: element.styles.selectFillColor,\r\n\t\t\t\t\talpha: element.styles.strokeAlpha,\r\n\t\t\t\t\tuseTexture: false,\r\n\t\t\t\t\tuseDots: true,\r\n\t\t\t\t});\r\n\t\t\t\tdash.moveTo(from[0], from[1]).lineTo(to[0], to[1]);\r\n\t\t\t} else {\r\n\t\t\t\tthis.moveTo(from[0], from[1]);\r\n\t\t\t\tthis.lineTo(to[0], to[1]);\r\n\t\t\t\tthis.endFill();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * check all gizmos\r\n\t */\r\n\tprotected _checkGizmos(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tthis._checkLabelGizmo();\r\n\t\tthis._checkLabel2Gizmo();\r\n\t\tthis._checkEditorGizmo();\r\n\t}\r\n}\r\n","import { Matrix, Text, Rectangle, Polygon } from \"pixi.js\";\r\nimport { Element, ShapeLine } from \"@blood4/modeling\";\r\nimport { UI } from \".\";\r\nimport { DashLine } from \"../components\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\n\r\nexport class ShapeLineUI extends UI {\r\n\ttext?: Text;\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper(element, renderer);\r\n\t}\r\n\r\n\t/**\r\n\t * update global styles from view\r\n\t * @returns\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tsuper._updateStyles();\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst points4 = element.getHitArea(2);\r\n\t\tconst path4: number[] = [];\r\n\t\tpoints4.forEach((point: number[]) => {\r\n\t\t\tpath4.push(point[0], point[1]);\r\n\t\t});\r\n\t\tthis.hitArea = new Polygon(path4);\r\n\t}\r\n\r\n\t/**\r\n\t *  BoundingBox\r\n\t */\r\n\tprotected _drawBoundingBox() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst rect: Rectangle = new Rectangle();\r\n\t\tif (this.text) {\r\n\t\t\tthis.text.getLocalBounds(rect);\r\n\t\t}\r\n\t\tconst boundingbox = element.getBoundingBox(10);\r\n\t\tthis.lineStyle(1, 0xff6666, 1.0);\r\n\t\tthis.beginFill(0x0000, 0.0);\r\n\t\tthis.drawRect(\r\n\t\t\tboundingbox.x,\r\n\t\t\tboundingbox.y,\r\n\t\t\tboundingbox.width,\r\n\t\t\tboundingbox.height\r\n\t\t);\r\n\t\tthis.endFill();\r\n\r\n\t\tconst boundingbox2 = this._boundsRect;\r\n\t\tthis.lineStyle(1, 0xff0033, 1.0);\r\n\t\tthis.beginFill(0x0000, 0.0);\r\n\t\tthis.drawRect(\r\n\t\t\tboundingbox2.x,\r\n\t\t\tboundingbox2.y,\r\n\t\t\tboundingbox2.width,\r\n\t\t\tboundingbox2.height\r\n\t\t);\r\n\t\tthis.endFill();\r\n\r\n\t\tif (this.text) {\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\tif (this.text) {\r\n\t\t\t\tthis.text.getLocalBounds(rect);\r\n\t\t\t}\r\n\t\t\tconst viewport: any = this.parent;\r\n\t\t\tconst scale = viewport.scaled || 1.0;\r\n\t\t\tthis.lineStyle(1, 0xffff66, 1.0);\r\n\t\t\tthis.beginFill(0x0000, 0.0);\r\n\t\t\tthis.drawRect(this.text.x, this.text.y, rect.width, rect.height);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tprotected _drawAABB() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst aabb = element.getAABB();\r\n\t\tthis.lineStyle(1, 0x00ff00, 1.0);\r\n\t\tthis.beginFill(0xffff00, 0.0);\r\n\t\tthis.drawRect(aabb.x, aabb.y, aabb.width, aabb.height);\r\n\t\tthis.endFill();\r\n\t\tthis.lineStyle(1, 0x000000, 1.0);\r\n\t\tthis.drawEllipse(\r\n\t\t\taabb.x + aabb.width / 2,\r\n\t\t\taabb.y + aabb.height / 2,\r\n\t\t\taabb.width / 2,\r\n\t\t\taabb.height / 2\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * OBB Bounds\r\n\t */\r\n\tprotected _drawOBB() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst obb = element.getOBB();\r\n\t\tconst points = obb.points;\r\n\t\tthis.lineStyle(1, 0xffff00, 1.0);\r\n\t\tthis.beginFill(0xffff00, 0.0);\r\n\t\tconst path: number[] = [];\r\n\t\tpoints.forEach((point: number[]) => {\r\n\t\t\tpath.push(point[0], point[1]);\r\n\t\t});\r\n\t\tthis.drawPolygon(path);\r\n\r\n\t\tconst points4 = element.getHitArea(2);\r\n\t\tthis.lineStyle(10, 0x99cc33, 1.0);\r\n\t\tthis.beginFill(0x99cc33, 0.5);\r\n\t\tconst path4: number[] = [];\r\n\t\tpoints4.forEach((point: number[]) => {\r\n\t\t\tpath4.push(point[0], point[1]);\r\n\t\t});\r\n\t\tthis.drawPolygon(path4);\r\n\t\tthis.closePath();\r\n\t}\r\n\r\n\t/**\r\n\t * draw Body\r\n\t */\r\n\tprotected _drawBody(): void {\r\n\t\tconst element = this._element as ShapeLine;\r\n\r\n\t\tif (!element) return;\r\n\t\tconst points = element.points;\r\n\t\tif (!points || points.length === 0) return;\r\n\r\n\t\tconst matrix = element._matrix,\r\n\t\t\tangle = element.angle;\r\n\t\tif (angle !== 0) {\r\n\t\t\tthis.setMatrix(\r\n\t\t\t\tnew Matrix(\r\n\t\t\t\t\tmatrix[0],\r\n\t\t\t\t\tmatrix[1],\r\n\t\t\t\t\tmatrix[2],\r\n\t\t\t\t\tmatrix[3],\r\n\t\t\t\t\tmatrix[4],\r\n\t\t\t\t\tmatrix[5]\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t}\r\n\t\tconst path: number[] = [];\r\n\t\tpoints.forEach((point: any) => {\r\n\t\t\tpath.push(point[0], point[1]);\r\n\t\t});\r\n\t\tconst lineDash = element.dash;\r\n\t\tif (lineDash) {\r\n\t\t\tconst dash = new DashLine(this, {\r\n\t\t\t\tdash: lineDash,\r\n\t\t\t\twidth: element.styles.strokeWidth || 1,\r\n\t\t\t\tcolor: element.styles.strokeColor,\r\n\t\t\t\talpha: element.styles.strokeAlpha,\r\n\t\t\t\tuseTexture: false,\r\n\t\t\t\tuseDots: true,\r\n\t\t\t});\r\n\t\t\tdash.drawPolygon(path);\r\n\t\t} else {\r\n\t\t\tconst isDrawing = element.clients.isDrawing;\r\n\t\t\tif (isDrawing) {\r\n\t\t\t\tpoints.forEach((point: number[], index: number) => {\r\n\t\t\t\t\tif (index === points.length - 2) {\r\n\t\t\t\t\t\tthis.lineStyle(1.5, 0x737373, 1.0);\r\n\t\t\t\t\t\tthis.beginFill(0xffffff, 1.0);\r\n\t\t\t\t\t\tthis.drawCircle(point[0], point[1], 3);\r\n\t\t\t\t\t\tthis.endFill();\r\n\t\t\t\t\t} else if (index === points.length - 1) {\r\n\t\t\t\t\t\tthis.lineStyle(1.0, 0x000000, 0.35);\r\n\t\t\t\t\t\tthis.beginFill(0xffffff, 1.0);\r\n\t\t\t\t\t\tthis.drawCircle(point[0], point[1], 2.5);\r\n\t\t\t\t\t\tthis.endFill();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis.lineStyle(\r\n\t\t\t\telement.styles.strokeWidth || 1,\r\n\t\t\t\telement.styles.strokeColor || 0xf78284,\r\n\t\t\t\telement.styles.strokeAlpha || 1.0\r\n\t\t\t);\r\n\t\t\tpoints.forEach((point: number[], index: number) => {\r\n\t\t\t\tif (index === 0) {\r\n\t\t\t\t\tthis.moveTo(point[0], point[1]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.lineTo(point[0], point[1]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (angle !== 0) {\r\n\t\t\tthis.setMatrix(new Matrix());\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _drawHover(): void {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst points = element.points;\r\n\t\tif (!points || points.length === 0) return;\r\n\t\tif (element.hovered) {\r\n\t\t\tconst points = element.points;\r\n\t\t\tthis.lineStyle(\r\n\t\t\t\telement.styles.hoverStrokeWidth || 1,\r\n\t\t\t\telement.styles.hoverStrokeColor || 0xf78284,\r\n\t\t\t\telement.styles.hoverStrokeAlpha || 1.0\r\n\t\t\t);\r\n\t\t\tpoints.forEach((point: number[], index: number) => {\r\n\t\t\t\tif (index === 0) {\r\n\t\t\t\t\tthis.moveTo(point[0], point[1]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.lineTo(point[0], point[1]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _drawSelect(): void {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst points = element.points;\r\n\t\tif (!points || points.length === 0) return;\r\n\t\tif (element.selected) {\r\n\t\t\tconst points = element.points;\r\n\t\t\tthis.lineStyle(\r\n\t\t\t\telement.styles.selectStrokeWidth || 1,\r\n\t\t\t\telement.styles.selectStrokeColor || 0xf78284,\r\n\t\t\t\telement.styles.selectStrokeAlpha || 1.0\r\n\t\t\t);\r\n\t\t\tpoints.forEach((point: number[], index: number) => {\r\n\t\t\t\tif (index === 0) {\r\n\t\t\t\t\tthis.moveTo(point[0], point[1]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.lineTo(point[0], point[1]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * check all gizmos\r\n\t */\r\n\tprotected _checkGizmos(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tthis._checkLabelGizmo();\r\n\t\tthis._checkLabel2Gizmo();\r\n\t\tthis._checkEditorGizmo();\r\n\t}\r\n}\r\n","import { Text, Rectangle, Polygon, DisplayObject } from \"pixi.js\";\r\nimport { Edge, Element, Line, OBB } from \"@blood4/modeling\";\r\nimport { UI } from \"./UI\";\r\nimport { DashLine } from \"../components\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\n\r\nexport class EdgeUI extends UI {\r\n\ttext?: Text;\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper(element, renderer);\r\n\t}\r\n\r\n\t/**\r\n\t * update global styles from view\r\n\t * @returns\r\n\t */\r\n\tprotected _updateStyles(): void {\r\n\t\tsuper._updateStyles();\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst points = element.getHitArea(2);\r\n\t\tlet gizmo = this._gizmos.get(\"editorGizmo\");\r\n\t\tif (gizmo) {\r\n\t\t\tconst unionPoints: number[][] = points.map((point: number[]) => {\r\n\t\t\t\treturn [point[0], point[1]];\r\n\t\t\t});\r\n\t\t\tgizmo.children.forEach((child: DisplayObject) => {\r\n\t\t\t\tconst localBounds = child.getLocalBounds();\r\n\t\t\t\tunionPoints.push([localBounds.x, localBounds.y]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x,\r\n\t\t\t\t\tlocalBounds.y + localBounds.height,\r\n\t\t\t\t]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x + localBounds.width,\r\n\t\t\t\t\tlocalBounds.y + localBounds.height,\r\n\t\t\t\t]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x + localBounds.width,\r\n\t\t\t\t\tlocalBounds.y,\r\n\t\t\t\t]);\r\n\t\t\t});\r\n\t\t\tconst obb = new OBB(unionPoints);\r\n\t\t\tconst path: number[] = [];\r\n\t\t\tobb.points.forEach((point: number[]) => {\r\n\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.hitArea = new Polygon(path);\r\n\t\t} else {\r\n\t\t\tconst path: number[] = [];\r\n\t\t\tpoints.forEach((point: number[]) => {\r\n\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.hitArea = new Polygon(path);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *  BoundingBox\r\n\t */\r\n\tprotected _drawBoundingBox() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst rect: Rectangle = new Rectangle();\r\n\t\tif (this.text) {\r\n\t\t\tthis.text.getLocalBounds(rect);\r\n\t\t}\r\n\t\tconst boundingbox = element.getBoundingBox(10);\r\n\t\tthis.lineStyle(1, 0xff6666, 1.0);\r\n\t\tthis.beginFill(0x0000, 0.0);\r\n\t\tthis.drawRect(\r\n\t\t\tboundingbox.x,\r\n\t\t\tboundingbox.y,\r\n\t\t\tboundingbox.width,\r\n\t\t\tboundingbox.height\r\n\t\t);\r\n\t\tthis.endFill();\r\n\r\n\t\tconst boundingbox2 = this._boundsRect;\r\n\t\tthis.lineStyle(1, 0xff0033, 1.0);\r\n\t\tthis.beginFill(0x0000, 0.0);\r\n\t\tthis.drawRect(\r\n\t\t\tboundingbox2.x,\r\n\t\t\tboundingbox2.y,\r\n\t\t\tboundingbox2.width,\r\n\t\t\tboundingbox2.height\r\n\t\t);\r\n\t\tthis.endFill();\r\n\r\n\t\tif (this.text) {\r\n\t\t\tconst rect: Rectangle = new Rectangle();\r\n\t\t\tif (this.text) {\r\n\t\t\t\tthis.text.getLocalBounds(rect);\r\n\t\t\t}\r\n\t\t\tconst viewport: any = this.parent;\r\n\t\t\tconst scale = viewport.scaled || 1.0;\r\n\t\t\tthis.lineStyle(1, 0xffff66, 1.0);\r\n\t\t\tthis.beginFill(0x0000, 0.0);\r\n\t\t\tthis.drawRect(this.text.x, this.text.y, rect.width, rect.height);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * AABB Bounds\r\n\t */\r\n\tprotected _drawAABB() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst aabb = element.getAABB();\r\n\t\tthis.lineStyle(1, 0x00ff00, 1.0);\r\n\t\tthis.beginFill(0xffff00, 0.0);\r\n\t\tthis.drawRect(aabb.x, aabb.y, aabb.width, aabb.height);\r\n\t\tthis.endFill();\r\n\t\tthis.lineStyle(1, 0x000000, 1.0);\r\n\t\tthis.drawEllipse(\r\n\t\t\taabb.x + aabb.width / 2,\r\n\t\t\taabb.y + aabb.height / 2,\r\n\t\t\taabb.width / 2,\r\n\t\t\taabb.height / 2\r\n\t\t);\r\n\t\tthis.closePath();\r\n\t}\r\n\r\n\t/**\r\n\t * OBB Bounds\r\n\t */\r\n\tprotected _drawOBB() {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst obb = element.getOBB();\r\n\t\tconst points = obb.points;\r\n\t\tthis.lineStyle(2, 0xffff00, 1.0);\r\n\t\tthis.beginFill(0xffff00, 0.0);\r\n\t\tconst path: number[] = [];\r\n\t\tpoints.forEach((point: number[]) => {\r\n\t\t\tpath.push(point[0], point[1]);\r\n\t\t});\r\n\t\tthis.drawPolygon(path);\r\n\t\tthis.closePath();\r\n\r\n\t\tif (element.debug) {\r\n\t\t\tconst points4 = element.getHitArea(2);\r\n\t\t\tthis.lineStyle(1, 0x99cc33, 1.0);\r\n\t\t\tthis.beginFill(0x99cc33, 0.1);\r\n\t\t\tconst path4: number[] = [];\r\n\t\t\tpoints4.forEach((point: number[]) => {\r\n\t\t\t\tpath4.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.drawPolygon(path4);\r\n\t\t}\r\n\t\tlet gizmo = this._gizmos.get(\"editorGizmo\");\r\n\t\tif (gizmo) {\r\n\t\t\tconst unionPoints: number[][] = points.map((point: number[]) => {\r\n\t\t\t\treturn [point[0], point[1]];\r\n\t\t\t});\r\n\t\t\tgizmo.children.forEach((child: DisplayObject) => {\r\n\t\t\t\tconst localBounds = child.getLocalBounds();\r\n\t\t\t\tunionPoints.push([localBounds.x, localBounds.y]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x,\r\n\t\t\t\t\tlocalBounds.y + localBounds.height,\r\n\t\t\t\t]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x + localBounds.width,\r\n\t\t\t\t\tlocalBounds.y + localBounds.height,\r\n\t\t\t\t]);\r\n\t\t\t\tunionPoints.push([\r\n\t\t\t\t\tlocalBounds.x + localBounds.width,\r\n\t\t\t\t\tlocalBounds.y,\r\n\t\t\t\t]);\r\n\t\t\t});\r\n\t\t\tconst obb = new OBB(unionPoints);\r\n\t\t\tconst path: number[] = [];\r\n\t\t\tobb.points.forEach((point: number[]) => {\r\n\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.drawPolygon(path);\r\n\t\t} else {\r\n\t\t\tconst path: number[] = [];\r\n\t\t\tpoints.forEach((point: number[]) => {\r\n\t\t\t\tpath.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.drawPolygon(path);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * draw Body\r\n\t */\r\n\tprotected _drawBody(): void {\r\n\t\tconst element = this._element as Edge;\r\n\t\tif (!element) return;\r\n\t\tconst from = element.from,\r\n\t\t\tto = element.to;\r\n\t\tif (!from || !to) return;\r\n\r\n\t\tconst p0 = from.center,\r\n\t\t\tp1 = to.center;\r\n\r\n\t\tif (element.selected) {\r\n\t\t\tconst points4 = element.getHitArea(2);\r\n\t\t\tthis.lineStyle(1, 0x000000, 0.0);\r\n\t\t\tthis.beginFill(0x000000, 0.05);\r\n\t\t\tconst path4: number[] = [];\r\n\t\t\tpoints4.forEach((point: number[]) => {\r\n\t\t\t\tpath4.push(point[0], point[1]);\r\n\t\t\t});\r\n\t\t\tthis.drawPolygon(path4);\r\n\t\t\tthis.lineStyle(\r\n\t\t\t\telement.styles.selectStrokeWidth || 1,\r\n\t\t\t\telement.styles.selectStrokeColor || 0x000000,\r\n\t\t\t\telement.styles.selectStrokeAlpha || 1.0\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tthis.lineStyle(\r\n\t\t\t\telement.styles.strokeWidth || 1,\r\n\t\t\t\telement.styles.strokeColor || 0x000000,\r\n\t\t\t\telement.styles.strokeAlpha || 1.0\r\n\t\t\t);\r\n\t\t}\r\n\t\t// const lineDash = element.dash;\r\n\t\t// if (lineDash) {\r\n\t\t// \tconst dash = new DashLine(this, {\r\n\t\t// \t\tdash: lineDash,\r\n\t\t// \t\twidth: element.styles.strokeWidth || 1,\r\n\t\t// \t\tcolor: element.styles.strokeColor,\r\n\t\t// \t\talpha: element.styles.strokeAlpha,\r\n\t\t// \t\tuseTexture: false,\r\n\t\t// \t\tuseDots: true,\r\n\t\t// \t});\r\n\t\t// \tdash.moveTo(from[0], from[1]).lineTo(to[0], to[1]);\r\n\t\t// } else {\r\n\t\tthis.moveTo(p0[0], p0[1]);\r\n\t\tthis.lineTo(p1[0], p1[1]);\r\n\t\tthis.endFill();\r\n\t\t// }\r\n\r\n\t\tif (element.debug) {\r\n\t\t\tconst offset = -1 * element.styles.offsetDelta;\r\n\t\t\tconst alongPoints = element.getAlongPoints(offset);\r\n\t\t\tthis.lineStyle(1, 0xff0000, 1.0);\r\n\t\t\tthis.moveTo(alongPoints.p0[0], alongPoints.p0[1]);\r\n\t\t\tthis.lineTo(alongPoints.p1[0], alongPoints.p1[1]);\r\n\t\t\tthis.endFill();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _drawSelect(): void {\r\n\t\tconst element = this._element as Element;\r\n\t\tif (!element) return;\r\n\t\tconst points = element.points;\r\n\t\tif (!points || points.length === 0) return;\r\n\t}\r\n\r\n\tprotected _drawHover(): void {\r\n\t\tconst element = this._element as Edge;\r\n\t\tif (!element) return;\r\n\t\tconst from = element.from,\r\n\t\t\tto = element.to;\r\n\t\tif (!from || !to) return;\r\n\r\n\t\tconst p0 = from.center,\r\n\t\t\tp1 = to.center;\r\n\r\n\t\tif (element.hovered && !element.selected) {\r\n\t\t\tconst from = element.from,\r\n\t\t\t\tto = element.to;\r\n\t\t\tconst points4 = element.getHitArea(2);\r\n\t\t\tthis.lineStyle(1, 0x000000, 0.0);\r\n\t\t\tthis.beginFill(0x000000, 0.05);\r\n\t\t\tconst path4: number[] = [];\r\n\t\t\tpoints4.forEach((point: number[]) => {\r\n\t\t\t\tpath4.push(point[0], point[1]);\r\n\t\t\t});\r\n\r\n\t\t\tthis.drawPolygon(path4);\r\n\r\n\t\t\tthis.lineStyle(\r\n\t\t\t\telement.styles.hoverStrokeWidth || 1,\r\n\t\t\t\telement.styles.hoverStrokeColor || 0xff0000,\r\n\t\t\t\telement.styles.hoverStrokeAlpha || 1.0\r\n\t\t\t);\r\n\t\t\t/* if (lineDash) {\r\n\t\t\t\tconst dash = new DashLine(this, {\r\n\t\t\t\t\tdash: lineDash,\r\n\t\t\t\t\twidth: element.styles.strokeWidth || 1,\r\n\t\t\t\t\tcolor: element.styles.selectFillColor,\r\n\t\t\t\t\talpha: element.styles.strokeAlpha,\r\n\t\t\t\t\tuseTexture: false,\r\n\t\t\t\t\tuseDots: true,\r\n\t\t\t\t});\r\n\t\t\t\tdash.moveTo(from[0], from[1]).lineTo(to[0], to[1]);\r\n\t\t\t} else { */\r\n\t\t\tthis.moveTo(p0[0], p0[1]);\r\n\t\t\tthis.lineTo(p1[0], p1[1]);\r\n\t\t\tthis.endFill();\r\n\t\t\t// }\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * check all gizmos\r\n\t */\r\n\tprotected _checkGizmos(): void {\r\n\t\tconst element = this._element;\r\n\t\tif (!element) return;\r\n\t\tthis._checkLabelGizmo();\r\n\t\tthis._checkLabel2Gizmo();\r\n\t\tthis._checkEditorGizmo();\r\n\t}\r\n}\r\n","import { Matrix, Text, Rectangle, Texture, BaseTexture } from \"pixi.js\";\r\nimport { Element, FillType, Shape } from \"@blood4/modeling\";\r\nimport { UI } from \".\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\nimport { ShapeUI } from \"./ShapeUI\";\r\n\r\nexport class GroupUI extends ShapeUI {\r\n\tconstructor(element: Element, renderer: PixiRenderer<any>) {\r\n\t\tsuper(element, renderer);\r\n\t}\r\n}\r\n","import { EventEmitter } from \"eventemitter3\";\r\nimport { PixiRenderer } from \"..\";\r\n\r\nexport class BaseInteraction extends EventEmitter {\r\n\tprotected renderer: PixiRenderer<any>;\r\n\r\n\tconstructor(renderer: PixiRenderer<any>) {\r\n\t\tsuper();\r\n\t\tthis.renderer = renderer;\r\n\t}\r\n\r\n\t/**\r\n\t * mount\r\n\t * @returns\r\n\t */\r\n\tmount() { }\r\n\r\n\t/**\r\n\t * unmount\r\n\t * @returns\r\n\t */\r\n\tunmount() { }\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tupdate() { }\r\n\r\n\t/**\r\n\t * clear\r\n\t */\r\n\tclear() { }\r\n\r\n\t/**\r\n\t * change pointer cursor\r\n\t * @param cursor\r\n\t * @returns\r\n\t */\r\n\tchangeCursorMode(cursor = \"default\"): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tif (!renderer) return;\r\n\t\trenderer.renderer.plugins.interaction.cursorStyles.crosshair = cursor;\r\n\t\trenderer.renderer.plugins.interaction.cursorStyles.default = cursor;\r\n\t\trenderer.renderer.plugins.interaction.setCursorMode(cursor);\r\n\t}\r\n}\r\n","import { InteractionEvent, Point } from \"pixi.js\";\r\nimport { PixiRenderer } from \"..\";\r\nimport { LayerType, Element } from \"@blood4/modeling\";\r\nimport { Grid } from \"../components/grid\";\r\nimport { InteractionEvents, KeyboardEvents } from \"../events\";\r\nimport { BaseGizmo, EditorGizmo, LabelGizmo } from \"../gizmos\";\r\nimport { RotateSpot } from \"../gizmos/spots\";\r\nimport { LineUI, UI } from \"../ui\";\r\nimport { BaseInteraction } from \"./BaseInteraction\";\r\nexport class DefaultInteraction extends BaseInteraction {\r\n\t_zoomedEvent!: (evt: InteractionEvent) => void;\r\n\t_pannedEvent!: (evt: InteractionEvent) => void;\r\n\t_selectedEvent!: (evt: InteractionEvent) => void;\r\n\t_mousedownEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseupEvent!: (evt: InteractionEvent) => void;\r\n\t_mousemoveEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseoutEvent!: (evt: InteractionEvent) => void;\r\n\t_mouseoverEvent!: (evt: InteractionEvent) => void;\r\n\r\n\t_keydownEvent!: (evt: KeyboardEvent) => void;\r\n\t_keyupEvent!: (evt: KeyboardEvent) => void;\r\n\t_contextmenu!: (evt: any) => void;\r\n\r\n\t_onDocumentMouseDown!: (evt: MouseEvent) => void;\r\n\t_onDocumentMouseUp!: (evt: MouseEvent) => void;\r\n\r\n\t_hitTarget?: UI;\r\n\t_hoverTarget?: UI;\r\n\t_isDragging = false;\r\n\t_mousePoint?: Point = undefined;\r\n\r\n\t_ctrlDown: boolean = false;\r\n\t_shiftDown: boolean = false;\r\n\t_altDown: boolean = false;\r\n\t_doubleClickedTimeout: NodeJS.Timeout | null = null;\r\n\tprotected _oldOutTarget?: UI;\r\n\tprotected _oldMousePoint?: Point = undefined;\r\n\r\n\tconstructor(renderer: PixiRenderer<any>) {\r\n\t\tsuper(renderer);\r\n\t}\r\n\r\n\t/**\r\n\t * mount\r\n\t * @returns\r\n\t */\r\n\tmount() {\r\n\t\t// console.log('default interaction mount');\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\r\n\t\tif (!viewport) return;\r\n\t\tdocument.body.style.cursor = \"default\";\r\n\t\tviewport\r\n\t\t\t.drag({\r\n\t\t\t\twheel: false,\r\n\t\t\t\tmouseButtons: \"right\",\r\n\t\t\t\tpressDrag: true,\r\n\t\t\t\tdirection: \"all\", // 'x' | 'y' |'all' | null\r\n\t\t\t})\r\n\t\t\t.pinch()\r\n\t\t\t.wheel({\r\n\t\t\t\twheelZoom: true,\r\n\t\t\t});\r\n\t\tthis._zoomedEvent = this.handle_zoomed.bind(this);\r\n\t\tthis._pannedEvent = this.handle_panned.bind(this);\r\n\t\tthis._mousedownEvent = this.handle_mousedown.bind(this);\r\n\t\tthis._mouseupEvent = this.handle_mouseup.bind(this);\r\n\t\tthis._mousemoveEvent = this.handle_mousemove.bind(this);\r\n\t\tthis._mouseoutEvent = this.handle_mouseout.bind(this);\r\n\t\tthis._mouseoverEvent = this.handle_mouseover.bind(this);\r\n\t\tthis._keydownEvent = this.handle_keydown.bind(this);\r\n\t\tthis._keyupEvent = this.handle_keyup.bind(this);\r\n\t\tthis._contextmenu = this.handle_contextmenu.bind(this);\r\n\r\n\t\tviewport.on(\"zoomed\", this._zoomedEvent);\r\n\t\tviewport.on(\"moved\", this._pannedEvent);\r\n\t\tviewport.on(\"mousedown\", this._mousedownEvent);\r\n\t\tviewport.on(\"mouseup\", this._mouseupEvent);\r\n\t\tviewport.on(\"mousemove\", this._mousemoveEvent);\r\n\t\tviewport.on(\"mouseout\", this._mouseoutEvent);\r\n\t\tviewport.on(\"mouseover\", this._mouseoverEvent);\r\n\r\n\t\tdocument.addEventListener(\"keydown\", this._keydownEvent);\r\n\t\tdocument.addEventListener(\"keyup\", this._keyupEvent);\r\n\t\tdocument.addEventListener(\"contextmenu\", this._contextmenu);\r\n\r\n\t\t/* const sm = renderer.selectionModel;\r\n\t\tsm?.on(EventsSelection.Change, (evt: any) => {\r\n\t\t\tconst oldValue = evt.oldValue;\r\n\t\t\tif (oldValue) {\r\n\t\t\t\toldValue.forEach((data: Element) => {});\r\n\t\t\t}\r\n\t\t}); */\r\n\t}\r\n\r\n\t/**\r\n\t * unmount\r\n\t * @returns\r\n\t */\r\n\tunmount() {\r\n\t\t// console.log('default interaction unmount');\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tviewport\r\n\t\t\t.drag({\r\n\t\t\t\twheel: false,\r\n\t\t\t\tmouseButtons: \"right\",\r\n\t\t\t\tpressDrag: false,\r\n\t\t\t})\r\n\t\t\t.wheel({\r\n\t\t\t\twheelZoom: false,\r\n\t\t\t});\r\n\t\tviewport.off(\"zoomed\", this._zoomedEvent);\r\n\t\tviewport.off(\"moved\", this._pannedEvent);\r\n\t\tviewport.off(\"mousedown\", this._mousedownEvent);\r\n\t\tviewport.off(\"mouseup\", this._mouseupEvent);\r\n\t\tviewport.off(\"mousemove\", this._mousemoveEvent);\r\n\t\tviewport.off(\"mouseout\", this._mouseoutEvent);\r\n\r\n\t\tdocument.removeEventListener(\"keydown\", this._keydownEvent);\r\n\t\tdocument.removeEventListener(\"keyup\", this._keyupEvent);\r\n\t\tdocument.removeEventListener(\"contextmenu\", this._contextmenu);\r\n\r\n\t\tconst sm = renderer.selectionModel;\r\n\t\t// sm?.off(EventsSelection.Change);\r\n\t\tthis.off(InteractionEvents.Resizing, (evt: any) => { });\r\n\t}\r\n\r\n\t/**\r\n\t * update\r\n\t */\r\n\tupdate() {\r\n\t\t// console.log('default interaction update');\r\n\t}\r\n\r\n\t/**\r\n\t * clear\r\n\t */\r\n\tclear() {\r\n\t\t// console.log('default interaction clear');\r\n\t}\r\n\r\n\t/**\r\n\t * handle zoomed\r\n\t * @param e\r\n\t */\r\n\thandle_zoomed(evt: InteractionEvent) {\r\n\t\tif (this.renderer.grid && this.renderer.grid instanceof Grid) {\r\n\t\t\t// this.renderer.grid.refline = [];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * handle panned\r\n\t * @param e\r\n\t */\r\n\thandle_panned(evt: InteractionEvent) {\r\n\t\tif (this.renderer.grid && this.renderer.grid instanceof Grid) {\r\n\t\t\t// this.renderer.grid.refline = [];\r\n\t\t}\r\n\t}\r\n\tisDelDown(evt: KeyboardEvent) {\r\n\t\treturn evt.code === \"Delete\";\r\n\t}\r\n\r\n\tisCtrlDown(evt: KeyboardEvent) {\r\n\t\treturn evt.ctrlKey || evt.metaKey;\r\n\t}\r\n\r\n\tisShiftDown(evt: KeyboardEvent) {\r\n\t\treturn evt.shiftKey;\r\n\t}\r\n\r\n\tisAltDown(evt: KeyboardEvent) {\r\n\t\treturn evt.altKey;\r\n\t}\r\n\r\n\t/**\r\n\t * mouse down\r\n\t * @param e\r\n\t */\r\n\thandle_mousedown(evt: InteractionEvent): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tconst hitTarget = renderer.renderer.plugins.interaction.hitTest(\r\n\t\t\tevt.data.global\r\n\t\t);\r\n\t\tif (hitTarget instanceof UI) {\r\n\t\t\tthis._hitTarget = hitTarget;\r\n\t\t} else if (hitTarget instanceof BaseGizmo) {\r\n\t\t\tthis._hitTarget = hitTarget.parent as UI;\r\n\t\t} else if (hitTarget instanceof EditorGizmo) {\r\n\t\t\tthis._hitTarget = hitTarget.parent as UI;\r\n\t\t}\r\n\t\tconst element = hitTarget._element;\r\n\r\n\t\tif (this._hitTarget instanceof UI) {\r\n\t\t\tif (element && element.movable) {\r\n\t\t\t\tthis.__dragStart(evt);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst sm = renderer.selectionModel;\r\n\t\tif (sm) {\r\n\t\t\t// ctrl down append Or remove\r\n\t\t\tif (this._ctrlDown) {\r\n\t\t\t\tif (sm.contains(element)) {\r\n\t\t\t\t\tsm.removeSelection(element);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsm.appendSelection(element);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// normal\r\n\t\t\t\tif (!sm.contains(element)) {\r\n\t\t\t\t\t// if (element instanceof Element) {\r\n\t\t\t\t\t// \tconst selection = sm.getSelection();\r\n\t\t\t\t\t// \trenderer.changeLayer(selection, LayerType.DefaultZIndex);\r\n\t\t\t\t\t// \trenderer.changeLayer(element, LayerType.SelectZIndex);\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tsm.setSelection(element);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._doubleClickedTimeout) {\r\n\t\t\tclearTimeout(this._doubleClickedTimeout);\r\n\t\t\tthis._doubleClickedTimeout = null;\r\n\t\t\t// console.log('double click', element);\r\n\t\t\tthis.emit(InteractionEvents.DoubleClick, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\ttarget: element,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t// console.log('click', element);\r\n\t\t\tthis.emit(InteractionEvents.Click, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\ttarget: element,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * mouse up\r\n\t * @param e\r\n\t */\r\n\thandle_mouseup(evt: InteractionEvent): void {\r\n\t\tthis._doubleClickedTimeout = setTimeout(() => {\r\n\t\t\tthis._doubleClickedTimeout = null;\r\n\t\t}, 300);\r\n\t\tif (this._hitTarget) {\r\n\t\t\tthis._hitTarget.update();\r\n\t\t\tconst gizmos = this._hitTarget?._gizmos;\r\n\t\t\tgizmos &&\r\n\t\t\t\tgizmos.forEach((gizmo: BaseGizmo) => {\r\n\t\t\t\t\tgizmo.handle_mouseup(evt);\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\tconst renderer = this.renderer;\r\n\t\t\tconst sm = renderer.selectionModel;\r\n\t\t\tconst datas = sm?.getSelection();\r\n\t\t\tif (datas) {\r\n\t\t\t\tdatas.forEach((data: Element) => {\r\n\t\t\t\t\tconst ui = renderer.getUIById(data.id);\r\n\t\t\t\t\tif (ui) {\r\n\t\t\t\t\t\tui.update();\r\n\t\t\t\t\t\tconst gizmos = ui?._gizmos;\r\n\t\t\t\t\t\tgizmos &&\r\n\t\t\t\t\t\t\tgizmos.forEach((gizmo: BaseGizmo) => {\r\n\t\t\t\t\t\t\t\tgizmo.handle_mouseup(evt);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.__dragEnd(evt);\r\n\t}\r\n\r\n\t/**\r\n\t * mouse move\r\n\t * @param e\r\n\t */\r\n\thandle_mousemove(evt: InteractionEvent): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tthis.__dragMove(evt);\r\n\t\tconst hoverTarget = renderer.renderer.plugins.interaction.hitTest(\r\n\t\t\tevt.data.global\r\n\t\t);\r\n\t\tconst oldHover = this._hoverTarget;\r\n\r\n\t\tif (oldHover !== hoverTarget) {\r\n\t\t\tthis._hoverTarget = hoverTarget;\r\n\t\t\tconst newHover = hoverTarget;\r\n\t\t\tconst oldElement = oldHover && oldHover._element;\r\n\t\t\tconst newElement = newHover && newHover._element;\r\n\t\t\tif (oldElement) {\r\n\t\t\t\toldElement.hovered = false;\r\n\t\t\t\t// if (oldHover && oldHover instanceof UI) {\r\n\t\t\t\t// \toldHover.filterOff();\r\n\t\t\t\t// }\r\n\t\t\t\t// renderer.changeLayer(newElement, LayerType.DefaultZIndex);\r\n\t\t\t}\r\n\t\t\tif (newElement) {\r\n\t\t\t\tnewElement.hovered = true;\r\n\t\t\t\t// if (oldHover && oldHover instanceof UI) {\r\n\t\t\t\t// \toldHover.filterOn();\r\n\t\t\t\t// }\r\n\t\t\t\t// renderer.changeLayer(newElement, LayerType.SelectZIndex);\r\n\t\t\t}\r\n\t\t\tthis.emit(InteractionEvents.Hover, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\toldValue: oldElement,\r\n\t\t\t\tnewValue: newElement,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseout(evt: InteractionEvent): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (this._hitTarget) {\r\n\t\t\tconst gizmos = this._hitTarget?._gizmos;\r\n\t\t\tgizmos &&\r\n\t\t\t\tgizmos.forEach((gizmo: BaseGizmo) => {\r\n\t\t\t\t\tgizmo.handle_mouseout(evt);\r\n\t\t\t\t});\r\n\t\t\tthis._oldOutTarget = this._hitTarget;\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tthis._oldMousePoint = new Point(position.x, position.y);\r\n\t\t\tthis._onDocumentMouseUp = this.handle_documentMouseUp.bind(this);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._onDocumentMouseUp);\r\n\t\t}\r\n\t\tthis.__dragEnd(evt);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseover(evt: InteractionEvent): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (this._oldOutTarget && this._oldMousePoint) {\r\n\t\t\tconst mousePoint = this._oldMousePoint;\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tthis._hitTarget = this._oldOutTarget;\r\n\t\t\tthis._hitTarget._element.translation(\r\n\t\t\t\tposition.x - mousePoint.x,\r\n\t\t\t\tposition.y - mousePoint.y\r\n\t\t\t);\r\n\t\t\tthis.__dragStart(evt);\r\n\t\t\tthis._oldOutTarget = undefined;\r\n\t\t\tdocument.removeEventListener(\"mouseup\", this._onDocumentMouseUp);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * drag start\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragStart(evt: InteractionEvent) {\r\n\t\tconst hitTarget: any = this._hitTarget;\r\n\t\tif (this._isDragging) return;\r\n\t\tif (hitTarget instanceof UI) {\r\n\t\t\tconst position = evt.data.getLocalPosition(hitTarget.parent);\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\t\t// this._isDragging = true;\r\n\t\t\t// this.emit(InteractionEvents.DragStart, {\r\n\t\t\t// \tsource: this,\r\n\t\t\t// \ttarget: hitTarget._element\r\n\t\t\t// });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * drag Move\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragMove(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tif (!hitTarget || !hitTarget.parent) return;\r\n\t\tconst position = evt.data.getLocalPosition(hitTarget.parent);\r\n\t\tif (!this._isDragging && this._mousePoint) {\r\n\t\t\tif (\r\n\t\t\t\tMath.abs(position.x - this._mousePoint.x) >= 0.1 ||\r\n\t\t\t\tMath.abs(position.y - this._mousePoint.y) >= 0.1\r\n\t\t\t) {\r\n\t\t\t\tthis._isDragging = true;\r\n\t\t\t\tthis.emit(InteractionEvents.DragStart, {\r\n\t\t\t\t\tsource: this,\r\n\t\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\t});\r\n\t\t\t\t// console.log('__DragStart');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!this._isDragging) return;\r\n\r\n\t\tif (hitTarget instanceof UI && this._mousePoint) {\r\n\t\t\t// console.log('__dragMove');\r\n\t\t\tthis.renderer.moveSelectedElements(\r\n\t\t\t\tposition.x - this._mousePoint.x,\r\n\t\t\t\tposition.y - this._mousePoint.y\r\n\t\t\t);\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\t\tevt.stopPropagation();\r\n\t\t\tthis.emit(InteractionEvents.Dragging, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t});\r\n\t\t\tif (!hitTarget._element.dragging) {\r\n\t\t\t\thitTarget._element.dragging = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * drag End\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragEnd(evt?: InteractionEvent) {\r\n\t\tif (this._isDragging) {\r\n\t\t\tthis._isDragging = false;\r\n\t\t\tevt && evt.stopPropagation();\r\n\t\t\t// console.log('__dragEnd', this._isDragging);\r\n\t\t\tconst hitTarget = this._hitTarget;\r\n\t\t\tif (hitTarget && hitTarget._element) {\r\n\t\t\t\thitTarget._element.dragging = false;\r\n\t\t\t\tthis.emit(InteractionEvents.DragEnd, {\r\n\t\t\t\t\tsource: this,\r\n\t\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._hitTarget = undefined;\r\n\t\tthis._mousePoint = undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * key down event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keydown(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\t// control key\r\n\t\tconst oldCtrlDown = this._ctrlDown;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t\tconst newCtrlDown = this._ctrlDown;\r\n\t\tif (oldCtrlDown !== newCtrlDown) {\r\n\t\t\t// document.body.style.cursor = \"url('renderer/icons/ic_align.png') 18 18, auto\";\r\n\t\t\tthis.emit(KeyboardEvents.CtrlKeyDown, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldCtrlDown,\r\n\t\t\t\tnewCtrlDown,\r\n\t\t\t});\r\n\t\t\tconst element = this._hoverTarget?._element;\r\n\t\t\tif (element) {\r\n\t\t\t\telement.hovered = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// control key\r\n\t\tconst oldShiftDown = this._shiftDown;\r\n\t\tthis._shiftDown = this.isShiftDown(evt);\r\n\t\tconst newShiftDown = this._shiftDown;\r\n\t\tif (oldShiftDown !== newShiftDown) {\r\n\t\t\tthis.emit(KeyboardEvents.ShiftKey, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldShiftDown,\r\n\t\t\t\tnewShiftDown,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// control key\r\n\t\tconst oldAltDown = this._altDown;\r\n\t\tthis._altDown = this.isAltDown(evt);\r\n\t\tconst newAltDown = this._altDown;\r\n\t\tif (oldAltDown !== newAltDown) {\r\n\t\t\tthis.emit(KeyboardEvents.AltKey, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldAltDown,\r\n\t\t\t\tnewAltDown,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.emit(KeyboardEvents.KeyDown, {\r\n\t\t\tsource: this,\r\n\t\t\tevent: evt,\r\n\t\t});\r\n\t\tthis.__dragEnd();\r\n\t}\r\n\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keyup(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\tconst oldCtrlDown = this._ctrlDown;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t\tconst newCtrlDown = this._ctrlDown;\r\n\t\tif (oldCtrlDown !== newCtrlDown) {\r\n\t\t\tdocument.body.style.cursor = \"default\";\r\n\t\t\tconst element = this._hoverTarget?._element;\r\n\t\t\tif (element) {\r\n\t\t\t\telement.hovered = true;\r\n\t\t\t}\r\n\t\t\tthis.emit(KeyboardEvents.CtrlKeyUp, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldCtrlDown,\r\n\t\t\t\tnewCtrlDown,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// control key\r\n\t\tconst oldShiftDown = this._shiftDown;\r\n\t\tthis._shiftDown = this.isShiftDown(evt);\r\n\t\tconst newShiftDown = this._shiftDown;\r\n\t\tif (oldShiftDown !== newShiftDown) {\r\n\t\t\tthis.emit(KeyboardEvents.ShiftKey, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldShiftDown,\r\n\t\t\t\tnewShiftDown,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// control key\r\n\t\tconst oldAltDown = this._altDown;\r\n\t\tthis._altDown = this.isAltDown(evt);\r\n\t\tconst newAltDown = this._altDown;\r\n\t\tif (oldAltDown !== newAltDown) {\r\n\t\t\tthis.emit(KeyboardEvents.AltKey, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\tkey,\r\n\t\t\t\toldAltDown,\r\n\t\t\t\tnewAltDown,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.emit(KeyboardEvents.KeyUp, {\r\n\t\t\tsource: this,\r\n\t\t\tevent: evt,\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_contextmenu(e: any): void {\r\n\t\te.preventDefault();\r\n\t\tthis.__dragEnd(e);\r\n\t}\r\n\r\n\t_cancel() { }\r\n\r\n\thandle_documentMouseDown(e: MouseEvent) {\r\n\t\tif (this._oldOutTarget) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis._oldOutTarget = undefined;\r\n\t\t}\r\n\t\tdocument.removeEventListener(\"mousedown\", this._onDocumentMouseDown);\r\n\t}\r\n\r\n\thandle_documentMouseUp(e: MouseEvent) {\r\n\t\tif (this._isDragging) {\r\n\t\t\tthis._isDragging = false;\r\n\t\t\tconst hitTarget = this._hitTarget;\r\n\t\t\tif (hitTarget && hitTarget._element) {\r\n\t\t\t\thitTarget._element.dragging = false;\r\n\t\t\t\tthis.emit(InteractionEvents.DragEnd, {\r\n\t\t\t\t\tsource: this,\r\n\t\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._oldOutTarget = undefined;\r\n\t\tthis._oldMousePoint = undefined;\r\n\t\tdocument.removeEventListener(\"mouseup\", this._onDocumentMouseUp);\r\n\t}\r\n}\r\n","import { InteractionEvent, Point } from \"pixi.js\";\r\nimport { InteractionEvents, PixiRenderer } from \"..\";\r\nimport { Element } from \"@blood4/modeling\";\r\nimport { Grid } from \"../components\";\r\nimport { UI } from \"../ui\";\r\nimport { DefaultInteraction } from \"./DefaultInteraction\";\r\n\r\nexport class EditInteraction extends DefaultInteraction {\r\n\tconstructor(renderer: PixiRenderer<any>) {\r\n\t\tsuper(renderer);\r\n\t}\r\n\r\n\t/**\r\n\t * handle zoomed\r\n\t * @param e\r\n\t */\r\n\thandle_zoomed(evt: InteractionEvent) {\r\n\t\t// if (this.renderer.grid && this.renderer.grid instanceof Grid) {\r\n\t\t// \tthis.renderer.refline.clear();\r\n\t\t// }\r\n\t}\r\n\r\n\t/**\r\n\t * handle panned\r\n\t * @param e\r\n\t */\r\n\thandle_panned(evt: InteractionEvent) {\r\n\t\tif (this.renderer.grid && this.renderer.grid instanceof Grid) {\r\n\t\t\tthis.renderer.refline.clear();\r\n\t\t}\r\n\t}\r\n\r\n\thandle_mousedown(evt: InteractionEvent): void {\r\n\t\tsuper.handle_mousedown(evt);\r\n\t\tconst element = this._hitTarget?._element;\r\n\t\tif (!element) return;\r\n\r\n\t\tconst model = this.renderer.model;\r\n\t\tconst datas = model.getDatas();\r\n\t\telement.gatherRects(datas);\r\n\t\tconst refLine = element.refLine;\r\n\t\telement.updater = refLine.adsorbCreator({\r\n\t\t\tpageX: evt.data.global.x,\r\n\t\t\tpageY: evt.data.global.y,\r\n\t\t\tdistance: 24,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * drag Move\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragMove(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tif (!hitTarget || !hitTarget.parent) return;\r\n\t\tconst position = evt.data.getLocalPosition(hitTarget.parent);\r\n\t\tif (!this._isDragging && this._mousePoint) {\r\n\t\t\tif (\r\n\t\t\t\tMath.abs(position.x - this._mousePoint.x) >= 0.1 ||\r\n\t\t\t\tMath.abs(position.y - this._mousePoint.y) >= 0.1\r\n\t\t\t) {\r\n\t\t\t\tthis._isDragging = true;\r\n\t\t\t\tthis.emit(InteractionEvents.DragStart, {\r\n\t\t\t\t\tsource: this,\r\n\t\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\t});\r\n\t\t\t\t// console.log('__DragStart');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!this._isDragging) return;\r\n\r\n\t\tif (hitTarget instanceof UI && this._mousePoint) {\r\n\t\t\t// console.log('__dragMove');\r\n\t\t\t// this.renderer.moveSelectedElements(position.x - this._mousePoint.x, position.y - this._mousePoint.y);\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\t\tevt.stopPropagation();\r\n\t\t\tthis.emit(InteractionEvents.Dragging, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t});\r\n\t\t\tif (!hitTarget._element.dragging) {\r\n\t\t\t\thitTarget._element.dragging = true;\r\n\t\t\t}\r\n\t\t\tconst element = this._hitTarget?._element;\r\n\t\t\tif (!element) return;\r\n\r\n\t\t\tconst refLine = element.refLine;\r\n\t\t\tconst updater = element.updater;\r\n\t\t\tif (this.renderer.refline) {\r\n\t\t\t\tthis.renderer.refline.datas = refLine.getAllRefLines() as any;\r\n\t\t\t}\r\n\t\t\tconst scale = this.renderer?.getScaled() || 1;\r\n\t\t\tconst { delta } = updater({\r\n\t\t\t\tpageX: evt.data.global.x,\r\n\t\t\t\tpageY: evt.data.global.y,\r\n\t\t\t\tdistance: 24,\r\n\t\t\t});\r\n\t\t\tthis.renderer.moveSelectedElements(\r\n\t\t\t\tdelta.left / scale,\r\n\t\t\t\tdelta.top / scale\r\n\t\t\t);\r\n\t\t\tevt.stopPropagation();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * drag End\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragEnd(evt: InteractionEvent) {\r\n\t\tif (this._isDragging) {\r\n\t\t\tthis._isDragging = false;\r\n\t\t\tevt.stopPropagation();\r\n\t\t\t// console.log('__dragEnd', this._isDragging);\r\n\t\t\tconst hitTarget = this._hitTarget;\r\n\t\t\tif (hitTarget && hitTarget._element) {\r\n\t\t\t\thitTarget._element.dragging = false;\r\n\t\t\t\tthis.emit(InteractionEvents.DragEnd, {\r\n\t\t\t\t\tsource: this,\r\n\t\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t\t});\r\n\t\t\t\tconst element = hitTarget._element;\r\n\t\t\t\tconst updater = element.updater;\r\n\t\t\t\tconst { delta } = updater({\r\n\t\t\t\t\tpageX: evt.data.global.x,\r\n\t\t\t\t\tpageY: evt.data.global.y,\r\n\t\t\t\t});\r\n\t\t\t\telement.x += delta.left;\r\n\t\t\t\telement.y += delta.top;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._mousePoint = undefined;\r\n\t}\r\n}\r\n","import { InteractionEvent, Point } from \"pixi.js\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\nimport { UI } from \"../ui\";\r\nimport { DefaultInteraction } from \"./DefaultInteraction\";\r\nimport { Element, LayerType } from \"@blood4/modeling\";\r\nimport { InteractionEvents } from \"../events\";\r\n\r\nexport class CreateInteraction extends DefaultInteraction {\r\n\tpublic element?: Element;\r\n\tprotected _onMouseDown?: (point?: Point, scope?: CreateInteraction) => any;\r\n\tprotected _onMouseMove?: (point?: Point, scope?: CreateInteraction) => any;\r\n\tprotected _onMouseUp?: (point?: Point, scope?: CreateInteraction) => any;\r\n\tprotected _onFinish?: (scope?: CreateInteraction, evt?: MouseEvent) => any;\r\n\r\n\tconstructor(\r\n\t\trenderer: PixiRenderer<any>,\r\n\t\tonMouseDown?: (point?: Point, scope?: CreateInteraction) => any,\r\n\t\tonMouseMove?: (point?: Point, scope?: CreateInteraction) => any,\r\n\t\tonMouseUp?: (point?: Point, scope?: CreateInteraction) => any,\r\n\t\tonFinish?: (scope?: CreateInteraction) => any\r\n\t) {\r\n\t\tsuper(renderer);\r\n\t\tthis._onMouseDown = onMouseDown?.bind(this);\r\n\t\tthis._onMouseMove = onMouseMove?.bind(this);\r\n\t\tthis._onMouseUp = onMouseUp?.bind(this);\r\n\t\tthis._onFinish = onFinish?.bind(this);\r\n\t}\r\n\r\n\t/**\r\n\t * mount\r\n\t * @returns\r\n\t */\r\n\tmount() {\r\n\t\t// console.log('create interaction mount');\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tviewport\r\n\t\t\t.drag({\r\n\t\t\t\twheel: false,\r\n\t\t\t\tmouseButtons: \"right\",\r\n\t\t\t\tpressDrag: true,\r\n\t\t\t\tdirection: \"all\", // 'x' | 'y' |'all' | null\r\n\t\t\t})\r\n\t\t\t.pinch()\r\n\t\t\t.wheel({\r\n\t\t\t\twheelZoom: true,\r\n\t\t\t});\r\n\t\tthis._zoomedEvent = this.handle_zoomed.bind(this);\r\n\t\tthis._pannedEvent = this.handle_panned.bind(this);\r\n\t\tthis._mousedownEvent = this.handle_mousedown.bind(this);\r\n\t\tthis._mouseupEvent = this.handle_mouseup.bind(this);\r\n\t\tthis._mousemoveEvent = this.handle_mousemove.bind(this);\r\n\t\tthis._mouseoutEvent = this.handle_mouseout.bind(this);\r\n\t\tthis._mouseoverEvent = this.handle_mouseover.bind(this);\r\n\t\tthis._keydownEvent = this.handle_keydown.bind(this);\r\n\t\tthis._keyupEvent = this.handle_keyup.bind(this);\r\n\t\tthis._contextmenu = this.handle_contextmenu.bind(this);\r\n\r\n\t\tviewport.on(\"zoomed\", this._zoomedEvent);\r\n\t\tviewport.on(\"moved\", this._pannedEvent);\r\n\t\tviewport.on(\"mousedown\", this._mousedownEvent);\r\n\t\tviewport.on(\"mouseup\", this._mouseupEvent);\r\n\t\tviewport.on(\"mousemove\", this._mousemoveEvent);\r\n\t\tviewport.on(\"mouseout\", this._mouseoutEvent);\r\n\t\tviewport.on(\"mouseover\", this._mouseoverEvent);\r\n\r\n\t\tdocument.addEventListener(\"keydown\", this._keydownEvent);\r\n\t\tdocument.addEventListener(\"keyup\", this._keyupEvent);\r\n\t\tdocument.addEventListener(\"contextmenu\", this._contextmenu);\r\n\t}\r\n\r\n\t/**\r\n\t * unmount\r\n\t * @returns\r\n\t */\r\n\tunmount() {\r\n\t\t// console.log('create interaction unmount');\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tviewport\r\n\t\t\t.drag({\r\n\t\t\t\twheel: false,\r\n\t\t\t\tmouseButtons: \"right\",\r\n\t\t\t\tpressDrag: false,\r\n\t\t\t})\r\n\t\t\t.wheel({\r\n\t\t\t\twheelZoom: false,\r\n\t\t\t});\r\n\t\t(viewport as any).off(\"zoomed\", this._zoomedEvent);\r\n\t\t(viewport as any).off(\"moved\", this._pannedEvent);\r\n\t\t(viewport as any).off(\"mousedown\", this._mousedownEvent);\r\n\t\t(viewport as any).off(\"mouseup\", this._mouseupEvent);\r\n\t\t(viewport as any).off(\"mousemove\", this._mousemoveEvent);\r\n\t\t(viewport as any).off(\"mouseout\", this._mouseoutEvent);\r\n\t\tdocument.removeEventListener(\"keydown\", this._keydownEvent);\r\n\t\tdocument.removeEventListener(\"keyup\", this._keyupEvent);\r\n\t\tdocument.removeEventListener(\"contextmenu\", this._contextmenu);\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * clear\r\n\t */\r\n\tclear() {\r\n\t\t// console.log('create interaction clear');\r\n\t\tsuper.clear();\r\n\t\tthis._hitTarget = undefined;\r\n\t\tthis.element = undefined;\r\n\t\tthis._onMouseDown = undefined;\r\n\t\tthis._onMouseMove = undefined;\r\n\t\tthis._onMouseUp = undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * handle zoomed\r\n\t * @param e\r\n\t */\r\n\thandle_zoomed(evt: InteractionEvent) { }\r\n\r\n\t/**\r\n\t * handle panned\r\n\t * @param e\r\n\t */\r\n\thandle_panned(evt: InteractionEvent) { }\r\n\r\n\tisCtrlDown(evt: KeyboardEvent) {\r\n\t\treturn evt.ctrlKey || evt.metaKey;\r\n\t}\r\n\r\n\t/**\r\n\t * mouse down\r\n\t * @param e\r\n\t */\r\n\thandle_mousedown(evt: InteractionEvent): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tconst model = renderer.model;\r\n\t\tif (!viewport || !viewport || !model) return;\r\n\t\tconst point: Point = evt && evt.data.getLocalPosition(viewport);\r\n\t\tif (this._onMouseDown) {\r\n\t\t\tconst element = this._onMouseDown(point, this);\r\n\t\t\tif (element) {\r\n\t\t\t\tif (element.id === this.element?.id) {\r\n\t\t\t\t\tthis._onMouseMove && this._onMouseMove(point, this);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.element = element;\r\n\t\t\t\t\tmodel.add(element);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * mouse up\r\n\t * @param e\r\n\t */\r\n\thandle_mouseup(evt: InteractionEvent): void {\r\n\t\tthis._doubleClickedTimeout = setTimeout(() => {\r\n\t\t\tthis._doubleClickedTimeout = null;\r\n\t\t}, 300);\r\n\t\tthis.__dragEnd(evt);\r\n\t\tif (this._onMouseUp) {\r\n\t\t\tconst renderer = this.renderer;\r\n\t\t\tconst viewport = renderer.viewport;\r\n\t\t\tif (!viewport) return;\r\n\t\t\tconst point: Point = evt && evt.data.getLocalPosition(viewport);\r\n\t\t\tif (this.element) {\r\n\t\t\t\tthis.element.isEditing = false;\r\n\t\t\t\tconst element = this.element;\r\n\t\t\t\tconst sm = renderer.selectionModel;\r\n\t\t\t\tif (sm) {\r\n\t\t\t\t\t// ctrl down append Or remove\r\n\t\t\t\t\tif (this._ctrlDown) {\r\n\t\t\t\t\t\tif (sm.contains(element)) {\r\n\t\t\t\t\t\t\tsm.removeSelection(element);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsm.appendSelection(element);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// normal\r\n\t\t\t\t\t\tif (!sm.contains(element)) {\r\n\t\t\t\t\t\t\tconst selection = sm.getSelection();\r\n\t\t\t\t\t\t\trenderer.changeLayer(\r\n\t\t\t\t\t\t\t\tselection,\r\n\t\t\t\t\t\t\t\tLayerType.DefaultZIndex\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tsm.setSelection(element);\r\n\t\t\t\t\t\t\trenderer.changeLayer(\r\n\t\t\t\t\t\t\t\telement,\r\n\t\t\t\t\t\t\t\tLayerType.SelectZIndex\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._onMouseUp(point, this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * mouse move\r\n\t * @param e\r\n\t */\r\n\thandle_mousemove(evt: InteractionEvent): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (this._hitTarget && this._hitTarget instanceof UI) {\r\n\t\t\tconst element = this._hitTarget._element as Element;\r\n\t\t\tif (element) {\r\n\t\t\t\tconst center = element.center;\r\n\t\t\t\tconst dx = evt.data.global.x - center[0],\r\n\t\t\t\t\tdy = evt.data.global.y - center[1];\r\n\t\t\t\telement.translation(dx, dy);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.element && this._onMouseMove) {\r\n\t\t\tconst point: Point = evt && evt.data.getLocalPosition(viewport);\r\n\t\t\tthis._onMouseMove(point, this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseout(evt: InteractionEvent): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tthis.__dragEnd(evt);\r\n\t\tthis._oldOutTarget = this._hitTarget;\r\n\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\tthis._oldMousePoint = new Point(position.x, position.y);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseover(evt: InteractionEvent): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (this._oldOutTarget && this._oldMousePoint) {\r\n\t\t\tconst mousePoint = this._oldMousePoint;\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tthis._hitTarget = this._oldOutTarget;\r\n\t\t\tthis._hitTarget._element.translation(\r\n\t\t\t\tposition.x - mousePoint.x,\r\n\t\t\t\tposition.y - mousePoint.y\r\n\t\t\t);\r\n\t\t\tthis.__dragStart(evt);\r\n\t\t\tthis._oldOutTarget = undefined;\r\n\t\t\tdocument.removeEventListener(\"mouseup\", this._onDocumentMouseUp);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * drag start\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragStart(evt: InteractionEvent) {\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tif (this._isDragging) return;\r\n\t\tif (hitTarget instanceof UI) {\r\n\t\t\tconst position = evt.data.getLocalPosition(hitTarget.parent);\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\t\tthis._isDragging = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * drag Move\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragMove(evt: InteractionEvent) {\r\n\t\tif (!this._isDragging) return;\r\n\t\tconst hitTarget = this._hitTarget;\r\n\t\tif (hitTarget instanceof UI && this._mousePoint) {\r\n\t\t\tconst position = evt.data.getLocalPosition(hitTarget.parent);\r\n\t\t\tthis.renderer.moveUI(\r\n\t\t\t\thitTarget,\r\n\t\t\t\tposition.x - this._mousePoint.x,\r\n\t\t\t\tposition.y - this._mousePoint.y\r\n\t\t\t);\r\n\t\t\tthis._mousePoint = new Point(position.x, position.y);\r\n\t\t\tevt.stopPropagation();\r\n\t\t\tthis.emit(InteractionEvents.Dragging, {\r\n\t\t\t\tsource: this,\r\n\t\t\t\ttarget: hitTarget._element,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * drag End\r\n\t * @param evt\r\n\t */\r\n\tprotected __dragEnd(evt?: InteractionEvent) {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (this._isDragging) {\r\n\t\t\tthis._isDragging = false;\r\n\t\t\tevt && evt.stopPropagation();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * key down event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keydown(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t\tthis.__dragEnd();\r\n\t\tthis._onFinish && this._onFinish(this);\r\n\t}\r\n\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keyup(evt: KeyboardEvent): void {\r\n\t\tconst key = evt.code;\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t\tif (evt.code === \"Escape\") {\r\n\t\t\tconst renderer = this.renderer;\r\n\t\t\tconst viewport = renderer.viewport;\r\n\t\t\tif (!viewport) return;\r\n\t\t\tif (this._isDragging) {\r\n\t\t\t\tthis._isDragging = false;\r\n\t\t\t}\r\n\t\t\tthis._onFinish && this._onFinish(this);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_contextmenu(e: any): void {\r\n\t\te.preventDefault();\r\n\t\tthis.__dragEnd(e);\r\n\t\tthis._onFinish && this._onFinish(this);\r\n\t}\r\n\r\n\t/**\r\n\t * set onMouseDown function\r\n\t */\r\n\tpublic set onMouseDown(\r\n\t\tcb: (point?: Point, scope?: CreateInteraction) => any\r\n\t) {\r\n\t\tthis._onMouseDown = cb.bind(this);\r\n\t}\r\n\r\n\t/**\r\n\t * set onMouseMove function\r\n\t */\r\n\tpublic set onMouseMove(\r\n\t\tcb: (point?: Point, scope?: CreateInteraction) => any\r\n\t) {\r\n\t\tthis._onMouseMove = cb.bind(this);\r\n\t}\r\n\r\n\t/**\r\n\t * set onMouseUp function\r\n\t */\r\n\tpublic set onMouseUp(\r\n\t\tcb: (point?: Point, scope?: CreateInteraction) => any\r\n\t) {\r\n\t\tthis._onMouseUp = cb.bind(this);\r\n\t}\r\n\r\n\t/**\r\n\t * set onFinish function\r\n\t */\r\n\tpublic set onFinish(cb: (scope?: CreateInteraction) => any) {\r\n\t\tthis._onFinish = cb.bind(this);\r\n\t}\r\n}\r\n","import { InteractionEvent, Point } from \"pixi.js\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\nimport { CreateInteraction } from \"./CreateInteraction\";\r\n\r\nexport class AutoCreateInteraction extends CreateInteraction {\r\n\tconstructor(\r\n\t\trenderer: PixiRenderer<any>,\r\n\t\tonMouseDown?: (point?: Point, scope?: CreateInteraction) => any,\r\n\t\tonMouseMove?: (point?: Point, scope?: CreateInteraction) => any,\r\n\t\tonMouseUp?: (point?: Point, scope?: CreateInteraction) => any,\r\n\t\tonFinish?: (scope?: CreateInteraction) => any\r\n\t) {\r\n\t\tsuper(renderer, onMouseDown, onMouseMove, onMouseUp, onFinish);\r\n\t}\r\n\r\n\t/**\r\n\t * mouse down\r\n\t * @param e\r\n\t */\r\n\thandle_mousedown(evt: InteractionEvent): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t}\r\n\r\n\t/**\r\n\t * mouse move\r\n\t * @param e\r\n\t */\r\n\thandle_mousemove(evt: InteractionEvent): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tconst model = renderer.model;\r\n\t\tif (!viewport || !model || !renderer) return;\r\n\t\tconst point: Point = evt && evt.data.getLocalPosition(viewport);\r\n\t\tif (this._onMouseMove && !this.element) {\r\n\t\t\tthis.element = this._onMouseMove(point, this);\r\n\t\t\tif (this.element) {\r\n\t\t\t\tmodel.add(this.element);\r\n\t\t\t\tthis.element.isEditing = true;\r\n\t\t\t\tthis._hitTarget = renderer.uis.get(this.element.id);\r\n\t\t\t\tthis.__dragStart(evt);\r\n\t\t\t\tthis._onDocumentMouseDown =\r\n\t\t\t\t\tthis.handle_documentMouseDown.bind(this);\r\n\t\t\t\tdocument.addEventListener(\r\n\t\t\t\t\t\"mousedown\",\r\n\t\t\t\t\tthis._onDocumentMouseDown\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.__dragMove(evt);\r\n\t\t}\r\n\t\tevt.stopPropagation();\r\n\t}\r\n\r\n\t/**\r\n\t * key up event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keyup(evt: KeyboardEvent): void {\r\n\t\tsuper.handle_keyup(evt);\r\n\t\tif (evt.code === \"Escape\") {\r\n\t\t\tdocument.removeEventListener(\r\n\t\t\t\t\"mousedown\",\r\n\t\t\t\tthis._onDocumentMouseDown\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\thandle_documentMouseDown(e: MouseEvent) {\r\n\t\tif (this._oldOutTarget) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis._onFinish && this._onFinish(this, e);\r\n\t\t\tthis._oldOutTarget = undefined;\r\n\t\t}\r\n\t\tdocument.removeEventListener(\"mousedown\", this._onDocumentMouseDown);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param evt\r\n\t */\r\n\thandle_mouseover(evt: InteractionEvent): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst viewport = renderer.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (this._oldOutTarget && this._oldMousePoint) {\r\n\t\t\tconst mousePoint = this._oldMousePoint;\r\n\t\t\tconst position = evt.data.getLocalPosition(viewport);\r\n\t\t\tthis._hitTarget = this._oldOutTarget;\r\n\t\t\tthis.element = this._hitTarget._element;\r\n\t\t\tthis.element.translation(\r\n\t\t\t\tposition.x - mousePoint.x,\r\n\t\t\t\tposition.y - mousePoint.y\r\n\t\t\t);\r\n\t\t\tthis.__dragStart(evt);\r\n\t\t\tthis._oldOutTarget = undefined;\r\n\t\t}\r\n\t}\r\n}\r\n","import { Point } from \"pixi.js\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\nimport { CreateInteraction } from \"./CreateInteraction\";\r\n\r\nexport class CreateLineInteraction extends CreateInteraction {\r\n\tconstructor(\r\n\t\trenderer: PixiRenderer<any>,\r\n\t\tonMouseDown?: (point?: Point, scope?: CreateInteraction) => any,\r\n\t\tonMouseMove?: (point?: Point, scope?: CreateInteraction) => any,\r\n\t\tonMouseUp?: (point?: Point, scope?: CreateInteraction) => any,\r\n\t\tonFinish?: (scope?: CreateInteraction) => any\r\n\t) {\r\n\t\tsuper(renderer, onMouseDown, onMouseMove, onMouseUp, onFinish);\r\n\t}\r\n\r\n\t/**\r\n\t * key down event\r\n\t * @param scope\r\n\t * @param evt\r\n\t */\r\n\tprotected handle_keydown(evt: KeyboardEvent): void {\r\n\t\tthis._ctrlDown = this.isCtrlDown(evt);\r\n\t}\r\n}\r\n","import { isEqual } from \"@antv/util\";\r\nimport { EventEmitter } from \"eventemitter3\";\r\nimport { BaseInteraction } from \"./BaseInteraction\";\r\nimport { DefaultInteraction } from \"./DefaultInteraction\";\r\nimport { EditInteraction } from \"./EditInteraction\";\r\nimport { PixiRenderer } from \"../PixiRenderer\";\r\nimport { Point } from \"pixi.js\";\r\nimport { CreateInteraction } from \"./CreateInteraction\";\r\nimport { AutoCreateInteraction } from \"./AutoCreateinteraction\";\r\nimport { CreateLineInteraction } from \"./CreateLineInteraction\";\r\n\r\n/**\r\n * 2D Viewer Interaction Manager\r\n */\r\nexport class InteractionManager extends EventEmitter {\r\n\tprivate _renderer: PixiRenderer<any>;\r\n\tprivate _current?: BaseInteraction | BaseInteraction[];\r\n\tprivate _interactionMap: Map<string, BaseInteraction> = new Map();\r\n\r\n\tconstructor(renderer: PixiRenderer<any>) {\r\n\t\tsuper();\r\n\t\tthis._renderer = renderer;\r\n\t\tconst interaction = new DefaultInteraction(renderer);\r\n\t\tthis.execute(interaction);\r\n\t\tthis._interactionMap.set(\"default\", interaction);\r\n\t\tthis._current = interaction;\r\n\t\tconst editInteraction = new EditInteraction(renderer);\r\n\t\tthis._interactionMap.set(\"edit\", editInteraction);\r\n\t}\r\n\r\n\t/**\r\n\t * execute current interaction\r\n\t * @param interaction\r\n\t * @returns\r\n\t */\r\n\tpublic execute(t: BaseInteraction | BaseInteraction[]): void {\r\n\t\tif (isEqual(this._current, t)) return;\r\n\t\tconst oldValue = this._current;\r\n\t\tif (oldValue instanceof Array) {\r\n\t\t\toldValue.forEach((interaction: BaseInteraction) => {\r\n\t\t\t\tinteraction?.clear();\r\n\t\t\t\tinteraction?.unmount();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\toldValue?.clear();\r\n\t\t\toldValue?.unmount();\r\n\t\t}\r\n\r\n\t\tthis._current = t;\r\n\t\tif (t instanceof Array) {\r\n\t\t\tt.forEach((i: BaseInteraction) => {\r\n\t\t\t\ti.mount();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tt?.mount();\r\n\t\t}\r\n\r\n\t\t// \r\n\t\tif (this._renderer.refline) {\r\n\t\t\tthis._renderer.refline.clear();\r\n\t\t}\r\n\t\tthis.emit(\"interaction.change\", {\r\n\t\t\tsource: this,\r\n\t\t\toldValue,\r\n\t\t\tnewValue: t,\r\n\t\t});\r\n\t}\r\n\r\n\tpublic setInteractions(modes: string[] = [\"default\"]) {\r\n\t\tconst interactions: BaseInteraction[] = [];\r\n\t\tmodes.forEach((mode: string) => {\r\n\t\t\tlet interaction = this._interactionMap.get(mode);\r\n\t\t\tif (!interaction) {\r\n\t\t\t\tif (mode === \"default\") {\r\n\t\t\t\t\tinteraction = new DefaultInteraction(this._renderer);\r\n\t\t\t\t\tthis._interactionMap.set(mode, interaction);\r\n\t\t\t\t} else if (mode === \"edit\") {\r\n\t\t\t\t\tinteraction = new EditInteraction(this._renderer);\r\n\t\t\t\t\tthis._interactionMap.set(mode, interaction);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (interaction) {\r\n\t\t\t\tinteractions.push(interaction);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.execute(interactions);\r\n\r\n\t\t// const model = this._renderer.model;\r\n\t\t// model.forEach((element: Element) => {\r\n\t\t// \telement.gatherRects(model.getDatas());\r\n\t\t// });\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param mode\r\n\t * @returns\r\n\t */\r\n\tpublic getInteraction(mode: string = \"default\") {\r\n\t\treturn this._interactionMap.get(mode);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic setDefaultInteraction() {\r\n\t\t// console.log('set default interaction');\r\n\t\tlet interaction =\r\n\t\t\tthis._interactionMap.get(\"default\") ||\r\n\t\t\tnew DefaultInteraction(this._renderer);\r\n\t\tthis._interactionMap.set(\"default\", interaction);\r\n\t\tthis.execute(interaction);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic setEditInteraction(mode: string = \"default\") {\r\n\t\t// lazy, auto\r\n\t\t// console.log('set edit interaction', mode);\r\n\t\tlet interaction =\r\n\t\t\tthis._interactionMap.get(\"edit\") ||\r\n\t\t\tnew EditInteraction(this._renderer);\r\n\t\tthis._interactionMap.set(\"edit\", interaction);\r\n\t\tthis.execute(interaction);\r\n\r\n\t\t// todo\r\n\t\t// const model = this._renderer.model;\r\n\t\t// model.forEach((element: Element) => {\r\n\t\t// \telement.gatherRects(model.getDatas());\r\n\t\t// });\r\n\t}\r\n\r\n\t/**\r\n\t * use Create Element Interaction\r\n\t */\r\n\tpublic setCreateInteraction(\r\n\t\tonMouseDown?: (point?: Point, scope?: any) => any,\r\n\t\tonMouseMove?: (point?: Point, scope?: any) => any,\r\n\t\tonMouseUp?: (point?: Point, scope?: any) => any,\r\n\t\tonFinish?: (scope?: any) => any\r\n\t) {\r\n\t\tlet interaction = (this._interactionMap.get(\"create\") ||\r\n\t\t\tnew CreateInteraction(\r\n\t\t\t\tthis._renderer,\r\n\t\t\t\tonMouseDown,\r\n\t\t\t\tonMouseMove,\r\n\t\t\t\tonMouseUp,\r\n\t\t\t\tonFinish\r\n\t\t\t)) as CreateInteraction;\r\n\t\tthis._interactionMap.set(\"create\", interaction);\r\n\t\tif (onMouseDown) {\r\n\t\t\tinteraction.onMouseDown = onMouseDown;\r\n\t\t}\r\n\t\tif (onMouseMove) {\r\n\t\t\tinteraction.onMouseMove = onMouseMove;\r\n\t\t}\r\n\t\tif (onMouseUp) {\r\n\t\t\tinteraction.onMouseUp = onMouseUp;\r\n\t\t}\r\n\t\tif (onFinish) {\r\n\t\t\tinteraction.onFinish = onFinish;\r\n\t\t}\r\n\t\tthis.execute(interaction);\r\n\t}\r\n\r\n\t/**\r\n\t * use Auto Create Element Interaction\r\n\t */\r\n\tpublic setAutoCreateInteraction(\r\n\t\tonMouseDown?: (point?: Point, scope?: any) => any,\r\n\t\tonMouseMove?: (point?: Point, scope?: any) => any,\r\n\t\tonMouseUp?: (point?: Point, scope?: any) => any,\r\n\t\tonFinish?: (scope?: any) => any\r\n\t) {\r\n\t\tlet interaction = (this._interactionMap.get(\"autocreate\") ||\r\n\t\t\tnew AutoCreateInteraction(\r\n\t\t\t\tthis._renderer,\r\n\t\t\t\tonMouseDown,\r\n\t\t\t\tonMouseMove,\r\n\t\t\t\tonMouseUp,\r\n\t\t\t\tonFinish\r\n\t\t\t)) as AutoCreateInteraction;\r\n\t\tthis._interactionMap.set(\"autocreate\", interaction);\r\n\t\tif (onMouseDown) {\r\n\t\t\tinteraction.onMouseDown = onMouseDown;\r\n\t\t}\r\n\t\tif (onMouseMove) {\r\n\t\t\tinteraction.onMouseMove = onMouseMove;\r\n\t\t}\r\n\t\tif (onMouseUp) {\r\n\t\t\tinteraction.onMouseUp = onMouseUp;\r\n\t\t}\r\n\t\tif (onFinish) {\r\n\t\t\tinteraction.onFinish = onFinish;\r\n\t\t}\r\n\t\tthis.execute(interaction);\r\n\t}\r\n\r\n\t/**\r\n\t * use Create Line Interaction\r\n\t */\r\n\tpublic setCreateLineInteraction(\r\n\t\tonMouseDown?: (point?: Point, scope?: any) => any,\r\n\t\tonMouseMove?: (point?: Point, scope?: any) => any,\r\n\t\tonMouseUp?: (point?: Point, scope?: any) => any,\r\n\t\tonFinish?: (scope?: any) => any\r\n\t) {\r\n\t\tlet interaction = (this._interactionMap.get(\"createline\") ||\r\n\t\t\tnew CreateLineInteraction(\r\n\t\t\t\tthis._renderer,\r\n\t\t\t\tonMouseDown,\r\n\t\t\t\tonMouseMove,\r\n\t\t\t\tonMouseUp,\r\n\t\t\t\tonFinish\r\n\t\t\t)) as CreateLineInteraction;\r\n\t\tthis._interactionMap.set(\"createline\", interaction);\r\n\t\tif (onMouseDown) {\r\n\t\t\tinteraction.onMouseDown = onMouseDown;\r\n\t\t}\r\n\t\tif (onMouseMove) {\r\n\t\t\tinteraction.onMouseMove = onMouseMove;\r\n\t\t}\r\n\t\tif (onMouseUp) {\r\n\t\t\tinteraction.onMouseUp = onMouseUp;\r\n\t\t}\r\n\t\tif (onFinish) {\r\n\t\t\tinteraction.onFinish = onFinish;\r\n\t\t}\r\n\t\tthis.execute(interaction);\r\n\t}\r\n\r\n\t/**\r\n\t * use Create Shape Interaction\r\n\t */\r\n\tpublic setCreateShapeInteraction(\r\n\t\tonMouseDown?: (point?: Point, scope?: any) => any,\r\n\t\tonMouseMove?: (point?: Point, scope?: any) => any,\r\n\t\tonMouseUp?: (point?: Point, scope?: any) => any,\r\n\t\tonFinish?: (scope?: any) => any\r\n\t) {\r\n\t\tlet interaction = (this._interactionMap.get(\"create\") ||\r\n\t\t\tnew CreateInteraction(\r\n\t\t\t\tthis._renderer,\r\n\t\t\t\tonMouseDown,\r\n\t\t\t\tonMouseMove,\r\n\t\t\t\tonMouseUp,\r\n\t\t\t\tonFinish\r\n\t\t\t)) as CreateInteraction;\r\n\t\tthis._interactionMap.set(\"create\", interaction);\r\n\t\tif (onMouseDown) {\r\n\t\t\tinteraction.onMouseDown = onMouseDown;\r\n\t\t}\r\n\t\tif (onMouseMove) {\r\n\t\t\tinteraction.onMouseMove = onMouseMove;\r\n\t\t}\r\n\t\tif (onMouseUp) {\r\n\t\t\tinteraction.onMouseUp = onMouseUp;\r\n\t\t}\r\n\t\tif (onFinish) {\r\n\t\t\tinteraction.onFinish = onFinish;\r\n\t\t}\r\n\t\tthis.execute(interaction);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns\r\n\t */\r\n\tpublic getCurrentInteraction():\r\n\t\t| BaseInteraction\r\n\t\t| BaseInteraction[]\r\n\t\t| undefined {\r\n\t\treturn this._current;\r\n\t}\r\n}\r\n","import { EventEmitter } from \"eventemitter3\";\r\nimport { EventsModel } from \"./events\";\r\nimport { IModel } from \"./interfaces\";\r\nimport { TType } from \"./types\";\r\n\r\nexport interface ModelProps { }\r\n\r\n/**\r\n * \r\n * Model\r\n * \t--Model\r\n */\r\nexport class Model<S extends TType> extends EventEmitter implements IModel<S> {\r\n\t_pros?: ModelProps;\r\n\t_datas: S[] = [];\r\n\t_datasMap: Map<string, S> = new Map();\r\n\r\n\tpublic constructor(pros?: ModelProps) {\r\n\t\tsuper();\r\n\t\tthis._pros = pros;\r\n\t}\r\n\r\n\t/**\r\n\t * add data to datas\r\n\t * @param data\r\n\t * @returns\r\n\t */\r\n\tadd(data: S) {\r\n\t\tconst datas = this._datas,\r\n\t\t\tdatasMap = this._datasMap;\r\n\t\tif (this.contains(data)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tconst old: Array<S> = [];\r\n\t\tObject.assign(old, datas);\r\n\t\tdatas.push(data);\r\n\t\tdatasMap.set(data._id, data);\r\n\t\tthis.emit(EventsModel.Add, {\r\n\t\t\tsource: this,\r\n\t\t\tdata,\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * get by index\r\n\t * @param id\r\n\t * @returns\r\n\t */\r\n\tget(index: number): S | undefined {\r\n\t\treturn this._datas[index];\r\n\t}\r\n\r\n\t/**\r\n\t * get S By Id\r\n\t * @param id\r\n\t * @returns\r\n\t */\r\n\tgetById(id: string): S | undefined {\r\n\t\treturn this._datasMap.get(id);\r\n\t}\r\n\r\n\t/**\r\n\t * remove data from datas\r\n\t * @param data\r\n\t * @returns\r\n\t */\r\n\tremove(data: S | S[]) {\r\n\t\tif (!data) return this;\r\n\t\tif (data instanceof Array) {\r\n\t\t\tdata.forEach((d: S) => {\r\n\t\t\t\tthis.remove(d);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconst datas = this._datas,\r\n\t\t\t\tindex = datas.indexOf(data);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\tdatas.splice(index, 1);\r\n\t\t\t\tthis._datasMap.delete(data._id);\r\n\t\t\t\tthis.emit(EventsModel.Remove, {\r\n\t\t\t\t\tsource: this,\r\n\t\t\t\t\tdata,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param data\r\n\t * @returns\r\n\t */\r\n\tcontains(data: S): boolean {\r\n\t\treturn !!this._datasMap.get(data._id);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param callback\r\n\t * @param thisArg\r\n\t * @returns\r\n\t */\r\n\tforEach(callback: (data: S, index: number) => void, thisArg?: unknown) {\r\n\t\tthis._datas.forEach(callback, thisArg);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * clear\r\n\t * @returns\r\n\t */\r\n\tclear() {\r\n\t\tconst old = this._datas;\r\n\t\tthis._datas = [];\r\n\t\tthis._datasMap.clear();\r\n\t\tthis.emit(EventsModel.Clear, {\r\n\t\t\tsource: this,\r\n\t\t\tdata: null,\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * get datas array\r\n\t * @returns\r\n\t */\r\n\tgetDatas(filter?: (element: S) => boolean): S[] {\r\n\t\tif (filter) {\r\n\t\t\tlet datas: S[] = [];\r\n\t\t\tthis._datas.forEach((data: S) => {\r\n\t\t\t\tif (filter(data)) {\r\n\t\t\t\t\tdatas.push(data);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn datas;\r\n\t\t}\r\n\t\treturn this._datas;\r\n\t}\r\n\r\n\t/**\r\n\t * get datas map\r\n\t * @returns\r\n\t */\r\n\tgetDatasMap(filter?: (element: S) => boolean): Map<string, S> {\r\n\t\tif (filter) {\r\n\t\t\tlet datasMap: Map<string, S> = new Map();\r\n\t\t\tthis._datas.forEach((data: S) => {\r\n\t\t\t\tif (filter(data)) {\r\n\t\t\t\t\tdatasMap.set(data._id, data);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn datasMap;\r\n\t\t}\r\n\t\treturn this._datasMap;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param data {S[]} \r\n\t * @returns\r\n\t */\r\n\tbatchAdd(data: S[]) {\r\n\t\tconst datas = this._datas,\r\n\t\t\tdatasMap = this._datasMap;\r\n\t\tconst old: S[] = [];\r\n\t\tObject.assign(old, datas);\r\n\t\tdata.forEach((d: S) => {\r\n\t\t\tif (this.contains(d)) {\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\tdatas.push(d);\r\n\t\t\tdatasMap.set(d._id, d);\r\n\t\t});\r\n\t\tthis.emit(EventsModel.BatchAdd, {\r\n\t\t\tsource: this,\r\n\t\t\tdata,\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import EventEmitter from \"eventemitter3\";\r\nimport {\r\n\tCommandManager,\r\n\tEdge,\r\n\tElement,\r\n\tElementType,\r\n\tFillType,\r\n\tGroup,\r\n\tLayerType,\r\n\tLine,\r\n\tMementoManager,\r\n\tNode,\r\n\tRectangle,\r\n\tShape,\r\n\tShapeLine,\r\n\tVertex,\r\n} from \"@blood4/modeling\";\r\nimport {\r\n\tDefaultInteraction,\r\n\tInteractionEvents,\r\n\tKeyboardEvents,\r\n\tPixiRenderer,\r\n} from \"@blood4/renderer-pixi\";\r\nimport { EventsModel, Model } from \"@blood4/models\";\r\nimport { BloodIO } from \"@blood4/io\";\r\nimport ControlPane from \"../controlPane/ControlPane\";\r\nimport { Graphics } from \"pixi.js\";\r\n\r\n/**\r\n * access_line_lst: UI\r\n * no_access_line_lst: \r\n * proscenium_line_lst: \r\n */\r\n\r\nexport enum LineType {\r\n\tAccessLine, // \r\n\tUnAccessLine, // \r\n\tProsceniumLine, // \r\n}\r\n/**\r\n * Interface Application\r\n */\r\nexport interface IApplication {\r\n\tid?: string;\r\n\tcanvas?: HTMLCanvasElement | null;\r\n\tdebug?: {\r\n\t\tmodel?: boolean;\r\n\t\tui?: boolean;\r\n\t\torigin?: boolean;\r\n\t\tcontrolPane?: boolean;\r\n\t\tstats?: boolean;\r\n\t};\r\n}\r\n\r\nexport const Config = {\r\n\tscale: 1 / 50,\r\n\taxis: [1, -1],\r\n};\r\n\r\nconst defaultDomainStyles = {\r\n\tcursor: \"move\",\r\n\tfill: true,\r\n\tfillColor: 0xffffff,\r\n\tfillAlpha: 1.0,\r\n\tstrokeWidth: 1,\r\n\tstrokeColor: 0x000000,\r\n\tstrokeAlpha: 0.55,\r\n\thoverStrokeWidth: 0.6,\r\n\thoverStrokeColor: 0x3477fc,\r\n\thoverStrokeAlpha: 1.0,\r\n\thoverFill: false,\r\n\thoverFillColor: 0xffffff,\r\n\thoverFillAlpha: 0.0,\r\n\tselectFill: true,\r\n\tselectFillColor: 0xffffff,\r\n\tselectFillAlpha: 0.1,\r\n\tselectStrokeWidth: 1.0,\r\n\tselectStrokeColor: 0x3477fc,\r\n\tselectStrokeAlpha: 1.0,\r\n\tlabelGizmoCursor: \"move\",\r\n\talarmFillColor: 0xe02929,\r\n\talarmFillAlpha: 0.09,\r\n\tlabel2GizmoPosition: \"Center\",\r\n\tlabel2GizmoPositionOffsetX: 0,\r\n\tlabel2GizmoPositionOffsetY: 20,\r\n};\r\nexport default class Application extends EventEmitter {\r\n\tprivate _options: IApplication;\r\n\tprivate _debug: {\r\n\t\tmodel?: boolean;\r\n\t\tui?: boolean;\r\n\t\torigin?: boolean;\r\n\t\tcontrolPane?: boolean;\r\n\t\tstats?: boolean;\r\n\t} = {\r\n\t\t\tmodel: false,\r\n\t\t\tui: false,\r\n\t\t\torigin: false,\r\n\t\t\tcontrolPane: false,\r\n\t\t\tstats: false,\r\n\t\t};\r\n\tprivate _controlPane?: ControlPane;\r\n\tmodel?: Model<Element> = new Model();\r\n\tpixiRenderer: PixiRenderer<Model<Element>>;\r\n\tboundingBox: Rectangle = new Rectangle(0, 0, 0, 0);\r\n\t_mode: string = \"show\"; // show edit\r\n\tio?: BloodIO;\r\n\tgraphics?: Graphics = new Graphics();\r\n\r\n\tmementoManager: MementoManager = new MementoManager();\r\n\tcommandManager: CommandManager = new CommandManager();\r\n\r\n\tconstructor(options?: Partial<IApplication>) {\r\n\t\tsuper();\r\n\t\tthis._options = {\r\n\t\t\t...options,\r\n\t\t};\r\n\t\tthis._debug = {\r\n\t\t\t...options?.debug,\r\n\t\t};\r\n\t\tthis.pixiRenderer = new PixiRenderer({\r\n\t\t\tcanvas: options?.canvas || document.createElement(\"canvas\"),\r\n\t\t});\r\n\t\tif (!this.model) {\r\n\t\t\tthis.model = new Model();\r\n\t\t}\r\n\t\tconst model = this.model;\r\n\r\n\t\tconst pixiRenderer = this.pixiRenderer;\r\n\t\tpixiRenderer.renderer.backgroundColor = 0xf5f5f5;\r\n\t\tpixiRenderer.model = model;\r\n\t\t// pixiRenderer.setGridVisible(true);\r\n\r\n\t\tif (!!this._debug.controlPane) {\r\n\t\t\tthis._controlPane = new ControlPane({\r\n\t\t\t\ttitle: \"Control Pane\",\r\n\t\t\t\tmodel: this.model,\r\n\t\t\t\tapp: this,\r\n\t\t\t});\r\n\t\t\tthis._controlPane.visible = !!this._debug.controlPane;\r\n\t\t\tthis._controlPane.renderer = pixiRenderer;\r\n\t\t\tthis._controlPane.model = model;\r\n\t\t}\r\n\t\tthis.initCommandManager();\r\n\t\tthis.initMementoManager();\r\n\t\tthis.initInteractionListener();\r\n\t\tthis.initModelListener();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @returns\r\n\t */\r\n\tinitInteractionListener() {\r\n\t\tconst pixiRenderer = this.pixiRenderer,\r\n\t\t\tmodel = this.model;\r\n\t\tif (!pixiRenderer || !model) return;\r\n\t\tconst currentInteraction =\r\n\t\t\tpixiRenderer.interactionManager.getCurrentInteraction();\r\n\t\tif (currentInteraction instanceof DefaultInteraction) {\r\n\t\t\tcurrentInteraction.on(KeyboardEvents.KeyUp, async (evt: any) => {\r\n\t\t\t\tif (evt.event.key === \"Alt\") {\r\n\t\t\t\t\t// await this.handleAlignPreview();\r\n\t\t\t\t\t// await this.doMinArea();\r\n\t\t\t\t\t// await this.doEarlyWarning();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tcurrentInteraction.on(InteractionEvents.Scale, (evt: any) => {\r\n\t\t\t\tconst { source, target } = evt;\r\n\t\t\t\tif (!target) return;\r\n\t\t\t});\r\n\r\n\t\t\tcurrentInteraction.on(\r\n\t\t\t\tInteractionEvents.UnableResize,\r\n\t\t\t\t(evt: any) => { }\r\n\t\t\t);\r\n\r\n\t\t\tcurrentInteraction.on(InteractionEvents.Click, async (evt: any) => {\r\n\t\t\t\tconst { source, target } = evt;\r\n\t\t\t\tif (!source || !target) return;\r\n\t\t\t});\r\n\r\n\t\t\tcurrentInteraction.on(InteractionEvents.Sleep, (evt: any) => {\r\n\t\t\t\tthis.emit(InteractionEvents.Sleep, {\r\n\t\t\t\t\tsource: this,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tcurrentInteraction.on(KeyboardEvents.KeyDown, async (evt: any) => {\r\n\t\t\t\tconst { source, event } = evt;\r\n\t\t\t\tif (event.code === \"KeyL\" && this.mode === \"edit\") {\r\n\t\t\t\t} else if (event.code === \"Delete\") {\r\n\t\t\t\t\tconst sm = this.pixiRenderer.selectionModel;\r\n\t\t\t\t\tconst model = this.model;\r\n\t\t\t\t\tif (sm && model) {\r\n\t\t\t\t\t\tconst selected = sm.getSelection();\r\n\t\t\t\t\t\tselected.forEach((select: Element) => {\r\n\t\t\t\t\t\t\tconst children = select.getChildren();\r\n\t\t\t\t\t\t\tchildren &&\r\n\t\t\t\t\t\t\t\tchildren.forEach((child: Element) => {\r\n\t\t\t\t\t\t\t\t\tmodel.remove(child);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tmodel.remove(select);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (source._ctrlDown && event.code === \"KeyA\") {\r\n\t\t\t\t\tconst sm = this.pixiRenderer.selectionModel;\r\n\t\t\t\t\tconst model = this.model;\r\n\t\t\t\t\tif (sm && model && this._debug.ui) {\r\n\t\t\t\t\t\tconst domains = model.getDatas((element: Element) => {\r\n\t\t\t\t\t\t\treturn element instanceof Element;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tsm.setSelection(domains);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (source._ctrlDown && event.code === \"KeyS\") {\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tawait this.save();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * init Model Listener\r\n\t */\r\n\tinitModelListener() {\r\n\t\tconst model = this.model;\r\n\t\tif (!model) return;\r\n\t\tmodel.on(EventsModel.Remove, (evt: any) => {\r\n\t\t\tconst { data } = evt;\r\n\t\t\t// if (data instanceof AlignLine) {\r\n\t\t\t// \tthis.handleAlignPreview();\r\n\t\t\t// } else if (data instanceof Domain) {\r\n\t\t\t// \tthis.property?.removeDomain(data);\r\n\t\t\t// }\r\n\t\t});\r\n\t}\r\n\r\n\tinitModel() {\r\n\t\tconst model = this.model;\r\n\t\tif (!model) return;\r\n\t\tconst v0 = new Vertex({\r\n\t\t\tname: `v0`,\r\n\t\t\tx: 660,\r\n\t\t\ty: 260,\r\n\t\t});\r\n\t\tmodel.add(v0);\r\n\r\n\t\tconst v1 = new Vertex({\r\n\t\t\tname: `v1`,\r\n\t\t\tx: 1093,\r\n\t\t\ty: 493,\r\n\t\t});\r\n\t\tmodel.add(v1);\r\n\r\n\t\tconst v2 = new Vertex({\r\n\t\t\tname: `v2`,\r\n\t\t\tx: 693,\r\n\t\t\ty: 593,\r\n\t\t});\r\n\t\tmodel.add(v2);\r\n\r\n\t\tconst v3 = new Vertex({\r\n\t\t\tname: `v3`,\r\n\t\t\tx: 393,\r\n\t\t\ty: 493,\r\n\t\t});\r\n\t\tmodel.add(v3);\r\n\r\n\t\tconst v4 = new Vertex({\r\n\t\t\tname: `v4`,\r\n\t\t\tx: 1266.0,\r\n\t\t\ty: 293,\r\n\t\t});\r\n\t\tmodel.add(v4);\r\n\r\n\t\tconst v5 = new Vertex({\r\n\t\t\tname: `v5`,\r\n\t\t\tx: 360,\r\n\t\t\ty: 260,\r\n\t\t});\r\n\t\tmodel.add(v5);\r\n\r\n\t\tmodel.add(\r\n\t\t\tnew Edge({\r\n\t\t\t\tfrom: v0,\r\n\t\t\t\tto: v1,\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tmodel.add(\r\n\t\t\tnew Edge({\r\n\t\t\t\tfrom: v1,\r\n\t\t\t\tto: v2,\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tmodel.add(\r\n\t\t\tnew Edge({\r\n\t\t\t\tfrom: v2,\r\n\t\t\t\tto: v0,\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tconst group = new Group({\r\n\t\t\tstyles: {\r\n\t\t\t\tfill: true,\r\n\t\t\t\tfillColor: 0xcdcdcd,\r\n\t\t\t\tfillAlpha: 0.8,\r\n\t\t\t\tfillVector: true,\r\n\t\t\t\tfillImage: false,\r\n\t\t\t\tzIndex: LayerType.BottomZIndex,\r\n\t\t\t},\r\n\t\t});\r\n\t\t// group.addChild(v0);\r\n\t\t// group.addChild(v1);\r\n\t\t// group.addChild(v2);\r\n\t\t// group.addChild(v3);\r\n\t\t// group.addChild(v4);\r\n\t\t// model.add(group);\r\n\r\n\t\t/* \tthis.model?.add(\r\n\t\t\t\tnew Shape({\r\n\t\t\t\t\tname: \"\",\r\n\t\t\t\t\tpoints: [\r\n\t\t\t\t\t\t[200, -200],\r\n\t\t\t\t\t\t[-200, -200],\r\n\t\t\t\t\t\t[-200, 200],\r\n\t\t\t\t\t\t[200, 200],\r\n\t\t\t\t\t],\r\n\t\t\t\t\tmode: ElementType.Show,\r\n\t\t\t\t\tstyles: {\r\n\t\t\t\t\t\tcursor: \"move\",\r\n\t\t\t\t\t\tfill: true,\r\n\t\t\t\t\t\tfillColor: 0xffffff,\r\n\t\t\t\t\t\tfillAlpha: 0.1,\r\n\t\t\t\t\t\thoverStrokeWidth: 0.6,\r\n\t\t\t\t\t\thoverStrokeColor: 0x3477fc,\r\n\t\t\t\t\t\thoverStrokeAlpha: 1.0,\r\n\t\t\t\t\t\tselectFill: true,\r\n\t\t\t\t\t\tselectFillColor: 0xffffff,\r\n\t\t\t\t\t\tselectFillAlpha: 0.1,\r\n\t\t\t\t\t\tselectStrokeWidth: 1.0,\r\n\t\t\t\t\t\tselectStrokeColor: 0x3477fc,\r\n\t\t\t\t\t\tselectStrokeAlpha: 1.0,\r\n\t\t\t\t\t\tlabelGizmoCursor: \"move\",\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t\r\n\t\t\tthis.model?.add(\r\n\t\t\t\tnew Shape({\r\n\t\t\t\t\tname: \"\",\r\n\t\t\t\t\tpoints: [\r\n\t\t\t\t\t\t[500, 100],\r\n\t\t\t\t\t\t[500, 400],\r\n\t\t\t\t\t\t[900, 400],\r\n\t\t\t\t\t\t[900, 100],\r\n\t\t\t\t\t\t[800, 100],\r\n\t\t\t\t\t\t[800, 300],\r\n\t\t\t\t\t\t[600, 300],\r\n\t\t\t\t\t\t[600, 100],\r\n\t\t\t\t\t],\r\n\t\t\t\t\tmode: ElementType.Show,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t\r\n\t\t\tmodel.add(\r\n\t\t\t\tnew Node({\r\n\t\t\t\t\tname: `B`,\r\n\t\t\t\t\tname2: \"B2\",\r\n\t\t\t\t\tx: 450,\r\n\t\t\t\t\ty: 300,\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\theight: 100,\r\n\t\t\t\t\tangle: 30,\r\n\t\t\t\t\tdebug: this._debug.ui,\r\n\t\t\t\t\tclients: {\r\n\t\t\t\t\t\teasing: \"easeInOutSine\",\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t\r\n\t\t\tmodel.add(\r\n\t\t\t\tnew Node({\r\n\t\t\t\t\tname: `C`,\r\n\t\t\t\t\tname2: \"C2\",\r\n\t\t\t\t\tx: 600,\r\n\t\t\t\t\ty: 300,\r\n\t\t\t\t\twidth: 80,\r\n\t\t\t\t\theight: 80,\r\n\t\t\t\t\tangle: 60,\r\n\t\t\t\t\tdebug: this._debug.ui,\r\n\t\t\t\t\tclients: {\r\n\t\t\t\t\t\teasing: \"easeInQuad\",\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t\r\n\t\t\tmodel.add(\r\n\t\t\t\tnew Node({\r\n\t\t\t\t\tname: `D`,\r\n\t\t\t\t\tname2: \"D2\",\r\n\t\t\t\t\tx: 700,\r\n\t\t\t\t\ty: 300,\r\n\t\t\t\t\twidth: 60,\r\n\t\t\t\t\theight: 60,\r\n\t\t\t\t\tangle: 90,\r\n\t\t\t\t\tdebug: this._debug.ui,\r\n\t\t\t\t\tclients: {\r\n\t\t\t\t\t\teasing: \"easeInOutBounce\",\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t\r\n\t\t\tmodel.add(\r\n\t\t\t\tnew Node({\r\n\t\t\t\t\tname: `E`,\r\n\t\t\t\t\tname2: \"E2\",\r\n\t\t\t\t\tx: 800,\r\n\t\t\t\t\ty: 300,\r\n\t\t\t\t\twidth: 40,\r\n\t\t\t\t\theight: 40,\r\n\t\t\t\t\tangle: 130,\r\n\t\t\t\t\tdebug: this._debug.ui,\r\n\t\t\t\t\tclients: {\r\n\t\t\t\t\t\teasing: \"easeOutInCirc\",\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t\r\n\t\t\tmodel.add(\r\n\t\t\t\tnew Node({\r\n\t\t\t\t\tname: `F`,\r\n\t\t\t\t\tname2: \"F2\",\r\n\t\t\t\t\tx: 900,\r\n\t\t\t\t\ty: 300,\r\n\t\t\t\t\twidth: 140,\r\n\t\t\t\t\theight: 70,\r\n\t\t\t\t\tangle: 130,\r\n\t\t\t\t\tdebug: this._debug.ui,\r\n\t\t\t\t\tclients: {\r\n\t\t\t\t\t\teasing: \"easeInOutQuart\",\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t\r\n\t\t\tconst domain = new Shape({\r\n\t\t\t\tname: \"\",\r\n\t\t\t\tpoints: [\r\n\t\t\t\t\t[500, 100],\r\n\t\t\t\t\t[500, 400],\r\n\t\t\t\t\t[900, 400],\r\n\t\t\t\t\t[900, 100],\r\n\t\t\t\t\t[800, 100],\r\n\t\t\t\t\t[800, 300],\r\n\t\t\t\t\t[600, 300],\r\n\t\t\t\t\t[600, 100],\r\n\t\t\t\t],\r\n\t\t\t\tmode: ElementType.Show,\r\n\t\t\t});\r\n\t\t\tthis.model?.add(domain);\r\n\t\t\r\n\t\t\tconst domain2 = new Shape({\r\n\t\t\t\tname: \"2\",\r\n\t\t\t\tpoints: [\r\n\t\t\t\t\t[300, 100],\r\n\t\t\t\t\t[200, 200],\r\n\t\t\t\t\t[250, 300],\r\n\t\t\t\t\t[400, 300],\r\n\t\t\t\t\t[500, 200],\r\n\t\t\t\t\t[400, 100],\r\n\t\t\t\t],\r\n\t\t\t\tmode: ElementType.Show,\r\n\t\t\t});\r\n\t\t\tthis.model?.add(domain2);\r\n\t\t\r\n\t\t\tthis._createShape(\r\n\t\t\t\t[\r\n\t\t\t\t\t[1000, 100],\r\n\t\t\t\t\t[1000, 400],\r\n\t\t\t\t\t[1400, 400],\r\n\t\t\t\t\t[1400, 100],\r\n\t\t\t\t\t[1300, 100],\r\n\t\t\t\t\t[1300, 300],\r\n\t\t\t\t\t[1100, 300],\r\n\t\t\t\t\t[1100, 100],\r\n\t\t\t\t],\r\n\t\t\t\t0\r\n\t\t\t);\r\n\t\t\r\n\t\t\tthis._createShape(\r\n\t\t\t\t[\r\n\t\t\t\t\t[1600, 100],\r\n\t\t\t\t\t[1600, 400],\r\n\t\t\t\t\t[1700, 400],\r\n\t\t\t\t],\r\n\t\t\t\t45\r\n\t\t\t);\r\n\t\t\tthis._createShape(\r\n\t\t\t\t[\r\n\t\t\t\t\t[200, 500],\r\n\t\t\t\t\t[400, 400],\r\n\t\t\t\t\t[500, 600],\r\n\t\t\t\t],\r\n\t\t\t\t30\r\n\t\t\t);\r\n\t\t\tthis._createShape(\r\n\t\t\t\t[\r\n\t\t\t\t\t[700, 500],\r\n\t\t\t\t\t[800, 400],\r\n\t\t\t\t\t[800, 600],\r\n\t\t\t\t\t[600, 600],\r\n\t\t\t\t],\r\n\t\t\t\t50\r\n\t\t\t);\r\n\t\t\tthis._createShape(\r\n\t\t\t\t[\r\n\t\t\t\t\t[900, 700],\r\n\t\t\t\t\t[1100, 500],\r\n\t\t\t\t\t[1200, 640],\r\n\t\t\t\t\t[1500, 610],\r\n\t\t\t\t],\r\n\t\t\t\t60\r\n\t\t\t);\r\n\t\t\r\n\t\t\tmodel.add(\r\n\t\t\t\tnew Line({\r\n\t\t\t\t\tname: \"Line\",\r\n\t\t\t\t\tfrom: [0, 0],\r\n\t\t\t\t\tto: [200, 200],\r\n\t\t\t\t\tdebug: this._debug.ui,\r\n\t\t\t\t\tclients: {\r\n\t\t\t\t\t\teasing: \"easeInOutQuart\",\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t\tmodel.add(\r\n\t\t\t\tnew Line({\r\n\t\t\t\t\tname: \"DashLine\",\r\n\t\t\t\t\tfrom: [200, 900],\r\n\t\t\t\t\tto: [400, 1000],\r\n\t\t\t\t\tdash: [1, 1],\r\n\t\t\t\t\tdebug: false,\r\n\t\t\t\t\tclients: {\r\n\t\t\t\t\t\teasing: \"easeInOutQuart\",\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t\tthis._createShapeLine([\r\n\t\t\t\t[100, 1000],\r\n\t\t\t\t[600, 800],\r\n\t\t\t\t[500, 400],\r\n\t\t\t]);\r\n\t\t\r\n\t\t\tthis._createShapeLine(\r\n\t\t\t\t[\r\n\t\t\t\t\t[900, 1000],\r\n\t\t\t\t\t[1100, 800],\r\n\t\t\t\t\t[1200, 940],\r\n\t\t\t\t\t[1500, 910],\r\n\t\t\t\t],\r\n\t\t\t\t[1, 1],\r\n\t\t\t\t0\r\n\t\t\t); */\r\n\t}\r\n\r\n\tinitCommandManager() {\r\n\t\tif (!this.commandManager) {\r\n\t\t\tthis.commandManager = new CommandManager();\r\n\t\t}\r\n\t\tconst commandManager = this.commandManager;\r\n\t\tcommandManager\r\n\t\t\t.onBeforeAdd((event: any) => {\r\n\t\t\t\tconst current = event.current,\r\n\t\t\t\t\tcursor = event.cursor,\r\n\t\t\t\t\taction = event.action,\r\n\t\t\t\t\tcommands = event.commands,\r\n\t\t\t\t\tscope = event.scope;\r\n\t\t\t})\r\n\t\t\t.onUpdate((event: any) => {\r\n\t\t\t\tconst current = event.current,\r\n\t\t\t\t\tcursor = event.cursor,\r\n\t\t\t\t\taction = event.action,\r\n\t\t\t\t\tcommands = event.commands,\r\n\t\t\t\t\tscope = event.scope;\r\n\t\t\t})\r\n\t\t\t.onSuspended((event: any) => {\r\n\t\t\t\tconst current = event.current,\r\n\t\t\t\t\tcursor = event.cursor,\r\n\t\t\t\t\taction = event.action,\r\n\t\t\t\t\tcommands = event.commands,\r\n\t\t\t\t\tscope = event.scope;\r\n\t\t\t})\r\n\t\t\t.onLimited((event: any) => {\r\n\t\t\t\tconst current = event.current,\r\n\t\t\t\t\tcursor = event.cursor,\r\n\t\t\t\t\taction = event.action,\r\n\t\t\t\t\tcommands = event.commands,\r\n\t\t\t\t\tscope = event.scope;\r\n\t\t\t});\r\n\t}\r\n\r\n\tinitMementoManager() {\r\n\t\tif (!this.mementoManager) {\r\n\t\t\tthis.mementoManager = new MementoManager();\r\n\t\t}\r\n\t\tconst mementoManager = this.mementoManager;\r\n\t\tmementoManager\r\n\t\t\t.onUpdate((event: any) => {\r\n\t\t\t\tif (event) {\r\n\t\t\t\t\tconst item = event.current,\r\n\t\t\t\t\t\taction = event.action,\r\n\t\t\t\t\t\thistory = event.history,\r\n\t\t\t\t\t\tscope = event.scope;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.onBeforeSave((event: any) => {\r\n\t\t\t\tconst item = event.current,\r\n\t\t\t\t\taction = event.action,\r\n\t\t\t\t\thistory = event.history,\r\n\t\t\t\t\tscope = event.scope;\r\n\t\t\t})\r\n\t\t\t.onMaxLength((event: any) => {\r\n\t\t\t\tconst item = event.current,\r\n\t\t\t\t\taction = event.action,\r\n\t\t\t\t\thistory = event.history,\r\n\t\t\t\t\tscope = event.scope;\r\n\t\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * clear\r\n\t */\r\n\tclear() {\r\n\t\tthis.model?.clear();\r\n\t\tif (this.pixiRenderer.guide) {\r\n\t\t\tthis.pixiRenderer.guide.datas = [];\r\n\t\t}\r\n\t\t// this.property?.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\texit() {\r\n\t\tthis.mode = \"show\";\r\n\t\tif (this._controlPane) {\r\n\t\t\tthis._controlPane.visible = false;\r\n\t\t}\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\tmount() {\r\n\t\tif (this._controlPane) {\r\n\t\t\tthis._controlPane.visible = !!this._debug.controlPane;\r\n\t\t}\r\n\t\tthis.load();\r\n\t}\r\n\r\n\tunmount() {\r\n\t\tif (this._controlPane) {\r\n\t\t\tthis._controlPane.visible = false;\r\n\t\t}\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\tprivate _createShape(points: number[][], angle?: number) {\r\n\t\tconst model = this.model;\r\n\t\tif (!model) return;\r\n\r\n\t\tconst points1: number[][] = points.map((m: number[]) => {\r\n\t\t\treturn [m[0], m[1]];\r\n\t\t});\r\n\r\n\t\tmodel.add(\r\n\t\t\tnew Shape({\r\n\t\t\t\tname: `Shape`,\r\n\t\t\t\tpoints: points1,\r\n\t\t\t\tdebug: this._debug.ui,\r\n\t\t\t\tangle: angle || 0,\r\n\t\t\t\tmode: ElementType.Edit,\r\n\t\t\t\tclients: {\r\n\t\t\t\t\teasing: \"easeInOutQuart\",\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tprivate _createShapeLine(\r\n\t\tpoints: number[][],\r\n\t\tdash?: number[],\r\n\t\tangle?: number\r\n\t) {\r\n\t\tconst model = this.model;\r\n\t\tif (!model) return;\r\n\r\n\t\tconst points1: number[][] = points.map((m: number[]) => {\r\n\t\t\treturn [m[0], m[1]];\r\n\t\t});\r\n\r\n\t\tmodel.add(\r\n\t\t\tnew ShapeLine({\r\n\t\t\t\tname: `ShapeLine`,\r\n\t\t\t\tpoints: points1,\r\n\t\t\t\tdebug: this._debug.ui,\r\n\t\t\t\tdash: dash,\r\n\t\t\t\tangle: angle || 0,\r\n\t\t\t\tclients: {\r\n\t\t\t\t\teasing: \"easeInOutQuart\",\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * load system data\r\n\t */\r\n\tasync load() {\r\n\t\tthis.clear();\r\n\t\tthis.emit(\"loading.start\", {\r\n\t\t\tsource: this,\r\n\t\t});\r\n\t\tthis.initModel();\r\n\t\tthis.emit(\"loading.end\", {\r\n\t\t\tsource: this,\r\n\t\t});\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *\r\n\t * @param v\r\n\t */\r\n\tsetRefLinesVisible(v: boolean) {\r\n\t\tthis.pixiRenderer.guide.visible = v;\r\n\t}\r\n\r\n\t/**\r\n\t * load Bubble json\r\n\t * @param json\r\n\t */\r\n\tpublic importData(json: any) {\r\n\t\tconst model = this.model;\r\n\t\tif (!model) return;\r\n\t\tthis.io?.deserialize(json);\r\n\t\t// add to property\r\n\t}\r\n\r\n\t/**\r\n\t * +\r\n\t */\r\n\tpublic exportData() {\r\n\t\tconst datas = this.io?.serializer();\r\n\t\treturn datas;\r\n\t}\r\n\r\n\t/**\r\n\t * return\r\n\t */\r\n\tpublic get mode(): string {\r\n\t\treturn this._mode;\r\n\t}\r\n\r\n\t/**\r\n\t * set mode\r\n\t */\r\n\tpublic set mode(mode: string) {\r\n\t\tthis._mode = mode;\r\n\t\tthis.model?.forEach((element: Element) => {\r\n\t\t\tif (element instanceof Element) {\r\n\t\t\t\telement.mode =\r\n\t\t\t\t\tmode === ElementType.Show\r\n\t\t\t\t\t\t? ElementType.Show\r\n\t\t\t\t\t\t: ElementType.Edit;\r\n\t\t\t\tif (mode === ElementType.Show) {\r\n\t\t\t\t\telement.styles.fillColor = defaultDomainStyles.fillColor;\r\n\t\t\t\t\telement.styles.fillAlpha = defaultDomainStyles.fillAlpha;\r\n\t\t\t\t} else if (mode === ElementType.Edit) {\r\n\t\t\t\t\telement.styles.fillColor = 0x000000;\r\n\t\t\t\t\telement.styles.fillAlpha = 0.1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tpublic async changeMode(mode: string) {\r\n\t\tthis.mode = mode;\r\n\t\tconst model = this.model;\r\n\t\tif (!model) return;\r\n\r\n\t\tif (mode === ElementType.Show) {\r\n\t\t} else if (mode === ElementType.Edit) {\r\n\t\t\tthis.emit(\"loading.start\", {\r\n\t\t\t\tsource: this,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"loading.end\", {\r\n\t\t\t\tsource: this,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @todo\r\n\t */\r\n\tpublic isDirty(): boolean {\r\n\t\tconst datas = this.io?.serializer();\r\n\t\tconst oldDatas = this.mementoManager?.current();\r\n\t\treturn JSON.stringify(datas) === JSON.stringify(oldDatas)\r\n\t\t\t? false\r\n\t\t\t: true;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param id\r\n\t */\r\n\tpublic hoverById(id?: string) {\r\n\t\tconst model = this.model;\r\n\t\tif (!model) return;\r\n\r\n\t\tif (id) {\r\n\t\t\tconst element = model.getById(id);\r\n\t\t\tif (element) {\r\n\t\t\t\tmodel.getDatas().forEach((data: Element) => {\r\n\t\t\t\t\tdata.hovered = false;\r\n\t\t\t\t});\r\n\t\t\t\telement.hovered = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tmodel.getDatas().forEach((data: Element) => {\r\n\t\t\t\tdata.hovered = false;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param id\r\n\t */\r\n\tpublic selectById(id: string) {\r\n\t\tconst model = this.model;\r\n\t\tif (!model) return;\r\n\t\tconst sm = this.pixiRenderer.selectionModel;\r\n\t\tconst element = model.getById(id);\r\n\t\tif (element) {\r\n\t\t\tsm?.clearSelection();\r\n\t\t\tsm?.setSelection(element);\r\n\t\t\telement.selected = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param type {string} manual auto \r\n\t * @param callback {function} \r\n\t */\r\n\tsave(type: string = \"manual\", callback?: (res: any) => {}) { }\r\n\r\n\t/**\r\n\t * dispose\r\n\t */\r\n\tpublic dispose() {\r\n\t\tconsole.log(\"application dispose\");\r\n\t\tthis._controlPane?.dispose();\r\n\t}\r\n\r\n\t/**\r\n\t * init scene\r\n\t * @returns\r\n\t */\r\n\tpublic initScene() {\r\n\t\tif (!this.pixiRenderer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst graphics = this.graphics || new Graphics();\r\n\r\n\t\t// Rectangle\r\n\t\tgraphics.beginFill(0xde3249);\r\n\t\tgraphics.drawRect(50, 50, 100, 100);\r\n\t\tgraphics.endFill();\r\n\r\n\t\t// Rectangle + line style 1\r\n\t\tgraphics.lineStyle(2, 0xfeeb77, 1);\r\n\t\tgraphics.beginFill(0x650a5a);\r\n\t\tgraphics.drawRect(200, 50, 100, 100);\r\n\t\tgraphics.endFill();\r\n\r\n\t\t// Rectangle + line style 2\r\n\t\tgraphics.lineStyle(10, 0xffbd01, 1);\r\n\t\tgraphics.beginFill(0xc34288);\r\n\t\tgraphics.drawRect(350, 50, 100, 100);\r\n\t\tgraphics.endFill();\r\n\r\n\t\t// Rectangle 2\r\n\t\tgraphics.lineStyle(2, 0xffffff, 1);\r\n\t\tgraphics.beginFill(0xaa4f08);\r\n\t\tgraphics.drawRect(530, 50, 140, 100);\r\n\t\tgraphics.endFill();\r\n\r\n\t\t// Circle\r\n\t\tgraphics.lineStyle(0); // draw a circle, set the lineStyle to zero so the circle doesn't have an outline\r\n\t\tgraphics.beginFill(0xde3249, 1);\r\n\t\tgraphics.drawCircle(100, 250, 50);\r\n\t\tgraphics.endFill();\r\n\r\n\t\t// Circle + line style 1\r\n\t\tgraphics.lineStyle(2, 0xfeeb77, 1);\r\n\t\tgraphics.beginFill(0x650a5a, 1);\r\n\t\tgraphics.drawCircle(250, 250, 50);\r\n\t\tgraphics.endFill();\r\n\r\n\t\t// Circle + line style 2\r\n\t\tgraphics.lineStyle(10, 0xffbd01, 1);\r\n\t\tgraphics.beginFill(0xc34288, 1);\r\n\t\tgraphics.drawCircle(400, 250, 50);\r\n\t\tgraphics.endFill();\r\n\r\n\t\t// Ellipse + line style 2\r\n\t\tgraphics.lineStyle(2, 0xffffff, 1);\r\n\t\tgraphics.beginFill(0xaa4f08, 1);\r\n\t\tgraphics.drawEllipse(600, 250, 80, 50);\r\n\t\tgraphics.endFill();\r\n\r\n\t\t// draw a shape\r\n\t\tgraphics.beginFill(0xff3300);\r\n\t\tgraphics.lineStyle(4, 0xffd900, 1);\r\n\t\tgraphics.moveTo(50, 350);\r\n\t\tgraphics.lineTo(250, 350);\r\n\t\tgraphics.lineTo(100, 400);\r\n\t\tgraphics.lineTo(50, 350);\r\n\t\tgraphics.closePath();\r\n\t\tgraphics.endFill();\r\n\r\n\t\t// draw a rounded rectangle\r\n\t\tgraphics.lineStyle(2, 0xff00ff, 1);\r\n\t\tgraphics.beginFill(0x650a5a, 0.25);\r\n\t\tgraphics.drawRoundedRect(50, 440, 100, 100, 16);\r\n\t\tgraphics.endFill();\r\n\r\n\t\t// draw polygon\r\n\t\tconst path = [600, 370, 700, 460, 780, 420, 730, 570, 590, 520];\r\n\r\n\t\tgraphics.lineStyle(0);\r\n\t\tgraphics.beginFill(0x3500fa, 1);\r\n\t\tgraphics.drawPolygon(path);\r\n\t\tgraphics.endFill();\r\n\r\n\t\tthis.pixiRenderer.viewport?.addChild(graphics);\r\n\t}\r\n\r\n\tpublic clearScene() {\r\n\t\tconst viewport = this.pixiRenderer.viewport;\r\n\t\tif (!this.pixiRenderer || !viewport) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.graphics?.clear();\r\n\t}\r\n}\r\n","import { EventEmitter } from 'eventemitter3';\r\nimport { EventsSelection } from './events';\r\nimport { ISelection } from './interfaces';\r\nimport { Model } from './model';\r\nimport { TType } from './types';\r\n\r\nexport interface SelectionProps<S extends TType> {\r\n\tmodel: Model<S>;\r\n}\r\n\r\n/**\r\n * \r\n * Model\r\n * \t--Model\r\n */\r\nexport class SelectionModel<S extends TType> extends EventEmitter implements ISelection<S> {\r\n\t_model: Model<S>;\r\n\t_pros?: SelectionProps<S>;\r\n\t_datas: S[] = [];\r\n\t_datasMap: Map<string, S> = new Map();\r\n\t_selectionMode: string = 'single';\r\n\t_filterFunction: (() => {}) | undefined;\r\n\r\n\tpublic constructor(pros?: SelectionProps<S>) {\r\n\t\tsuper();\r\n\t\tthis._pros = pros;\r\n\t\tthis._model = pros?.model || new Model<S>();\r\n\t}\r\n\t/**\r\n\t * \r\n\t * @param data\r\n\t * @returns\r\n\t */\r\n\tcontains(data: S): boolean {\r\n\t\tif (!data) return false;\r\n\t\treturn !!this._datasMap.get(data._id);\r\n\t}\r\n\r\n\t/**\r\n\t * add data to datas\r\n\t * @param data\r\n\t * @returns\r\n\t */\r\n\tadd(data: S) {\r\n\t\tconst datas = this._datas,\r\n\t\t\tdatasMap = this._datasMap;\r\n\t\tif (this.contains(data)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tconst old: Array<S> = [];\r\n\t\tObject.assign(old, datas);\r\n\t\tdatas.push(data);\r\n\t\tdatasMap.set(data._id, data);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * remove data from datas\r\n\t * @param data\r\n\t * @returns\r\n\t */\r\n\tremove(data: S) {\r\n\t\tif (!data) return this;\r\n\t\tconst datas = this._datas,\r\n\t\t\tindex = datas.indexOf(data);\r\n\t\tif (index >= 0) {\r\n\t\t\tdatas.splice(index, 1);\r\n\t\t\tthis._datasMap.delete(data._id);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * get by index\r\n\t * @param id\r\n\t * @returns\r\n\t */\r\n\tget(index: number): S | undefined {\r\n\t\treturn this._datas[index];\r\n\t}\r\n\r\n\t/**\r\n\t * get S By Id\r\n\t * @param id\r\n\t * @returns\r\n\t */\r\n\tgetById(id: string): S | undefined {\r\n\t\treturn this._datasMap.get(id);\r\n\t}\r\n\r\n\t/**\r\n\t * clear\r\n\t * @returns\r\n\t */\r\n\tclear() {\r\n\t\tconst old = this._datas;\r\n\t\tif (this._datas.length === 0) return;\r\n\t\tthis._datas = [];\r\n\t\tthis._datasMap.clear();\r\n\t\tthis.emit(EventsSelection.Change, {\r\n\t\t\tsource: this,\r\n\t\t\ttype: EventsSelection.ClearSelection,\r\n\t\t\toldValue: old\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * get datas array\r\n\t * @returns\r\n\t */\r\n\tgetDatas(): S[] {\r\n\t\treturn this._datas;\r\n\t}\r\n\r\n\t/**\r\n\t * get datas map\r\n\t * @returns\r\n\t */\r\n\tgetDatasMap(): Map<string, S> {\r\n\t\treturn this._datasMap;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param data {S[]} \r\n\t * @returns\r\n\t */\r\n\tbatchAdd(data: S[]) {\r\n\t\tconst datas = this._datas,\r\n\t\t\tdatasMap = this._datasMap;\r\n\t\tconst old: S[] = [];\r\n\t\tObject.assign(old, datas);\r\n\t\tdata.forEach((d: S) => {\r\n\t\t\tif (this.contains(d)) {\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\tdatas.push(d);\r\n\t\t\tdatasMap.set(d._id, d);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetSelectionMode(): string {\r\n\t\treturn this._selectionMode;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param data\r\n\t */\r\n\tappendSelection(data: S | S[]) {\r\n\t\tif (!data) return;\r\n\t\tif (data instanceof Array) {\r\n\t\t\tthis.batchAdd(data);\r\n\t\t} else {\r\n\t\t\tthis.add(data);\r\n\t\t}\r\n\t\tthis.emit(EventsSelection.Change, {\r\n\t\t\tsource: this,\r\n\t\t\ttype: EventsSelection.AppendSelection\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param data\r\n\t */\r\n\tremoveSelection(data: S | S[]) {\r\n\t\tif (!data) return;\r\n\t\tif (data instanceof Array) {\r\n\t\t\tdata.forEach((d: S) => {\r\n\t\t\t\tthis.remove(d);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.remove(data);\r\n\t\t}\r\n\t\tthis.emit(EventsSelection.Change, {\r\n\t\t\tsource: this,\r\n\t\t\ttype: EventsSelection.RemoveSelection\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @returns\r\n\t */\r\n\tgetSelection(): S[] {\r\n\t\treturn this._datas;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param data\r\n\t */\r\n\tsetSelection(data: S | S[]) {\r\n\t\tconst oldSelection = this._datas;\r\n\t\tthis.clear();\r\n\t\tif (!data) return;\r\n\t\tif (data instanceof Array) {\r\n\t\t\tthis.batchAdd(data);\r\n\t\t} else {\r\n\t\t\tthis.add(data);\r\n\t\t}\r\n\t\tthis.emit(EventsSelection.Change, {\r\n\t\t\tsource: this,\r\n\t\t\ttype: EventsSelection.SetSelection,\r\n\t\t\toldValue: oldSelection,\r\n\t\t\tnewValue: data\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tclearSelection() {\r\n\t\tthis.clear();\r\n\t\tthis.emit(EventsSelection.Change, {\r\n\t\t\tsource: this,\r\n\t\t\ttype: EventsSelection.ClearSelection\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * select all\r\n\t */\r\n\tselectAll() {\r\n\t\tthis.emit(EventsSelection.SelectionAll, {\r\n\t\t\tsource: this,\r\n\t\t\tdata: this._datas\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @returns\r\n\t */\r\n\tsize(): number {\r\n\t\treturn this._datas.length;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @returns\r\n\t */\r\n\tgetLastData(): S | undefined {\r\n\t\treturn this._datas[this._datas.length - 1];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @returns\r\n\t */\r\n\tgetFirstData(): S | undefined {\r\n\t\treturn this._datas[0];\r\n\t}\r\n}\r\n","import EventEmitter from \"eventemitter3\";\r\nimport { Viewport } from \"pixi-viewport\";\r\nimport { Application, DisplayObject, Rectangle } from \"pixi.js\";\r\nimport * as Stats from \"stats.js\";\r\nimport {\r\n\tModel,\r\n\tEventsModel,\r\n\tSelectionModel,\r\n\tEventsSelection,\r\n} from \"@blood4/models\";\r\n\r\nimport { Element, Node, Events, ElementType, SHAPE } from \"@blood4/modeling\";\r\nimport {\r\n\tUI,\r\n\tNodeUI,\r\n\tLineUI,\r\n\tShapeUI,\r\n\tEdgeUI,\r\n\tShapeLineUI,\r\n\tGroupUI,\r\n} from \"./ui\";\r\nimport { Grid, GridStyle, Guide, RefLine } from \"./components\";\r\nimport { InteractionManager, DefaultInteraction } from \"./interaction\";\r\nexport interface PixiRendererConfig {\r\n\tcanvas?: HTMLCanvasElement;\r\n\tstats?: Stats;\r\n}\r\n\r\nexport interface Grid2DDescriptor {\r\n\tcanvas: HTMLCanvasElement;\r\n}\r\n\r\n/**\r\n * PixiRenderer\r\n */\r\nexport class PixiRenderer<M extends Model<Element>> extends Application {\r\n\tprivate _config: PixiRendererConfig;\r\n\tprivate _canvas?: HTMLCanvasElement;\r\n\tprivate _viewrect?: Rectangle = new Rectangle();\r\n\tprivate _enabled?: boolean = true;\r\n\tprivate _stats?: Stats;\r\n\tprivate _model?: M;\r\n\tprivate _uis: Map<string, UI> = new Map();\r\n\teventEmitter: EventEmitter = new EventEmitter();\r\n\tinteractionManager: InteractionManager;\r\n\tviewport?: Viewport;\r\n\tselectionModel?: SelectionModel<Element>;\r\n\tgrid?: Grid;\r\n\tguide: Guide;\r\n\trefline: RefLine;\r\n\t_timeout: NodeJS.Timeout | null = null;\r\n\r\n\tconstructor(config: PixiRendererConfig) {\r\n\t\tsuper({\r\n\t\t\twidth: config.canvas?.clientWidth || 0,\r\n\t\t\theight: config.canvas?.clientHeight || 0,\r\n\t\t\tresolution: window.devicePixelRatio || 2,\r\n\t\t\tantialias: true,\r\n\t\t\tbackgroundAlpha: 1.0,\r\n\t\t\tview: config.canvas as HTMLCanvasElement,\r\n\t\t\tresizeTo: window,\r\n\t\t});\r\n\t\tthis._config = config || {};\r\n\t\tthis._canvas = config.canvas || document.createElement(\"canvas\");\r\n\t\tconst canvas = this._canvas;\r\n\t\tconst rect = canvas.getBoundingClientRect();\r\n\r\n\t\tthis.renderer.backgroundColor = 0xffffff;\r\n\t\tthis.renderer.resize(rect.width, rect.height);\r\n\r\n\t\tconst viewport = new Viewport({\r\n\t\t\tscreenWidth: rect.width,\r\n\t\t\tscreenHeight: rect.height,\r\n\t\t\tworldWidth: rect.width,\r\n\t\t\tworldHeight: rect.height,\r\n\t\t\tinteraction: this.renderer.plugins.interaction,\r\n\t\t\tdisableOnContextMenu: true,\r\n\t\t});\r\n\t\tthis.stage.addChild(viewport);\r\n\t\t/* const shadowFilter = new DropShadowFilter({\r\n\t\t\trotation: 0,\r\n\t\t\tdistance: 0,\r\n\t\t\tcolor: 0xff0000,\r\n\t\t\talpha: 1.0,\r\n\t\t\tshadowOnly: false,\r\n\t\t\tblur: 2,\r\n\t\t\tquality: 7\r\n\t\t});\r\n\t\tviewport.filters = [shadowFilter]; */\r\n\t\tthis.viewport = viewport;\r\n\t\tviewport.sortableChildren = true;\r\n\t\tviewport.children.sort((a: DisplayObject, b: DisplayObject) => {\r\n\t\t\ta.zIndex = a.zIndex || 0;\r\n\t\t\tb.zIndex = b.zIndex || 0;\r\n\t\t\treturn b.zIndex - a.zIndex;\r\n\t\t});\r\n\t\tthis._viewrect = new Rectangle(rect.x, rect.y, rect.width, rect.height);\r\n\t\tthis.selectionModel = new SelectionModel();\r\n\t\tthis.selectionModel.on(EventsSelection.ClearSelection, (e: any) => {\r\n\t\t\tconst { oldValue } = e;\r\n\t\t\tif (oldValue) {\r\n\t\t\t\toldValue.forEach((old: Element) => {\r\n\t\t\t\t\told.selected = false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.selectionModel.on(EventsSelection.Change, (e: any) => {\r\n\t\t\tthis.handleSelectionChange(e);\r\n\t\t});\r\n\t\tthis.interactionManager = new InteractionManager(this);\r\n\r\n\t\tconst grid = new Grid({\r\n\t\t\tgraphWidth: 2000,\r\n\t\t\tgraphHeight: 2000,\r\n\t\t});\r\n\t\tgrid.set(GridStyle.dark());\r\n\r\n\t\tthis.grid = grid;\r\n\t\tgrid.visible = false;\r\n\t\tviewport.addChild(grid);\r\n\t\tthis.guide = new Guide();\r\n\t\tviewport.addChild(this.guide);\r\n\t\tthis.refline = new RefLine();\r\n\t\tviewport.addChild(this.refline);\r\n\t\tthis.stopTimer();\r\n\t\tthis.startTimer();\r\n\t}\r\n\r\n\t/**\r\n\t * render loop\r\n\t * @returns\r\n\t */\r\n\tpublic render(): void {\r\n\t\tif (!this._enabled) return;\r\n\t\tconst stats = this._stats;\r\n\t\tstats && stats.update();\r\n\t\tsuper.render();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param v\r\n\t */\r\n\tpublic enable(v = false): void {\r\n\t\tif (!this._canvas) return;\r\n\t\tif (v) {\r\n\t\t\tthis._canvas.style.display = \"block\";\r\n\t\t} else {\r\n\t\t\tthis._canvas.style.display = \"none\";\r\n\t\t}\r\n\t\tthis._enabled = v;\r\n\t}\r\n\r\n\t/**\r\n\t * set model\r\n\t */\r\n\tpublic set model(model: M | undefined) {\r\n\t\tif (!model) return;\r\n\t\tthis._model = model;\r\n\t\tthis._model.on(EventsModel.Add, (e: any) => {\r\n\t\t\tconst { source, data } = e;\r\n\t\t\tif (data) {\r\n\t\t\t\tthis._add(data);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._model.on(EventsModel.BatchAdd, (e: any) => {\r\n\t\t\tconst { source, data } = e;\r\n\t\t\tif (data && data instanceof Array) {\r\n\t\t\t\tdata.forEach((node: Node) => {\r\n\t\t\t\t\tthis._add(node);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._model.on(EventsModel.Remove, (e: any) => {\r\n\t\t\tconst { source, data } = e;\r\n\t\t\tif (data) {\r\n\t\t\t\tthis._remove(data);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._model.on(EventsModel.Clear, (e: any) => {\r\n\t\t\tthis._clear();\r\n\t\t});\r\n\t}\r\n\r\n\tpublic get model(): M | undefined {\r\n\t\treturn this._model;\r\n\t}\r\n\r\n\tprivate _add(node: Node) {\r\n\t\tif (!node) return;\r\n\t\t// node.on(Events.ChildrenChangeAdd, (e: any) => {\r\n\t\t// \tconst { oldValue, newValue } = e;\r\n\t\t// \tthis._model?.add(newValue);\r\n\t\t// });\r\n\t\t// node.on(Events.ChildrenChangeRemove, (e: any) => {\r\n\t\t// \tconst { oldValue, newValue } = e;\r\n\t\t// \tthis._model?.remove(newValue);\r\n\t\t// });\r\n\t\t// node.on(Events.ChildrenChangeClear, (e: any) => {\r\n\t\t// \tconst { oldValue, newValue } = e;\r\n\t\t// \tif (newValue) {\r\n\t\t// \t\tnewValue.forEach((child: Element) => {\r\n\t\t// \t\t\tthis._model?.remove(child);\r\n\t\t// \t\t});\r\n\t\t// \t}\r\n\t\t// });\r\n\t\tnode.on(Events.AttributeChange, (e: any) => {\r\n\t\t\tconst ui = this._uis.get(node._id);\r\n\t\t\tui?.update();\r\n\t\t\tthis.stopTimer(e);\r\n\t\t\tthis.startTimer(e);\r\n\t\t});\r\n\t\tnode.on(Events.StyleChange, (e: any) => {\r\n\t\t\tconst ui = this._uis.get(node._id);\r\n\t\t\tui?.update();\r\n\t\t});\r\n\t\tconst clazz = node.ui2d;\r\n\t\tif (clazz === \"NodeUI\") {\r\n\t\t\tif (!this._uis.get(node._id)) {\r\n\t\t\t\tconst ui = new NodeUI(node, this);\r\n\t\t\t\tthis._uis.set(node._id, ui);\r\n\t\t\t\tthis.viewport?.addChild(ui);\r\n\t\t\t}\r\n\t\t} else if (clazz === \"ShapeUI\") {\r\n\t\t\tif (!this._uis.get(node._id)) {\r\n\t\t\t\tconst ui = new ShapeUI(node, this);\r\n\t\t\t\tthis._uis.set(node._id, ui);\r\n\t\t\t\tthis.viewport?.addChild(ui);\r\n\t\t\t}\r\n\t\t} else if (clazz === \"GroupUI\") {\r\n\t\t\tif (!this._uis.get(node._id)) {\r\n\t\t\t\tconst ui = new GroupUI(node, this);\r\n\t\t\t\tthis._uis.set(node._id, ui);\r\n\t\t\t\tthis.viewport?.addChild(ui);\r\n\t\t\t}\r\n\t\t} else if (clazz === \"LineUI\") {\r\n\t\t\tif (!this._uis.get(node._id)) {\r\n\t\t\t\tconst ui = new LineUI(node, this);\r\n\t\t\t\tthis._uis.set(node._id, ui);\r\n\t\t\t\tthis.viewport?.addChild(ui);\r\n\t\t\t}\r\n\t\t} else if (clazz === \"ShapeLineUI\") {\r\n\t\t\tif (!this._uis.get(node._id)) {\r\n\t\t\t\tconst ui = new ShapeLineUI(node, this);\r\n\t\t\t\tthis._uis.set(node._id, ui);\r\n\t\t\t\tthis.viewport?.addChild(ui);\r\n\t\t\t}\r\n\t\t} else if (clazz === \"EdgeUI\") {\r\n\t\t\tif (!this._uis.get(node._id)) {\r\n\t\t\t\tconst ui = new EdgeUI(node, this);\r\n\t\t\t\tthis._uis.set(node._id, ui);\r\n\t\t\t\tthis.viewport?.addChild(ui);\r\n\t\t\t}\r\n\t\t} else if (clazz === \"DomainUI\") {\r\n\t\t} else if (clazz === \"DoorUI\") {\r\n\t\t} else {\r\n\t\t\tif (!this._uis.get(node._id)) {\r\n\t\t\t\tconst ui = new UI(node, this);\r\n\t\t\t\tthis._uis.set(node._id, ui);\r\n\t\t\t\tthis.viewport?.addChild(ui);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param node\r\n\t * @returns\r\n\t */\r\n\tprivate _remove(node: Node): void {\r\n\t\tif (!node) return;\r\n\t\tconst ui = this._uis.get(node._id);\r\n\t\tif (ui) {\r\n\t\t\tthis.viewport && this.viewport.removeChild(ui);\r\n\t\t\tthis._uis && this._uis.delete(node._id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * clear all ui datas\r\n\t */\r\n\tprivate _clear(): void {\r\n\t\tif (this._uis) {\r\n\t\t\tthis._uis.forEach((ui: UI) => {\r\n\t\t\t\tthis.viewport?.removeChild(ui);\r\n\t\t\t});\r\n\t\t\tthis._uis.clear();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @todo\r\n\t * @param rect\r\n\t */\r\n\tpublic zoomOverview(rect: Rectangle): void {\r\n\t\tif (!rect) return;\r\n\t\tconst w = rect?.width || 0;\r\n\t\tconst h = rect?.height || 0;\r\n\t\tif (this._viewrect && this.viewport) {\r\n\t\t\tconst ratio =\r\n\t\t\t\tMath.min(this._viewrect.width / w, this._viewrect.height / h) *\r\n\t\t\t\t0.75;\r\n\t\t\tthis.viewport.setTransform(\r\n\t\t\t\tthis._viewrect.x +\r\n\t\t\t\tthis._viewrect.width / 2 -\r\n\t\t\t\t(rect.x + rect.width / 2),\r\n\t\t\t\tthis._viewrect.y +\r\n\t\t\t\tthis._viewrect.height / 2 -\r\n\t\t\t\t56 -\r\n\t\t\t\t(rect.y + rect.height / 2),\r\n\t\t\t\t1,\r\n\t\t\t\t1,\r\n\t\t\t\t0,\r\n\t\t\t\t0,\r\n\t\t\t\t0,\r\n\t\t\t\t0,\r\n\t\t\t\t0\r\n\t\t\t);\r\n\t\t\tthis.viewport.setZoom(ratio, true);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic zoomIn() {\r\n\t\tif (!this.viewport) return;\r\n\t\tlet scale = this.viewport.scale;\r\n\t\tscale.x += 0.1;\r\n\t\tscale.y += 0.1;\r\n\t\tthis.viewport.setZoom(scale.x, true);\r\n\t}\r\n\r\n\tpublic zoomOut() {\r\n\t\tif (!this.viewport) return;\r\n\t\tlet scale = this.viewport.scale;\r\n\t\tif (scale.x - 0.1 < 0) return;\r\n\t\tscale.x -= 0.1;\r\n\t\tscale.y -= 0.1;\r\n\r\n\t\tthis.viewport.setZoom(scale.x, true);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tprivate handleSelectionChange(e: any) {\r\n\t\tconst { oldValue } = e;\r\n\t\tif (oldValue) {\r\n\t\t\toldValue.forEach((old: Element) => {\r\n\t\t\t\told.selected = false;\r\n\t\t\t});\r\n\t\t}\r\n\t\tconst sm = this.selectionModel;\r\n\t\tif (!sm) return;\r\n\t\tconst datas = sm.getSelection();\r\n\t\tdatas.forEach((data: Element) => {\r\n\t\t\tdata.selected = true;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param dx\r\n\t * @param dy\r\n\t */\r\n\tmoveUI(ui: UI, dx: number, dy: number) {\r\n\t\tconst element = ui._element;\r\n\t\tif (!ui || !element) return;\r\n\t\telement.translation(dx, dy);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param dx\r\n\t * @param dy\r\n\t */\r\n\tmoveSelectedElements(dx: number, dy: number) {\r\n\t\tconst sm = this.selectionModel;\r\n\t\tif (!sm) return;\r\n\t\tconst elements = sm.getSelection();\r\n\t\telements.forEach((element: Element) => {\r\n\t\t\tif (this.isMovable(element)) {\r\n\t\t\t\telement.translation(dx, dy);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tisMovable(element: Element) {\r\n\t\treturn element.movable;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param element\r\n\t * @returns\r\n\t * @todo \r\n\t */\r\n\tisEditable(element: Element) {\r\n\t\tconst points = element.points;\r\n\t\tconst mode = element.mode;\r\n\t\tif (element.type === SHAPE.Domain) {\r\n\t\t\tconst currentInteraction =\r\n\t\t\t\tthis.interactionManager.getCurrentInteraction();\r\n\t\t\tif (currentInteraction instanceof DefaultInteraction) {\r\n\t\t\t\tif (currentInteraction._shiftDown) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (mode === ElementType.Show) {\r\n\t\t\t\tif (points.length !== 4) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst d02 =\r\n\t\t\t\t\t\t(points[0][0] - points[2][0]) *\r\n\t\t\t\t\t\t(points[0][0] - points[2][0]) +\r\n\t\t\t\t\t\t(points[0][1] - points[2][1]) *\r\n\t\t\t\t\t\t(points[0][1] - points[2][1]);\r\n\t\t\t\t\tconst d13 =\r\n\t\t\t\t\t\t(points[1][0] - points[3][0]) *\r\n\t\t\t\t\t\t(points[1][0] - points[3][0]) +\r\n\t\t\t\t\t\t(points[1][1] - points[3][1]) *\r\n\t\t\t\t\t\t(points[1][1] - points[3][1]);\r\n\t\t\t\t\treturn Math.abs(d02 - d13) < 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tsetGridVisible(v: boolean) {\r\n\t\tif (this.grid) {\r\n\t\t\tthis.grid.visible = v;\r\n\t\t} else {\r\n\t\t\tthis.grid = new Grid();\r\n\t\t\tthis.viewport?.addChild(this.grid);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param v\r\n\t * @returns\r\n\t */\r\n\tsetGridStyle(v: string) {\r\n\t\tif (!this.grid) return;\r\n\t\tif (this.grid instanceof Grid) {\r\n\t\t\tswitch (v) {\r\n\t\t\t\tcase \"dark\":\r\n\t\t\t\t\tthis.grid.set(GridStyle.dark());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"blueprint\":\r\n\t\t\t\t\tthis.grid.set(GridStyle.blueprint());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"engineering\":\r\n\t\t\t\t\tthis.grid.set(GridStyle.engineering());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"quad\":\r\n\t\t\t\t\tthis.grid.set(GridStyle.quad());\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsetEditable(v: boolean) {\r\n\t\t// this.interactionManager.setInteractions(['default', 'edit']);\r\n\t\tthis.interactionManager.setInteractions([\"edit\"]);\r\n\t}\r\n\r\n\t/**\r\n\t * get all uis\r\n\t */\r\n\tpublic get uis(): Map<string, UI> {\r\n\t\treturn this._uis;\r\n\t}\r\n\r\n\t/**\r\n\t * change elements Layer\r\n\t * @param element {Element}\r\n\t */\r\n\tpublic changeLayer(elements: Element[] | Element, zIndex: number) {\r\n\t\tif (!elements) return;\r\n\t\tif (elements instanceof Array) {\r\n\t\t\telements.forEach((element: Element) => {\r\n\t\t\t\telement.styles.zIndex = zIndex;\r\n\t\t\t});\r\n\t\t} else if (elements instanceof Element) {\r\n\t\t\telements.styles.zIndex = zIndex;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns\r\n\t */\r\n\tgetScaled(): number {\r\n\t\treturn this.viewport?.scaled || 1.0;\r\n\t}\r\n\r\n\tinvalidatElementUI(element: Element) {\r\n\t\tif (!element) return;\r\n\t\tconst ui = this._uis.get(element.id);\r\n\t\tif (ui) {\r\n\t\t\tui._invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\tselectElements(elements: Element | Element[]) { }\r\n\tunSelectElements(elements: Element | Element[]) {\r\n\t\tif (!elements) return;\r\n\t\tif (elements instanceof Array) {\r\n\t\t\telements.forEach((element: Element) => {\r\n\t\t\t\tconst ui = this._uis.get(element.id);\r\n\t\t\t\tif (ui) {\r\n\t\t\t\t\tui._invalidate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconst ui = this._uis.get(elements.id);\r\n\t\t\tif (ui) {\r\n\t\t\t\tui._invalidate();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic startTimer(e?: any) {\r\n\t\tthis._timeout = setTimeout(() => {\r\n\t\t\tif (this.eventEmitter) {\r\n\t\t\t\tthis.eventEmitter.emit(Events.UnDirty, {\r\n\t\t\t\t\tsource: this,\r\n\t\t\t\t\ttarget: e,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}, 5 * 60 * 1000);\r\n\t}\r\n\tpublic pauseTimer(e?: any) {\r\n\t\tif (this._timeout) {\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t}\r\n\t}\r\n\tpublic resumeTimer(e?: any) {\r\n\t\tif (this._timeout) {\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t}\r\n\t\tthis.startTimer();\r\n\t}\r\n\tpublic stopTimer(e?: any) {\r\n\t\tif (this._timeout) {\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t\tif (this.eventEmitter) {\r\n\t\t\t\tthis.eventEmitter.emit(Events.Dirty, {\r\n\t\t\t\t\tsource: this,\r\n\t\t\t\t\ttarget: e,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * exportImage\r\n\t */\r\n\tpublic exportImage(callback: (result: any) => void, download = false) {\r\n\t\tconst viewport = this.viewport;\r\n\t\tif (!viewport) return;\r\n\t\tif (this.renderer) {\r\n\t\t\tthis.renderer.plugins.extract.canvas(viewport).toBlob((b: any) => {\r\n\t\t\t\tlet a = new FileReader();\r\n\t\t\t\ta.onload = (e: any) => {\r\n\t\t\t\t\tcallback && callback(e.target.result);\r\n\t\t\t\t};\r\n\t\t\t\ta.readAsDataURL(b);\r\n\t\t\t\tif (download) {\r\n\t\t\t\t\tconst a = document.createElement(\"a\");\r\n\t\t\t\t\tdocument.body.append(a);\r\n\t\t\t\t\ta.download = \"bubble.png\";\r\n\t\t\t\t\ta.href = URL.createObjectURL(b);\r\n\t\t\t\t\ta.click();\r\n\t\t\t\t\ta.remove();\r\n\t\t\t\t}\r\n\t\t\t}, \"image/png\");\r\n\t\t}\r\n\t}\r\n\r\n\tgetUIById(id: string): UI | undefined {\r\n\t\treturn this._uis.get(id);\r\n\t}\r\n}\r\n","import { Edge, Element, FillType, Node, Vertex } from \"@blood4/modeling\";\r\nimport { PixiRenderer } from \"@blood4/renderer-pixi\";\r\nimport { EventsSelection, Model } from \"@blood4/models\";\r\nimport { Pane } from \"tweakpane\";\r\nimport anime from \"animejs\";\r\nimport Application from \"@components/renderer/application\";\r\n\r\nexport interface IControlPane {\r\n\ttitle?: string;\r\n\tshow?: boolean;\r\n\tmodel?: Model<Element>;\r\n\trenderer?: PixiRenderer<any>;\r\n\tapp?: Application;\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport default class ControlPane {\r\n\tprivate _pane: Pane = new Pane({\r\n\t\ttitle: \"Control Pane\",\r\n\t});\r\n\tprivate _tabs: any;\r\n\tprivate _config: IControlPane;\r\n\tprivate _model?: Model<any>;\r\n\tprivate _renderer?: PixiRenderer<any>;\r\n\tprivate _anime: any;\r\n\tprivate _app?: Application;\r\n\r\n\tconstructor(config?: Partial<IControlPane>) {\r\n\t\tthis._config = {\r\n\t\t\tshow: true,\r\n\t\t\t...config,\r\n\t\t};\r\n\t\tif (!this._pane) {\r\n\t\t\tthis._pane = new Pane({\r\n\t\t\t\ttitle: \"Control Pane\",\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (this._pane.element.parentElement) {\r\n\t\t\tthis._pane.element.parentElement.style.top = \"0px\";\r\n\t\t\tthis._pane.element.parentElement.style.right = \"0px\";\r\n\t\t\tthis._pane.element.parentElement.style.zIndex = \"99999\";\r\n\t\t}\r\n\t\tconst pane = this._pane;\r\n\t\tpane.title = config?.title ? `${config?.title}` : \"Control Pane\";\r\n\t\tthis._model = config?.model;\r\n\t\tthis._app = config?.app;\r\n\r\n\t\tthis._renderer = config?.renderer;\r\n\t\tpane.expanded = true;\r\n\r\n\t\tconst tabs = pane.addTab({\r\n\t\t\tpages: [\r\n\t\t\t\t{ title: \"Dev\" },\r\n\t\t\t\t{ title: \"Model\" },\r\n\t\t\t\t{ title: \"Render\" },\r\n\t\t\t\t{ title: \"Element\" },\r\n\t\t\t],\r\n\t\t});\r\n\t\tthis._tabs = tabs;\r\n\t\tthis._initToolPane();\r\n\t\tthis._initModelPane();\r\n\t}\r\n\r\n\tpublic set model(v: Model<any>) {\r\n\t\tthis._model = v;\r\n\t}\r\n\r\n\t/**\r\n\t * visible control pane\r\n\t * @param v\r\n\t */\r\n\tpublic set visible(v: boolean) {\r\n\t\tthis._pane.hidden = !v;\r\n\t}\r\n\r\n\t/**\r\n\t * dispose\r\n\t */\r\n\tpublic dispose() {\r\n\t\tthis._pane.dispose();\r\n\t}\r\n\r\n\tpublic set renderer(render: PixiRenderer<any>) {\r\n\t\tif (!render) return;\r\n\t\tthis._renderer = render;\r\n\t\tthis._initRenderPane();\r\n\t}\r\n\r\n\tprivate _initToolPane() {\r\n\t\tconst tabs = this._tabs;\r\n\t\tif (!tabs) return;\r\n\t\tconst tab1 = tabs.pages[0];\r\n\t\tconst fdev = tab1.addFolder({\r\n\t\t\ttitle: \"Dev\",\r\n\t\t});\r\n\t\tfdev.expanded = true;\r\n\t\tfdev.addButton({\r\n\t\t\ttitle: \"Add\",\r\n\t\t\tlabel: \"Scene\",\r\n\t\t\tdisabled: false,\r\n\t\t}).on(\"click\", (e: any) => {\r\n\t\t\tthis._app?.initScene();\r\n\t\t});\r\n\t\tfdev.addButton({\r\n\t\t\ttitle: \"Clear\",\r\n\t\t\tlabel: \"Scene\",\r\n\t\t\tdisabled: false,\r\n\t\t}).on(\"click\", (e: any) => {\r\n\t\t\tthis._app?.clearScene();\r\n\t\t});\r\n\r\n\t\tconst ftoolbar = tab1.addFolder({\r\n\t\t\ttitle: \"Tools\",\r\n\t\t});\r\n\t\tftoolbar.expanded = true;\r\n\r\n\t\tftoolbar\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Delete\",\r\n\t\t\t\tlabel: \"\",\r\n\t\t\t\tdisabled: false,\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\tconst sm = this._renderer?.selectionModel;\r\n\t\t\t\tconst model = this._model;\r\n\t\t\t\tif (sm && model) {\r\n\t\t\t\t\tconst datas = sm.getSelection();\r\n\t\t\t\t\tmodel.remove(datas);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\tftoolbar\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Undo\",\r\n\t\t\t\tlabel: \"\",\r\n\t\t\t\tdisabled: true,\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\t\tftoolbar\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Redo\",\r\n\t\t\t\tlabel: \"\",\r\n\t\t\t\tdisabled: true,\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\t\tftoolbar\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"\",\r\n\t\t\t\tlabel: \"\",\r\n\t\t\t\tdisabled: false,\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\r\n\t\tconst fapis = tab1.addFolder({\r\n\t\t\ttitle: \"\",\r\n\t\t});\r\n\t\tfapis.expanded = true;\r\n\t\tfapis\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"\",\r\n\t\t\t\tdisabled: false,\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\t\tfapis\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"\",\r\n\t\t\t\tdisabled: false,\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\t\tfapis\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Mock\",\r\n\t\t\t\tdisabled: false,\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\tfetch(\"/api/data\", { method: \"POST\" }).then((res) => {\r\n\t\t\t\t\tres.json().then((response) => {\r\n\t\t\t\t\t\tconsole.log(\"Success data:\", response);\r\n\t\t\t\t\t\tconst model = this._app?.model;\r\n\t\t\t\t\t\tif (!model) return;\r\n\t\t\t\t\t\tconst datas = response.data;\r\n\t\t\t\t\t\tconst vertices: Vertex[] = [];\r\n\t\t\t\t\t\tdatas.nodes.forEach((node: any, index: number) => {\r\n\t\t\t\t\t\t\tif (index > 1000) return;\r\n\t\t\t\t\t\t\tconst v0 = new Vertex({\r\n\t\t\t\t\t\t\t\tid: node.id,\r\n\t\t\t\t\t\t\t\tname: node.id,\r\n\t\t\t\t\t\t\t\tx: node.x,\r\n\t\t\t\t\t\t\t\ty: node.y,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tvertices.push(v0);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tmodel.batchAdd(vertices);\r\n\r\n\t\t\t\t\t\tconst edges: Edge[] = [];\r\n\t\t\t\t\t\tdatas.edges.forEach((edge: any, index: number) => {\r\n\t\t\t\t\t\t\tif (index > 1000) return;\r\n\t\t\t\t\t\t\tconst source = model.getById(edge.source);\r\n\t\t\t\t\t\t\tconst target = model.getById(edge.target);\r\n\t\t\t\t\t\t\tif (source && target) {\r\n\t\t\t\t\t\t\t\tedges.push(\r\n\t\t\t\t\t\t\t\t\tnew Edge({\r\n\t\t\t\t\t\t\t\t\t\tfrom: source as Vertex,\r\n\t\t\t\t\t\t\t\t\t\tto: target as Vertex,\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tmodel.batchAdd(edges);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * init model pane\r\n\t * @returns\r\n\t */\r\n\tprivate _initModelPane() {\r\n\t\tconst tabs = this._tabs;\r\n\t\tif (!tabs) return;\r\n\t\tconst tab1 = tabs.pages[1];\r\n\r\n\t\tconst fmodels = tab1.addFolder({\r\n\t\t\ttitle: \"\",\r\n\t\t});\r\n\t\tfmodels\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Add\",\r\n\t\t\t\tlabel: \"\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\tconst count = 10;\r\n\t\t\t\tconsole.log(`add ${count} data into model`);\r\n\t\t\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\t\t\tconst node = new Node({\r\n\t\t\t\t\t\tname: `Random${i}`,\r\n\t\t\t\t\t\tx: Math.random() * 1920,\r\n\t\t\t\t\t\ty: Math.random() * 600,\r\n\t\t\t\t\t\twidth: Math.random() * 100,\r\n\t\t\t\t\t\theight: Math.random() * 100,\r\n\t\t\t\t\t\tangle: 0,\r\n\t\t\t\t\t\tdebug: false,\r\n\t\t\t\t\t\tclients: {\r\n\t\t\t\t\t\t\teasing: \"linear\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis._model?.add(node);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\tfmodels\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Batch Add\",\r\n\t\t\t\tlabel: \"\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\tconst count = 10;\r\n\t\t\t\tconst datas: any[] = [];\r\n\t\t\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\t\t\tconst node = new Node({\r\n\t\t\t\t\t\tname: `Random${i}`,\r\n\t\t\t\t\t\tx: Math.random() * 1920,\r\n\t\t\t\t\t\ty: Math.random() * 600,\r\n\t\t\t\t\t\twidth: Math.random() * 100,\r\n\t\t\t\t\t\theight: Math.random() * 100,\r\n\t\t\t\t\t\tangle: 0,\r\n\t\t\t\t\t\tdebug: false,\r\n\t\t\t\t\t\tclients: {\r\n\t\t\t\t\t\t\teasing: \"linear\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t\tdatas.push(node);\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(`batch add ${datas.length} data into model`);\r\n\t\t\t\tthis._model?.batchAdd(datas);\r\n\t\t\t});\r\n\t\tfmodels\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Remove Select\",\r\n\t\t\t\tlabel: \"\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\tconst sm = this._renderer?.selectionModel;\r\n\t\t\t\tconst model = this._model;\r\n\t\t\t\tif (sm && model) {\r\n\t\t\t\t\tconst datas = sm.getSelection();\r\n\t\t\t\t\tmodel.remove(datas);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\tfmodels\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Clear\",\r\n\t\t\t\tlabel: \"\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\tthis._model?.clear();\r\n\t\t\t});\r\n\t\tfmodels\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Clear Domain\",\r\n\t\t\t\tlabel: \"\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\t\tfmodels\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Datas Count\",\r\n\t\t\t\tlabel: \"\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\talert(this._model?._datas.length);\r\n\t\t\t});\r\n\r\n\t\tfmodels\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Console All Datas Array\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\tconsole.log(this._model?.getDatas());\r\n\t\t\t});\r\n\r\n\t\tfmodels\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Console All Datas Map\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\tconsole.log(this._model?.getDatasMap());\r\n\t\t\t});\r\n\r\n\t\tfmodels\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Console Last Data\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\tconst length = this._model?.getDatas().length || 0;\r\n\t\t\t\tconsole.log(this._model?.get(length - 1));\r\n\t\t\t});\r\n\t\tfmodels\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Console Select Data\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\tconst sm = this._renderer?.selectionModel;\r\n\t\t\t\tconst model = this._model;\r\n\t\t\t\tif (sm && model) {\r\n\t\t\t\t\tconst datas = sm.getSelection();\r\n\t\t\t\t\tconsole.log(datas);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tconst fpropertys = tab1.addFolder({\r\n\t\t\ttitle: \"\",\r\n\t\t});\r\n\t\tfpropertys\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Console Property\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\t}\r\n\r\n\t/**\r\n\t * init renderer pane\r\n\t */\r\n\tprivate _initRenderPane() {\r\n\t\tconst render = this._renderer;\r\n\t\tif (!render) return;\r\n\t\trender.selectionModel?.on(EventsSelection.Change, (e) => {\r\n\t\t\t// console.log('', e);\r\n\t\t\tconst sm = render.selectionModel;\r\n\t\t\tconst select = sm?.getLastData();\r\n\t\t\tthis._initSelectPane(select);\r\n\t\t});\r\n\t\tconst PARAMS = {\r\n\t\t\tbackground: 0x616264,\r\n\t\t\tgrid: false,\r\n\t\t};\r\n\t\tconst tab1 = this._tabs.pages[2];\r\n\t\tconst frenderer_basic = tab1.addFolder({\r\n\t\t\ttitle: \"Basic\",\r\n\t\t});\r\n\t\tfrenderer_basic\r\n\t\t\t.addInput(PARAMS, \"background\", {\r\n\t\t\t\tview: \"color\",\r\n\t\t\t})\r\n\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\tconst { value } = e;\r\n\t\t\t\tif (this._renderer) {\r\n\t\t\t\t\tthis._renderer.renderer.backgroundColor = value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tfrenderer_basic\r\n\t\t\t.addBlade({\r\n\t\t\t\tview: \"list\",\r\n\t\t\t\tlabel: \"grid style\",\r\n\t\t\t\toptions: [\r\n\t\t\t\t\t{ text: \"dark\", value: \"dark\" },\r\n\t\t\t\t\t{ text: \"blueprint\", value: \"blueprint\" },\r\n\t\t\t\t\t{ text: \"engineering\", value: \"engineering\" },\r\n\t\t\t\t\t{ text: \"quad\", value: \"quad\" },\r\n\t\t\t\t],\r\n\t\t\t\tvalue: \"dark\",\r\n\t\t\t})\r\n\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\tconst { value } = e;\r\n\t\t\t\tif (this._renderer) {\r\n\t\t\t\t\tthis._renderer.setGridStyle(value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tfrenderer_basic.addInput(PARAMS, \"grid\", {}).on(\"change\", (e: any) => {\r\n\t\t\tconsole.log(e);\r\n\t\t\tthis._renderer?.setGridVisible(e.value);\r\n\t\t});\r\n\r\n\t\tconst frenderer_mode = tab1.addFolder({\r\n\t\t\ttitle: \"Mode\",\r\n\t\t});\r\n\r\n\t\t// frenderer_mode\r\n\t\t// \t.addBlade({\r\n\t\t// \t\tview: 'list',\r\n\t\t// \t\tlabel: 'Mode',\r\n\t\t// \t\toptions: [\r\n\t\t// \t\t\t{ text: 'edit', value: ElementType.Edit },\r\n\t\t// \t\t\t{ text: 'show', value: ElementType.Show }\r\n\t\t// \t\t],\r\n\t\t// \t\tvalue: ElementType.Show\r\n\t\t// \t})\r\n\t\t// \t.on('change', (e: any) => {\r\n\t\t// \t\tconst { value } = e;\r\n\t\t// \t\tthis._app.mode = value;\r\n\t\t// \t});\r\n\r\n\t\tconst frenderer_interaction = tab1.addFolder({\r\n\t\t\ttitle: \"Interactions\",\r\n\t\t});\r\n\t\tfrenderer_interaction\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Default\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\trender.interactionManager.setDefaultInteraction();\r\n\t\t\t});\r\n\r\n\t\tfrenderer_interaction\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Edit\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\trender.interactionManager.setEditInteraction();\r\n\t\t\t});\r\n\r\n\t\tfrenderer_interaction\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Default+Edit\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\trender.interactionManager.setInteractions([\"default\", \"edit\"]);\r\n\t\t\t});\r\n\r\n\t\tfrenderer_interaction\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Create Node\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\r\n\t\tfrenderer_interaction\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Create Node (Auto)\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\r\n\t\tfrenderer_interaction\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Create Shape\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\r\n\t\tfrenderer_interaction\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Create Line\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\r\n\t\tfrenderer_interaction\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"Create Shape Line\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\r\n\t\tconst frenderer_api = tab1.addFolder({\r\n\t\t\ttitle: \"API\",\r\n\t\t});\r\n\t\tfrenderer_api\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"ZoomOverview\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\r\n\t\tfrenderer_api\r\n\t\t\t.addButton({\r\n\t\t\t\ttitle: \"DownloadImage\",\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (e: any) => { });\r\n\t}\r\n\r\n\t/**\r\n\t * init select pane\r\n\t * @param select\r\n\t * @returns\r\n\t */\r\n\tprivate _initSelectPane(select: any) {\r\n\t\tconst render = this._renderer;\r\n\t\tif (!render) return;\r\n\t\tconst sm = render.selectionModel;\r\n\t\tconst tab3 = this._tabs.pages[3];\r\n\t\ttab3.children.forEach((child: any) => {\r\n\t\t\tchild.dispose();\r\n\t\t});\r\n\t\tif (select) {\r\n\t\t\tthis._pane.expanded = true;\r\n\t\t\tif (this._anime) {\r\n\t\t\t\tthis._anime.pause();\r\n\t\t\t}\r\n\t\t\tthis._anime = undefined;\r\n\t\t\t// tab3.selected = true;\r\n\t\t\tconst fattribute = tab3.addFolder({\r\n\t\t\t\ttitle: \"Attribute\",\r\n\t\t\t});\r\n\t\t\tfattribute.expanded = false;\r\n\t\t\tfattribute.addInput(select, \"_id\", {});\r\n\t\t\tfattribute.addInput(select, \"name\", {}).on(\"change\", (e: any) => {\r\n\t\t\t\tconst select = sm?.getLastData();\r\n\t\t\t\tif (select) {\r\n\t\t\t\t\tselect.name = e.value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tfattribute.addInput(select, \"name2\", {}).on(\"change\", (e: any) => {\r\n\t\t\t\tconst select = sm?.getLastData();\r\n\t\t\t\tif (select) {\r\n\t\t\t\t\tselect.name2 = e.value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tfattribute.addInput(select, \"x\", {});\r\n\t\t\tfattribute.addInput(select, \"y\", {});\r\n\t\t\tfattribute.addInput(select, \"width\", {});\r\n\t\t\tfattribute.addInput(select, \"height\", {});\r\n\r\n\t\t\tfattribute\r\n\t\t\t\t.addInput(select, \"visible\", {})\r\n\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\tconst select = sm?.getLastData();\r\n\t\t\t\t\tif (select) {\r\n\t\t\t\t\t\tselect.visible = e.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tfattribute\r\n\t\t\t\t.addInput(select, \"movable\", {})\r\n\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\tconst select = sm?.getLastData();\r\n\t\t\t\t\tif (select) {\r\n\t\t\t\t\t\tselect.movable = e.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t// fattribute\r\n\t\t\t// \t.addInput(select, 'angle', {\r\n\t\t\t// \t\tmin: -360,\r\n\t\t\t// \t\tmax: 360,\r\n\t\t\t// \t\tspeed: 1\r\n\t\t\t// \t})\r\n\t\t\t// \t.on('change', (e: any) => {\r\n\t\t\t// \t\tconst select = sm?.getLastData();\r\n\t\t\t// \t\tif (select) {\r\n\t\t\t// \t\t\tselect.angle = e.value;\r\n\t\t\t// \t\t}\r\n\t\t\t// \t});\r\n\t\t\tfattribute.addInput(select, \"debug\").on(\"change\", (e: any) => {\r\n\t\t\t\tconst select = sm?.getLastData();\r\n\t\t\t\tif (select) {\r\n\t\t\t\t\tselect.debug = e.value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tconst fstyle = tab3.addFolder({\r\n\t\t\t\ttitle: \"Style\",\r\n\t\t\t});\r\n\t\t\tfstyle.expanded = false;\r\n\t\t\tfstyle\r\n\t\t\t\t.addInput(select.styles, \"interactive\", {})\r\n\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\tconst select = sm?.getLastData();\r\n\t\t\t\t\tif (select) {\r\n\t\t\t\t\t\tselect.styles.interactive = e.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tfstyle\r\n\t\t\t\t.addInput(select.styles, \"buttonMode\", {})\r\n\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\tconst select = sm?.getLastData();\r\n\t\t\t\t\tif (select) {\r\n\t\t\t\t\t\tselect.styles.buttonMode = e.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tfattribute\r\n\t\t\t\t.addInput(select.styles, \"zIndex\", {\r\n\t\t\t\t\tmin: 0,\r\n\t\t\t\t\tmax: 99999,\r\n\t\t\t\t\tspeed: 1,\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\tconst select = sm?.getLastData();\r\n\t\t\t\t\tif (select) {\r\n\t\t\t\t\t\tselect.styles.zIndex = e.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tfstyle\r\n\t\t\t\t.addBlade({\r\n\t\t\t\t\tview: \"list\",\r\n\t\t\t\t\tlabel: \"Cursor\",\r\n\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t{ text: \"auto\", value: \"auto\" },\r\n\t\t\t\t\t\t{ text: \"default\", value: \"default\" },\r\n\t\t\t\t\t\t{ text: \"none\", value: \"none\" },\r\n\t\t\t\t\t\t{ text: \"context-menu\", value: \"context-menu\" },\r\n\t\t\t\t\t\t{ text: \"help\", value: \"help\" },\r\n\t\t\t\t\t\t{ text: \"pointer\", value: \"pointer\" },\r\n\t\t\t\t\t\t{ text: \"progress\", value: \"progress\" },\r\n\t\t\t\t\t\t{ text: \"wait\", value: \"wait\" },\r\n\t\t\t\t\t\t{ text: \"cell\", value: \"cell\" },\r\n\t\t\t\t\t\t{ text: \"crosshair\", value: \"crosshair\" },\r\n\t\t\t\t\t\t{ text: \"text\", value: \"text\" },\r\n\t\t\t\t\t\t{ text: \"vertical-text\", value: \"vertical-text\" },\r\n\t\t\t\t\t\t{ text: \"alias\", value: \"alias\" },\r\n\t\t\t\t\t\t{ text: \"copy\", value: \"copy\" },\r\n\t\t\t\t\t\t{ text: \"move\", value: \"move\" },\r\n\t\t\t\t\t\t{ text: \"no-drop\", value: \"no-drop\" },\r\n\t\t\t\t\t\t{ text: \"not-allowed\", value: \"not-allowed\" },\r\n\t\t\t\t\t\t{ text: \"grab\", value: \"grab\" },\r\n\t\t\t\t\t\t{ text: \"grabbing\", value: \"grabbing\" },\r\n\t\t\t\t\t\t{ text: \"all-scroll\", value: \"all-scroll\" },\r\n\t\t\t\t\t\t{ text: \"col-resize\", value: \"col-resize\" },\r\n\t\t\t\t\t\t{ text: \"row-resize\", value: \"row-resize\" },\r\n\t\t\t\t\t\t{ text: \"n-resize\", value: \"n-resize\" },\r\n\t\t\t\t\t\t{ text: \"e-resize\", value: \"e-resize\" },\r\n\t\t\t\t\t\t{ text: \"s-resize\", value: \"s-resize\" },\r\n\t\t\t\t\t\t{ text: \"w-resize\", value: \"w-resize\" },\r\n\t\t\t\t\t\t{ text: \"ne-resize\", value: \"ne-resize\" },\r\n\t\t\t\t\t\t{ text: \"nw-resize\", value: \"nw-resize\" },\r\n\t\t\t\t\t\t{ text: \"se-resize\", value: \"se-resize\" },\r\n\t\t\t\t\t\t{ text: \"sw-resize\", value: \"sw-resize\" },\r\n\t\t\t\t\t\t{ text: \"ew-resize\", value: \"ew-resize\" },\r\n\t\t\t\t\t\t{ text: \"ns-resize\", value: \"ns-resize\" },\r\n\t\t\t\t\t\t{ text: \"nesw-resize\", value: \"nesw-resize\" },\r\n\t\t\t\t\t\t{ text: \"nwse-resize\", value: \"nwse-resize\" },\r\n\t\t\t\t\t\t{ text: \"zoom-in\", value: \"zoom-in\" },\r\n\t\t\t\t\t\t{ text: \"zoom-out\", value: \"zoom-out\" },\r\n\t\t\t\t\t],\r\n\t\t\t\t\tvalue: \"default\",\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\tif (select) {\r\n\t\t\t\t\t\tselect.styles.cursor = e.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tfstyle\r\n\t\t\t\t.addInput(select.styles, \"shapeClosed\", {})\r\n\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\tconst select = sm?.getLastData();\r\n\t\t\t\t\tif (select) {\r\n\t\t\t\t\t\tselect.setStyle(\"shapeClosed\", e.value);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tfstyle\r\n\t\t\t\t.addInput(select.styles, \"fill\", {})\r\n\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\tselect.styles.fill = e.value;\r\n\t\t\t\t});\r\n\t\t\tfstyle\r\n\t\t\t\t.addBlade({\r\n\t\t\t\t\tview: \"list\",\r\n\t\t\t\t\tlabel: \"fillType\",\r\n\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t{ text: \"Default\", value: FillType.Default },\r\n\t\t\t\t\t\t{ text: \"ImageVector\", value: FillType.ImageVector },\r\n\t\t\t\t\t\t{ text: \"VectorImage\", value: FillType.VectorImage },\r\n\t\t\t\t\t],\r\n\t\t\t\t\tvalue: FillType.Default,\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\tselect.styles.fillType = e.value;\r\n\t\t\t\t});\r\n\t\t\tfstyle.addInput(select.styles, \"fillVector\", {});\r\n\t\t\tfstyle.addInput(select.styles, \"fillImage\", {});\r\n\r\n\t\t\tfstyle.addInput(select.styles, \"fillColor\", {\r\n\t\t\t\tview: \"color\",\r\n\t\t\t});\r\n\t\t\tfstyle.addInput(select.styles, \"fillAlpha\", {\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tmax: 1,\r\n\t\t\t\tstep: 0.1,\r\n\t\t\t});\r\n\t\t\tfstyle.addInput(select.styles, \"strokeWidth\", {\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tmax: 10,\r\n\t\t\t\tstep: 1,\r\n\t\t\t});\r\n\t\t\tfstyle.addInput(select.styles, \"strokeColor\", {\r\n\t\t\t\tview: \"color\",\r\n\t\t\t});\r\n\t\t\tfstyle.addInput(select.styles, \"strokeAlpha\", {\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tmax: 1,\r\n\t\t\t\tstep: 0.1,\r\n\t\t\t});\r\n\t\t\tfstyle.addInput(select.styles, \"offsetDelta\", {\r\n\t\t\t\tmin: -100,\r\n\t\t\t\tmax: 100,\r\n\t\t\t\tstep: 0.1,\r\n\t\t\t});\r\n\r\n\t\t\tconst flabelgizmo = fstyle.addFolder({\r\n\t\t\t\ttitle: \"Label Gizmo\",\r\n\t\t\t});\r\n\t\t\tflabelgizmo.expanded = false;\r\n\r\n\t\t\tflabelgizmo\r\n\t\t\t\t.addBlade({\r\n\t\t\t\t\tview: \"list\",\r\n\t\t\t\t\tlabel: \"Label Position\",\r\n\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t{ text: \"center\", value: \"center\" },\r\n\t\t\t\t\t\t{ text: \"top\", value: \"top\" },\r\n\t\t\t\t\t\t{ text: \"bottom\", value: \"bottom\" },\r\n\t\t\t\t\t\t{ text: \"left\", value: \"left\" },\r\n\t\t\t\t\t\t{ text: \"right\", value: \"right\" },\r\n\t\t\t\t\t\t{ text: \"topleft\", value: \"topleft\" },\r\n\t\t\t\t\t\t{ text: \"topright\", value: \"topright\" },\r\n\t\t\t\t\t\t{ text: \"bottomleft\", value: \"bottomleft\" },\r\n\t\t\t\t\t\t{ text: \"bottomright\", value: \"bottomright\" },\r\n\t\t\t\t\t],\r\n\t\t\t\t\tvalue: \"center\",\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\tif (select) {\r\n\t\t\t\t\t\tselect.styles.labelGizmoPosition = e.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tflabelgizmo.addInput(select.styles, \"labelGizmoRotation\", {});\r\n\t\t\tflabelgizmo.addInput(select.styles, \"labelGizmoPositionOffsetX\", {\r\n\t\t\t\tmin: -200,\r\n\t\t\t\tmax: 200,\r\n\t\t\t});\r\n\t\t\tflabelgizmo.addInput(select.styles, \"labelGizmoPositionOffsetY\", {\r\n\t\t\t\tmin: -200,\r\n\t\t\t\tmax: 200,\r\n\t\t\t});\r\n\t\t\tconst flabel2gizmo = fstyle.addFolder({\r\n\t\t\t\ttitle: \"Label2 Gizmo\",\r\n\t\t\t});\r\n\t\t\tflabel2gizmo.expanded = false;\r\n\t\t\tflabel2gizmo\r\n\t\t\t\t.addBlade({\r\n\t\t\t\t\tview: \"list\",\r\n\t\t\t\t\tlabel: \"Label2 Position\",\r\n\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t{ text: \"center\", value: \"center\" },\r\n\t\t\t\t\t\t{ text: \"top\", value: \"top\" },\r\n\t\t\t\t\t\t{ text: \"bottom\", value: \"bottom\" },\r\n\t\t\t\t\t\t{ text: \"left\", value: \"left\" },\r\n\t\t\t\t\t\t{ text: \"right\", value: \"right\" },\r\n\t\t\t\t\t\t{ text: \"topleft\", value: \"topleft\" },\r\n\t\t\t\t\t\t{ text: \"topright\", value: \"topright\" },\r\n\t\t\t\t\t\t{ text: \"bottomleft\", value: \"bottomleft\" },\r\n\t\t\t\t\t\t{ text: \"bottomright\", value: \"bottomright\" },\r\n\t\t\t\t\t],\r\n\t\t\t\t\tvalue: \"center\",\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\tif (select) {\r\n\t\t\t\t\t\tselect.styles.label2GizmoPosition = e.value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tflabel2gizmo.addInput(select.styles, \"label2GizmoRotation\", {});\r\n\t\t\tflabel2gizmo.addInput(select.styles, \"label2GizmoPositionOffsetX\", {\r\n\t\t\t\tmin: -200,\r\n\t\t\t\tmax: 200,\r\n\t\t\t});\r\n\t\t\tflabel2gizmo.addInput(select.styles, \"label2GizmoPositionOffsetY\", {\r\n\t\t\t\tmin: -200,\r\n\t\t\t\tmax: 200,\r\n\t\t\t});\r\n\t\t\tconst feditorgizmo = fstyle.addFolder({\r\n\t\t\t\ttitle: \"Editor Gizmo\",\r\n\t\t\t});\r\n\t\t\tfeditorgizmo.expanded = false;\r\n\t\t\tfeditorgizmo.addInput(select.styles, \"editorGizmoZIndex\", {\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tmax: 10,\r\n\t\t\t});\r\n\r\n\t\t\t// client\r\n\t\t\tconst fclient = tab3.addFolder({\r\n\t\t\t\ttitle: \"Client\",\r\n\t\t\t});\r\n\t\t\tfclient.expanded = false;\r\n\t\t\tif (select.clients.type !== undefined) {\r\n\t\t\t}\r\n\r\n\t\t\tif (select.clients.people !== undefined) {\r\n\t\t\t\tfclient\r\n\t\t\t\t\t.addInput(select.clients, \"people\", {\r\n\t\t\t\t\t\tmin: 0,\r\n\t\t\t\t\t\tmax: 24,\r\n\t\t\t\t\t\tspeed: 1,\r\n\t\t\t\t\t\tstep: 1,\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"change\", (e: any) => {\r\n\t\t\t\t\t\tselect.clients.people = e.value;\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconst fanimate = tab3.addFolder({\r\n\t\t\t\ttitle: \"Animate\",\r\n\t\t\t});\r\n\t\t\tfanimate.expanded = false;\r\n\t\t\tfanimate\r\n\t\t\t\t.addButton({\r\n\t\t\t\t\ttitle: \"Start\",\r\n\t\t\t\t\tlabel: \"Start\",\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"click\", () => {\r\n\t\t\t\t\tif (this._anime) {\r\n\t\t\t\t\t\tthis._anime.start();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._anime = anime({\r\n\t\t\t\t\t\t\ttargets: select,\r\n\t\t\t\t\t\t\tangle: 360,\r\n\t\t\t\t\t\t\tround: 1,\r\n\t\t\t\t\t\t\teasing:\r\n\t\t\t\t\t\t\t\tselect.getClient(\"easing\") || \"easeInOutSine\",\r\n\t\t\t\t\t\t\tloop: true,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tfanimate\r\n\t\t\t\t.addButton({\r\n\t\t\t\t\ttitle: \"Pause\",\r\n\t\t\t\t\tlabel: \"Pause\",\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"click\", () => {\r\n\t\t\t\t\tif (this._anime) {\r\n\t\t\t\t\t\tthis._anime.pause();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tfanimate\r\n\t\t\t\t.addButton({\r\n\t\t\t\t\ttitle: \"Remove\",\r\n\t\t\t\t\tlabel: \"Remove\",\r\n\t\t\t\t\tdisabled: false,\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"click\", (e: any) => {\r\n\t\t\t\t\tconst sm = this._renderer?.selectionModel;\r\n\t\t\t\t\tconst model = this._model;\r\n\t\t\t\t\tif (sm && model) {\r\n\t\t\t\t\t\tconst datas = sm.getSelection();\r\n\t\t\t\t\t\tmodel.remove(datas);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tconst fAlgorithm = tab3.addFolder({\r\n\t\t\t\ttitle: \"Algorithm\",\r\n\t\t\t});\r\n\t\t\tfAlgorithm\r\n\t\t\t\t.addButton({\r\n\t\t\t\t\ttitle: \"subtract\",\r\n\t\t\t\t\tlabel: \"subtract\",\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"click\", () => { });\r\n\r\n\t\t\tfAlgorithm\r\n\t\t\t\t.addButton({\r\n\t\t\t\t\ttitle: \"union\",\r\n\t\t\t\t\tlabel: \"union\",\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"click\", () => { });\r\n\r\n\t\t\tfAlgorithm\r\n\t\t\t\t.addButton({\r\n\t\t\t\t\ttitle: \"intersect\",\r\n\t\t\t\t\tlabel: \"intersect\",\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"click\", () => { });\r\n\t\t} else {\r\n\t\t\tthis._tabs.pages[0].selected = true;\r\n\t\t\tthis._pane.expanded = false;\r\n\t\t}\r\n\t}\r\n}\r\n","import React, { Component, createRef } from \"react\";\r\nimport Application from \"./application\";\r\ndeclare global {\r\n\tinterface Window {\r\n\t\trenderer: Application;\r\n\t\tapplication: Application;\r\n\t}\r\n}\r\n\r\nconst style = {\r\n\twidth: \"100%\",\r\n\theight: \"100%\",\r\n\tbackgroundColor: \"#CDCDCD\",\r\n};\r\n\r\ntype Props = {};\r\n\r\ntype State = {};\r\n\r\nclass RendererComponent extends Component<Props, State> {\r\n\tapp?: Application;\r\n\tcanvasRef = createRef<HTMLCanvasElement>();\r\n\r\n\t/**\r\n\t *\r\n\t * @param props\r\n\t */\r\n\tconstructor(props: Props) {\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tcomponentDidMount() {\r\n\t\tconsole.log(\"PixiRenderer:componentDidMount\");\r\n\t\tthis.app = new Application({\r\n\t\t\tcanvas: this.canvasRef.current,\r\n\t\t\tid: \"application\",\r\n\t\t\tdebug: {\r\n\t\t\t\tmodel:\r\n\t\t\t\t\t!!location.search.includes(\"debug\") &&\r\n\t\t\t\t\t!!location.search.includes(\"model\"),\r\n\t\t\t\tui:\r\n\t\t\t\t\t!!location.search.includes(\"debug\") &&\r\n\t\t\t\t\t!!location.search.includes(\"ui\"),\r\n\t\t\t\torigin:\r\n\t\t\t\t\t!!location.search.includes(\"debug\") &&\r\n\t\t\t\t\t!!location.search.includes(\"origin\"),\r\n\t\t\t\tcontrolPane: true || !!location.search.includes(\"debug\"),\r\n\t\t\t},\r\n\t\t});\r\n\t\twindow.renderer = this.app;\r\n\t\twindow.application = this.app;\r\n\t\tthis.app.load();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tcomponentWillUnmount() {\r\n\t\tconsole.log(\"PixiRenderer:componentWillUnmount\");\r\n\t\tif (this.app) {\r\n\t\t\tthis.app.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn <canvas style={style} ref={this.canvasRef} />;\r\n\t}\r\n}\r\n\r\nexport default RendererComponent;\r\n","import React, { Component } from \"react\";\r\nimport logo from \"./logo.svg\";\r\nimport \"./App.css\";\r\nimport BubbleComponent from \"@components/bubble\";\r\nimport RendererComponent from \"@components/renderer\";\r\nimport { Button } from \"antd\";\r\nimport \"antd/dist/antd.css\";\r\n\r\nclass App extends Component<{}, {}> {\r\n\tstate = { isMounted: true };\r\n\trender() {\r\n\t\tconst { isMounted = true } = this.state;\r\n\t\treturn (\r\n\t\t\t<div>\r\n\t\t\t\t<button\r\n\t\t\t\t\tonClick={() =>\r\n\t\t\t\t\t\tthis.setState((state: any) => ({\r\n\t\t\t\t\t\t\tisMounted: !state.isMounted,\r\n\t\t\t\t\t\t}))\r\n\t\t\t\t\t}\r\n\t\t\t\t>\r\n\t\t\t\t\t{isMounted ? \"UnMount\" : \"Mount\"}\r\n\t\t\t\t</button>\r\n\t\t\t\t{/* <Button type=\"primary\">Primary Button</Button>\r\n\t\t\t\t<Button>Default Button</Button>\r\n\t\t\t\t<Button type=\"dashed\">Dashed Button</Button>\r\n\t\t\t\t<Button type=\"text\">Text Button</Button>\r\n\t\t\t\t<Button type=\"link\">Link Button</Button> */}\r\n\t\t\t\t{/* <br></br> */}\r\n\t\t\t\t{isMounted && <RendererComponent />}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n\tif (onPerfEntry && onPerfEntry instanceof Function) {\r\n\t\timport('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n\t\t\tgetCLS(onPerfEntry);\r\n\t\t\tgetFID(onPerfEntry);\r\n\t\t\tgetFCP(onPerfEntry);\r\n\t\t\tgetLCP(onPerfEntry);\r\n\t\t\tgetTTFB(onPerfEntry);\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\nimport reportWebVitals from \"./reportWebVitals\";\r\n\r\nReactDOM.render(\r\n\t<React.StrictMode>\r\n\t\t<App />\r\n\t</React.StrictMode>,\r\n\tdocument.getElementById(\"root\")\r\n);\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n\r\n// test mock api\r\n/* fetch('http://127.0.0.1:3000/scene', { method: 'GET' }).then((res) => {\r\n\tres.json().then((response) => {\r\n\t\tconsole.log('Success:', response);\r\n\t});\r\n}); */\r\n\r\n/* // test mock api\r\nfetch('/api/sceneData', { method: 'POST' }).then((res) => {\r\n\tres.json().then((response) => {\r\n\t\tconsole.log('Success sceneData:', response);\r\n\t\t// app.load(response.data);\r\n\t});\r\n});\r\n\r\nfetch('/api/guidelines', { method: 'POST' }).then((res) => {\r\n\tres.json().then((response) => {\r\n\t\tconsole.log('Success guidelines:', response);\r\n\t\t// app.load(response.data);\r\n\t});\r\n}); */\r\n"],"sourceRoot":""}