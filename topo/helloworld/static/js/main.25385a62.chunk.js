(this["webpackJsonp@examples/demo-dev"]=this["webpackJsonp@examples/demo-dev"]||[]).push([[0],{250:function(t,e,i){},251:function(t,e,i){},451:function(t,e){},622:function(t,e,i){"use strict";i.r(e);var n=i(44),o=i.n(n),s=i(233),a=i.n(s),r=(i(250),i(6)),h=i(7),l=i(8),u=i(9),d=(i(251),i(49)),c=i(21),v=i(22),_=i(28),f=i.n(_),g=i(31),m=i.n(g),p=i(104),y=i(3),b=i(40);var k,w=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r.a)(this,t),this._x=0,this._y=0,this._width=0,this._height=0,this._originPoints=[],this._points=[],this._x=Number(e),this._y=Number(i),this._width=Number(n),this._height=Number(o)}return Object(h.a)(t,[{key:"originPoints",set:function(e){this._originPoints=e;var i=t.fromPoints(e);this.x=i.x,this.y=i.y,this.width=i.width,this.height=i.height,this.update()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t}},{key:"y",get:function(){return this._y},set:function(t){this._y=t}},{key:"width",get:function(){return this._width},set:function(t){this._width=t}},{key:"height",get:function(){return this._height},set:function(t){this._height=t}},{key:"points",get:function(){return this.update(),this._points}},{key:"topLeft",get:function(){return this.update(),this._points[0]}},{key:"topRight",get:function(){return this.update(),this._points[1]}},{key:"bottomRight",get:function(){return this.update(),this._points[2]}},{key:"bottomLeft",get:function(){return this.update(),this._points[3]}},{key:"update",value:function(){this._points=[[this._x,this._y],[this._x+this._width,this._y],[this._x+this._width,this._y+this._height],[this._x,this._y+this._height]]}},{key:"left",get:function(){return this.x}},{key:"right",get:function(){return this.x+this.width}},{key:"top",get:function(){return this.y}},{key:"bottom",get:function(){return this.y+this.height}},{key:"clone",value:function(){return new t(this.x,this.y,this.width,this.height)}},{key:"copyFrom",value:function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}},{key:"copyTo",value:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}},{key:"contains",value:function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}},{key:"equals",value:function(t){return!!t&&(t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height)}},{key:"pad",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}},{key:"fit",value:function(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(o-n,0),this}},{key:"ceil",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001,i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this}},{key:"enlarge",value:function(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=o-n,this}}],[{key:"fromPoints",value:function(e){var i=new t(0,0,0,0);if(!e||0===e.length)return i;var n=e.length,o=e[0];i.x=o[0],i.y=o[1];for(var s=1;s<n;s+=1){o=e[s];var a=Math.min(i.x,o[0]),r=Math.min(i.y,o[1]),h=Math.max(i.x+i.width,o[0]),l=Math.max(i.y+i.height,o[1]);i.x=a,i.y=r,i.width=h-a,i.height=l-r}return i}}]),t}(),x=(y.c.create(),i(36));!function(t){t[t.OUTSIDE=4294967295]="OUTSIDE",t[t.INSIDE=0]="INSIDE",t[t.INDETERMINATE=2147483647]="INDETERMINATE"}(k||(k={}));Math.PI,Math.PI;var S,M=Math.PI/180;!function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"}(S||(S={}));var E,C,z,O,L,P,j,T,B,D,A=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r.a)(this,t),this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.type=void 0,this.x=Number(e),this.y=Number(i),this.width=Number(n),this.height=Number(o),this.type=S.RECT}return Object(h.a)(t,[{key:"left",get:function(){return this.x}},{key:"right",get:function(){return this.x+this.width}},{key:"top",get:function(){return this.y}},{key:"bottom",get:function(){return this.y+this.height}},{key:"clone",value:function(){return new t(this.x,this.y,this.width,this.height)}},{key:"copyFrom",value:function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}},{key:"copyTo",value:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}},{key:"contains",value:function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}},{key:"pad",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}},{key:"fit",value:function(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(o-n,0),this}},{key:"ceil",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001,i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this}},{key:"enlarge",value:function(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=o-n,this}},{key:"toString",value:function(){return"[Rectangle x=".concat(this.x," y=").concat(this.y," width=").concat(this.width," height=").concat(this.height,"]")}}],[{key:"EMPTY",get:function(){return new t(0,0,0,0)}}]),t}(),R=i(32),I=i(64),F=i.n(I),G=i(234),V=i.n(G),U=i(625),K=function(){function t(e){Object(r.a)(this,t),this._originPoints=[],this._points=[],this._originPoints=e,this._points=t.fromPoints(e)}return Object(h.a)(t,[{key:"points",get:function(){return this._points}},{key:"pad",value:function(){Object(R.offset)({delta:10},Object(I.line)([[0,0],[100,0]])),Object(R.expand)({delta:5,corners:"chamfer"},Object(I.square)({size:30}));return this}}],[{key:"fromPoints",value:function(t){if(!t||0===t.length)return[];for(var e=V()(t,1/0),i=[],n=0;n<e.length-1;n++)i.push([e[n+1][0]-e[n][0],e[n+1][1]-e[n][1]]);var o=i.map((function(t){return Math.abs(Math.atan2(t[1],t[0])%(Math.PI/2))})).map((function(t){return[[Math.cos(t),Math.cos(t-Math.PI/2)],[Math.cos(t+Math.PI/2),Math.cos(t)]]})),s=o.map((function(t){return Object(U.d)(Object(U.a)(t),Object(U.e)(Object(U.a)(e))).toArray()})),a=s.map((function(t){var e=Object(U.c)(t,1);return[e[0],e[1]]})),r=s.map((function(t){var e=Object(U.b)(t,1);return[e[0],e[1]]})),h=a.map((function(t){return t[0]})),l=a.map((function(t){return t[1]})),u=r.map((function(t){return t[0]})),d=r.map((function(t){return t[1]})),c=h.map((function(t,e){return(u[e]-h[e])*(d[e]-l[e])})),v=c.reduce((function(t,e,i,n){return e<n[t]?i:t}),0),_=u[v],f=h[v],g=d[v],m=l[v],p=o[v],y=[];return y.push(Object(U.d)([_,m],p)),y.push(Object(U.d)([f,m],p)),y.push(Object(U.d)([f,g],p)),y.push(Object(U.d)([_,g],p)),y}}]),t}();function W(t,e){var i=t[0];return e||(i=t[0]),e&&0===e[1]?(t.sort((function(t,e){return t[1]-e[1]})),i=t[0][0]<t[1][0]?t[0]:t[1]):e&&0===e[0]?(t.sort((function(t,e){return t[1]-e[1]})),i=t[0][0]>t[1][0]?t[0]:t[1]):e&&e[0]*e[1]>0?(t.sort((function(t,e){return t[0]-e[0]})),i=t[0]):e&&e[0]*e[1]<0&&(t.sort((function(t,e){return t[1]-e[1]})),i=t[0]),t.map((function(t){var e=y.b.angle(y.b.fromValues(1,0),y.b.fromValues(t[0]-(i[0]+1),-(t[1]-i[1])));return[t[0],t[1],e]})).sort((function(t,e){return t[2]-e[2]}))}!function(t){t.Butt="butt",t.Round="round",t.Square="square"}(E||(E={})),function(t){t.Bevel="bevel",t.Round="round",t.Miter="miter"}(C||(C={})),function(t){t.NodeUI="NodeUI",t.ShapeUI="ShapeUI",t.LineUI="LineUI",t.ShapeLineUI="ShapeLineUI",t.DomainUI="DomainUI",t.DoorUI="DoorUI",t.VertexUI="VertexUI",t.EdgeUI="EdgeUI",t.GroupUI="GroupUI"}(z||(z={})),function(t){t.CubeUI="CubeUI"}(O||(O={})),function(t){t.Show="show",t.Edit="edit"}(L||(L={})),function(t){t.Default="ImageVector",t.ImageVector="ImageVector",t.VectorImage="VectorImage"}(P||(P={})),function(t){t.Center="Center",t.Top="Top",t.Bottom="Bottom",t.Left="Left",t.Right="Right",t.TopLeft="TopLeft",t.TopRight="TopRight",t.BottomLeft="BottomLeft",t.BottomRight="BottomRight"}(j||(j={})),function(t){t.Center="Center",t.Top="Top",t.Bottom="Bottom",t.Left="Left",t.Right="Right",t.TopLeft="TopLeft",t.TopRight="TopRight",t.BottomLeft="BottomLeft",t.BottomRight="BottomRight"}(T||(T={})),function(t){t[t.BottomZIndex=0]="BottomZIndex",t[t.DefaultZIndex=1]="DefaultZIndex",t[t.LabelZIndex=2]="LabelZIndex",t[t.Label2ZIndex=2]="Label2ZIndex",t[t.EditorZIndex=3]="EditorZIndex",t[t.SelectZIndex=4]="SelectZIndex",t[t.PreviewZIndex=5]="PreviewZIndex",t[t.AlignLineZIndex=6]="AlignLineZIndex",t[t.DimensionGizmoZIndex=6]="DimensionGizmoZIndex",t[t.HoverZIndex=7]="HoverZIndex"}(B||(B={})),function(t){t.Element="element",t.Node="node",t.Shape="shape",t.Domain="domain",t.Wall="wall",t.Line="line",t.AlignLine="alignLine",t.ShapeLine="shapeLine",t.Door="door",t.Vertex="vertex",t.Edge="edge",t.Group="group"}(D||(D={}));var Z,N={interactive:!0,buttonMode:!0,cursor:"default",zIndex:B.DefaultZIndex,fill:!0,fillVector:!1,fillImage:!0,fillType:P.Default,fillColor:15198439,fillAlpha:1,offsetDelta:-.5,blur:10,blurQuality:8,blurX:8,blurY:8,strokeWidth:1,strokeColor:0,strokeAlpha:1,shapeClosed:!0,selectFill:!0,selectFillColor:16737792,selectFillAlpha:1,selectStrokeWidth:1,selectStrokeColor:0,selectStrokeAlpha:1,hoverFill:!0,hoverFillColor:16737792,hoverFillAlpha:1,hoverStrokeWidth:1,hoverStrokeColor:0,hoverStrokeAlpha:1,alarmFill:!0,alarmFillColor:16737792,alarmFillAlpha:.5,alarmStrokeWidth:1,alarmStrokeColor:0,alarmStrokeAlpha:1,labelGizmoVisible:!0,labelGizmoZIndex:B.LabelZIndex,labelGizmoInteractive:!0,labelGizmoButtonMode:!0,labelGizmoCursor:"default",labelGizmoPosition:"Bottom",labelGizmoRotation:!1,labelGizmoPositionOffsetX:0,labelGizmoPositionOffsetY:10,label2GizmoVisible:!0,label2GizmoZIndex:B.Label2ZIndex,label2GizmoInteractive:!0,label2GizmoButtonMode:!0,label2GizmoCursor:"default",label2GizmoPosition:"Top",label2GizmoRotation:!1,label2GizmoPositionOffsetX:0,label2GizmoPositionOffsetY:20,editorGizmoVisible:!0,editorGizmoZIndex:B.EditorZIndex,editorGizmoInteractive:!0,editorGizmoButtonMode:!0,editorGizmoRotation:!1,editorGizmoCursor:"default",alignGizmoVisible:!1,alignGizmoZIndex:0,alignGizmoInteractive:!1,alignGizmoButtonMode:!1,alignGizmoRotation:!1,alignGizmoCursor:"default",dimensionGizmoVisible:!1,dimensionGizmoZIndex:B.DimensionGizmoZIndex,dimensionGizmoInteractive:!1,dimensionGizmoButtonMode:!1,dimensionGizmoRotation:!1,dimensionGizmoCursor:"default"};!function(t){t.Change="change",t.Dirty="dirty",t.UnDirty="unDirty",t.DataChange="data.change",t.AttributeChange="attribute.change",t.StyleChange="style.change",t.ClientChange="client.change",t.ChildrenChange="children.change",t.ChildrenChangeAdd="children.change.add",t.ChildrenChangeRemove="children.change.remove",t.ChildrenChangeClear="children.change.clear"}(Z||(Z={}));var H,Y=i(25);function q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return+t.toFixed(e)}function X(t,e,i,n,o){var s=o*(Math.PI/180),a=t-i,r=e-n;return[a*Math.cos(s)-r*Math.sin(s)+i,a*Math.sin(s)+r*Math.cos(s)+n]}function J(t){var e=function(t){var e=t.width,i=t.height,n=t.left,o=t.top,s=t.rotate,a=void 0===s?0:s;if(a%360===0)return[n,o,n+e,o+i];var r=n+e/2,h=o+i/2,l=X(n,o,r,h,a),u=X(n+e,o,r,h,a),d=X(n,o+i,r,h,a),c=X(n+e,o+i,r,h,a),v=[l[0],u[0],d[0],c[0]],_=[l[1],u[1],d[1],c[1]];return[Math.min.apply(Math,v),Math.min.apply(Math,_),Math.max.apply(Math,v),Math.max.apply(Math,_)]}(t),i=e[0],n=e[1],o=e[2],s=e[3];return{left:i,top:n,right:o,bottom:s,width:o-i,height:s-n}}function Q(t){var e=J(t),i=e.width,n=e.height,o=e.left+(1===i?0:e.width/2),s=e.top+(1===n?0:e.height/2);return[{type:"vertical",position:"vl",offset:e.left,start:e.top,end:e.bottom,rect:t},{type:"vertical",position:"vc",offset:o,start:e.top,end:e.bottom,rect:t},{type:"vertical",position:"vr",offset:1===i?e.left:e.right,start:e.top,end:e.bottom,rect:t},{type:"horizontal",position:"ht",offset:e.top,start:e.left,end:e.right,rect:t},{type:"horizontal",position:"hc",offset:s,start:e.left,end:e.right,rect:t},{type:"horizontal",position:"hb",offset:1===n?e.top:e.bottom,start:e.left,end:e.right,rect:t}]}function $(t,e){var i=[],n=Object.create(null);return t.forEach((function(t){var o=e(t);n[o]||(n[o]=[],i.push(o)),n[o].push(t)})),{group:n,keys:i}}function tt(t,e){for(var i=0;i<t.length;i++)if(e(t[i]))return t[i];return null}function et(t,e){if(!e.length)return null;var i=J(t.rect),n="vertical"===t.type,o=e;return o.length?function(t,e,i){var n="vertical"===t;if(!e.length)return{type:t,left:0,top:0,size:0,refLineMetaList:[]};var o=e[0].offset,s=Math.min.apply(Math,Object(Y.a)(e.map((function(t){return t.start}))).concat([void 0==(null===i||void 0===i?void 0:i.start)?1/0:i.start])),a=Math.max.apply(Math,Object(Y.a)(e.map((function(t){return t.end}))).concat([void 0==(null===i||void 0===i?void 0:i.end)?-1/0:i.end])),r=n?[o,s]:[s,o];return{type:t,left:r[0],top:r[1],size:a-s,refLineMetaList:Object(Y.a)(e)}}(t.type,o,{start:n?i.top:i.left,end:n?i.bottom:i.right}):null}function it(t){return null==t}!function(t){t[t.MOVE_TOP=0]="MOVE_TOP",t[t.MOVE_RIGHT=1]="MOVE_RIGHT",t[t.MOVE_BOTTOM=2]="MOVE_BOTTOM",t[t.MOVE_LEFT=3]="MOVE_LEFT",t[t.NONE=4]="NONE"}(H||(H={}));var nt=function(){function t(e){Object(r.a)(this,t),this.opts={},this.seq=1,this.__rects=[],this._rects=[],this.current=null,this._dirty=!0,this._vLines=[],this._hLines=[],this._vLineMap=new Map,this._hLineMap=new Map,this._adsorbVLines=[],this._adsorbHLines=[],this._lineFilter=null,this.opts=e||{},this.__rects=(null===e||void 0===e?void 0:e.rects)||[],this._lineFilter=(null===e||void 0===e?void 0:e.lineFilter)||null,this._adsorbVLines=(null===e||void 0===e?void 0:e.adsorbVLines)||[],this._adsorbHLines=(null===e||void 0===e?void 0:e.adsorbHLines)||[],null!==e&&void 0!==e&&e.current&&this.setCurrent(e.current),this._dirty=!0}return Object(h.a)(t,[{key:"rects",get:function(){return this._dirty&&this.initRefLines(),this._rects},set:function(t){this.__rects=t,this._dirty=!0}},{key:"vLines",get:function(){return this._dirty&&this.initRefLines(),this._vLines}},{key:"hLines",get:function(){return this._dirty&&this.initRefLines(),this._hLines}},{key:"vLineMap",get:function(){return this._dirty&&this.initRefLines(),this._vLineMap}},{key:"hLineMap",get:function(){return this._dirty&&this.initRefLines(),this._hLineMap}},{key:"adsorbVLines",get:function(){return this._adsorbHLines},set:function(t){this._adsorbVLines=t,this._dirty=!0}},{key:"adsorbHLines",get:function(){return this._adsorbHLines},set:function(t){this._adsorbHLines=t,this._dirty=!0}},{key:"getRectByKey",value:function(t){return tt(this.__rects,(function(e){return e.key===t}))}},{key:"getOffsetRefLineMetaList",value:function(t,e){return e=q(e,0),("vertical"===t?this.vLineMap:this.hLineMap).get(this.toLineMapKey(e))||[]}},{key:"setRects",value:function(t){this.__rects=t,this._dirty=!0}},{key:"getRect",value:function(t){return"string"===typeof t?this.getRectByKey(t):t}},{key:"setCurrent",value:function(t){var e,i=this.getCurrent();this.current=t?this.getRect(t):null,(null===i||void 0===i?void 0:i.key)!==(null===(e=this.current)||void 0===e?void 0:e.key)&&(this._dirty=!0)}},{key:"getCurrent",value:function(){return this.current}},{key:"setLineFilter",value:function(t){this._lineFilter=t,this._dirty=!0}},{key:"getLineFilter",value:function(){return this._lineFilter}},{key:"toLineMapKey",value:function(t){return t+""}},{key:"getLineMapKey",value:function(t){return this.toLineMapKey(q(t.offset,0))}},{key:"isEnableLine",value:function(t){if(t.adsorbOnly)return!0;var e=this.getLineFilter();return!e||e(t)}},{key:"getRectRefLines",value:function(t){var e=this,i=Q(t);return this.getLineFilter()&&(i=i.filter((function(t){return e.isEnableLine(t)}))),i}},{key:"initRefLines",value:function(){var t=this,e=this.getCurrent(),i=[],n=[];this._rects=e?this.__rects.filter((function(t){return t.key!==e.key})):Object(Y.a)(this.__rects),this._rects.forEach((function(e){t.getRectRefLines(e).forEach((function(e){var o=t.getLineMapKey(e);if("vertical"===e.type){i.push(e);var s=t._vLineMap.get(o)||[];s.push(e),t._vLineMap.set(o,s)}else{n.push(e);var a=t._hLineMap.get(o)||[];a.push(e),t._hLineMap.set(o,a)}}))})),this._adsorbVLines.forEach((function(e){var n={type:"vertical",position:"vl",offset:e.offset,start:e.offset,end:0,rect:{key:"v_"+e.key,width:0,height:0,left:e.offset,top:0},adsorbOnly:!0};i.push(n);var o=t.getLineMapKey(e),s=t._vLineMap.get(o)||[];s.push(n),t._vLineMap.set(o,s)})),this._adsorbHLines.forEach((function(e){var i={type:"horizontal",position:"ht",offset:e.offset,start:e.offset,end:0,rect:{key:"h_"+e.key,width:0,height:0,left:0,top:e.offset},adsorbOnly:!0};n.push(i);var o=t.getLineMapKey(e),s=t._hLineMap.get(o)||[];s.push(i),t._hLineMap.set(o,s)})),i=i.sort((function(t,e){return t.offset-e.offset})),n=n.sort((function(t,e){return t.offset-e.offset}));var o=$(i,(function(e){return t.getLineMapKey(e)})),s=$(n,(function(e){return t.getLineMapKey(e)}));this._vLines=o.keys.map((function(t){var e=o.group[t];return{offset:q(e[0].offset,0),min:Math.min.apply(Math,Object(Y.a)(e.map((function(t){return t.offset})))),max:Math.max.apply(Math,Object(Y.a)(e.map((function(t){return t.offset})))),refLineMetaList:e}})),this._hLines=s.keys.map((function(t){var e=s.group[t];return{offset:q(e[0].offset,0),min:Math.min.apply(Math,Object(Y.a)(e.map((function(t){return t.offset})))),max:Math.max.apply(Math,Object(Y.a)(e.map((function(t){return t.offset})))),refLineMetaList:e}})),this._dirty=!1}},{key:"matchRefLines",value:function(t){var e=this,i=this.getCurrent();if(!i)return[];var n="vertical"===t?this.vLineMap:this.hLineMap,o=[];return i?(this.getRectRefLines(i).forEach((function(i){if(i.type===t){var s=e.getLineMapKey(i),a=et(i,(n.get(s)||[]).filter((function(t){return!t.adsorbOnly})));a&&o.push(a)}})),o):o}},{key:"getNearestOffsetFromOffset",value:function(t,e){var i="vertical"===t?this.vLines:this.hLines,n=-1/0,o=1/0,s=1/0,a=1/0;return i.forEach((function(t){var i=Math.abs(t.min-e);t.min<e&&i>=.5&&(n=Math.max(t.min,n),o=Math.min(i,o)),t.min>e&&i>=.5&&(s=Math.min(t.min,s),a=Math.min(i,a))})),[n!==-1/0?[n,o]:null,s!==1/0?[s,a]:null]}},{key:"hasMatchedRefLine",value:function(t){var e=this.getCurrent();if(!e)return!1;var i=tt(this.getRectRefLines(e),(function(e){return e.position===t}));if(!i)return!1;var n=this.getLineMapKey(i),o="vertical"===function(t){return{vl:"vertical",vc:"vertical",vr:"vertical",ht:"horizontal",hc:"horizontal",hb:"horizontal"}[t]}(t)?this.vLineMap:this.hLineMap,s=o.get(n);return!!s&&!!s.length}},{key:"matchVRefLines",value:function(){return this.matchRefLines("vertical")}},{key:"getVRefLines",value:function(){return this.matchRefLines("vertical")}},{key:"matchHRefLines",value:function(){return this.matchRefLines("horizontal")}},{key:"getHRefLines",value:function(){return this.matchRefLines("horizontal")}},{key:"matchAllRefLines",value:function(){return[].concat(Object(Y.a)(this.matchVRefLines()),Object(Y.a)(this.matchHRefLines()))}},{key:"getAllRefLines",value:function(){return[].concat(Object(Y.a)(this.matchVRefLines()),Object(Y.a)(this.matchHRefLines()))}},{key:"getOffsetAdsorbDelta",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;if((n=Math.abs(n))<1)return i;var o=this.getOffsetRefLineMetaList(t,e).length,s=this.getNearestOffsetFromOffset(t,e),a=i<0,r=a?0:1,h=s[r],l=h?h[0]:0,u=h?h[1]:0;if(h&&u<=n?n=u:n+=1,o)Math.abs(i)<n?i=0:1===Math.abs(i)&&n<1&&(i=n);else if(0!==i){var d=l-(e+i);Math.abs(d)<n&&(a?d<=0:d>=0)&&(i+=d)}return i}},{key:"getAdsorbDelta",value:function(t,e,i){var n=this.getCurrent();if(!n)return t;var o=(null===i||void 0===i?void 0:i.x)||"none",s=(null===i||void 0===i?void 0:i.y)||"none",a=e=Math.abs(e||5),r=Object(c.a)({},t);if(e<1)return r;var h=Q(n),l=[this.isEnableLine(h[0]),this.isEnableLine(h[1]),this.isEnableLine(h[2]),this.isEnableLine(h[3]),this.isEnableLine(h[4]),this.isEnableLine(h[5])],u=this.hasMatchedRefLine("vl")||this.hasMatchedRefLine("vc")||this.hasMatchedRefLine("vr"),d=this.hasMatchedRefLine("ht")||this.hasMatchedRefLine("hc")||this.hasMatchedRefLine("hb");if(0!==t.left&&"none"!==o){e=a;var v=[h[0].offset,h[1].offset,h[2].offset],_=this.getNearestOffsetFromOffset("vertical",h[0].offset),f=this.getNearestOffsetFromOffset("vertical",h[1].offset),g=this.getNearestOffsetFromOffset("vertical",h[2].offset),m="left"===o,p=[1/0,1/0,1/0],y=[1/0,1/0,1/0],b=m?0:1;l[0]&&_[b]&&(p[0]=_[b][0],y[0]=_[b][1]),l[1]&&f[b]&&(p[1]=f[b][0],y[1]=f[b][1]),l[2]&&g[b]&&(p[2]=g[b][0],y[2]=g[b][1]);var k=Math.min.apply(Math,y),w=y.indexOf(k),x=p[w];if(k<=e?e=k:e+=1,u)(m&&t.left>0||!m&&t.left<0||Math.abs(t.left)<e)&&(r.left=0);else{var S=x-(v[w]+t.left);m&&t.left>0||!m&&t.left<0?r.left=0:Math.abs(S)<e&&(m?S<=0:S>=0)&&(r.left=S+t.left)}}if(0!==t.top&&"none"!==s){e=a;var M=[h[3].offset,h[4].offset,h[5].offset],E=this.getNearestOffsetFromOffset("horizontal",h[3].offset),C=this.getNearestOffsetFromOffset("horizontal",h[4].offset),z=this.getNearestOffsetFromOffset("horizontal",h[5].offset),O="up"===s,L=[1/0,1/0,1/0],P=[1/0,1/0,1/0],j=O?0:1;l[3]&&E[j]&&(L[0]=E[j][0],P[0]=E[j][1]),l[4]&&C[j]&&(L[1]=C[j][0],P[1]=C[j][1]),l[5]&&z[j]&&(L[2]=z[j][0],P[2]=z[j][1]);var T=Math.min.apply(Math,P),B=P.indexOf(T),D=L[B];if(T<=e?e=T:e+=1,d)(O&&t.top>0||!O&&t.top<0||Math.abs(t.top)<e)&&(r.top=0);else{var A=D-(M[B]+t.top);O&&t.top>0||!O&&t.top<0?r.top=0:Math.abs(A)<e&&(O?A<=0:A>=0)&&(r.top=A+t.top)}}return r}},{key:"adsorbCreator",value:function(t){var e=this,i=t.pageX,n=t.pageY,o=t.current,s=void 0===o?this.getCurrent():o,a=t.distance,r=void 0===a?5:a,h=t.disableAdsorb,l=void 0!==h&&h,u=t.scale;if(!s)throw new Error("[refline.js] current rect does not exist!");var d=Object(c.a)({},s),v=i,_=n,f=d.left,g=d.top,m=u||1,p=l,y=i,b=n,k="none",w="none";return function(t){var i=p;t.current&&(d=Object(c.a)({},t.current)),it(t.distance)||(r=t.distance),it(t.disableAdsorb)||(i=t.disableAdsorb);var n=it(t.pageX)?v:t.pageX,o=it(t.pageY)?_:t.pageY,s=it(t.scale)?m:t.scale,a={x:"none",y:"none"};it(t.pageX)||(a.x=n===y?k:n<y?"left":"right",k=a.x),it(t.pageY)||(a.y=o===b?w:o<b?"up":"down",w=a.y);var h=it(t.offsetX)?(n-v)/s:t.offsetX,l=it(t.offsetY)?(o-_)/s:t.offsetY,u=g+l,x={left:f+h-d.left,top:u-d.top};it(t.pageX)||n!==y||(x.left=0),it(t.pageY)||o!==b||(x.top=0),it(t.pageX)||it(t.pageY)||n!==y||o!==b||(i=!0);var S=x;return i||(e.setCurrent(d),x=e.getAdsorbDelta(x,r||5,a)),d.left+=x.left,d.top+=x.top,y=n,b=o,{raw:S,delta:x,offset:{left:d.left-f,top:d.top-g},rect:Object(c.a)({},d)}}}}]),t}();var ot,st,at=i(50),rt=i(17),ht=i.n(rt),lt=i(12),ut=i.n(lt),dt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this)).props=void 0,n._id=function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}(),n.type=void 0,n.name=void 0,n.name2=void 0,n.x=0,n.y=0,n.center=[0,0],n.angle=0,n.scale=1,n.anchor=[0,0],n.visible=!0,n.movable=!0,n.hovered=!1,n.selected=!1,n.dragging=!1,n.rotating=!1,n.resizing=!1,n.isEditing=!1,n.isAlarm=!1,n.mode=L.Show,n._children=new Map,n._styles={},n._clients={},n._attributes={},n.styles={},n.clients={},n.attributes={},n.icons=[],n.debug=!0,n.ui2d=z.NodeUI,n.ui3d=O.CubeUI,n.width=0,n.height=0,n.size=[0,0],n.image="",n.parent=void 0,n._points=[],n._obb=new K([]),n._aabb=new w,n._matrix=y.a.create(),n._grids={x:[],y:[]},n.rects=[],n.refLine=new nt({rects:[],current:{key:"",left:0,top:0,width:0,height:0,rotate:0}}),n.updater=void 0,n.props=t||{},n.props.styles&&(n.props.styles=Object(c.a)(Object(c.a)({},N),n.props.styles)),n._id=(null===t||void 0===t?void 0:t.id)||n._id,n.type=(null===t||void 0===t?void 0:t.type)||D.Element,n.name=(null===t||void 0===t?void 0:t.name)||"",n.name2=(null===t||void 0===t?void 0:t.name2)||"",n.image=(null===t||void 0===t?void 0:t.image)||"",n.angle=(null===t||void 0===t?void 0:t.angle)||0,n.width=(null===t||void 0===t?void 0:t.width)||32,n.height=(null===t||void 0===t?void 0:t.height)||32,n.x=(null===t||void 0===t?void 0:t.x)||0,n.y=(null===t||void 0===t?void 0:t.y)||0,n.center=[n.x,n.y],n.anchor=[n.x,n.y],n.size=[n.width,n.height],n.visible=void 0===(null===t||void 0===t?void 0:t.visible)||!(null===t||void 0===t||!t.visible),n.movable=void 0===(null===t||void 0===t?void 0:t.movable)||!(null===t||void 0===t||!t.movable),n.hovered=void 0!==(null===t||void 0===t?void 0:t.hovered)&&!(null===t||void 0===t||!t.hovered),n.selected=void 0!==(null===t||void 0===t?void 0:t.selected)&&!(null===t||void 0===t||!t.selected),n.dragging=void 0!==(null===t||void 0===t?void 0:t.dragging)&&!(null===t||void 0===t||!t.dragging),n.mode=(null===t||void 0===t?void 0:t.mode)||L.Show,n.icons=(null===t||void 0===t?void 0:t.icons)||[],n.debug=void 0!==(null===t||void 0===t?void 0:t.debug)&&!(null===t||void 0===t||!t.debug),n.ui2d=(null===t||void 0===t?void 0:t.ui2d)||z.NodeUI,n.ui3d=(null===t||void 0===t?void 0:t.ui3d)||O.CubeUI,n._matrix=n._angleToMatrix(n.angle),n._grids||(n._grids={x:[],y:[]}),n.styles=new Proxy(n._styles,{get:function(t,e){return n.getStyle(e)},set:function(t,e,i){return n.setStyle(e,i),!0}}),n.clients=new Proxy(n._clients,{get:function(t,e){return n.getClient(e)},set:function(t,e,i){return n.setClient(e,i),!0}}),n._styles=n.props.styles||Object(c.a)({},N),n._clients=n.props.clients||{},Object(p.a)(n,new Proxy(Object(v.a)(n),{get:function(t,e){var i=t[e];return Object(b.c)(i)?void 0:i},set:function(t,e,i){var o=t[e];if(Object(b.d)(i)){if(Object(b.e)(t[e],i))return!0}else if(Object(b.a)(t[e],i))return!0;t[e]=i,"center"===e?(t.x=i[0],t.y=i[1],n._updatePoints()):"angle"===e&&n._updateRotate(o,i);var s=i;return n.emit(Z.AttributeChange,{source:Object(v.a)(n),prop:e,oldValue:o,newValue:s}),!0}}))}return Object(h.a)(i,[{key:"_updatePoints",value:function(){}},{key:"_updateSize",value:function(){if(this._points){var t=w.fromPoints(this._points);this.x=t.x+t.width/2,this.y=t.y+t.height/2,this.center=[this.x,this.y],this.width=t.width,this.height=t.height,this.size=[t.width,t.height],this._matrix=this._angleToMatrix(this.angle)}}},{key:"_updateRotate",value:function(t,e){this._matrix=this._angleToMatrix(this.angle)}},{key:"setStyle",value:function(t,e){var i=this._styles[t];if(!Object(b.a)(i,e)){this._styles[t]=e;var n=e;this.emit(Z.StyleChange,{source:this,key:t,oldValue:i,newValue:n})}}},{key:"getStyle",value:function(t){var e=this._styles[t];return Object(b.b)(e)?void 0:e}},{key:"removeStyle",value:function(t){delete this._styles[t]}},{key:"setClient",value:function(t,e){var i=this._clients[t];if(!Object(b.a)(i,e)){this._clients[t]=e;var n=e;this.emit(Z.ClientChange,{source:this,key:t,oldValue:i,newValue:n})}}},{key:"getClient",value:function(t){var e=this._clients[t];return Object(b.b)(e)?void 0:e}},{key:"removeClient",value:function(t){delete this._clients[t]}},{key:"destroy",value:function(){}},{key:"translation",value:function(t,e){this.center=[this.center[0]+t,this.center[1]+e];var i=this._angleToMatrix(this.angle);this._matrix=i}},{key:"id",get:function(){return this._id}},{key:"getAABB",value:function(){return this._aabb}},{key:"getInnerAABB",value:function(){return this._aabb}},{key:"getOBB",value:function(){return this._obb}},{key:"getBoundingBox",value:function(t){return new w(0,0,0,0)}},{key:"getHitArea",value:function(t){return[]}},{key:"_angleToMatrix",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.angle,e=this.center,i=Math.sin(t*M),n=Math.cos(t*M),o=e[0]*(1-n)+e[1]*i,s=e[1]*(1-n)-e[0]*i,a=y.a.fromValues(n,i,-i,n,o,s);return a}},{key:"gatherRects",value:function(t){var e=this;this.rects=[],t.forEach((function(t){var i;t.id!==e.id&&(null===(i=e.rects)||void 0===i||i.push({key:t.id,left:t.x-t.width/2,top:t.y-t.height/2,width:t.width,height:t.height,rotate:t.angle}))}));this.refLine=new nt({rects:this.rects,current:{key:this.id,left:this.x-this.width/2,top:this.y-this.height/2,width:this.width,height:this.height,rotate:this.angle}}),this.updater=this.refLine.adsorbCreator({pageX:this.x,pageY:this.y,distance:24})}},{key:"getCenter",value:function(){return{x:this.x,y:this.y}}},{key:"points",get:function(){return this._points},set:function(t){var e=this._points;this._points=t;var i=t;this._updatePoints(),this._updateSize(),this._matrix=this._angleToMatrix(this.angle),this.emit(Z.AttributeChange,{source:this,props:"points",oldValue:e,newValue:i})}},{key:"addPoint",value:function(t){if(t){var e=this._points;this._points.push(t);var i=this._points;this.emit(Z.AttributeChange,{source:this,oldValue:e,newValue:i})}}},{key:"removePoint",value:function(t){var e=Object(at.clone)(this._points);delete this._points[t];var i=this._points;this.emit(Z.AttributeChange,{source:this,oldValue:e,newValue:i})}},{key:"removeLastPoint",value:function(){var t=this._points;if(t){var e=Object(at.clone)(t);t.pop();var i=Object(at.clone)(t);this._updatePoints(),this.emit(Z.AttributeChange,{source:this,oldValue:e,newValue:i})}}},{key:"updatePoint",value:function(t,e){var i=this;if(t instanceof Array){var n=Object(at.clone)(this._points);t.forEach((function(t){i._points[t]=e[t]}));var o=this._points;this._updateSize(),this.emit(Z.AttributeChange,{source:this,oldValue:n,newValue:o})}else{var s=this._points[t];this._points[t]=e;var a=e;this._updateSize(),this.emit(Z.AttributeChange,{source:this,oldValue:s,newValue:a})}}},{key:"translatePoint",value:function(t,e){var i=this;if(t instanceof Array){var n=Object(at.clone)(this._points);t.forEach((function(t,n){i._points[t][0]+=e[n][0],i._points[t][1]+=e[n][1]}));var o=this._points;this._updateSize(),this.emit(Z.AttributeChange,{source:this,oldValue:n,newValue:o})}else{var s=this._points[t];this._points[t][0]+=e[0],this._points[t][1]+=e[1];var a=this._points[t];this._updateSize(),this.emit(Z.AttributeChange,{source:this,oldValue:s,newValue:a})}this._matrix=this._angleToMatrix(this.angle)}},{key:"scaled",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.Center,i=y.b.fromValues(this.x,this.y);switch(e){case j.Center:i=y.b.fromValues(this.x,this.y);break;case j.Top:i=y.b.fromValues(this.x,this.y-this.height/2);break;case j.Right:i=y.b.fromValues(this.x+this.width/2,this.y);break;case j.Bottom:i=y.b.fromValues(this.x,this.y+this.height/2);break;case j.Left:i=y.b.fromValues(this.x-this.width/2,this.y);break;case j.TopLeft:i=y.b.fromValues(this.x-this.width/2,this.y-this.height/2);break;case j.TopRight:i=y.b.fromValues(this.x+this.width/2,this.y-this.height/2);break;case j.BottomRight:i=y.b.fromValues(this.x+this.width/2,this.y+this.height/2);break;case j.BottomLeft:i=y.b.fromValues(this.x-this.width/2,this.y+this.height/2)}this._points.forEach((function(e){var n=y.b.create();y.b.scale(n,y.b.fromValues(e[0]-i[0],e[1]-i[1]),t),y.b.add(n,i,n),e[0]=n[0],e[1]=n[1]})),this._updateSize(),this._updatePoints()}},{key:"updateLastPoint",value:function(t){if(t){var e=this._points.length-1;e>=0&&this.updatePoint(e,t)}}},{key:"getEditorPoints",value:function(){return this._points}},{key:"addChild",value:function(t){var e;null===(e=this._children)||void 0===e||e.set(t.id,t),t.parent=this,this.emit(Z.ChildrenChangeAdd,{source:this,prop:"children",oldValue:void 0,newValue:t})}},{key:"removeChild",value:function(t){this._children.get(t.id)&&(t.parent=void 0,this._children.delete(t.id),this.emit(Z.ChildrenChangeRemove,{source:this,prop:"children",oldValue:void 0,newValue:t}))}},{key:"getChildren",value:function(){return this._children}},{key:"getChildById",value:function(t){return this._children.get(t)}},{key:"clearChildren",value:function(){var t=Object(at.clone)(this._children);this._children.clear();var e=this._children;this.emit(Z.ChildrenChangeRemove,{source:this,prop:"children",oldValue:t,newValue:e})}},{key:"getRotatedPoints",value:function(){for(var t=Object(at.clone)(this._points),e=this._angleToMatrix(this.angle),i=[],n=0,o=t.length;n<o;n++){var s=y.b.create(),a=t[n],r=y.b.transformMat2d(s,y.b.fromValues(a[0],a[1]),y.a.clone(e));i[n]=[r[0],r[1]]}return i}},{key:"getOffsetPoints",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"chamfer",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.points;if(n.length<3)return[];var o=ht.a.fromPoints({closed:!0},n),s=Object(R.offset)({delta:t,corners:e,segments:i},o),a=ht.a.toPoints(s);return a}},{key:"getInnerPoints",value:function(){var t=this.styles.offsetDelta||0;return this.getOffsetPoints(t)}},{key:"toSides",value:function(){var t=this._points,e=ut.a.fromPoints(t);return ut.a.toSides(e)}},{key:"serialize",value:function(){return{id:this._id,type:this.type,name:this.name,name2:this.name2,image:this.image,points:this.points,size:this.size,center:this.center,angle:this.angle,mode:L.Show,movable:this.movable,visible:this.visible,selected:this.selected,hovered:this.hovered,attributes:this.attributes,geometries:{},clients:this._clients,styles:this._styles}}},{key:"deserialize",value:function(t){}},{key:"isRectangle",value:function(){return!1}}]),i}(g.EventEmitter),ct=i(141),vt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,Object(c.a)({type:D.Node},t)))._updatePoints(),n}return Object(h.a)(i,[{key:"getBoundingBox",value:function(t){var e=this.getAABB().clone(),i=new w(e.x,e.y,e.width,e.height);return t&&"number"===typeof t?(i.x-=t,i.y-=t,i.width+=2*t,i.height+=2*t):t&&"object"===typeof t&&(i.x-=t.left||0,i.y-=t.top||0,i.width+=(t.left||0)+(t.right||0),i.height+=(t.top||0)+(t.bottom||0)),i}},{key:"_updatePoints",value:function(){var t=ct.primitives.rectangle({center:[this.x,this.y],size:[this.width,this.height]}),e=ct.geometries.geom2.toPoints(t);if(0!==this.angle){var i=this._angleToMatrix(this.angle);this._matrix=i;for(var n=[],o=0,s=e.length;o<s;o++){var a=y.b.create(),r=e[o],h=y.b.transformMat2d(a,y.b.fromValues(r[0],r[1]),y.a.clone(i));n[o]=[h[0],h[1]]}this._points=n}else this._points=e}},{key:"getAABB",value:function(){return this._updatePoints(),w.fromPoints(this._points)}},{key:"getOBB",value:function(t){var e=[];return this._points.map((function(t){e.push([t[0],t[1]])})),new K(e)}}]),i}(dt),_t=i(78),ft=i.n(_t),gt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;Object(r.a)(this,i),(n=e.call(this,Object(c.a)({type:D.Shape},t))).ui2d=z.ShapeUI,n._points=(null===t||void 0===t?void 0:t.points)||[];var o=w.fromPoints(n._points);return n.x=o.x+o.width/2,n.y=o.y+o.height/2,n.center=[n.x,n.y],n._updateSize(),n._matrix=n._angleToMatrix(n.angle),n}return Object(h.a)(i,[{key:"_updateRotate",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.angle,i=this._points,n=this._angleToMatrix(-1*t),o=[],s=0,a=i.length;s<a;s++){var r=y.b.create(),h=i[s],l=y.b.transformMat2d(r,y.b.fromValues(h[0],h[1]),y.a.clone(n));o[s]=[l[0],l[1]]}for(var u=this._angleToMatrix(e),d=[],c=0,v=o.length;c<v;c++){var _=y.b.create(),f=o[c],g=y.b.transformMat2d(_,y.b.fromValues(f[0],f[1]),y.a.clone(u));d[c]=[g[0],g[1]]}this._points=d,this._matrix=u}},{key:"getBoundingBox",value:function(t){var e=this.getAABB().clone(),i=new w(e.x,e.y,e.width,e.height);return t&&"number"===typeof t?(i.x-=t,i.y-=t,i.width+=2*t,i.height+=2*t):t&&"object"===typeof t&&(i.x-=t.left||0,i.y-=t.top||0,i.width+=(t.left||0)+(t.right||0),i.height+=(t.top||0)+(t.bottom||0)),i}},{key:"getAABB",value:function(){var t=w.fromPoints(this._points);return this._aabb=t,t}},{key:"getInnerAABB",value:function(){var t=this.styles.offsetDelta||0,e=this.getOffsetPoints(t),i=w.fromPoints(e);return this._aabb=i,i}},{key:"getOBB",value:function(){this._aabb=this.getAABB();var t=new K(this._points);return this._obb=t,this._obb}},{key:"getCenter",value:function(){var t=this.getAABB();return{x:t.x+t.width/2,y:t.y+t.height/2}}},{key:"translation",value:function(t,e){var i=this._points,n=[];i.forEach((function(i){n.push([i[0]+t,i[1]+e])})),this._points=n,this._updateSize(),this._matrix=this._angleToMatrix(this.angle)}},{key:"splitPolygon",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.from,o=t.to;if(!t)return{intersectionCount:0,polygons:[]};var s=this,a=[],r=[],h=!1,l=0;if(i)for(var u=-1*t.styles.offsetDelta,d=t.getAlongPoints(u),c=[[d.from[0],d.from[1]],[d.to[0],d.to[1]]],v=0;v<e.length;v++){var _=v==e.length-1?[e[v],e[0]]:[e[v],e[v+1]],f=s.getT(c,_),g=s.getU(c,_);0<=f&&f<=1&&0<=g&&g<=1?(l++,h=!h,r.push(s.getIntersection(c,f)),1==l&&(a.push(e[v]),r.push(e[v+1])),a.push(s.getIntersection(c,f))):h?r.push(e[v+1]):a.push(e[v])}else for(var m=[[n[0],n[1]],[o[0],o[1]]],p=0;p<e.length;p++){var y=p==e.length-1?[e[p],e[0]]:[e[p],e[p+1]],b=s.getT(m,y),k=s.getU(m,y);0<=b&&b<=1&&0<=k&&k<=1?(l++,h=!h,r.push(s.getIntersection(m,b)),1==l&&(a.push(e[p]),r.push(e[p+1])),a.push(s.getIntersection(m,b))):h?r.push(e[p+1]):a.push(e[p])}return{intersectionCount:l,polygons:[a,r]}}},{key:"getT",value:function(t,e){return((t[0][0]-e[0][0])*(e[0][1]-e[1][1])-(t[0][1]-e[0][1])*(e[0][0]-e[1][0]))/((t[0][0]-t[1][0])*(e[0][1]-e[1][1])-(t[0][1]-t[1][1])*(e[0][0]-e[1][0]))}},{key:"getU",value:function(t,e){return-((t[0][0]-t[1][0])*(t[0][1]-e[0][1])-(t[0][1]-t[1][1])*(t[0][0]-e[0][0]))/((t[0][0]-t[1][0])*(e[0][1]-e[1][1])-(t[0][1]-t[1][1])*(e[0][0]-e[1][0]))}},{key:"getIntersection",value:function(t,e){return[t[0][0]+e*(t[1][0]-t[0][0]),t[0][1]+e*(t[1][1]-t[0][1])]}}],[{key:"angleToMatrix",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=Math.sin(e*M),n=Math.cos(e*M),o=t[0]*(1-n)+t[1]*i,s=t[1]*(1-n)-t[0]*i,a=y.a.fromValues(n,i,-i,n,o,s);return a}},{key:"fromNode",value:function(t,e,n){var o=F.a.rectangle({center:[t[0],t[1]],size:[e[0],e[1]]}),s=ft.a.geom2.toPoints(o);return new i(Object(c.a)({points:s},n))}}]),i}(dt),mt=i(55),pt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,Object(c.a)({type:D.ShapeLine},t))).dash=void 0,n.ui2d=z.ShapeLineUI,n._points=(null===t||void 0===t?void 0:t.points)||[],n.dash=null===t||void 0===t?void 0:t.dash,n._updateSize(),n}return Object(h.a)(i,[{key:"getBoundingBox",value:function(t){var e=this.getAABB().clone(),i=new w(e.x,e.y,e.width,e.height);return t&&"number"===typeof t?(i.x-=t,i.y-=t,i.width+=2*t,i.height+=2*t):t&&"object"===typeof t&&(i.x-=t.left||0,i.y-=t.top||0,i.width+=(t.left||0)+(t.right||0),i.height+=(t.top||0)+(t.bottom||0)),i}},{key:"getAABB",value:function(){var t=w.fromPoints(this._points);return this._aabb=t,t}},{key:"getOBB",value:function(){this._aabb=this.getAABB();var t=new K(this._points);return this._obb=t,this._obb}},{key:"getHitArea",value:function(t){this._aabb=this.getAABB();var e=this._matrix,i=[];this._points.map((function(t){var n=y.b.create(),o=y.b.transformMat2d(n,y.b.fromValues(t[0],t[1]),y.a.clone(e));i.push([o[0],o[1]])}));var n=new K(i);if(this._obb=n,t&&t&&"number"===typeof t){if(i.length<3)return[];var o=ht.a.fromPoints({closed:!1},i),s=Object(R.expand)({delta:t,corners:"edge",segments:8},o),a=ut.a.toPoints(s),r=[];return a.forEach((function(t){r.push([t[0],t[1]])})),r}return[]}},{key:"getCenter",value:function(){var t=this.getAABB();return{x:t.x+t.width/2,y:t.y+t.height/2}}},{key:"translation",value:function(t,e){var i=this._points,n=[];i.forEach((function(i){n.push([i[0]+t,i[1]+e])})),this._points=n,this._updateSize()}}]),i}(dt),yt=i(27),bt=i(102),kt=i.n(bt),wt=function(){function t(e){Object(r.a)(this,t),this._maxLength=100,this._history=[],this._position=-1,this._initialState=void 0,this._isExceeded=!1,this._suspendSave=!1,this._onUpdate=function(){return 0},this._onBeforeSave=function(){return 0},this._onMaxLength=function(){return 0},this._provider=function(){return 0},e&&e.provider&&(this._provider=e.provider),this._maxLength=(null===e||void 0===e?void 0:e.maxLength)||100,this._initiliaze()}return Object(h.a)(t,[{key:"_initiliaze",value:function(){this._initialState=void 0,this._history=[],this._isExceeded=!1,this._position=-1}},{key:"_checkMaxLength",value:function(){this._history.length>this._maxLength?(this._history=this._history.slice(1,this._history.length),this._isExceeded||(this._onMaxLength({action:"max",position:this._position,current:this.current(),history:this.history(),scope:this}),this._isExceeded=!0)):this._isExceeded=!1}},{key:"_rejectSave",value:function(t,e){return this._isEqual(t,this.current())||!1===e||this._suspendSave}},{key:"_isEqual",value:function(t,e){if(t===e)return!0;var i,n,o,s=Array.isArray(t),a=Array.isArray(e);if(s&&a){if((n=t.length)!=e.length)return!1;for(i=0;i<n;i++)if(!this._isEqual(t[i],e[i]))return!1;return!0}if(s!=a)return!1;var r=t instanceof Date,h=e instanceof Date;if(r!=h)return!1;if(r&&h)return t.getTime()==e.getTime();var l=t instanceof RegExp,u=e instanceof RegExp;if(l!=u)return!1;if(l&&u)return t.toString()==e.toString();if(t instanceof Map&&e instanceof Map)return function(t,e){var i;if(t.size!==e.size)return!1;var n,o=Object(yt.a)(t);try{for(o.s();!(n=o.n()).done;){var s=Object(x.a)(n.value,2),a=s[0],r=s[1];if((i=e.get(a))!==r||void 0===i&&!e.has(a))return!1}}catch(h){o.e(h)}finally{o.f()}return!0}(t,e);if(t instanceof Object&&e instanceof Object){var d=Object.keys(t);if((n=d.length)!==Object.keys(e).length)return!1;for(i=0;i<n;i++)if(!Object.prototype.hasOwnProperty.call(e,d[i]))return!1;for(i=0;i<n;i++)if(o=d[i],!this._isEqual(t[o],e[o]))return!1;return!0}return!1}},{key:"canUndo",value:function(){return this._position>0}},{key:"canRedo",value:function(){return this._position<this._history.length-1}},{key:"import",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(t))throw new TypeError("Items must be an array");return this._initiliaze(),this._history=t,this._position=this._history.length-1,this._initialState=t[0],this}},{key:"history",value:function(){return this._history}},{key:"save",value:function(t){var e=t;"undefined"===typeof e&&"function"===typeof this._provider&&(e=this._provider());var i=this._onBeforeSave({action:"beforesave",position:this._position,history:this._history,current:this.current(),scope:this});return e=i||e,this._rejectSave(e,i)||(this._position<this._history.length-1&&(this._history=this._history.slice(0,this._position+1)),"undefined"!==typeof e&&(e instanceof Map?this._history.push(kt()(e)):this._history.push(JSON.parse(JSON.stringify(e))),void 0===this._initialState&&(this._initialState=e)),this._checkMaxLength(),this._position=this._history.length-1,this._onUpdate({action:"save",position:this._position,current:this.current(),history:this.history(),scope:this})),this}},{key:"suspendSave",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._suspendSave=t,this}},{key:"allowedSave",value:function(){return!this._suspendSave}},{key:"clear",value:function(){return this._initiliaze(),this._onUpdate({action:"clear",position:this._position,current:null,history:this.history(),scope:this}),this}},{key:"undo",value:function(t){return this.canUndo()&&(this._position--,"function"===typeof t&&t(this.current()),this._onUpdate({action:"undo",position:this._position,current:this.current(),history:this.history(),scope:this})),this}},{key:"redo",value:function(t){return this.canRedo()&&(this._position++,"function"===typeof t&&t(this.current()),this._onUpdate({action:"redo",position:this._position,current:this.current(),history:this.history(),scope:this})),this}},{key:"position",get:function(){return this._position}},{key:"current",value:function(){return this._history.length?this._history[this._position]:null}},{key:"count",value:function(){return this._history.length?this._history.length-1:0}},{key:"maxLength",set:function(t){this._maxLength=t}},{key:"initialState",value:function(){return this._initialState}},{key:"onUpdate",value:function(e){return t.callbackError(e),this._onUpdate=e,this}},{key:"onMaxLength",value:function(e){return t.callbackError(e),this._onMaxLength=e,this}},{key:"onBeforeSave",value:function(e){return t.callbackError(e),this._onBeforeSave=e,this}}],[{key:"callbackError",value:function(t){if("function"!==typeof t)throw new TypeError("callback must be a function")}}]),t}(),xt=function(){function t(){Object(r.a)(this,t),this._commands=[],this._cursor=-1,this._suspended=!1,this._limit=100,this._batch=void 0,this._onUpdate=function(){return 0},this._onBeforeAdd=function(){return 0},this._onLimited=function(){return 0},this._onSuspended=function(){return 0},this._provider=function(){return 0},console.log("init Command Manager")}return Object(h.a)(t,[{key:"add",value:function(t){var e=this._batch,i=this._commands;this._onBeforeAdd({cursor:this._cursor,action:"beforeAdd",current:this.current(),commands:this._commands,scope:this}),this._suspended?this._onSuspended({cursor:this._cursor,action:"suspended",current:this.current(),commands:this._commands,scope:this}):!e||t instanceof Array?(this._cursor!==i.length-1&&i.splice(this._cursor+1,i.length),0!==this._limit&&i.length===this._limit&&(this._onLimited({action:"limit",cursor:this._cursor,current:this.current(),commands:this._commands,scope:this}),i.splice(0,1)),i.push(t),this._cursor=i.length-1,this._onUpdate({action:"add",cursor:this._cursor,current:this.current(),commands:this._commands,scope:this})):e.push(t)}},{key:"undo",value:function(t){var e=this._commands;if(!this.canUndo())return console.log("can not undo!"),this;var i=e[this._cursor--];if(this._suspended=!0,i instanceof Array)for(var n=i.length-1;n>=0;n--)i[n].undo();else i.undo();return this._suspended=!1,t&&"function"===typeof t&&t(this.current()),this._onUpdate({action:"undo",cursor:this._cursor,current:this.current(),commands:this._commands,scope:this}),this}},{key:"redo",value:function(t){var e=this._commands;if(!this.canRedo())return console.log("can not redo!"),this;var i=e[++this._cursor];return this._suspended=!0,i instanceof Array?i.forEach((function(t){t.redo()})):i.redo(),this._suspended=!1,"function"===typeof t&&t(this.current()),this._onUpdate({action:"redo",cursor:this._cursor,current:this.current(),commands:this._commands,scope:this}),this}},{key:"onUpdate",value:function(e){return t.callbackError(e),this._onUpdate=e,this}},{key:"onLimited",value:function(e){return t.callbackError(e),this._onLimited=e,this}},{key:"onSuspended",value:function(e){return t.callbackError(e),this._onSuspended=e,this}},{key:"onBeforeAdd",value:function(e){return t.callbackError(e),this._onBeforeAdd=e,this}},{key:"canUndo",value:function(){return this._cursor>=0}},{key:"canRedo",value:function(){return this._cursor<this._commands.length-1}},{key:"size",value:function(){return this._commands.length}},{key:"cursor",get:function(){return this._cursor}},{key:"clear",value:function(){return this._commands=[],this._cursor=-1,this}},{key:"current",value:function(){return this._commands[this._cursor]}},{key:"commands",get:function(){return this._commands}},{key:"limit",get:function(){return this._limit},set:function(t){this._limit=t}},{key:"suspended",get:function(){return this._suspended},set:function(t){this._suspended=t}},{key:"suspendAdd",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._suspended=t,this}},{key:"allowedAdd",value:function(){return!this._suspended}},{key:"startBatch",value:function(){return this._batch||(this._batch=[]),this}},{key:"endBatch",value:function(){if(this._batch){var t=kt()(this._batch);this._batch=void 0,t.length>0&&this.add(t)}return this}},{key:"batch",value:function(t,e){return this.startBatch(),t&&t.call(e),this.endBatch(),this}},{key:"isBatching",value:function(){return!!this._batch}}],[{key:"callbackError",value:function(t){if("function"!==typeof t)throw new TypeError("callback must be a function")}}]),t}(),St=i(23),Mt=i(20),Et=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,Object(c.a)({type:D.Node},t)))._edges=new Set,n._fromEdges=new Set,n._toEdges=new Set,n.width=16,n.height=16,n.image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg==",n._updatePoints(),n}return Object(h.a)(i,[{key:"translation",value:function(t,e){var n=this;Object(St.a)(Object(Mt.a)(i.prototype),"translation",this).call(this,t,e),this.edges.forEach((function(t){var e=t.from;(null===e||void 0===e?void 0:e.id)===n.id&&t.emit(Z.AttributeChange,{source:t,prop:"_from"});var i=t.to;(null===i||void 0===i?void 0:i.id)===n.id&&t.emit(Z.AttributeChange,{source:t,prop:"_to"})}));var o=this.parent;o&&o.emit(Z.AttributeChange,{source:o,prop:"child"})}},{key:"addToEdge",value:function(t){this._toEdges.add(t)}},{key:"addFromEdge",value:function(t){this._fromEdges.add(t)}},{key:"deleteEdge",value:function(t){this._fromEdges.delete(t),this._toEdges.delete(t)}},{key:"edges",get:function(){return this._edges=new Set([].concat(Object(Y.a)(this._fromEdges),Object(Y.a)(this._toEdges))),this._edges}},{key:"getFromEdges",value:function(){return this._fromEdges}},{key:"getToEdges",value:function(){return this._toEdges}},{key:"getEdgeById",value:function(t){var e=this.edges;console.log(e)}},{key:"clearEdge",value:function(){this._fromEdges.clear(),this._toEdges.clear(),this._edges.clear()}}]),i}(vt),Ct=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,Object(c.a)(Object(c.a)({type:D.Edge},t),{},{styles:{zIndex:B.BottomZIndex}})))._from=void 0,n._to=void 0,n.ui2d=z.EdgeUI,n.from=null===t||void 0===t?void 0:t.from,n.to=null===t||void 0===t?void 0:t.to,n._updatePoints(),n._updateSize(),n}return Object(h.a)(i,[{key:"_updatePoints",value:function(){var t=this._from,e=this._to;if(t&&e){var i=[t.center,e.center];if(0!==this.angle){var n=this._angleToMatrix();this._matrix=n;for(var o=[],s=0,a=i.length;s<a;s++){var r=y.b.create(),h=i[s],l=y.b.transformMat2d(r,y.b.fromValues(h[0],h[1]),y.a.clone(n));o[s]=[l[0],l[1]]}this._points=o}else this._points=i}}},{key:"getCenter",value:function(){var t=this.getAABB();return{x:t.x+t.width/2,y:t.y+t.height/2}}},{key:"translation",value:function(t,e){}},{key:"getHitArea",value:function(t){this._aabb=this.getAABB();var e=this._matrix,i=[];this._points.map((function(t){var n=y.b.create(),o=y.b.transformMat2d(n,y.b.fromValues(t[0],t[1]),y.a.clone(e));i.push([o[0],o[1]])}));var n=new K(i);if(this._obb=n,t&&t&&"number"===typeof t){if(i.length<2)return[];var o=[],s=ht.a.fromPoints({closed:!1},i),a=Object(R.offset)({delta:t,corners:"edge",segments:8},s);ht.a.toPoints(a).forEach((function(t){o.push([t[0],t[1]])}));var r=Object(R.offset)({delta:-t,corners:"edge",segments:8},s);if(ht.a.toPoints(r).forEach((function(t){o.push([t[0],t[1]])})),4===o.length){var h=Object(mt.hull)(ut.a.fromPoints(o));return ut.a.toPoints(h)}return W(o)}return[]}},{key:"from",get:function(){return this._from},set:function(t){if(t){var e=this._from;this._from=t;var i=t;t.addToEdge(this),this._updatePoints(),this._updateSize(),this.emit(Z.AttributeChange,{source:this,props:"_from",oldValue:e,newValue:i})}}},{key:"to",get:function(){return this._to},set:function(t){if(t){var e=this._to;this._to=t,t.addFromEdge(this);var i=t;this._updatePoints(),this._updateSize(),this.emit(Z.AttributeChange,{source:this,props:"_to",oldValue:e,newValue:i})}}},{key:"getAlongPoints",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this._from,i=this._to;if(!e||!i)return{p0:[0,0],p1:[0,0]};var n=e.center,o=i.center,s=(y.b.fromValues(o[0]-n[0],o[1]-n[1]),(o[1]-n[1])/(o[0]-n[0])),a=o[0]-n[0]>0?1:-1;return{p0:[n[0]-a*t,n[1]-a*t*s],p1:[o[0]+a*t,o[1]+a*t*s]}}},{key:"_updateSize",value:function(){}},{key:"serialize",value:function(){return{id:this._id,type:this.type,name:this.name,name2:this.name2,image:this.image,points:this.points,size:this.size,center:this.center,angle:this.angle,mode:L.Show,movable:this.movable,visible:this.visible,selected:this.selected,hovered:this.hovered,from:this._from,to:this._to,attributes:this.attributes,geometries:{},clients:this._clients,styles:this._styles}}}]),i}(vt),zt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,Object(c.a)({type:D.Group},t))).ui2d=z.GroupUI,n}return Object(h.a)(i,[{key:"points",get:function(){var t=this._children,e=[];if(t.forEach((function(t){e.push(t.center)})),e.length>=3){var i=ut.a.fromPoints(e),n=Object(mt.hull)(i),o=(ut.a.toPoints(n),ht.a.fromPoints({closed:!1},e)),s=Object(R.expand)({delta:20,corners:"round",segments:20},o),a=ut.a.toPoints(s),r=[];a.forEach((function(t){r.push([t[0],t[1]])})),this._points=r}else this._points=e;return this._points}}]),i}(gt);!function(t){t.KeyDown="KeyDown",t.KeyUp="KeyUp",t.CtrlKey="CtrlKey",t.CtrlKeyDown="CtrlKeyDown",t.CtrlKeyUp="CtrlKeyUp",t.ShiftKey="ShiftKey",t.ShiftKeyDown="ShiftKeyDown",t.ShiftKeyUp="ShiftKeyUp",t.AltKey="AltKey",t.AltKeyDown="AltKeyDown",t.AltKeyUp="AltKeyUp"}(ot||(ot={})),function(t){t.DoubleClick="DoubleClick",t.Click="Click",t.Scale="Scale",t.Drag="Drag",t.Move="Move",t.Hover="Hover",t.Sleep="Sleep",t.DragStart="DragStart",t.Dragging="Dragging",t.DragEnd="DragEnd",t.RotateStart="RotateStart",t.Rotating="Rotating",t.RotateEnd="RotateEnd",t.UnableResize="UnableResize",t.ResizeStart="ResizeStart",t.Resizing="Resizing",t.ResizeEnd="ResizeEnd"}(st||(st={}));var Ot,Lt=i(5),Pt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(r.a)(this,i),(t=e.call(this))._dirty=!0,t._backgroundFillAlpha=1,t._backgroundFillColor=0,t._backgroundVisible=!1,t._graphHeight=1e3,t._graphWidth=1e3,t._intermediateGridSize=50,t._intermediateGridVisible=!0,t._intermediateStrokeAlpha=1,t._intermediateStrokeColor=3223857,t._intermediateStrokeWeight=1,t._majorGridSize=100,t._majorGridVisible=!0,t._majorStrokeAlpha=1,t._majorStrokeColor=4342338,t._majorStrokeWeight=2,t._minorGridSize=10,t._minorGridVisible=!0,t._minorStrokeAlpha=1,t._minorStrokeColor=2763306,t._minorStrokeWeight=.25,t._graphics=void 0,t._reflines=[],t.set(n),t._graphics=new Lt.d,t.addChild(t._graphics),t._dirty=!0,t}return Object(h.a)(i,[{key:"backgroundFillAlpha",get:function(){return this._backgroundFillAlpha},set:function(t){this._backgroundFillAlpha!==t&&(this._backgroundFillAlpha=t,this._dirty=!0)}},{key:"backgroundFillColor",get:function(){return this._backgroundFillColor},set:function(t){this._backgroundFillColor!==t&&(this._backgroundFillColor=t,this._dirty=!0)}},{key:"backgroundVisible",get:function(){return this._backgroundVisible},set:function(t){this._backgroundVisible!==t&&(this._backgroundVisible=t,this._dirty=!0)}},{key:"graphHeight",get:function(){return this._graphHeight},set:function(t){this._graphHeight!==t&&(this._graphHeight=t,this._dirty=!0)}},{key:"graphWidth",get:function(){return this._graphWidth},set:function(t){this._graphWidth!==t&&(this._graphWidth=t,this._dirty=!0)}},{key:"intermediateGridSize",get:function(){return this._intermediateGridSize},set:function(t){this._intermediateGridSize!==t&&(this._intermediateGridSize=t,this._dirty=!0)}},{key:"intermediateGridVisible",get:function(){return this._intermediateGridVisible},set:function(t){this._intermediateGridVisible!==t&&(this._intermediateGridVisible=t,this._dirty=!0)}},{key:"intermediateStrokeAlpha",get:function(){return this._intermediateStrokeAlpha},set:function(t){this._intermediateStrokeAlpha!==t&&(this._intermediateStrokeAlpha=t,this._dirty=!0)}},{key:"intermediateStrokeColor",get:function(){return this._intermediateStrokeColor},set:function(t){this._intermediateStrokeColor!==t&&(this._intermediateStrokeColor=t,this._dirty=!0)}},{key:"intermediateStrokeWeight",get:function(){return this._intermediateStrokeWeight},set:function(t){this._intermediateStrokeWeight!==t&&(this._intermediateStrokeWeight=t,this._dirty=!0)}},{key:"majorGridSize",get:function(){return this._majorGridSize},set:function(t){this._majorGridSize!==t&&(this._majorGridSize=t,this._dirty=!0)}},{key:"majorGridVisible",get:function(){return this._majorGridVisible},set:function(t){this._majorGridVisible!==t&&(this._majorGridVisible=t,this._dirty=!0)}},{key:"majorStrokeAlpha",get:function(){return this._majorStrokeAlpha},set:function(t){this._majorStrokeAlpha!==t&&(this._majorStrokeAlpha=t,this._dirty=!0)}},{key:"majorStrokeColor",get:function(){return this._majorStrokeColor},set:function(t){this._majorStrokeColor!==t&&(this._majorStrokeColor=t,this._dirty=!0)}},{key:"majorStrokeWeight",get:function(){return this._majorStrokeWeight},set:function(t){this._majorStrokeWeight!==t&&(this._majorStrokeWeight=t,this._dirty=!0)}},{key:"minorGridSize",get:function(){return this._minorGridSize},set:function(t){this._minorGridSize!==t&&(this._minorGridSize=t,this._dirty=!0)}},{key:"minorGridVisible",get:function(){return this._minorGridVisible},set:function(t){this._minorGridVisible!==t&&(this._minorGridVisible=t,this._dirty=!0)}},{key:"minorStrokeAlpha",get:function(){return this._minorStrokeAlpha},set:function(t){this._minorStrokeAlpha!==t&&(this._minorStrokeAlpha=t,this._dirty=!0)}},{key:"minorStrokeColor",get:function(){return this._minorStrokeColor},set:function(t){this._minorStrokeColor!==t&&(this._minorStrokeColor=t,this._dirty=!0)}},{key:"minorStrokeWeight",get:function(){return this._minorStrokeWeight},set:function(t){this._minorStrokeWeight!==t&&(this._minorStrokeWeight=t,this._dirty=!0)}},{key:"reflines",get:function(){return this._reflines},set:function(t){this._reflines!==t&&(this._reflines=t,this._dirty=!0)}},{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t),this._dirty=!0}},{key:"render",value:function(t){Object(St.a)(Object(Mt.a)(i.prototype),"render",this).call(this,t),this._dirty&&(this._dirty=!1,this._graphics.clear(),this.renderBackground(),this.renderMinorGrid(),this.renderIntermediateGrid(),this.renderMajorGrid(),this.renderRefLines())}},{key:"renderRefLines",value:function(){var t=this;this._reflines.map((function(e,i){var n=e.left,o=e.top,s=e.size;"horizontal"===e.type?(t._graphics.lineStyle(1,16711680,1),t._graphics.moveTo(n,o),t._graphics.lineTo(n+s,o),t._graphics.closePath()):"vertical"===e.type&&(t._graphics.lineStyle(1,65280,1),t._graphics.moveTo(n,o),t._graphics.lineTo(n,o+s),t._graphics.closePath())}))}},{key:"renderBackground",value:function(){var t=this._backgroundFillAlpha,e=this._backgroundFillColor,i=this._graphHeight,n=this._graphWidth,o=this._backgroundVisible,s=this._graphics;o&&(s.beginFill(e,t),s.drawRect(0,0,n,i),s.endFill())}},{key:"renderIntermediateGrid",value:function(){var t=this._graphHeight,e=this._graphWidth,i=this._intermediateGridSize,n=this._intermediateStrokeAlpha,o=this._intermediateStrokeColor,s=this._intermediateStrokeWeight,a=this._majorGridSize,r=this._majorGridVisible,h=this._intermediateGridVisible,l=this._graphics;if(h){l.lineStyle(s,o,n);for(var u=0;u<t;u+=i)r&&u%a===0||(l.moveTo(0,u),l.lineTo(e,u));for(var d=0;d<e;d+=i)r&&d%a===0||(l.moveTo(d,0),l.lineTo(d,t))}}},{key:"renderMajorGrid",value:function(){var t=this._graphHeight,e=this._graphWidth,i=this._majorGridSize,n=this._majorStrokeAlpha,o=this._majorStrokeColor,s=this._majorStrokeWeight,a=this._majorGridVisible,r=this._graphics;if(a){r.lineStyle(s,o,n);for(var h=0;h<=t;h+=i)r.moveTo(0,h),r.lineTo(e,h);for(var l=0;l<=e;l+=i)r.moveTo(l,0),r.lineTo(l,t)}}},{key:"renderMinorGrid",value:function(){var t=this._graphHeight,e=this._graphWidth,i=this._intermediateGridSize,n=this._majorGridSize,o=this._minorGridSize,s=this._minorStrokeAlpha,a=this._minorStrokeColor,r=this._minorStrokeWeight,h=this._intermediateGridVisible,l=this._majorGridVisible,u=this._minorGridVisible,d=this._graphics;if(u){d.lineStyle(r,a,s);for(var c=0;c<t;c+=o)l&&c%n===0||h&&c%i===0||(d.moveTo(0,c),d.lineTo(e,c));for(var v=0;v<e;v+=o)l&&v%n===0||h&&v%i===0||(d.moveTo(v,0),d.lineTo(v,t))}}}]),i}(Lt.k),jt=function(){function t(){Object(r.a)(this,t)}return Object(h.a)(t,null,[{key:"blueprint",value:function(){return{backgroundFillAlpha:1,backgroundFillColor:2310787,backgroundVisible:!0,intermediateGridVisible:!1,majorGridSize:100,majorGridVisible:!0,majorStrokeAlpha:.5,majorStrokeColor:12574956,majorStrokeWeight:2,minorGridSize:10,minorGridVisible:!0,minorStrokeAlpha:.1,minorStrokeColor:12574956,minorStrokeWeight:1}}},{key:"dark",value:function(){return{backgroundFillAlpha:1,backgroundFillColor:0,backgroundVisible:!1,intermediateGridSize:50,intermediateGridVisible:!0,intermediateStrokeAlpha:1,intermediateStrokeColor:3223857,intermediateStrokeWeight:1,majorGridSize:100,majorGridVisible:!0,majorStrokeAlpha:1,majorStrokeColor:4342338,majorStrokeWeight:2,minorGridSize:10,minorGridVisible:!0,minorStrokeAlpha:1,minorStrokeColor:2763306,minorStrokeWeight:.25}}},{key:"engineering",value:function(){return{backgroundFillAlpha:1,backgroundFillColor:16514009,backgroundVisible:!0,intermediateGridVisible:!1,majorGridSize:100,majorGridVisible:!0,majorStrokeAlpha:.5,majorStrokeColor:4235328,majorStrokeWeight:2,minorGridSize:10,minorGridVisible:!0,minorStrokeAlpha:.1,minorStrokeColor:6348928,minorStrokeWeight:1}}},{key:"quad",value:function(){return{backgroundFillAlpha:1,backgroundFillColor:13559536,backgroundVisible:!0,intermediateGridVisible:!1,majorGridSize:100,majorGridVisible:!0,majorStrokeAlpha:.4,majorStrokeColor:7709349,majorStrokeWeight:2,minorGridSize:25,minorGridVisible:!0,minorStrokeAlpha:.4,minorStrokeColor:11783893,minorStrokeWeight:1}}}]),t}(),Tt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this))._renderer=void 0,o._element=void 0,o._mouseDownEvent=void 0,o._mouseUpEvent=void 0,o._mouseMoveEvent=void 0,o._mouseOverEvent=void 0,o._mouseOutEvent=void 0,o._mousePoint=new Lt.f(0,0),o._keydownEvent=void 0,o._keyupEvent=void 0,o._ctrlDown=!1,o._shiftDown=!1,o._altDown=!1,o._eventEmitter=new m.a,o._isDragging=!1,o.interactive=!0,o.buttonMode=!0,o._element=t,o._renderer=n,o.zIndex=t.styles.zIndex+1,o.visible=t.visible,o.cursor=t.styles.cursor,o}return Object(h.a)(i,[{key:"mount",value:function(){this._mouseDownEvent=this.handle_mousedown.bind(this)}},{key:"unmount",value:function(){}},{key:"_invalidate",value:function(){this.clear()}},{key:"_validate",value:function(){this._updateStyles(),this._validateImpl()}},{key:"_validateImpl",value:function(){this._draw()}},{key:"_updateStyles",value:function(){}},{key:"update",value:function(){this._invalidate(),this._validate()}},{key:"_draw",value:function(){this.clear();var t=this._element;t&&t.visible&&(this._drawBody(),this._element&&this._element.debug&&this._drawAABB())}},{key:"_drawBody",value:function(){}},{key:"_drawAABB",value:function(){}},{key:"handle_mousedown",value:function(t){t.stopPropagation(),t.currentTarget._element.movable&&this.__dragStart(t)}},{key:"handle_mouseup",value:function(t){this.__dragEnd(t)}},{key:"handle_mousemove",value:function(t){this.__dragMove(t)}},{key:"handle_mouseout",value:function(t){this.__dragEnd(t)}},{key:"__dragStart",value:function(t){}},{key:"__dragEnd",value:function(t){}},{key:"__dragMove",value:function(t){}},{key:"destroy",value:function(){}},{key:"handle_keydown",value:function(t){var e=t.code,i=this._ctrlDown;this._ctrlDown=this.isCtrlDown(t);var n=this._ctrlDown;i!==n&&this._eventEmitter.emit(ot.CtrlKeyDown,{source:this,key:e,oldCtrlDown:i,newCtrlDown:n});var o=this._shiftDown;this._shiftDown=this.isShiftDown(t);var s=this._shiftDown;o!==s&&this._eventEmitter.emit(ot.ShiftKey,{source:this,key:e,oldShiftDown:o,newShiftDown:s});var a=this._altDown;this._altDown=this.isAltDown(t);var r=this._altDown;a!==r&&this._eventEmitter.emit(ot.AltKey,{source:this,key:e,oldAltDown:a,newAltDown:r})}},{key:"handle_keyup",value:function(t){var e=t.code,i=this._ctrlDown;this._ctrlDown=this.isCtrlDown(t);var n=this._ctrlDown;i!==n&&this._eventEmitter.emit(ot.CtrlKeyUp,{source:this,key:e,oldCtrlDown:i,newCtrlDown:n});var o=this._shiftDown;this._shiftDown=this.isShiftDown(t);var s=this._shiftDown;o!==s&&this._eventEmitter.emit(ot.ShiftKey,{source:this,key:e,oldShiftDown:o,newShiftDown:s});var a=this._altDown;this._altDown=this.isAltDown(t);var r=this._altDown;a!==r&&this._eventEmitter.emit(ot.AltKey,{source:this,key:e,oldAltDown:a,newAltDown:r})}},{key:"isCtrlDown",value:function(t){return t.ctrlKey||t.metaKey}},{key:"isShiftDown",value:function(t){return t.shiftKey}},{key:"isAltDown",value:function(t){return t.altKey}}]),i}(Lt.d),Bt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this,t,n))._text=void 0,o.interactive=!0,o.buttonMode=!0,o._element=t,o.zIndex=t.styles.labelGizmoZIndex,o.visible=t.styles.labelGizmoVisible,o.cursor=t.styles.labelGizmoCursor,t instanceof dt&&(o._text=new Lt.l("Length: ",{fontFamily:"PingFangSC-Regular, PingFang SC",fontSize:12,fill:0,align:"center",fontWeight:"600"}),o._text.resolution=2,o._text.anchor.set(.5,.5),o._text.text="".concat(t.name),o.addChild(o._text)),o}return Object(h.a)(i,[{key:"_updateStyles",value:function(){var t=this._element;if(t&&this._text){var e=t.getAABB(),i=new Lt.i;switch(this._text.getLocalBounds(i),this._text.x=0,this._text.y=0,this._text.anchor.set(.5,.5),this._text.text="".concat(t.name),t.styles.labelGizmoRotation&&(this._text.angle=t.angle),t.styles.labelGizmoPosition||T.Center){case T.Center:this.x=t.center[0],this.y=t.center[1];break;case T.Top:this.x=t.center[0],this.y=e.y;break;case T.Bottom:this.x=t.center[0],this.y=e.y+e.height;break;case T.Left:this.x=e.x,this.y=e.y+e.height/2;break;case T.Right:this.x=e.x+e.width,this.y=e.y+e.height/2;break;case T.TopLeft:this.x=e.x,this.y=e.y;break;case T.TopRight:this.x=e.x+e.width,this.y=e.y;break;case T.BottomLeft:this.x=e.x,this.y=e.y+e.height;break;case T.BottomRight:this.x=e.x+e.width,this.y=e.y+e.height}var n=t.styles.labelGizmoPositionOffsetX,o=t.styles.labelGizmoPositionOffsetY;this.x+=n,this.y+=o}}},{key:"_drawBody",value:function(){var t=this._element;if(t&&(this.clear(),this._text)){var e=new Lt.i;this._text.getLocalBounds(e),t.debug&&(this.beginFill(16711680,.5),this.lineStyle(1,39372,1),this.drawRect(0-e.width/2,0-e.height/2,e.width,e.height),this.endFill())}}}]),i}(Tt),Dt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this,t,n))._text=void 0,o.interactive=!0,o.buttonMode=!0,o._element=t,o.zIndex=t.styles.label2GizmoZIndex,o.visible=t.styles.label2GizmoVisible,o.cursor=t.styles.label2GizmoCursor,t instanceof dt&&(o._text=new Lt.l("Length: ",{fontFamily:"PingFangSC-Regular, PingFang SC",fontSize:12,fill:0,align:"center",fontWeight:"600"}),o._text.resolution=2,o._text.anchor.set(.5,.5),o._text.text="".concat(t.name2),o.addChild(o._text)),o}return Object(h.a)(i,[{key:"_updateStyles",value:function(){var t=this._element;if(t&&this._text){var e=t.getAABB(),i=new Lt.i;switch(this._text.getLocalBounds(i),this._text.x=0,this._text.y=0,this._text.anchor.set(.5,.5),this._text.text="".concat(t.name2),t.styles.label2GizmoRotation&&(this._text.angle=t.angle),t.styles.label2GizmoPosition||T.Center){case T.Center:this.x=t.center[0],this.y=t.center[1];break;case T.Top:this.x=t.center[0],this.y=e.y;break;case T.Bottom:this.x=t.center[0],this.y=e.y+e.height;break;case T.Left:this.x=e.x,this.y=e.y+e.height/2;break;case T.Right:this.x=e.x+e.width,this.y=e.y+e.height/2;break;case T.TopLeft:this.x=e.x,this.y=e.y;break;case T.TopRight:this.x=e.x+e.width,this.y=e.y;break;case T.BottomLeft:this.x=e.x,this.y=e.y+e.height;break;case T.BottomRight:this.x=e.x+e.width,this.y=e.y+e.height}var n=t.styles.label2GizmoPositionOffsetX,o=t.styles.label2GizmoPositionOffsetY;this.x+=n,this.y+=o}}},{key:"_drawBody",value:function(){var t=this._element;if(t&&(this.clear(),this._text)){var e=new Lt.i;this._text.getLocalBounds(e),t.debug&&(this.beginFill(16711680,.5),this.lineStyle(1,39372,1),this.drawRect(0-e.width/2,0-e.height/2,e.width,e.height),this.endFill())}}}]),i}(Tt);!function(t){t.Center="Center",t.Top="Top",t.Bottom="Bottom",t.Left="Left",t.Right="Right",t.TopLeft="TopLeft",t.TopRight="TopRight",t.BottomLeft="BottomLeft",t.BottomRight="BottomRight"}(Ot||(Ot={}));var At=new Map;At.set("0.5",Ot.Top),At.set("1.5",Ot.Right),At.set("2.5",Ot.Bottom),At.set("3.5",Ot.Left),At.set("0",Ot.TopLeft),At.set("1",Ot.TopRight),At.set("2",Ot.BottomRight),At.set("3",Ot.BottomLeft);var Rt,It=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n,o,s){var a,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"roundedRect";return Object(r.a)(this,i),(a=e.call(this))._element=void 0,a._index=void 0,a._angle=void 0,a._shape="roundedRect",a._renderer=void 0,a._center=[0,0],a._points=void 0,a._fillColor=13487565,a._text=void 0,a.mode="resize",a._mousedownEvent=void 0,a._mouseupEvent=void 0,a._mousemoveEvent=void 0,a._mouseoutEvent=void 0,a._hitTarget=void 0,a._isDragging=!1,a._mousePoint=void 0,a._ctrlDown=!1,a._doubleClickedTimeout=null,a._originSize=void 0,a._originCenter=void 0,a._zIndex=999,a._element=t,a._renderer=n,a._center=o,a._index=s,a._angle=h,a._shape=l,a._invalidate(),a._validate(),a.interactive=!0,a.buttonMode=!0,a.mount(),a}return Object(h.a)(i,[{key:"mount",value:function(){this._mousedownEvent=this.handle_mousedown.bind(this),this._mouseupEvent=this.handle_mouseup.bind(this),this._mousemoveEvent=this.handle_mousemove.bind(this),this._mouseoutEvent=this.handle_mouseout.bind(this),this.on("mousedown",this._mousedownEvent),this.on("mouseup",this._mouseupEvent),this._text=new Lt.l("Length: ",{fontFamily:"PingFangSC-Regular, PingFang SC",fontSize:6,fill:0,align:"center",fontWeight:"100"}),this._text.resolution=2,this._text.anchor.set(this._element.x||0,this._element.y||0),this._text.text="".concat(this._index,"-").concat(this._angle),this._text.zIndex=999}},{key:"unmount",value:function(){var t=this._renderer.viewport;this.off("mousedown",this._mousedownEvent),this.off("mouseup",this._mouseupEvent),this.off("mousemove",this._mousemoveEvent),t&&t.off("mousemove",this._mousemoveEvent),this.clear(),this._text&&this.removeChild(this._text)}},{key:"_invalidate",value:function(){this.clear()}},{key:"_validate",value:function(){this._updateStyles(),this._validateImpl()}},{key:"_validateImpl",value:function(){this._draw()}},{key:"_updateStyles",value:function(){var t=this._element;if(t)if(this.visible=t.selected,t.type===D.AlignLine||t.type===D.Line||t.type===D.ShapeLine){this.cursor="move";var e=this._center,i=this._renderer.getScaled(),n=1.5*(i<1?6/i:6)/2,o=[e[0]-n,e[1]-n,e[0]-n,e[1]+n,e[0]+n,e[1]+n,e[0]+n,e[1]-n];this.hitArea=new Lt.g(o)}else if(t.type===D.Domain){if(this._text){var s=new Lt.i;this._text.getLocalBounds(s),this._text.x=this._center[0],this._text.y=this._center[1],this._text.anchor.set(.5,.5),this._text.text="".concat(this._index,"-").concat((this._angle*Lt.h).toFixed(0))}if("resize"===this.mode){var a=this._angle*Lt.h;a>=0&&a<=15?this.cursor="ns-resize":a>15&&a<=75?this.cursor="nesw-resize":a>75&&a<=90||a>-90&&a<=-75?this.cursor="ew-resize":a>-75&&a<=-15?this.cursor="nwse-resize":a>-15&&a<=0&&(this.cursor="ns-resize")}else if("scale"===this.mode){var r=this._index;0===r?this.cursor="nwse-resize":1===r?this.cursor="nesw-resize":2===r?this.cursor="nwse-resize":3===r?this.cursor="nesw-resize":.5===r||.5===r||2.5===r?this.cursor="ns-resize":1.5!==r&&3.5!==r||(this.cursor="ew-resize")}}}},{key:"_draw",value:function(){this.clear(),this._drawBody()}},{key:"_drawBody",value:function(){var t=this._element;if(t&&t.selected){var e=this._angle,i=this._center,n=Math.sin(e),o=Math.cos(e),s=i[0]*(1-o)+i[1]*n,a=i[1]*(1-o)-i[0]*n,r=y.a.fromValues(o,n,-n,o,s,a);this.setMatrix(new Lt.e(r[0],r[1],r[2],r[3],r[4],r[5]));var h=this._renderer.getScaled(),l=h<1?6/h:6;switch(this._shape){case"rect":this.lineStyle(.6,0,.25),this.beginFill(16777215,1),this.drawRect(this._center[0]-l/2,this._center[1]-l/2,l,l);break;case"circle":this._hitTarget?(l=h<1?3/h:3,this.lineStyle(1.5,7566195,1),this.beginFill(16777215,1),this.drawCircle(this._center[0],this._center[1],l)):(l=h<1?2.5/h:2.5,this.lineStyle(1,10921638,1),this.beginFill(16777215,1),this.drawCircle(this._center[0],this._center[1],l));break;case"roundedRect":this._renderer.isEditable(t)?(this.lineStyle(.6,0,.25),this.beginFill(16777215,1)):(this.lineStyle(.6,13487565,.25),this.beginFill(13487565,1)),this.drawRoundedRect(this._center[0]-l/2,this._center[1]-l/2,l,l,1)}this.endFill(),this.setMatrix(new Lt.e)}}},{key:"fillColor",set:function(t){this._fillColor=t,this.update()}},{key:"center",set:function(t){this._center=t,this.update()}},{key:"setAngle",value:function(t){this._angle=t,this.update()}},{key:"points",set:function(t){this._points=t,this.update()}},{key:"update",value:function(){this._invalidate(),this._validate()}},{key:"handle_zoomed",value:function(t){}},{key:"handle_panned",value:function(t){}},{key:"isCtrlDown",value:function(t){return t.ctrlKey||t.metaKey}},{key:"handle_mousedown",value:function(t){t.stopPropagation();var e=this._renderer,n=e.viewport;if(n){var o=e.renderer.plugins.interaction.hitTest(t.data.global);this._hitTarget=o,o instanceof i&&(this.__dragStart(t),n.on("mousemove",this._mousemoveEvent),n.on("mouseout",this._mouseoutEvent),t.stopPropagation())}}},{key:"handle_mouseup",value:function(t){this.__dragEnd(t)}},{key:"handle_mousemove",value:function(t){this._renderer.viewport&&(this.__dragMove(t),t.stopPropagation())}},{key:"handle_mouseout",value:function(t){this.__dragEnd(t)}},{key:"__dragStart",value:function(t){var e=this._hitTarget,n=this._renderer.viewport;if(n&&!this._isDragging&&e instanceof i){var o=t.data.getLocalPosition(n);this._mousePoint=new Lt.f(o.x,o.y)}}},{key:"_reversPoint",value:function(t,e,i){i*=-1;var n=Math.cos(i*Math.PI/180),o=Math.sin(i*Math.PI/180),s=t[0]-e[0],a=t[1]-e[1],r=s*n-a*o,h=s*o+a*n;return t[0]=r+e[0],t[1]=h+e[1],t}},{key:"__dragMove",value:function(t){var e=this._hitTarget;if(e&&e.parent){var i=t.data.getLocalPosition(e.parent);if(!this._isDragging&&this._mousePoint&&(Math.abs(i.x-this._mousePoint.x)>=.1||Math.abs(i.y-this._mousePoint.y)>=.1)){var n=e._element,o=this._renderer.interactionManager.getCurrentInteraction(),s=this._renderer,a=s.viewport;if(!s||!a)return;if(s.isEditable(n)){this._isDragging=!0,this._originSize=[n.width,n.height],this._originCenter=[n.x,n.y];var r=t.data.getLocalPosition(a);o instanceof le&&o.emit(st.ResizeStart,{source:this,target:e._element,index:this._index,position:[r.x,r.y]})}else o instanceof le&&o.emit(st.UnableResize,{source:this,target:e._element})}this._isDragging&&this._mousePoint&&("resize"===this.mode?this._handleResize(t):"scale"===this.mode&&this._handleScale(t))}}},{key:"_handleResize",value:function(t){var e=this._hitTarget,i=this._renderer,n=i.viewport;if(n&&e&&this._originSize&&this._originCenter&&this._mousePoint){var o=e._element;if(o.type===D.Node){var s=t.data.getLocalPosition(n),a=s.x-this._mousePoint.x,r=s.y-this._mousePoint.y;this._mousePoint=new Lt.f(s.x,s.y);var h=e._element,l=At.get("".concat(this._index)),u=this._index%1===0?(h.points.length+this._index-1)%h.points.length:(h.points.length+this._index-.5)%h.points.length,d=this._index%1===0?(h.points.length+this._index+1)%h.points.length:(h.points.length+this._index+.5)%h.points.length,c=this._index%1===0?this._index%h.points.length:(this._index+.5)%h.points.length,v=h.angle,_=this._reversPoint([s.x,s.y],[this._originCenter[0],this._originCenter[1]],v);Math.abs(2*(_[0]-this._originCenter[0])),h.width,Math.abs(2*(_[1]-this._originCenter[1])),h.height;switch(l){case Ot.Right:h.translatePoint([u,d],[[a,0],[a,0]]);break;case Ot.Bottom:h.translatePoint([u,d],[[0,r],[0,r]]);break;case Ot.Left:h.translatePoint([u,d],[[a,0],[a,0]]);break;case Ot.Top:h.translatePoint([u,d],[[0,r],[0,r]]);break;case Ot.TopRight:h.translatePoint([u,c,d],[[0,r],[a,r],[a,0]]);break;case Ot.BottomRight:h.translatePoint([u,c,d],[[a,0],[a,r],[0,r]]);break;case Ot.BottomLeft:h.translatePoint([u,c,d],[[0,r],[a,r],[a,0]]);break;case Ot.TopLeft:h.translatePoint([u,c,d],[[a,0],[a,r],[0,r]])}}else if(o.type===D.Shape||o.type===D.Domain){var f=t.data.getLocalPosition(n),g=f.x-this._mousePoint.x,m=f.y-this._mousePoint.y;this._mousePoint=new Lt.f(f.x,f.y);var p=e._element,b=this._index%1===0?(p.points.length+this._index-1)%p.points.length:(p.points.length+this._index-.5)%p.points.length,k=this._index%1===0?(p.points.length+this._index+1)%p.points.length:(p.points.length+this._index+.5)%p.points.length,w=p.points[b],x=p.points[k],S=y.b.fromValues(w[0]-x[0],w[1]-x[1]),M=y.b.fromValues(-S[1],S[0]);y.b.normalize(M,M);var E=y.b.fromValues(g,m),C=y.b.dot(E,M),z=y.b.create();y.b.scale(z,M,C),p.translatePoint([b,k],[[z[0],z[1]],[z[0],z[1]]]),p.resizing||(p.resizing=!0)}else if(o.type===D.ShapeLine||o.type===D.Line||o.type===D.AlignLine){var O=t.data.getLocalPosition(n),L=O.x-this._mousePoint.x,P=O.y-this._mousePoint.y;this._mousePoint=new Lt.f(O.x,O.y),e._element.translatePoint([this._index],[[L,P]])}var j=i.interactionManager.getCurrentInteraction();if(j instanceof le){var T=t.data.getLocalPosition(n);j.emit(st.Resizing,{source:this,target:e._element,index:this._index,position:[T.x,T.y]})}}}},{key:"_handleScale",value:function(t){var e=this._hitTarget,i=this._renderer,n=i.viewport;if(n&&this._isDragging&&e&&this._originSize&&this._originCenter&&this._mousePoint){var o=e._element,s=t.data.getLocalPosition(n),a=s.x-this._mousePoint.x,r=s.y-this._mousePoint.y;this._mousePoint=new Lt.f(s.x,s.y);var h=At.get("".concat(this._index)),l=this._index%1===0?(o.points.length+this._index-1)%o.points.length:(o.points.length+this._index-.5)%o.points.length,u=this._index%1===0?(o.points.length+this._index+1)%o.points.length:(o.points.length+this._index+.5)%o.points.length,d=this._index%1===0?this._index%o.points.length:(this._index+.5)%o.points.length;if(o instanceof vt)switch(h){case Ot.Right:o.translatePoint([l,u],[[a,0],[a,0]]);break;case Ot.Bottom:o.translatePoint([l,u],[[0,r],[0,r]]);break;case Ot.Left:o.translatePoint([l,u],[[a,0],[a,0]]);break;case Ot.Top:o.translatePoint([l,u],[[0,r],[0,r]]);break;case Ot.TopRight:o.translatePoint([l,d,u],[[0,r],[a,r],[a,0]]);break;case Ot.BottomRight:o.translatePoint([l,d,u],[[a,0],[a,r],[0,r]]);break;case Ot.BottomLeft:o.translatePoint([l,d,u],[[0,r],[a,r],[a,0]]);break;case Ot.TopLeft:o.translatePoint([l,d,u],[[a,0],[a,r],[0,r]])}else if(o instanceof gt){var c=o.size,v=Math.sqrt(c[0]*c[0]+c[1]*c[1]),_=1;switch(h){case Ot.Right:_=(a+c[0])/c[0],o.scaled(_,Ot.Left);break;case Ot.Bottom:_=(r+c[1])/c[1],o.scaled(_,Ot.Top);break;case Ot.Left:_=(-a+c[0])/c[0],o.scaled(_,Ot.Right);break;case Ot.Top:_=(-r+c[1])/c[1],o.scaled(_,Ot.Bottom);break;case Ot.TopRight:_=Math.sqrt((a+c[0])*(a+c[0])+(-r+c[1])*(-r+c[1]))/v,o.scaled(_,Ot.BottomLeft);break;case Ot.BottomRight:_=Math.sqrt((a+c[0])*(a+c[0])+(r+c[1])*(r+c[1]))/v,o.scaled(_,Ot.TopLeft);break;case Ot.BottomLeft:_=Math.sqrt((-a+c[0])*(-a+c[0])+(r+c[1])*(r+c[1]))/v,o.scaled(_,Ot.TopRight);break;case Ot.TopLeft:_=Math.sqrt((-a+c[0])*(-a+c[0])+(-r+c[1])*(-r+c[1]))/v,o.scaled(_,Ot.BottomRight)}o.resizing||(o.resizing=!0)}var f=i.interactionManager.getCurrentInteraction();f instanceof le&&f.emit(st.Resizing,{source:this,target:e._element})}}},{key:"__dragEnd",value:function(t){if(this._isDragging){this._isDragging=!1,this._originSize=void 0,this._originCenter=void 0,this.off("mousemove",this._mousemoveEvent);var e=this._hitTarget,i=this._renderer,n=i.viewport;if(!n||!i)return;if(e&&e._element){e._element.resizing=!1;var o=this._renderer.interactionManager.getCurrentInteraction();if(o instanceof le){var s=t.data.getLocalPosition(n);o.emit(st.ResizeEnd,{source:this,target:e._element,index:this._index,position:[s.x,s.y]})}}}this._mousePoint=void 0}},{key:"handle_keydown",value:function(t){t.code;this._ctrlDown=this.isCtrlDown(t)}},{key:"handle_keyup",value:function(t){t.code;this._ctrlDown=this.isCtrlDown(t)}},{key:"handle_contextmenu",value:function(t){t.preventDefault(),this.__dragEnd(t)}},{key:"translate",value:function(t,e){this._center[0]+=t,this._center[1]+=e,this.update()}}]),i}(Lt.d);!function(t){t.Center="Center",t.Top="Top",t.Bottom="Bottom",t.Left="Left",t.Right="Right",t.TopLeft="TopLeft",t.TopRight="TopRight",t.BottomLeft="BottomLeft",t.BottomRight="BottomRight"}(Rt||(Rt={}));var Ft=new Map;Ft.set("0.5",Rt.Top),Ft.set("1.5",Rt.Right),Ft.set("2.5",Rt.Bottom),Ft.set("3.5",Rt.Left),Ft.set("0",Rt.TopLeft),Ft.set("1",Rt.TopRight),Ft.set("2",Rt.BottomRight),Ft.set("3",Rt.BottomLeft);var Gt,Vt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n,o,s,a){var h,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"roundedRect";Object(r.a)(this,i),(h=e.call(this))._element=void 0,h._from=void 0,h._to=void 0,h._index=void 0,h._angle=void 0,h._shape="roundedRect",h._renderer=void 0,h._center=[0,0],h._points=void 0,h._fillColor=8158332,h._fillAlpha=.1,h._text=void 0,h._size=4,h.mode="align",h._mousedownEvent=void 0,h._mouseupEvent=void 0,h._mousemoveEvent=void 0,h._mouseoverEvent=void 0,h._mouseoutEvent=void 0,h._hitTarget=void 0,h._isDragging=!1,h._mousePoint=new Lt.f(0,0),h._ctrlDown=!1,h._doubleClickedTimeout=null,h._originSize=void 0,h._originCenter=void 0,h._zIndex=999,h._element=t,h._renderer=s,h._index=a,h._shape=l,h._from=n||[0,0],h._to=o||[0,0],h._size=y.b.distance(y.b.fromValues(n[0],n[1]),y.b.fromValues(o[0],o[1]));var u=y.b.fromValues(o[0]-n[0],o[1]-n[1]),d=y.b.angle(u,y.b.fromValues(u[0],0));h._angle=u[0]*u[1]>=0?d:-d;var c=[(n[0]+o[0])/2,(n[1]+o[1])/2];return h._center=c,h._invalidate(),h._validate(),h.interactive=!0,h.buttonMode=!1,h.mount(),h}return Object(h.a)(i,[{key:"mount",value:function(){this._mousedownEvent=this.handle_mousedown.bind(this),this._mouseupEvent=this.handle_mouseup.bind(this),this._mousemoveEvent=this.handle_mousemove.bind(this),this._mouseoverEvent=this.handle_mouseover.bind(this),this._mouseoutEvent=this.handle_mouseout.bind(this),this.on("mousedown",this._mousedownEvent),this.on("mouseup",this._mouseupEvent),this.on("mouseover",this._mouseoverEvent),this.on("mouseout",this._mouseoutEvent),this._text=new Lt.l("Length: ",{fontFamily:"PingFangSC-Regular, PingFang SC",fontSize:6,fill:0,align:"center",fontWeight:"100"}),this._text.resolution=2,this._text.anchor.set(this._element.x||0,this._element.y||0),this._text.text="".concat(this._index),this._text.zIndex=999}},{key:"unmount",value:function(){var t=this._renderer.viewport;this.off("mousedown",this._mousedownEvent),this.off("mouseup",this._mouseupEvent),this.off("mousemove",this._mousemoveEvent),this.off("mouseover",this._mouseoverEvent),this.off("mouseout",this._mouseoutEvent),t&&t.off("mousemove",this._mousemoveEvent),this.clear(),this._text&&this.removeChild(this._text)}},{key:"_invalidate",value:function(){this.clear()}},{key:"_validate",value:function(){var t=this._from,e=this._to;this._from=t||[0,0],this._to=e||[0,0],this._size=y.b.distance(y.b.fromValues(t[0],t[1]),y.b.fromValues(e[0],e[1]));var i=y.b.fromValues(e[0]-t[0],e[1]-t[1]),n=y.b.angle(i,y.b.fromValues(i[0],0));this._angle=i[0]*i[1]>=0?n:-n;var o=[(t[0]+e[0])/2,(t[1]+e[1])/2];this._center=o,this._updateStyles(),this._validateImpl()}},{key:"_validateImpl",value:function(){this._draw()}},{key:"_updateStyles",value:function(){if(this._element&&this._text){var t=new Lt.i;this._text.getLocalBounds(t),this._text.x=this._center[0],this._text.y=this._center[1],this._text.anchor.set(.5,.5),this._text.text="".concat(this._index)}}},{key:"_draw",value:function(){this.clear(),this._drawBody()}},{key:"_drawBody",value:function(){if(this._element){var t=this._angle,e=this._center,i=Math.sin(t),n=Math.cos(t),o=e[0]*(1-n)+e[1]*i,s=e[1]*(1-n)-e[0]*i,a=y.a.fromValues(n,i,-i,n,o,s);this.setMatrix(new Lt.e(a[0],a[1],a[2],a[3],a[4],a[5]));var r=this._renderer.getScaled(),h=r<1?2/r:2,l=this._size;switch(this._shape){case"rect":this.beginFill(this._fillColor,this._fillAlpha),this.drawRect(this._center[0]-l/2,this._center[1]-h/2,l,h);break;case"circle":var u=r<1?3/r:3;this._hitTarget?(u=r<1?3/r:3,this.lineStyle(1.5,7566195,1),this.beginFill(16777215,1),this.drawCircle(this._center[0],this._center[1],u)):(u=r<1?2.5/r:2.5,this.lineStyle(1,10921638,1),this.beginFill(16777215,1),this.drawCircle(this._center[0],this._center[1],u));break;case"roundedRect":this.lineStyle(.6,0,.25),this.beginFill(16777215,1),this.drawRoundedRect(this._center[0]-l/2,this._center[1]-h/2,l,h,1)}this.endFill(),this.setMatrix(new Lt.e)}}},{key:"fillColor",set:function(t){this._fillColor=t,this.update()}},{key:"center",set:function(t){this._center=t,this.update()}},{key:"setAngle",value:function(t){this._angle=t,this.update()}},{key:"points",set:function(t){this._points=t,this.update()}},{key:"update",value:function(){this._invalidate(),this._validate()}},{key:"handle_zoomed",value:function(t){}},{key:"handle_panned",value:function(t){}},{key:"isCtrlDown",value:function(t){return t.ctrlKey||t.metaKey}},{key:"handle_mousedown",value:function(t){t.stopPropagation();var e=this._renderer;if(e.viewport){var i=e.renderer.plugins.interaction.hitTest(t.data.global);this._hitTarget=i,this._doubleClickedTimeout?(clearTimeout(this._doubleClickedTimeout),this._doubleClickedTimeout=null):this._handleAlignOption()}}},{key:"handle_mouseup",value:function(t){var e=this;this._doubleClickedTimeout=setTimeout((function(){e._doubleClickedTimeout=null}),300)}},{key:"handle_mousemove",value:function(t){this._renderer.viewport}},{key:"handle_mouseout",value:function(t){this._fillColor=8158332,this._fillAlpha=.1}},{key:"handle_mouseover",value:function(t){this._fillColor=3438588,this._fillAlpha=1}},{key:"__dragStart",value:function(t){var e=this._hitTarget,n=this._renderer.viewport;if(n&&!this._isDragging&&e instanceof i){var o=t.data.getLocalPosition(n);this._mousePoint=new Lt.f(o.x,o.y),this._isDragging=!0;var s=e._element;this._originSize=[s.width,s.height],this._originCenter=[s.x,s.y]}}},{key:"_reversPoint",value:function(t,e,i){i*=-1;var n=Math.cos(i*Math.PI/180),o=Math.sin(i*Math.PI/180),s=t[0]-e[0],a=t[1]-e[1],r=s*n-a*o,h=s*o+a*n;return t[0]=r+e[0],t[1]=h+e[1],t}},{key:"__dragMove",value:function(t){"align"===this.mode?this._handleAlign(t):"resize"===this.mode?this._handleResize(t):"scale"===this.mode&&this._handleScale(t)}},{key:"_handleAlign",value:function(t){var e=this._hitTarget,i=this._renderer.viewport;if(i&&this._isDragging&&e&&this._originSize&&this._originCenter){var n=e._element;if(n.type===D.Node){var o=t.data.getLocalPosition(i),s=o.x-this._mousePoint.x,a=o.y-this._mousePoint.y;this._mousePoint=new Lt.f(o.x,o.y);var r=e._element,h=Ft.get("".concat(this._index)),l=this._index%1===0?(r.points.length+this._index-1)%r.points.length:(r.points.length+this._index-.5)%r.points.length,u=this._index%1===0?(r.points.length+this._index+1)%r.points.length:(r.points.length+this._index+.5)%r.points.length,d=this._index%1===0?this._index%r.points.length:(this._index+.5)%r.points.length,c=r.angle,v=this._reversPoint([o.x,o.y],[this._originCenter[0],this._originCenter[1]],c);Math.abs(2*(v[0]-this._originCenter[0])),r.width,Math.abs(2*(v[1]-this._originCenter[1])),r.height;switch(h){case Rt.Right:r.translatePoint([l,u],[[s,0],[s,0]]);break;case Rt.Bottom:r.translatePoint([l,u],[[0,a],[0,a]]);break;case Rt.Left:r.translatePoint([l,u],[[s,0],[s,0]]);break;case Rt.Top:r.translatePoint([l,u],[[0,a],[0,a]]);break;case Rt.TopRight:r.translatePoint([l,d,u],[[0,a],[s,a],[s,0]]);break;case Rt.BottomRight:r.translatePoint([l,d,u],[[s,0],[s,a],[0,a]]);break;case Rt.BottomLeft:r.translatePoint([l,d,u],[[0,a],[s,a],[s,0]]);break;case Rt.TopLeft:r.translatePoint([l,d,u],[[s,0],[s,a],[0,a]])}}else if(n.type===D.Shape||n.type===D.Domain){var _=t.data.getLocalPosition(i),f=_.x-this._mousePoint.x,g=_.y-this._mousePoint.y;this._mousePoint=new Lt.f(_.x,_.y);var m=e._element,p=this._index%1===0?(m.points.length+this._index-1)%m.points.length:(m.points.length+this._index-.5)%m.points.length,b=this._index%1===0?(m.points.length+this._index+1)%m.points.length:(m.points.length+this._index+.5)%m.points.length,k=m.points[p],w=m.points[b],x=y.b.fromValues(k[0]-w[0],k[1]-w[1]),S=y.b.fromValues(-x[1],x[0]);y.b.normalize(S,S);var M=y.b.fromValues(f,g),E=y.b.dot(M,S),C=y.b.create();y.b.scale(C,S,E),m.translatePoint([p,b],[[C[0],C[1]],[C[0],C[1]]])}else if(n.type===D.ShapeLine||n.type===D.Line||n.type===D.AlignLine){var z=t.data.getLocalPosition(i),O=z.x-this._mousePoint.x,L=z.y-this._mousePoint.y;this._mousePoint=new Lt.f(z.x,z.y),e._element.translatePoint([this._index],[[O,L]])}}}},{key:"_handleResize",value:function(t){var e=this._hitTarget,i=this._renderer.viewport;if(i&&this._isDragging&&e&&this._originSize&&this._originCenter){var n=e._element;if(n.type===D.Node){var o=t.data.getLocalPosition(i),s=o.x-this._mousePoint.x,a=o.y-this._mousePoint.y;this._mousePoint=new Lt.f(o.x,o.y);var r=e._element,h=Ft.get("".concat(this._index)),l=this._index%1===0?(r.points.length+this._index-1)%r.points.length:(r.points.length+this._index-.5)%r.points.length,u=this._index%1===0?(r.points.length+this._index+1)%r.points.length:(r.points.length+this._index+.5)%r.points.length,d=this._index%1===0?this._index%r.points.length:(this._index+.5)%r.points.length,c=r.angle,v=this._reversPoint([o.x,o.y],[this._originCenter[0],this._originCenter[1]],c);Math.abs(2*(v[0]-this._originCenter[0])),r.width,Math.abs(2*(v[1]-this._originCenter[1])),r.height;switch(h){case Rt.Right:r.translatePoint([l,u],[[s,0],[s,0]]);break;case Rt.Bottom:r.translatePoint([l,u],[[0,a],[0,a]]);break;case Rt.Left:r.translatePoint([l,u],[[s,0],[s,0]]);break;case Rt.Top:r.translatePoint([l,u],[[0,a],[0,a]]);break;case Rt.TopRight:r.translatePoint([l,d,u],[[0,a],[s,a],[s,0]]);break;case Rt.BottomRight:r.translatePoint([l,d,u],[[s,0],[s,a],[0,a]]);break;case Rt.BottomLeft:r.translatePoint([l,d,u],[[0,a],[s,a],[s,0]]);break;case Rt.TopLeft:r.translatePoint([l,d,u],[[s,0],[s,a],[0,a]])}}else if(n.type===D.Shape||n.type===D.Domain){var _=t.data.getLocalPosition(i),f=_.x-this._mousePoint.x,g=_.y-this._mousePoint.y;this._mousePoint=new Lt.f(_.x,_.y);var m=e._element,p=this._index%1===0?(m.points.length+this._index-1)%m.points.length:(m.points.length+this._index-.5)%m.points.length,b=this._index%1===0?(m.points.length+this._index+1)%m.points.length:(m.points.length+this._index+.5)%m.points.length,k=m.points[p],w=m.points[b],x=y.b.fromValues(k[0]-w[0],k[1]-w[1]),S=y.b.fromValues(-x[1],x[0]);y.b.normalize(S,S);var M=y.b.fromValues(f,g),E=y.b.dot(M,S),C=y.b.create();y.b.scale(C,S,E),m.translatePoint([p,b],[[C[0],C[1]],[C[0],C[1]]])}else if(n.type===D.ShapeLine||n.type===D.Line||n.type===D.AlignLine){var z=t.data.getLocalPosition(i),O=z.x-this._mousePoint.x,L=z.y-this._mousePoint.y;this._mousePoint=new Lt.f(z.x,z.y),e._element.translatePoint([this._index],[[O,L]])}}}},{key:"_handleScale",value:function(t){var e=this._hitTarget,i=this._renderer.viewport;if(i&&this._isDragging&&e&&this._originSize&&this._originCenter){var n=e._element,o=t.data.getLocalPosition(i),s=o.x-this._mousePoint.x,a=o.y-this._mousePoint.y;this._mousePoint=new Lt.f(o.x,o.y);var r=Ft.get("".concat(this._index)),h=this._index%1===0?(n.points.length+this._index-1)%n.points.length:(n.points.length+this._index-.5)%n.points.length,l=this._index%1===0?(n.points.length+this._index+1)%n.points.length:(n.points.length+this._index+.5)%n.points.length,u=this._index%1===0?this._index%n.points.length:(this._index+.5)%n.points.length;if(n instanceof vt)switch(r){case Rt.Right:n.translatePoint([h,l],[[s,0],[s,0]]);break;case Rt.Bottom:n.translatePoint([h,l],[[0,a],[0,a]]);break;case Rt.Left:n.translatePoint([h,l],[[s,0],[s,0]]);break;case Rt.Top:n.translatePoint([h,l],[[0,a],[0,a]]);break;case Rt.TopRight:n.translatePoint([h,u,l],[[0,a],[s,a],[s,0]]);break;case Rt.BottomRight:n.translatePoint([h,u,l],[[s,0],[s,a],[0,a]]);break;case Rt.BottomLeft:n.translatePoint([h,u,l],[[0,a],[s,a],[s,0]]);break;case Rt.TopLeft:n.translatePoint([h,u,l],[[s,0],[s,a],[0,a]])}else if(n instanceof gt){var d=n.size,c=Math.sqrt(d[0]*d[0]+d[1]*d[1]),v=1;switch(r){case Rt.Right:v=(s+d[0])/d[0],n.scaled(v,Rt.Left);break;case Rt.Bottom:v=(a+d[1])/d[1],n.scaled(v,Rt.Top);break;case Rt.Left:v=(-s+d[0])/d[0],n.scaled(v,Rt.Right);break;case Rt.Top:v=(-a+d[1])/d[1],n.scaled(v,Rt.Bottom);break;case Rt.TopRight:v=Math.sqrt((s+d[0])*(s+d[0])+(-a+d[1])*(-a+d[1]))/c,n.scaled(v,Rt.BottomLeft);break;case Rt.BottomRight:v=Math.sqrt((s+d[0])*(s+d[0])+(a+d[1])*(a+d[1]))/c,n.scaled(v,Rt.TopLeft);break;case Rt.BottomLeft:v=Math.sqrt((-s+d[0])*(-s+d[0])+(a+d[1])*(a+d[1]))/c,n.scaled(v,Rt.TopRight);break;case Rt.TopLeft:v=Math.sqrt((-s+d[0])*(-s+d[0])+(-a+d[1])*(-a+d[1]))/c,n.scaled(v,Rt.BottomRight)}}}}},{key:"__dragEnd",value:function(t){this._isDragging&&(this._isDragging=!1,this._originSize=void 0,this._originCenter=void 0,this.off("mousemove",this._mousemoveEvent))}},{key:"handle_keydown",value:function(t){t.code;this._ctrlDown=this.isCtrlDown(t)}},{key:"handle_keyup",value:function(t){t.code;this._ctrlDown=this.isCtrlDown(t)}},{key:"handle_contextmenu",value:function(t){t.preventDefault(),this.__dragEnd(t)}},{key:"translate",value:function(t,e){this._center[0]+=t,this._center[1]+=e,this.update()}},{key:"setSize",value:function(t){this._size=t,this.update()}},{key:"_handleAlignOption",value:function(){}},{key:"setFrom",value:function(t){this._from=t,this.update()}},{key:"setTo",value:function(t){this._to=t,this.update()}},{key:"setFromTo",value:function(t,e){this._from=t,this._to=e,this.update()}}]),i}(Lt.d),Ut=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n,o,s,a,h){var l;return Object(r.a)(this,i),(l=e.call(this))._element=void 0,l._renderer=void 0,l._center=[0,0],l._offset=[0,0],l._fillColor=13487565,l._sprite=void 0,l._url=void 0,l._mousedownEvent=void 0,l._mouseupEvent=void 0,l._mousemoveEvent=void 0,l._mouseoutEvent=void 0,l._hitTarget=void 0,l._isDragging=!1,l._mousePoint=void 0,l._ctrlDown=!1,l._doubleClickedTimeout=null,l._element=t,l._renderer=n,l._center=o,l._offset=s,l._url=a,l.interactive=!0,l.buttonMode=!0,l.cursor="pointer",l._invalidate(),l._validate(),l.mount(),l}return Object(h.a)(i,[{key:"mount",value:function(){if(this._mousedownEvent=this.handle_mousedown.bind(this),this._mouseupEvent=this.handle_mouseup.bind(this),this._mousemoveEvent=this.handle_mousemove.bind(this),this._mouseoutEvent=this.handle_mouseout.bind(this),this.on("mousedown",this._mousedownEvent),this.on("mouseup",this._mouseupEvent),!this._sprite){var t=new Lt.k(Lt.m.from(this._url));t.anchor.set(.5),t.scale.set(.5,.5),t.x=0,t.y=0,this.addChild(t),this._sprite=t}}},{key:"unmount",value:function(){var t=this._renderer.viewport;this.off("mousedown",this._mousedownEvent),this.off("mouseup",this._mouseupEvent),this.off("mousemove",this._mousemoveEvent),t&&t.off("mousemove",this._mousemoveEvent)}},{key:"_invalidate",value:function(){}},{key:"_validate",value:function(){this._updateStyles(),this._validateImpl()}},{key:"_validateImpl",value:function(){this._draw()}},{key:"_updateStyles",value:function(){var t,e=this._element;if(e){e.resizing?this.visible=!1:this.visible=e.selected;var i=this._center[0]+this._offset[0],n=this._center[1]+this._offset[1],o=e.center,s=Math.sin(e.angle*Lt.c),a=Math.cos(e.angle*Lt.c),r=o[0]*(1-a)+o[1]*s,h=o[1]*(1-a)-o[0]*s,l=new Lt.e(a,s,-s,a,r,h).apply(new Lt.f(i,n));this.x=l.x,this.y=l.y;var u=(null===(t=this._renderer)||void 0===t?void 0:t.getScaled())||1;this.scale.x=1/u,this.scale.y=1/u}}},{key:"_draw",value:function(){this._drawBody()}},{key:"_drawBody",value:function(){this._element}},{key:"fillColor",set:function(t){this._fillColor=t,this.update()}},{key:"center",set:function(t){this._center=t,this.update()}},{key:"update",value:function(){this._invalidate(),this._validate()}},{key:"handle_zoomed",value:function(t){}},{key:"handle_panned",value:function(t){}},{key:"isCtrlDown",value:function(t){return t.ctrlKey||t.metaKey}},{key:"handle_mousedown",value:function(t){t.stopPropagation();var e=this._renderer,n=e.viewport;if(n){var o=e.renderer.plugins.interaction.hitTest(t.data.global);this._hitTarget=o,o instanceof i&&(this.__dragStart(t),n.on("mousemove",this._mousemoveEvent),n.on("mouseout",this._mouseoutEvent))}}},{key:"handle_mouseup",value:function(t){this.__dragEnd(t)}},{key:"handle_mousemove",value:function(t){this._renderer.viewport&&this.__dragMove(t)}},{key:"handle_mouseout",value:function(t){this.__dragEnd(t)}},{key:"__dragStart",value:function(t){var e=this._hitTarget,n=this._renderer.viewport;if(n&&!this._isDragging&&e instanceof i){var o=t.data.getLocalPosition(n);this._mousePoint=new Lt.f(o.x,o.y)}}},{key:"__dragMove",value:function(t){var e=this._hitTarget;if(e&&e.parent){var n=t.data.getLocalPosition(e.parent);if(!this._isDragging&&this._mousePoint&&(Math.abs(n.x-this._mousePoint.x)>=.1||Math.abs(n.y-this._mousePoint.y)>=.1)){this._isDragging=!0,e._element.rotating||(e._element.rotating=!0);var o=this._renderer.interactionManager.getCurrentInteraction();o instanceof le&&o.emit(st.RotateStart,{source:this,target:e._element})}var s=this._renderer;if(s.viewport&&this._isDragging&&this._mousePoint&&e instanceof i&&e.parent.parent){var a=e.parent.parent.getGlobalPosition(),r=e._element,h=this._calculateAngle([a.x,a.y],[t.data.global.x,t.data.global.y]);r.angle=-h;var l=s.interactionManager.getCurrentInteraction();l instanceof le&&(null===l||void 0===l||l.emit(st.Rotating,{source:this,target:e._element}))}}}},{key:"_calculateAngle",value:function(t,e){return-Math.round(180*Math.atan2(t[0]-e[0],e[1]-t[1])/Math.PI)}},{key:"__dragEnd",value:function(t){if(this._isDragging){this._isDragging=!1,this.off("mousemove",this._mousemoveEvent);var e=this._hitTarget;if(e&&e._element){e._element.rotating=!1;var i=this._renderer.interactionManager.getCurrentInteraction();i instanceof le&&i.emit(st.RotateEnd,{source:this,target:e._element})}}this._mousePoint=void 0}},{key:"handle_keydown",value:function(t){t.code;this._ctrlDown=this.isCtrlDown(t)}},{key:"handle_keyup",value:function(t){t.code;this._ctrlDown=this.isCtrlDown(t)}},{key:"handle_contextmenu",value:function(t){t.preventDefault(),this.__dragEnd(t)}},{key:"translate",value:function(t,e){this._center[0]+=t,this._center[1]+=e,this.update()}},{key:"offset",set:function(t){this._offset=t,this.update()}}]),i}(Lt.d);!function(t){t.Center="Center",t.Top="Top",t.Bottom="Bottom",t.Left="Left",t.Right="Right",t.TopLeft="TopLeft",t.TopRight="TopRight",t.BottomLeft="BottomLeft",t.BottomRight="BottomRight"}(Gt||(Gt={}));var Kt=new Map;Kt.set("0.5",Gt.Top),Kt.set("1.5",Gt.Right),Kt.set("2.5",Gt.Bottom),Kt.set("3.5",Gt.Left),Kt.set("0",Gt.TopLeft),Kt.set("1",Gt.TopRight),Kt.set("2",Gt.BottomRight),Kt.set("3",Gt.BottomLeft);var Wt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n,o,s,a){var h;return Object(r.a)(this,i),(h=e.call(this))._element=void 0,h._from=void 0,h._to=void 0,h._index=void 0,h._angle=0,h._renderer=void 0,h._center=[0,0],h._fillColor=8158332,h._fillAlpha=.1,h._text=void 0,h._size=4,h._mousedownEvent=void 0,h._mouseupEvent=void 0,h._mousemoveEvent=void 0,h._mouseoverEvent=void 0,h._mouseoutEvent=void 0,h._hitTarget=void 0,h._isDragging=!1,h._mousePoint=new Lt.f(0,0),h._doubleClickedTimeout=null,h._zIndex=999,h._element=t,h._renderer=s,h._index=a,h._from=n,h._to=o,h._invalidate(),h._validate(),h.interactive=!1,h.buttonMode=!1,h.mount(),h}return Object(h.a)(i,[{key:"mount",value:function(){this._text=new Lt.l("Length: ",{fontFamily:"PingFangSC-Regular, PingFang SC",fontSize:11,fill:0,align:"center",fontWeight:"400"}),this._text.resolution=2,this._text.anchor.set(this._element.x||0,this._element.y||0),this._text.text="".concat(this._size.toFixed(0)),this._text.zIndex=999,this._text.angle=this._angle*Lt.h,this.addChild(this._text)}},{key:"unmount",value:function(){this.clear(),this._text&&this.removeChild(this._text)}},{key:"_invalidate",value:function(){this.clear()}},{key:"_validate",value:function(){var t=this._from,e=this._to;if(this._from=t,this._to=e,t&&e&&t.p1&&e.p1){this._size=Number(y.b.distance(y.b.fromValues(t.p1[0],t.p1[1]),y.b.fromValues(e.p1[0],e.p1[1])));var i=y.b.fromValues(e.p1[0]-t.p1[0],e.p1[1]-t.p1[1]),n=y.b.angle(i,y.b.fromValues(i[0],0));this._angle=i[0]*i[1]>=0?n:-n,this._center=[(t.p1[0]+e.p1[0])/2,(t.p1[1]+e.p1[1])/2],this._updateStyles(),this._validateImpl()}else this.unmount()}},{key:"_validateImpl",value:function(){this._draw()}},{key:"_updateStyles",value:function(){var t=this._element;if(t){if(this.interactive=t.styles.dimensionGizmoInteractive,this.buttonMode=t.styles.dimensionGizmoButtonMode,this.zIndex=t.styles.dimensionGizmoZIndex,this._text){var e=new Lt.i;this._text.getLocalBounds(e),this._text.x=this._center[0],this._text.y=this._center[1],this._text.anchor.set(.5,.5),this._text.text="".concat(this._size.toFixed(0)),this._text.angle=this._angle*Lt.h,this._text.zIndex=t.styles.dimensionGizmoZIndex+1}this.visible=this._size>20}}},{key:"_draw",value:function(){this.clear(),this._drawBody()}},{key:"_drawBody",value:function(){var t=this._element;if(t){var e=this._from,i=this._to,n=y.b.fromValues(e.p1[0],e.p1[1]),o=y.b.fromValues(i.p1[0],i.p1[1]),s=y.b.fromValues(i.p1[0]-e.p1[0],i.p1[1]-e.p1[1]),a=y.b.create();y.b.normalize(a,s);var r=y.b.create();y.b.rotate(r,s,y.b.fromValues(0,0),-90*Lt.c),y.b.normalize(r,r);var h=y.b.create();y.b.scaleAndAdd(h,n,r,5),y.b.scaleAndAdd(r,n,r,10),this.lineStyle(.4,13487565,.55),this.moveTo(n[0],n[1]),this.lineTo(r[0],r[1]),this.closePath();var l=y.b.create();y.b.rotate(l,s,y.b.fromValues(0,0),-90*Lt.c),y.b.normalize(l,l);var u=y.b.create();y.b.scaleAndAdd(u,o,l,5),y.b.scaleAndAdd(l,o,l,10),this.lineStyle(.4,13487565,.55),this.moveTo(o[0],o[1]),this.lineTo(l[0],l[1]),this.closePath(),this.lineStyle(1,13487565,.55),this.moveTo(h[0],h[1]),this.lineTo(u[0],u[1]),this.closePath(),this._center=[(h[0]+u[0])/2,(h[1]+u[1])/2],this._text&&(this._text.x=this._center[0],this._text.y=this._center[1])}}},{key:"fillColor",set:function(t){this._fillColor=t,this.update()}},{key:"center",set:function(t){this._center=t,this.update()}},{key:"setAngle",value:function(t){this._angle=t,this.update()}},{key:"update",value:function(){this._invalidate(),this._validate()}},{key:"handle_zoomed",value:function(t){}},{key:"handle_panned",value:function(t){}},{key:"isCtrlDown",value:function(t){return t.ctrlKey||t.metaKey}},{key:"handle_mousedown",value:function(t){t.stopPropagation();var e=this._renderer;if(e.viewport){var i=e.renderer.plugins.interaction.hitTest(t.data.global);this._hitTarget=i,this._doubleClickedTimeout&&(clearTimeout(this._doubleClickedTimeout),this._doubleClickedTimeout=null)}}},{key:"handle_mouseup",value:function(t){var e=this;this._doubleClickedTimeout=setTimeout((function(){e._doubleClickedTimeout=null}),300)}},{key:"handle_mousemove",value:function(t){this._renderer.viewport}},{key:"handle_mouseout",value:function(t){this._fillColor=8158332,this._fillAlpha=.1}},{key:"handle_mouseover",value:function(t){this._fillColor=3438588,this._fillAlpha=1}},{key:"__dragStart",value:function(t){}},{key:"__dragMove",value:function(t){}},{key:"__dragEnd",value:function(t){}},{key:"handle_keydown",value:function(t){}},{key:"handle_keyup",value:function(t){}},{key:"handle_contextmenu",value:function(t){t.preventDefault(),this.__dragEnd(t)}},{key:"translate",value:function(t,e){this._center[0]+=t,this._center[1]+=e,this.update()}},{key:"setSize",value:function(t){this._size=t,this.update()}},{key:"setFrom",value:function(t){this._from=t,this.update()}},{key:"setTo",value:function(t){this._to=t,this.update()}},{key:"setFromTo",value:function(t,e){this._from=t,this._to=e,this.update()}}]),i}(Lt.d),Zt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this,t,n))._dragSpots=new Map,o._rotateSpot=void 0,o._zoomedEvent=void 0,o.interactive=!0,o.buttonMode=!0,o._element=t,o.visible=t.selected,o.zIndex=t.styles.editorGizmoZIndex,o.visible=t.styles.editorGizmoVisible,o.cursor=t.styles.editorGizmoCursor,o.mount(),o._eventEmitter.on(ot.ShiftKey,(function(t){o.unmount(),o.mount()})),o}return Object(h.a)(i,[{key:"_invalidate",value:function(){this.clear()}},{key:"_validate",value:function(){this._updateStyles(),this._validateImpl()}},{key:"_updateStyles",value:function(){var t=this._element;t&&(this.visible=t.selected,this.zIndex=t.styles.editorGizmoZIndex,this.visible=t.styles.editorGizmoVisible,this.cursor=t.styles.editorGizmoCursor)}},{key:"_drawBody",value:function(){var t=this,e=this._element,i=this._renderer;if(e&&i){this.clear();var n=i.interactionManager.getCurrentInteraction();if(n instanceof le)if(e.type===D.AlignLine||e.type===D.Line||e.type===D.ShapeLine){var o=e.points;o&&this._dragSpots&&this._dragSpots.size>0&&this._dragSpots.forEach((function(t,e){var i=o[Number(e)];t.center=i,t.mode="resize",t.update()}))}else if(n._shiftDown){var s=e.getAABB().points;if(s&&this._dragSpots&&this._dragSpots.size>0){var a=[];s.forEach((function(t){a.push(t[0],t[1])})),this.lineStyle(.6,3438588,.5),this.drawPolygon(a),this._dragSpots.forEach((function(e,i){var n=s[Number(i)];if(n)e.center=n,e.mode="scale",e.update();else{var o=s[Number(i)-.5],a=s[(Number(i)-.5+1)%s.length];if(!o||!a)return void t.unmount();var r=[(o[0]+a[0])/2,(o[1]+a[1])/2];e.center=r,e.mode="scale",e.update()}}))}this._rotateSpot&&(this._rotateSpot.unmount(),this._rotateSpot.visible=!1)}else{var r=e.points;if(r&&this._dragSpots&&this._dragSpots.size>0&&this._dragSpots.forEach((function(e,i){var n=r[Number(i)-.5],o=r[(Number(i)-.5+1)%r.length];if(n&&o){var s=y.b.fromValues(o[0]-n[0],o[1]-n[1]),a=y.b.angle(s,y.b.fromValues(s[0],0)),h=[(n[0]+o[0])/2,(n[1]+o[1])/2];e.center=h,e.mode="resize",e.setAngle(s[0]*s[1]>0?a:-a)}else t.unmount()})),this._rotateSpot){var h=e.size;this._rotateSpot.center=[e.x,e.y],this._rotateSpot.offset=[0,h[1]/2+26],this._rotateSpot.visible=!e.resizing}}}}},{key:"mount",value:function(){var t,e=this;this._keydownEvent=this.handle_keydown.bind(this),this._keyupEvent=this.handle_keyup.bind(this),document.addEventListener("keydown",this._keydownEvent),document.addEventListener("keyup",this._keyupEvent);var i=this._element,n=this._renderer;if(i&&n){var o=n.interactionManager.getCurrentInteraction();if(this._zoomedEvent=this.handle_zoomed.bind(this),null===(t=n.viewport)||void 0===t||t.on("zoomed",this._zoomedEvent),o instanceof le){if(i.type===D.AlignLine||i.type===D.Line||i.type===D.ShapeLine){var s=i.points;s&&s.forEach((function(t,o){var s=new It(i,n,t,o,i.angle,"circle");e._dragSpots.set(o,s),e.addChild(s)}))}else if(i.type===D.Domain)if(o._shiftDown){var a=i.getAABB().points;a.forEach((function(t,o){var s=new It(i,n,t,o);e._dragSpots.set(o,s),e.addChild(s);var r=t,h=a[(o+1)%a.length];if(r&&h){var l=[(r[0]+h[0])/2,(r[1]+h[1])/2],u=new It(i,n,l,o+.5);e._dragSpots.set(o+.5,u),e.addChild(u)}else e.unmount()}))}else{var r=i.points;if(r&&r.forEach((function(t,o){var s=t,a=r[(o+1)%r.length];if(s&&a){var h=y.b.fromValues(a[0]-s[0],a[1]-s[1]),l=y.b.angle(h,y.b.fromValues(h[0],0)),u=[(s[0]+a[0])/2,(s[1]+a[1])/2],d=new It(i,n,u,o+.5,h[0]*h[1]>=0?l:-l);e._dragSpots.set(o+.5,d),e.addChild(d)}else e.unmount()})),!this._rotateSpot){var h=i.size;this._rotateSpot=new Ut(i,n,[i.x,i.y],[0,h[1]/2+26],"renderer/icons/ic_rotate.png"),this.addChild(this._rotateSpot)}}this._invalidate(),this._validate()}}}},{key:"unmount",value:function(){var t,e,i=this;null===(t=this._renderer)||void 0===t||null===(e=t.viewport)||void 0===e||e.off("zoomed",this._zoomedEvent),this._dragSpots&&(this._dragSpots.forEach((function(t){i.removeChild(t),t.unmount()})),this._dragSpots.clear()),this._rotateSpot&&this._rotateSpot.unmount()}},{key:"handle_mouseup",value:function(t){this._dragSpots&&this._dragSpots.forEach((function(e){e.handle_mouseup(t)})),this._rotateSpot&&this._rotateSpot.handle_mouseup(t)}},{key:"handle_mouseout",value:function(t){this._dragSpots&&this._dragSpots.forEach((function(e){e.handle_mouseout(t)})),this._rotateSpot&&this._rotateSpot.handle_mouseout(t)}},{key:"handle_zoomed",value:function(t){this._invalidate(),this._validate()}}]),i}(Tt),Nt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this,t,n))._alignSpots=new Map,o.interactive=!0,o.buttonMode=!1,o._element=t,o.zIndex=t.styles.editorGizmoZIndex,o.visible=t.styles.editorGizmoVisible,o.mount(),o._eventEmitter.on(ot.CtrlKeyDown,(function(t){o.unmount(),o.mount()})),o._eventEmitter.on(ot.CtrlKeyUp,(function(t){o._alignSpots&&(o._alignSpots.forEach((function(t){t.unmount()})),o._alignSpots.clear())})),o}return Object(h.a)(i,[{key:"_invalidate",value:function(){this.clear()}},{key:"_validate",value:function(){this._updateStyles(),this._validateImpl()}},{key:"_updateStyles",value:function(){var t=this._element;t&&(this.zIndex=t.styles.editorGizmoZIndex,this.visible=t.styles.editorGizmoVisible)}},{key:"_drawBody",value:function(){var t=this._element,e=this._renderer;if(t&&e){this.clear();var i=t.points;i&&this._alignSpots&&this._alignSpots.size>0&&this._alignSpots.forEach((function(t,e){var n=i[Number(e)-.5],o=i[(Number(e)-.5+1)%i.length];t.setFromTo(n,o)}))}}},{key:"mount",value:function(){var t=this;this._keydownEvent=this.handle_keydown.bind(this),this._keyupEvent=this.handle_keyup.bind(this),document.addEventListener("keydown",this._keydownEvent),document.addEventListener("keyup",this._keyupEvent);var e=this._element,i=this._renderer;if(e&&i&&i.interactionManager.getCurrentInteraction()instanceof le){var n=e.points;n&&n.forEach((function(o,s){var a=o,r=n[(s+1)%n.length],h=new Vt(e,a,r,i,s+.5,"rect");t._alignSpots.set(s+.5,h),h.visible=!0,h.mode="align",t.addChild(h)})),this._invalidate(),this._validate()}}},{key:"unmount",value:function(){var t=this;this._alignSpots&&(this._alignSpots.forEach((function(e){t.removeChild(e),e.unmount()})),this._alignSpots.clear()),document.removeEventListener("keydown",this._keydownEvent),document.removeEventListener("keyup",this._keyupEvent)}},{key:"handle_mouseup",value:function(t){this._alignSpots&&this._alignSpots.forEach((function(e){e.handle_mouseup(t)}))}}]),i}(Tt),Ht=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this,t,n))._spots=new Map,o._element=t,o.interactive=t.styles.dimensionGizmoInteractive,o.buttonMode=t.styles.dimensionGizmoButtonMode,o.zIndex=t.styles.dimensionGizmoZIndex,o}return Object(h.a)(i,[{key:"_invalidate",value:function(){this.clear()}},{key:"_validate",value:function(){this._updateStyles(),this._validateImpl()}},{key:"_updateStyles",value:function(){var t=this._element;t&&(this.visible=t.selected,this.interactive=t.styles.dimensionGizmoInteractive,this.buttonMode=t.styles.dimensionGizmoButtonMode,this.zIndex=t.styles.dimensionGizmoZIndex)}},{key:"_drawBody",value:function(){var t=this._element,e=this._renderer;if(this.clear(),t&&e&&this.visible){var i=t.points;if(this._spots&&this._spots.size>0)this._spots.forEach((function(t,e){var n={p1:i[Number(e)-.5],p2:[]},o={p1:i[(Number(e)-.5+1)%i.length],p2:[]};t.setFromTo(n,o)}));else for(var n=0;n<i.length;n++){var o=i[n],s=i[(n+1)%i.length],a=new Wt(t,{p1:o,p2:[]},{p1:s,p2:[]},e,n+.5);this._spots.set(n+.5,a),this.addChild(a)}t.debug}}},{key:"mount",value:function(){var t=this._element,e=this._renderer;if(t&&e)e.interactionManager.getCurrentInteraction()}},{key:"unmount",value:function(){this._invalidate(),this._validate()}},{key:"handle_mouseup",value:function(t){}}]),i}(Tt);var Yt=i(143),qt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this))._id=function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}(),o._element=void 0,o._renderer=void 0,o._imageCache=void 0,o._textureCache=void 0,o._gizmos=new Map,o._outlineFilterBlue=new Yt.b(2,10092441),o._outlineFilterRed=new Yt.a({distance:10,outerStrength:4,innerStrength:0,color:16711680,quality:1,knockout:!1}),o._element=t,o._renderer=n,o.visible=t.visible,o.interactive=t.styles.interactive,o.buttonMode=t.styles.buttonMode,o.cursor=t.styles.cursor,o.zIndex=t.styles.zIndex,o._invalidate(),o._validate(),o}return Object(h.a)(i,[{key:"_invalidate",value:function(t){}},{key:"_validate",value:function(t){this._updateStyles(),this._checkGizmos(),this._validateImpl()}},{key:"calculateBounds",value:function(){}},{key:"_updateStyles",value:function(){var t=this._element;if(t){this.visible=t.visible,this.interactive=t.styles.interactive,this.buttonMode=t.styles.buttonMode,this.cursor=t.styles.cursor,this.zIndex=t.styles.zIndex,this.getBounds();var e=t.getAABB();this.pivot.x=e.x+e.width/2,this.pivot.y=e.y+e.height/2,this.x=e.x+e.width/2,this.y=e.y+e.height/2}}},{key:"_checkGizmos",value:function(){this._element&&(this._checkLabelGizmo(),this._checkLabel2Gizmo(),this._checkEditorGizmo(),this._checkDimensionGizmo())}},{key:"_checkLabelGizmo",value:function(){var t=this._element;if(t){var e=t.name,i=this._gizmos.get("labelGizmo");null!=e&&""!==e?i||(i=new Bt(t,this._renderer),this.addChild(i),this._gizmos.set("labelGizmo",i)):i&&(this.removeChild(i),i.unmount(),this._gizmos.delete("labelGizmo"))}}},{key:"_checkLabel2Gizmo",value:function(){var t=this._element;if(t){var e=t.name2,i=this._gizmos.get("label2Gizmo");null!=e&&""!==e?i||(i=new Dt(t,this._renderer),this.addChild(i),this._gizmos.set("label2Gizmo",i)):i&&(this.removeChild(i),i.unmount(),this._gizmos.delete("label2Gizmo"))}}},{key:"_checkEditorGizmo",value:function(){var t=this._element,e=this._renderer;if(t&&e){var i=this._gizmos.get("editorGizmo");t.selected&&!t.dragging?i||(i=new Zt(t,this._renderer),this.addChild(i),this._gizmos.set("editorGizmo",i)):(!t.selected||t.dragging||t.isEditing)&&i&&(this.removeChild(i),i.unmount(),this._gizmos.delete("editorGizmo"))}}},{key:"_checkAlignGizmo",value:function(){var t=this._element,e=this._renderer;if(t&&e){var i=this._gizmos.get("alignGizmo"),n=e.interactionManager.getCurrentInteraction();n instanceof le&&(n._ctrlDown?i||(i=new Nt(t,this._renderer),this.addChild(i),this._gizmos.set("alignGizmo",i)):i&&(this.removeChild(i),i.unmount(),this._gizmos.delete("alignGizmo")))}}},{key:"_checkDimensionGizmo",value:function(){var t=this._element,e=this._renderer;if(t&&e){var i=this._gizmos.get("dimensionGizmo");t.selected&&!t.dragging?i||(i=new Ht(t,this._renderer),this.addChild(i),this._gizmos.set("dimensionGizmo",i)):(!t.selected||t.dragging||t.isEditing)&&i&&(this.removeChild(i),i.unmount(),this._gizmos.delete("dimensionGizmo"))}}},{key:"_validateImpl",value:function(){this._draw()}},{key:"_draw",value:function(){this.clear();var t=this._element;t&&t.visible&&this._element&&this._element.visible&&(this._drawBody(),this._drawOuter(),this._drawHover(),this._drawSelect(),this._drawGizmos(),this._element&&this._element.debug&&(this._drawBoundingBox(),this._drawAABB(),this._drawOBB()))}},{key:"_drawBoundingBox",value:function(){}},{key:"_drawAABB",value:function(){}},{key:"_drawOBB",value:function(){}},{key:"_drawBody",value:function(){var t=this._element;t&&(t.selected?(this.beginFill(16750950,1),this.lineStyle(1,65280,1),this.drawEllipse(t.x,t.y,20,20),this.endFill()):(this.beginFill(65280,1),this.lineStyle(1,65280,1),this.drawEllipse(t.x,t.y,20,20),this.endFill()))}},{key:"_drawBorder",value:function(){}},{key:"_drawOuter",value:function(){}},{key:"_drawHover",value:function(){var t=this._element;if(t&&t.hovered){var e=t.points;this.lineStyle(.6,3438588,1);var i=[];e.forEach((function(t){i.push(t[0],t[1])})),this.drawPolygon(i)}}},{key:"_drawSelect",value:function(){var t=this._element;if(t&&t.selected){var e=t.points;t.dragging?(this.beginFill(0,.1),this.lineStyle(.6,3438588,1)):this.lineStyle(1,3438588,1);var i=[];e.forEach((function(t){i.push(t[0],t[1])})),this.drawPolygon(i)}}},{key:"_drawEditor",value:function(){}},{key:"_drawGizmos",value:function(){this._gizmos&&this._gizmos.forEach((function(t){t instanceof Tt&&t.update()}))}},{key:"update",value:function(){this._invalidate(),this._validate()}},{key:"filterOn",value:function(){this.filters=[this._outlineFilterRed]}},{key:"filterOff",value:function(){this.filters=[this._outlineFilterBlue]}},{key:"loadImage",value:function(){var t=Object(d.a)(f.a.mark((function t(e){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,i){var n=new Image;n.onload=function(){return t(n)},n.onerror=function(t){return i(t)},n.src=e})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),i}(Lt.d),Xt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this,t,n)).text=void 0,o}return Object(h.a)(i,[{key:"calculateBounds",value:function(){var t=this._element;if(t){var e=t.getAABB(),i=new Lt.i(e.x,e.y,e.width,e.height);if(this.text){var n=this.text,o=new Lt.i;n.getLocalBounds(o),function(t,e,i){i||(i=new Lt.i);var n=Math.min(t.x,e.x),o=Math.max(t.x+t.width,e.x+e.width),s=Math.min(t.y,e.y),a=Math.max(t.y+t.height,e.y+e.height);i?(i.x=n,i.y=s,i.width=o-n,i.height=a-s):new Lt.i}(i,new Lt.i(n.x,n.y,o.width,o.height),i)}this._boundsRect=i}}},{key:"_updateStyles",value:function(){Object(St.a)(Object(Mt.a)(i.prototype),"_updateStyles",this).call(this);this._element}},{key:"_drawBoundingBox",value:function(){var t=this._element;if(t){var e=new Lt.i;this.text&&this.text.getLocalBounds(e);var i=t.getBoundingBox(10);this.lineStyle(1,16737894,1),this.beginFill(0,0),this.drawRect(i.x,i.y,i.width,i.height),this.endFill();var n=this._boundsRect;if(this.lineStyle(1,16711731,1),this.beginFill(0,0),this.drawRect(n.x,n.y,n.width,n.height),this.endFill(),this.text){var o=new Lt.i;this.text&&this.text.getLocalBounds(o);this.parent.scaled;this.lineStyle(1,16777062,1),this.beginFill(0,0),this.drawRect(this.text.x,this.text.y,o.width,o.height),this.endFill()}}}},{key:"_drawAABB",value:function(){var t=this._element;if(t){var e=t.getAABB();this.lineStyle(1,65280,1),this.beginFill(16776960,0),this.drawRect(e.x,e.y,e.width,e.height),this.endFill()}}},{key:"_drawOBB",value:function(){var t=this._element;if(t){var e=t.getOBB().points;this.lineStyle(1,16776960,1),this.beginFill(16776960,0);var i=[];e.forEach((function(t){i.push(t[0],t[1])})),this.drawPolygon(i)}}},{key:"_drawBody",value:function(){var t=this,e=this._element;if(e){var i=e.points;if(i&&0!==i.length){var n=[];i.forEach((function(t){n.push(t[0],t[1])}));var o=e.selected,s=o?e.styles.selectFill:e.styles.fill,a=o?e.styles.selectFillColor:e.styles.fillColor,r=o?e.styles.selectFillAlpha:e.styles.fillAlpha,h=e.styles.fillImage,l=e.styles.fillVector,u=e.styles.fillType,d=e.styles.strokeColor,c=e.styles.strokeWidth,v=e.styles.strokeAlpha,_=e.styles.shapeClosed;if(s){var f=e.getAABB();if(e.image&&(this._imageCache||this.loadImage(e.image).then((function(e){e instanceof HTMLImageElement&&(t._imageCache=e,t.update())})).catch((function(t){}))),u===P.Default||u===P.ImageVector){if(l&&(this.lineStyle(c,d,v),this.beginFill(a,r),this.drawPolygon(n),this.endFill()),h&&this._imageCache){this.beginFill(a,r);var g=new Lt.e;if(g=g.translate(-f.x,-f.y).scale(this._imageCache.width/f.width,this._imageCache.height/f.height),!this._textureCache){var m=new Lt.m(new Lt.b(this._imageCache));this._textureCache=m}this.fill.visible=h,this.fill.texture=this._textureCache,this.fill.matrix=g,this.fill.color=16777215,this.drawPolygon(n),this.endFill()}}else if(u===P.VectorImage){if(h&&this._imageCache){var p=new Lt.e;if(p=p.translate(-f.x,-f.y).scale(this._imageCache.width/f.width,this._imageCache.height/f.height),!this._textureCache){var y=new Lt.m(new Lt.b(this._imageCache));this._textureCache=y}this.fill.visible=h,this.fill.texture=this._textureCache,this.fill.matrix=p,this.fill.color=16777215,this.drawPolygon(n),this.endFill()}l&&(this.lineStyle(c,d,v),this.beginFill(a,r),this.drawPolygon(n),this.endFill())}_&&this.closePath()}}}}}]),i}(qt),Jt=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this,t,n)).text=void 0,o}return Object(h.a)(i,[{key:"_updateStyles",value:function(){Object(St.a)(Object(Mt.a)(i.prototype),"_updateStyles",this).call(this);this._element}},{key:"_drawBoundingBox",value:function(){var t=this._element;if(t){var e=new Lt.i;this.text&&this.text.getLocalBounds(e);var i=t.getBoundingBox(10);this.lineStyle(1,16737894,1),this.beginFill(0,0),this.drawRect(i.x,i.y,i.width,i.height),this.endFill();var n=this._boundsRect;if(this.lineStyle(1,16711731,1),this.beginFill(0,0),this.drawRect(n.x,n.y,n.width,n.height),this.endFill(),this.text){var o=new Lt.i;this.text&&this.text.getLocalBounds(o);this.parent.scaled;this.lineStyle(1,16777062,1),this.beginFill(0,0),this.drawRect(this.text.x,this.text.y,o.width,o.height),this.endFill()}}}},{key:"_drawAABB",value:function(){var t=this._element;if(t){var e=t.getAABB();this.lineStyle(1,65280,1),this.beginFill(16776960,0),this.drawRect(e.x,e.y,e.width,e.height),this.endFill(),this.lineStyle(1,0,1)}}},{key:"_drawOBB",value:function(){var t=this._element;if(t){var e=t.getOBB().points;this.lineStyle(1,16776960,1),this.beginFill(16776960,0);var i=[];e.forEach((function(t){i.push(t[0],t[1])})),this.drawPolygon(i)}}},{key:"_drawBody",value:function(){var t=this,e=this._element;if(e){var i=e.points;if(i&&0!==i.length){var n=[];i.forEach((function(t){n.push(t[0],t[1])}));var o=e.selected,s=o?e.styles.selectFill:e.styles.fill,a=o?e.styles.selectFillColor:e.styles.fillColor,r=o?e.styles.selectFillAlpha:e.styles.fillAlpha,h=e.styles.fillImage,l=e.styles.fillVector,u=e.styles.fillType,d=e.styles.strokeColor,c=e.styles.strokeWidth,v=e.styles.strokeAlpha,_=e.styles.shapeClosed;if(s){var f=e.getAABB();if(e.image&&(this._imageCache||this.loadImage(e.image).then((function(e){e instanceof HTMLImageElement&&(t._imageCache=e,t.update())})).catch((function(t){}))),u===P.Default||u===P.ImageVector){if(l&&(this.lineStyle(c,d,v),this.beginFill(a,r),this.drawPolygon(n),this.endFill()),h&&this._imageCache){this.lineStyle(c,d,v),this.beginFill(a,r);var g=new Lt.e;if(g=g.translate(-f.x,-f.y).scale(this._imageCache.width/f.width,this._imageCache.height/f.height),!this._textureCache){var m=new Lt.m(new Lt.b(this._imageCache));this._textureCache=m}this.fill.visible=h,this.fill.texture=this._textureCache,this.fill.matrix=g,this.fill.color=16777215,this.drawPolygon(n),this.endFill()}}else if(u===P.VectorImage){if(h&&this._imageCache){var p=new Lt.e;if(p=p.translate(-f.x,-f.y).scale(this._imageCache.width/f.width,this._imageCache.height/f.height),!this._textureCache){var y=new Lt.m(new Lt.b(this._imageCache));this._textureCache=y}this.fill.visible=h,this.fill.texture=this._textureCache,this.fill.matrix=p,this.fill.color=16777215,this.drawPolygon(n),this.endFill()}l&&(this.lineStyle(c,d,v),this.beginFill(a,r),this.drawPolygon(n),this.endFill())}_&&this.closePath()}}}}},{key:"_drawHover",value:function(){var t=this._element;if(t){this._renderer,t.styles.fill,t.styles.fillColor,t.styles.fillAlpha,t.styles.fillImage,t.styles.fillVector,t.styles.fillType,t.styles.strokeColor,t.styles.strokeWidth,t.styles.strokeAlpha,t.styles.shapeClosed,t.styles.hoverFill;var e=t.styles.hoverFillColor,i=t.styles.hoverFillAlpha,n=t.styles.hoverStrokeWidth,o=t.styles.hoverStrokeColor;t.styles.hoverStrokeAlpha;if(t.hovered&&!t.selected){var s=t.points;this.beginFill(e,i),this.lineStyle(n,o,n);var a=[];s.forEach((function(t){a.push(t[0],t[1])})),this.drawPolygon(a)}}}}]),i}(qt),Qt={dash:[10,5],width:1,color:16777215,alpha:1,scale:1,useTexture:!1,alignment:.5},$t=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object(r.a)(this,t),this.graphics=void 0,this.lineLength=void 0,this.cursor=new Lt.f,this.scale=1,this.activeTexture=void 0,this.start=void 0,this.dashSize=void 0,this.dash=void 0,this.useTexture=void 0,this.graphics=e,i=Object(c.a)(Object(c.a)({},Qt),i),this.dash=i.dash,this.dash?this.dashSize=this.dash.reduce((function(t,e){return t+e})):this.dashSize=0,this.useTexture=i.useTexture,this.useTexture){var n=t.getTexture(i,this.dashSize);e.lineTextureStyle({width:(i.width||0)*(i.scale||1),color:i.color,alpha:i.alpha,texture:n,alignment:i.alignment}),this.activeTexture=n}else this.graphics.lineStyle({width:(i.width||0)*(i.scale||1),color:i.color,alpha:i.alpha,cap:i.cap,join:i.join,alignment:i.alignment});this.scale=i.scale||1}return Object(h.a)(t,[{key:"setStyle",value:function(e){if(e.dash&&(this.dash=e.dash,this.dash?this.dashSize=this.dash.reduce((function(t,e){return t+e})):this.dashSize=0),e.useTexture){this.useTexture=e.useTexture;var i=t.getTexture(e,this.dashSize||0);this.graphics.lineTextureStyle({width:(e.width||0)*(e.scale||1),color:e.color,alpha:e.alpha,texture:i,alignment:e.alignment}),this.activeTexture=i}else this.graphics.lineStyle({width:(e.width||0)*(e.scale||1),color:e.color,alpha:e.alpha,cap:e.cap,join:e.join,alignment:e.alignment});this.scale=e.scale||1}},{key:"moveTo",value:function(t,e){return this.lineLength=0,this.cursor.set(t,e),this.start=new Lt.f(t,e),this.graphics.moveTo(this.cursor.x,this.cursor.y),this}},{key:"lineTo",value:function(e,i,n){void 0===typeof this.lineLength&&this.moveTo(0,0);var o=t.distance(this.cursor.x,this.cursor.y,e,i),s=Math.atan2(i-this.cursor.y,e-this.cursor.x);if(!this.start||!this.dash||void 0===this.lineLength||!this.dashSize)return this;var a=n&&e===this.start.x&&i===this.start.y;if(this.useTexture)if(this.graphics.moveTo(this.cursor.x,this.cursor.y),this.adjustLineStyle(s),a&&this.dash.length%2===0){var r=this.dash[this.dash.length-1];this.graphics.lineTo(e-Math.cos(s)*r,i-Math.sin(s)*r)}else this.graphics.lineTo(e,i);else{for(var h=Math.cos(s),l=Math.sin(s),u=this.cursor.x,d=this.cursor.y,c=this.lineLength%(this.dashSize*this.scale),v=0,_=0,f=0,g=0;g<this.dash.length;g++){var m=this.dash[g]*this.scale;if(c<f+m){v=g,_=c-f;break}f+=m}for(var p=o;p>0;){var y=this.dash[v]*this.scale-_,b=p>y?y:p;if(a)if(t.distance(u+h*b,d+l*b,this.start.x,this.start.y)<=b){if(v%2===0){var k=t.distance(u,d,this.start.x,this.start.y)-this.dash[this.dash.length-1]*this.scale;u+=h*k,d+=l*k,this.graphics.lineTo(u,d)}break}u+=h*b,d+=l*b,v%2?this.graphics.moveTo(u,d):this.graphics.lineTo(u,d),p-=b,v=++v===this.dash.length?0:v,_=0}}return this.lineLength+=o,this.cursor.set(e,i),this}},{key:"closePath",value:function(){this.start&&this.lineTo(this.start.x,this.start.y,!0)}},{key:"drawCircle",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:80,o=2*Math.PI/n,s=0,a=[t+Math.cos(s)*i,e+Math.sin(s)*i];this.moveTo(a[0],a[1]),s+=o;for(var r=1;r<n+1;r++){var h=r===n?a:[t+Math.cos(s)*i,e+Math.sin(s)*i];this.lineTo(h[0],h[1]),s+=o}return this}},{key:"drawEllipse",value:function(t,e,i,n){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:80,s=2*Math.PI/o,a={x:t-i*Math.sin(0),y:e-n*Math.cos(0)},r=s;r<2*Math.PI;r+=s){var h=t-i*Math.sin(r),l=e-n*Math.cos(r);0===r?this.moveTo(h,l):this.lineTo(h,l)}return this.lineTo(a.x,a.y,!0),this}},{key:"drawPolygon",value:function(t){if("number"===typeof t[0]){this.moveTo(t[0],t[1]);for(var e=2;e<t.length;e+=2)this.lineTo(t[e],t[e+1],e===t.length-2)}else{var i=t[0];this.moveTo(i.x,i.y);for(var n=1;n<t.length;n++){var o=t[n];this.lineTo(o.x,o.y,n===t.length-1)}}return this}},{key:"drawRect",value:function(t,e,i,n){return this.moveTo(t,e).lineTo(t+i,e).lineTo(t+i,e+n).lineTo(t,e+n).lineTo(t,e,!0),this}},{key:"adjustLineStyle",value:function(t){if(this.lineLength){var e=this.graphics.line;e.matrix=new Lt.e,t&&e.matrix.rotate(t),1!==this.scale&&e.matrix.scale(this.scale,this.scale);var i=-this.lineLength;e.matrix.translate(this.cursor.x+i*Math.cos(t),this.cursor.y+i*Math.sin(t)),this.graphics.lineStyle(e)}}},{key:"clear",value:function(){var t;null===(t=this.graphics)||void 0===t||t.clear()}}],[{key:"distance",value:function(t,e,i,n){return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2))}},{key:"getTexture",value:function(e,i){if(e.dash&&e.width){var n=e.dash.toString();if(t.dashTextureCache[n])return t.dashTextureCache[n];var o=document.createElement("canvas");o.width=i,o.height=Math.ceil(e.width);var s=o.getContext("2d");if(s){s.strokeStyle="white",s.globalAlpha=e.alpha||1,s.lineWidth=e.width;var a=0,r=e.width/2;s.moveTo(a,r);for(var h=0;h<e.dash.length;h+=2)a+=e.dash[h],s.lineTo(a,r),e.dash.length!==h+1&&(a+=e.dash[h+1],s.moveTo(a,r));s.stroke();var l=t.dashTextureCache[n]=Lt.m.from(o);return l.baseTexture.scaleMode=Lt.j.NEAREST,l}console.warn("Did not get context from canvas")}}}]),t}();$t.dashTextureCache={};var te,ee,ie=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(r.a)(this,i),(t=e.call(this))._graphics=void 0,t._graphicsDash=void 0,t._dirty=!0,t._datas=[],t.set(n),t._graphics=new Lt.d,t._graphicsDash=new $t(Object(v.a)(t),{dash:[1,1],width:1,color:0,alpha:1,useTexture:!1,useDots:!0}),t.addChild(t._graphics),t._dirty=!0,t}return Object(h.a)(i,[{key:"datas",get:function(){return this._datas},set:function(t){this._datas!==t&&(this._datas=t,this._dirty=!0)}},{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t),this._dirty=!0}},{key:"render",value:function(t){Object(St.a)(Object(Mt.a)(i.prototype),"render",this).call(this,t),this._dirty&&(this._dirty=!1,this._graphics.clear(),this._graphicsDash.clear(),this.clear(),this.renderDatas())}},{key:"renderDatas",value:function(){var t=this;this._datas.forEach((function(e,i){var n=e.from,o=e.to,s=(e.type,e.dash);s?(t._graphicsDash.setStyle({dash:s||[1,1],width:1,color:71233,alpha:.2,useTexture:!1,useDots:!0,scale:1,alignment:.5}),t._graphicsDash.moveTo(n[0],n[1]),t._graphicsDash.lineTo(o[0],o[1]),t._graphicsDash.closePath()):(t._graphics.lineStyle(1,71233,.2),t._graphics.moveTo(n[0],n[1]),t._graphics.lineTo(o[0],o[1]),t._graphics.closePath())}))}}]),i}(Lt.d),ne=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(r.a)(this,i),(t=e.call(this))._graphics=void 0,t._graphicsDash=void 0,t._dirty=!0,t._datas=[],t.set(n),t._graphics=new Lt.d,t._graphicsDash=new $t(Object(v.a)(t),{dash:[1,1],width:1,color:0,alpha:1,useTexture:!1,useDots:!0}),t.addChild(t._graphics),t._dirty=!0,t}return Object(h.a)(i,[{key:"datas",get:function(){return this._datas},set:function(t){this._datas!==t&&(this._datas=t,this._dirty=!0)}},{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t),this._dirty=!0}},{key:"render",value:function(t){Object(St.a)(Object(Mt.a)(i.prototype),"render",this).call(this,t),this._dirty&&(this._dirty=!1,this._graphics.clear(),this.renderDatas())}},{key:"renderDatas",value:function(){var t=this;this._datas.map((function(e,i){var n=e.left,o=e.top,s=e.size;"horizontal"===e.type?(t._graphics.lineStyle(1,16711680,1),t._graphics.moveTo(n,o),t._graphics.lineTo(n+s,o),t._graphics.closePath()):"vertical"===e.type&&(t._graphics.lineStyle(1,16711680,1),t._graphics.moveTo(n,o),t._graphics.lineTo(n,o+s),t._graphics.closePath())}))}},{key:"clear",value:function(){return this._datas=[],this._dirty=!0,this}}]),i}(Lt.d),oe=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this,t,n)).text=void 0,o}return Object(h.a)(i,[{key:"_updateStyles",value:function(){Object(St.a)(Object(Mt.a)(i.prototype),"_updateStyles",this).call(this);var t=this._element;if(t){var e=t.getHitArea(2),n=this._gizmos.get("editorGizmo");if(n){var o=e.map((function(t){return[t[0],t[1]]}));n.children.forEach((function(t){var e=t.getLocalBounds();o.push([e.x,e.y]),o.push([e.x,e.y+e.height]),o.push([e.x+e.width,e.y+e.height]),o.push([e.x+e.width,e.y])}));var s=new K(o),a=[];s.points.forEach((function(t){a.push(t[0],t[1])})),this.hitArea=new Lt.g(a)}else{var r=[];e.forEach((function(t){r.push(t[0],t[1])})),this.hitArea=new Lt.g(r)}}}},{key:"_drawBoundingBox",value:function(){var t=this._element;if(t){var e=new Lt.i;this.text&&this.text.getLocalBounds(e);var i=t.getBoundingBox(10);this.lineStyle(1,16737894,1),this.beginFill(0,0),this.drawRect(i.x,i.y,i.width,i.height),this.endFill();var n=this._boundsRect;if(this.lineStyle(1,16711731,1),this.beginFill(0,0),this.drawRect(n.x,n.y,n.width,n.height),this.endFill(),this.text){var o=new Lt.i;this.text&&this.text.getLocalBounds(o);this.parent.scaled;this.lineStyle(1,16777062,1),this.beginFill(0,0),this.drawRect(this.text.x,this.text.y,o.width,o.height),this.endFill()}}}},{key:"_drawAABB",value:function(){var t=this._element;if(t){var e=t.getAABB();this.lineStyle(1,65280,1),this.beginFill(16776960,0),this.drawRect(e.x,e.y,e.width,e.height),this.endFill(),this.lineStyle(1,0,1),this.drawEllipse(e.x+e.width/2,e.y+e.height/2,e.width/2,e.height/2),this.closePath()}}},{key:"_drawOBB",value:function(){var t=this._element;if(t){var e=t.getOBB().points;this.lineStyle(2,16776960,1),this.beginFill(16776960,0);var i=[];if(e.forEach((function(t){i.push(t[0],t[1])})),this.drawPolygon(i),this.closePath(),t.debug){var n=t.getHitArea(2);this.lineStyle(1,10079283,1),this.beginFill(10079283,.1);var o=[];n.forEach((function(t){o.push(t[0],t[1])})),this.drawPolygon(o)}var s=this._gizmos.get("editorGizmo");if(s){var a=e.map((function(t){return[t[0],t[1]]}));s.children.forEach((function(t){var e=t.getLocalBounds();a.push([e.x,e.y]),a.push([e.x,e.y+e.height]),a.push([e.x+e.width,e.y+e.height]),a.push([e.x+e.width,e.y])}));var r=new K(a),h=[];r.points.forEach((function(t){h.push(t[0],t[1])})),this.drawPolygon(h)}else{var l=[];e.forEach((function(t){l.push(t[0],t[1])})),this.drawPolygon(l)}}}},{key:"_drawBody",value:function(){var t=this._element;if(t){var e=t.from,i=t.to;if(t.selected){var n=t.getHitArea(2);this.lineStyle(1,0,0),this.beginFill(0,.05);var o=[];n.forEach((function(t){o.push(t[0],t[1])})),this.drawPolygon(o),this.lineStyle(t.styles.selectStrokeWidth||1,t.styles.selectStrokeColor||0,t.styles.selectStrokeAlpha||1)}else this.lineStyle(t.styles.strokeWidth||1,t.styles.strokeColor||0,t.styles.strokeAlpha||1);var s=t.dash;if(s)new $t(this,{dash:s,width:t.styles.strokeWidth||1,color:t.styles.strokeColor,alpha:t.styles.strokeAlpha,useTexture:!1,useDots:!0}).moveTo(e[0],e[1]).lineTo(i[0],i[1]);else this.moveTo(e[0],e[1]),this.lineTo(i[0],i[1]),this.endFill();if(t.debug){var a=-1*t.styles.offsetDelta,r=t.getAlongPoints(a);this.lineStyle(1,16711680,1),this.moveTo(r.from[0],r.from[1]),this.lineTo(r.to[0],r.to[1]),this.endFill()}}}},{key:"_drawSelect",value:function(){var t=this._element;if(t){var e=t.points;e&&e.length}}},{key:"_drawHover",value:function(){var t=this._element;if(t&&t.hovered&&!t.selected){var e=t.from,i=t.to,n=t.dash,o=t.getHitArea(2);this.lineStyle(1,0,0),this.beginFill(0,.05);var s=[];if(o.forEach((function(t){s.push(t[0],t[1])})),this.drawPolygon(s),this.lineStyle(t.styles.hoverStrokeWidth||1,t.styles.hoverStrokeColor||16711680,t.styles.hoverStrokeAlpha||1),n)new $t(this,{dash:n,width:t.styles.strokeWidth||1,color:t.styles.selectFillColor,alpha:t.styles.strokeAlpha,useTexture:!1,useDots:!0}).moveTo(e[0],e[1]).lineTo(i[0],i[1]);else this.moveTo(e[0],e[1]),this.lineTo(i[0],i[1]),this.endFill()}}},{key:"_checkGizmos",value:function(){this._element&&(this._checkLabelGizmo(),this._checkLabel2Gizmo(),this._checkEditorGizmo())}}]),i}(qt),se=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this,t,n)).text=void 0,o}return Object(h.a)(i,[{key:"_updateStyles",value:function(){Object(St.a)(Object(Mt.a)(i.prototype),"_updateStyles",this).call(this);var t=this._element;if(t){var e=t.getHitArea(2),n=[];e.forEach((function(t){n.push(t[0],t[1])})),this.hitArea=new Lt.g(n)}}},{key:"_drawBoundingBox",value:function(){var t=this._element;if(t){var e=new Lt.i;this.text&&this.text.getLocalBounds(e);var i=t.getBoundingBox(10);this.lineStyle(1,16737894,1),this.beginFill(0,0),this.drawRect(i.x,i.y,i.width,i.height),this.endFill();var n=this._boundsRect;if(this.lineStyle(1,16711731,1),this.beginFill(0,0),this.drawRect(n.x,n.y,n.width,n.height),this.endFill(),this.text){var o=new Lt.i;this.text&&this.text.getLocalBounds(o);this.parent.scaled;this.lineStyle(1,16777062,1),this.beginFill(0,0),this.drawRect(this.text.x,this.text.y,o.width,o.height),this.endFill()}}}},{key:"_drawAABB",value:function(){var t=this._element;if(t){var e=t.getAABB();this.lineStyle(1,65280,1),this.beginFill(16776960,0),this.drawRect(e.x,e.y,e.width,e.height),this.endFill(),this.lineStyle(1,0,1),this.drawEllipse(e.x+e.width/2,e.y+e.height/2,e.width/2,e.height/2)}}},{key:"_drawOBB",value:function(){var t=this._element;if(t){var e=t.getOBB().points;this.lineStyle(1,16776960,1),this.beginFill(16776960,0);var i=[];e.forEach((function(t){i.push(t[0],t[1])})),this.drawPolygon(i);var n=t.getHitArea(2);this.lineStyle(10,10079283,1),this.beginFill(10079283,.5);var o=[];n.forEach((function(t){o.push(t[0],t[1])})),this.drawPolygon(o),this.closePath()}}},{key:"_drawBody",value:function(){var t=this,e=this._element;if(e){var i=e.points;if(i&&0!==i.length){var n=e._matrix,o=e.angle;0!==o&&this.setMatrix(new Lt.e(n[0],n[1],n[2],n[3],n[4],n[5]));var s=[];i.forEach((function(t){s.push(t[0],t[1])}));var a=e.dash;if(a)new $t(this,{dash:a,width:e.styles.strokeWidth||1,color:e.styles.strokeColor,alpha:e.styles.strokeAlpha,useTexture:!1,useDots:!0}).drawPolygon(s);else e.clients.isDrawing&&i.forEach((function(e,n){n===i.length-2?(t.lineStyle(1.5,7566195,1),t.beginFill(16777215,1),t.drawCircle(e[0],e[1],3),t.endFill()):n===i.length-1&&(t.lineStyle(1,0,.35),t.beginFill(16777215,1),t.drawCircle(e[0],e[1],2.5),t.endFill())})),this.lineStyle(e.styles.strokeWidth||1,e.styles.strokeColor||16220804,e.styles.strokeAlpha||1),i.forEach((function(e,i){0===i?t.moveTo(e[0],e[1]):t.lineTo(e[0],e[1])}));0!==o&&this.setMatrix(new Lt.e)}}}},{key:"_drawHover",value:function(){var t=this,e=this._element;if(e){var i=e.points;if(i&&0!==i.length&&e.hovered){var n=e.points;this.lineStyle(e.styles.hoverStrokeWidth||1,e.styles.hoverStrokeColor||16220804,e.styles.hoverStrokeAlpha||1),n.forEach((function(e,i){0===i?t.moveTo(e[0],e[1]):t.lineTo(e[0],e[1])}))}}}},{key:"_drawSelect",value:function(){var t=this,e=this._element;if(e){var i=e.points;if(i&&0!==i.length&&e.selected){var n=e.points;this.lineStyle(e.styles.selectStrokeWidth||1,e.styles.selectStrokeColor||16220804,e.styles.selectStrokeAlpha||1),n.forEach((function(e,i){0===i?t.moveTo(e[0],e[1]):t.lineTo(e[0],e[1])}))}}}},{key:"_checkGizmos",value:function(){this._element&&(this._checkLabelGizmo(),this._checkLabel2Gizmo(),this._checkEditorGizmo())}}]),i}(qt),ae=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){var o;return Object(r.a)(this,i),(o=e.call(this,t,n)).text=void 0,o}return Object(h.a)(i,[{key:"_updateStyles",value:function(){Object(St.a)(Object(Mt.a)(i.prototype),"_updateStyles",this).call(this);var t=this._element;if(t){var e=t.getHitArea(2),n=this._gizmos.get("editorGizmo");if(n){var o=e.map((function(t){return[t[0],t[1]]}));n.children.forEach((function(t){var e=t.getLocalBounds();o.push([e.x,e.y]),o.push([e.x,e.y+e.height]),o.push([e.x+e.width,e.y+e.height]),o.push([e.x+e.width,e.y])}));var s=new K(o),a=[];s.points.forEach((function(t){a.push(t[0],t[1])})),this.hitArea=new Lt.g(a)}else{var r=[];e.forEach((function(t){r.push(t[0],t[1])})),this.hitArea=new Lt.g(r)}}}},{key:"_drawBoundingBox",value:function(){var t=this._element;if(t){var e=new Lt.i;this.text&&this.text.getLocalBounds(e);var i=t.getBoundingBox(10);this.lineStyle(1,16737894,1),this.beginFill(0,0),this.drawRect(i.x,i.y,i.width,i.height),this.endFill();var n=this._boundsRect;if(this.lineStyle(1,16711731,1),this.beginFill(0,0),this.drawRect(n.x,n.y,n.width,n.height),this.endFill(),this.text){var o=new Lt.i;this.text&&this.text.getLocalBounds(o);this.parent.scaled;this.lineStyle(1,16777062,1),this.beginFill(0,0),this.drawRect(this.text.x,this.text.y,o.width,o.height),this.endFill()}}}},{key:"_drawAABB",value:function(){var t=this._element;if(t){var e=t.getAABB();this.lineStyle(1,65280,1),this.beginFill(16776960,0),this.drawRect(e.x,e.y,e.width,e.height),this.endFill(),this.lineStyle(1,0,1),this.drawEllipse(e.x+e.width/2,e.y+e.height/2,e.width/2,e.height/2),this.closePath()}}},{key:"_drawOBB",value:function(){var t=this._element;if(t){var e=t.getOBB().points;this.lineStyle(2,16776960,1),this.beginFill(16776960,0);var i=[];if(e.forEach((function(t){i.push(t[0],t[1])})),this.drawPolygon(i),this.closePath(),t.debug){var n=t.getHitArea(2);this.lineStyle(1,10079283,1),this.beginFill(10079283,.1);var o=[];n.forEach((function(t){o.push(t[0],t[1])})),this.drawPolygon(o)}var s=this._gizmos.get("editorGizmo");if(s){var a=e.map((function(t){return[t[0],t[1]]}));s.children.forEach((function(t){var e=t.getLocalBounds();a.push([e.x,e.y]),a.push([e.x,e.y+e.height]),a.push([e.x+e.width,e.y+e.height]),a.push([e.x+e.width,e.y])}));var r=new K(a),h=[];r.points.forEach((function(t){h.push(t[0],t[1])})),this.drawPolygon(h)}else{var l=[];e.forEach((function(t){l.push(t[0],t[1])})),this.drawPolygon(l)}}}},{key:"_drawBody",value:function(){var t=this._element;if(t){var e=t.from,i=t.to;if(e&&i){var n=e.center,o=i.center;if(t.selected){var s=t.getHitArea(2);this.lineStyle(1,0,0),this.beginFill(0,.05);var a=[];s.forEach((function(t){a.push(t[0],t[1])})),this.drawPolygon(a),this.lineStyle(t.styles.selectStrokeWidth||1,t.styles.selectStrokeColor||0,t.styles.selectStrokeAlpha||1)}else this.lineStyle(t.styles.strokeWidth||1,t.styles.strokeColor||0,t.styles.strokeAlpha||1);if(this.moveTo(n[0],n[1]),this.lineTo(o[0],o[1]),this.endFill(),t.debug){var r=-1*t.styles.offsetDelta,h=t.getAlongPoints(r);this.lineStyle(1,16711680,1),this.moveTo(h.p0[0],h.p0[1]),this.lineTo(h.p1[0],h.p1[1]),this.endFill()}}}}},{key:"_drawSelect",value:function(){var t=this._element;if(t){var e=t.points;e&&e.length}}},{key:"_drawHover",value:function(){var t=this._element;if(t){var e=t.from,i=t.to;if(e&&i){var n=e.center,o=i.center;if(t.hovered&&!t.selected){t.from,t.to;var s=t.getHitArea(2);this.lineStyle(1,0,0),this.beginFill(0,.05);var a=[];s.forEach((function(t){a.push(t[0],t[1])})),this.drawPolygon(a),this.lineStyle(t.styles.hoverStrokeWidth||1,t.styles.hoverStrokeColor||16711680,t.styles.hoverStrokeAlpha||1),this.moveTo(n[0],n[1]),this.lineTo(o[0],o[1]),this.endFill()}}}}},{key:"_checkGizmos",value:function(){this._element&&(this._checkLabelGizmo(),this._checkLabel2Gizmo(),this._checkEditorGizmo())}}]),i}(qt),re=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n){return Object(r.a)(this,i),e.call(this,t,n)}return Object(h.a)(i)}(Jt),he=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this)).renderer=void 0,n.renderer=t,n}return Object(h.a)(i,[{key:"mount",value:function(){}},{key:"unmount",value:function(){}},{key:"update",value:function(){}},{key:"clear",value:function(){}},{key:"changeCursorMode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",e=this.renderer;e&&(e.renderer.plugins.interaction.cursorStyles.crosshair=t,e.renderer.plugins.interaction.cursorStyles.default=t,e.renderer.plugins.interaction.setCursorMode(t))}}]),i}(g.EventEmitter),le=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,t))._zoomedEvent=void 0,n._pannedEvent=void 0,n._selectedEvent=void 0,n._mousedownEvent=void 0,n._mouseupEvent=void 0,n._mousemoveEvent=void 0,n._mouseoutEvent=void 0,n._mouseoverEvent=void 0,n._keydownEvent=void 0,n._keyupEvent=void 0,n._contextmenu=void 0,n._onDocumentMouseDown=void 0,n._onDocumentMouseUp=void 0,n._hitTarget=void 0,n._hoverTarget=void 0,n._isDragging=!1,n._mousePoint=void 0,n._ctrlDown=!1,n._shiftDown=!1,n._altDown=!1,n._doubleClickedTimeout=null,n._oldOutTarget=void 0,n._oldMousePoint=void 0,n}return Object(h.a)(i,[{key:"mount",value:function(){var t=this.renderer.viewport;t&&(document.body.style.cursor="default",t.drag({wheel:!1,mouseButtons:"right",pressDrag:!0,direction:"all"}).pinch().wheel({wheelZoom:!0}),this._zoomedEvent=this.handle_zoomed.bind(this),this._pannedEvent=this.handle_panned.bind(this),this._mousedownEvent=this.handle_mousedown.bind(this),this._mouseupEvent=this.handle_mouseup.bind(this),this._mousemoveEvent=this.handle_mousemove.bind(this),this._mouseoutEvent=this.handle_mouseout.bind(this),this._mouseoverEvent=this.handle_mouseover.bind(this),this._keydownEvent=this.handle_keydown.bind(this),this._keyupEvent=this.handle_keyup.bind(this),this._contextmenu=this.handle_contextmenu.bind(this),t.on("zoomed",this._zoomedEvent),t.on("moved",this._pannedEvent),t.on("mousedown",this._mousedownEvent),t.on("mouseup",this._mouseupEvent),t.on("mousemove",this._mousemoveEvent),t.on("mouseout",this._mouseoutEvent),t.on("mouseover",this._mouseoverEvent),document.addEventListener("keydown",this._keydownEvent),document.addEventListener("keyup",this._keyupEvent),document.addEventListener("contextmenu",this._contextmenu))}},{key:"unmount",value:function(){var t=this.renderer,e=t.viewport;if(e){e.drag({wheel:!1,mouseButtons:"right",pressDrag:!1}).wheel({wheelZoom:!1}),e.off("zoomed",this._zoomedEvent),e.off("moved",this._pannedEvent),e.off("mousedown",this._mousedownEvent),e.off("mouseup",this._mouseupEvent),e.off("mousemove",this._mousemoveEvent),e.off("mouseout",this._mouseoutEvent),document.removeEventListener("keydown",this._keydownEvent),document.removeEventListener("keyup",this._keyupEvent),document.removeEventListener("contextmenu",this._contextmenu);t.selectionModel;this.off(st.Resizing,(function(t){}))}}},{key:"update",value:function(){}},{key:"clear",value:function(){}},{key:"handle_zoomed",value:function(t){this.renderer.grid&&this.renderer.grid}},{key:"handle_panned",value:function(t){this.renderer.grid&&this.renderer.grid}},{key:"isDelDown",value:function(t){return"Delete"===t.code}},{key:"isCtrlDown",value:function(t){return t.ctrlKey||t.metaKey}},{key:"isShiftDown",value:function(t){return t.shiftKey}},{key:"isAltDown",value:function(t){return t.altKey}},{key:"handle_mousedown",value:function(t){var e=this.renderer;if(e.viewport){var i=e.renderer.plugins.interaction.hitTest(t.data.global);i instanceof qt?this._hitTarget=i:(i instanceof Tt||i instanceof Zt)&&(this._hitTarget=i.parent);var n=i._element;this._hitTarget instanceof qt&&n&&n.movable&&this.__dragStart(t);var o=e.selectionModel;o&&(this._ctrlDown?o.contains(n)?o.removeSelection(n):o.appendSelection(n):o.contains(n)||o.setSelection(n)),this._doubleClickedTimeout?(clearTimeout(this._doubleClickedTimeout),this._doubleClickedTimeout=null,this.emit(st.DoubleClick,{source:this,target:n})):this.emit(st.Click,{source:this,target:n})}}},{key:"handle_mouseup",value:function(t){var e=this;if(this._doubleClickedTimeout=setTimeout((function(){e._doubleClickedTimeout=null}),300),this._hitTarget){var i;this._hitTarget.update();var n=null===(i=this._hitTarget)||void 0===i?void 0:i._gizmos;n&&n.forEach((function(e){e.handle_mouseup(t)}))}else{var o=this.renderer,s=o.selectionModel,a=null===s||void 0===s?void 0:s.getSelection();a&&a.forEach((function(e){var i=o.getUIById(e.id);if(i){i.update();var n=null===i||void 0===i?void 0:i._gizmos;n&&n.forEach((function(e){e.handle_mouseup(t)}))}}))}this.__dragEnd(t)}},{key:"handle_mousemove",value:function(t){var e=this.renderer;if(e.viewport){this.__dragMove(t);var i=e.renderer.plugins.interaction.hitTest(t.data.global),n=this._hoverTarget;if(n!==i){this._hoverTarget=i;var o=i,s=n&&n._element,a=o&&o._element;s&&(s.hovered=!1),a&&(a.hovered=!0),this.emit(st.Hover,{source:this,oldValue:s,newValue:a})}}}},{key:"handle_mouseout",value:function(t){var e=this.renderer.viewport;if(e){if(this._hitTarget){var i,n=null===(i=this._hitTarget)||void 0===i?void 0:i._gizmos;n&&n.forEach((function(e){e.handle_mouseout(t)})),this._oldOutTarget=this._hitTarget;var o=t.data.getLocalPosition(e);this._oldMousePoint=new Lt.f(o.x,o.y),this._onDocumentMouseUp=this.handle_documentMouseUp.bind(this),document.addEventListener("mouseup",this._onDocumentMouseUp)}this.__dragEnd(t)}}},{key:"handle_mouseover",value:function(t){var e=this.renderer.viewport;if(e&&this._oldOutTarget&&this._oldMousePoint){var i=this._oldMousePoint,n=t.data.getLocalPosition(e);this._hitTarget=this._oldOutTarget,this._hitTarget._element.translation(n.x-i.x,n.y-i.y),this.__dragStart(t),this._oldOutTarget=void 0,document.removeEventListener("mouseup",this._onDocumentMouseUp)}}},{key:"__dragStart",value:function(t){var e=this._hitTarget;if(!this._isDragging&&e instanceof qt){var i=t.data.getLocalPosition(e.parent);this._mousePoint=new Lt.f(i.x,i.y)}}},{key:"__dragMove",value:function(t){var e=this._hitTarget;if(e&&e.parent){var i=t.data.getLocalPosition(e.parent);!this._isDragging&&this._mousePoint&&(Math.abs(i.x-this._mousePoint.x)>=.1||Math.abs(i.y-this._mousePoint.y)>=.1)&&(this._isDragging=!0,this.emit(st.DragStart,{source:this,target:e._element})),this._isDragging&&e instanceof qt&&this._mousePoint&&(this.renderer.moveSelectedElements(i.x-this._mousePoint.x,i.y-this._mousePoint.y),this._mousePoint=new Lt.f(i.x,i.y),t.stopPropagation(),this.emit(st.Dragging,{source:this,target:e._element}),e._element.dragging||(e._element.dragging=!0))}}},{key:"__dragEnd",value:function(t){if(this._isDragging){this._isDragging=!1,t&&t.stopPropagation();var e=this._hitTarget;e&&e._element&&(e._element.dragging=!1,this.emit(st.DragEnd,{source:this,target:e._element}))}this._hitTarget=void 0,this._mousePoint=void 0}},{key:"handle_keydown",value:function(t){var e=t.code,i=this._ctrlDown;this._ctrlDown=this.isCtrlDown(t);var n=this._ctrlDown;if(i!==n){var o;this.emit(ot.CtrlKeyDown,{source:this,key:e,oldCtrlDown:i,newCtrlDown:n});var s=null===(o=this._hoverTarget)||void 0===o?void 0:o._element;s&&(s.hovered=!1)}var a=this._shiftDown;this._shiftDown=this.isShiftDown(t);var r=this._shiftDown;a!==r&&this.emit(ot.ShiftKey,{source:this,key:e,oldShiftDown:a,newShiftDown:r});var h=this._altDown;this._altDown=this.isAltDown(t);var l=this._altDown;h!==l&&this.emit(ot.AltKey,{source:this,key:e,oldAltDown:h,newAltDown:l}),this.emit(ot.KeyDown,{source:this,event:t}),this.__dragEnd()}},{key:"handle_keyup",value:function(t){var e=t.code,i=this._ctrlDown;this._ctrlDown=this.isCtrlDown(t);var n=this._ctrlDown;if(i!==n){var o;document.body.style.cursor="default";var s=null===(o=this._hoverTarget)||void 0===o?void 0:o._element;s&&(s.hovered=!0),this.emit(ot.CtrlKeyUp,{source:this,key:e,oldCtrlDown:i,newCtrlDown:n})}var a=this._shiftDown;this._shiftDown=this.isShiftDown(t);var r=this._shiftDown;a!==r&&this.emit(ot.ShiftKey,{source:this,key:e,oldShiftDown:a,newShiftDown:r});var h=this._altDown;this._altDown=this.isAltDown(t);var l=this._altDown;h!==l&&this.emit(ot.AltKey,{source:this,key:e,oldAltDown:h,newAltDown:l}),this.emit(ot.KeyUp,{source:this,event:t})}},{key:"handle_contextmenu",value:function(t){t.preventDefault(),this.__dragEnd(t)}},{key:"_cancel",value:function(){}},{key:"handle_documentMouseDown",value:function(t){this._oldOutTarget&&(t.preventDefault(),t.stopPropagation(),this._oldOutTarget=void 0),document.removeEventListener("mousedown",this._onDocumentMouseDown)}},{key:"handle_documentMouseUp",value:function(t){if(this._isDragging){this._isDragging=!1;var e=this._hitTarget;e&&e._element&&(e._element.dragging=!1,this.emit(st.DragEnd,{source:this,target:e._element}))}this._oldOutTarget=void 0,this._oldMousePoint=void 0,document.removeEventListener("mouseup",this._onDocumentMouseUp)}}]),i}(he),ue=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){return Object(r.a)(this,i),e.call(this,t)}return Object(h.a)(i,[{key:"handle_zoomed",value:function(t){}},{key:"handle_panned",value:function(t){this.renderer.grid&&this.renderer.grid instanceof Pt&&this.renderer.refline.clear()}},{key:"handle_mousedown",value:function(t){var e;Object(St.a)(Object(Mt.a)(i.prototype),"handle_mousedown",this).call(this,t);var n=null===(e=this._hitTarget)||void 0===e?void 0:e._element;if(n){var o=this.renderer.model.getDatas();n.gatherRects(o);var s=n.refLine;n.updater=s.adsorbCreator({pageX:t.data.global.x,pageY:t.data.global.y,distance:24})}}},{key:"__dragMove",value:function(t){var e=this._hitTarget;if(e&&e.parent){var i=t.data.getLocalPosition(e.parent);if(!this._isDragging&&this._mousePoint&&(Math.abs(i.x-this._mousePoint.x)>=.1||Math.abs(i.y-this._mousePoint.y)>=.1)&&(this._isDragging=!0,this.emit(st.DragStart,{source:this,target:e._element})),this._isDragging&&e instanceof qt&&this._mousePoint){var n,o;this._mousePoint=new Lt.f(i.x,i.y),t.stopPropagation(),this.emit(st.Dragging,{source:this,target:e._element}),e._element.dragging||(e._element.dragging=!0);var s=null===(n=this._hitTarget)||void 0===n?void 0:n._element;if(!s)return;var a=s.refLine,r=s.updater;this.renderer.refline&&(this.renderer.refline.datas=a.getAllRefLines());var h=(null===(o=this.renderer)||void 0===o?void 0:o.getScaled())||1,l=r({pageX:t.data.global.x,pageY:t.data.global.y,distance:24}).delta;this.renderer.moveSelectedElements(l.left/h,l.top/h),t.stopPropagation()}}}},{key:"__dragEnd",value:function(t){if(this._isDragging){this._isDragging=!1,t.stopPropagation();var e=this._hitTarget;if(e&&e._element){e._element.dragging=!1,this.emit(st.DragEnd,{source:this,target:e._element});var i=e._element,n=(0,i.updater)({pageX:t.data.global.x,pageY:t.data.global.y}).delta;i.x+=n.left,i.y+=n.top}}this._mousePoint=void 0}}]),i}(le),de=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n,o,s,a){var h;return Object(r.a)(this,i),(h=e.call(this,t)).element=void 0,h._onMouseDown=void 0,h._onMouseMove=void 0,h._onMouseUp=void 0,h._onFinish=void 0,h._onMouseDown=null===n||void 0===n?void 0:n.bind(Object(v.a)(h)),h._onMouseMove=null===o||void 0===o?void 0:o.bind(Object(v.a)(h)),h._onMouseUp=null===s||void 0===s?void 0:s.bind(Object(v.a)(h)),h._onFinish=null===a||void 0===a?void 0:a.bind(Object(v.a)(h)),h}return Object(h.a)(i,[{key:"mount",value:function(){var t=this.renderer.viewport;t&&(t.drag({wheel:!1,mouseButtons:"right",pressDrag:!0,direction:"all"}).pinch().wheel({wheelZoom:!0}),this._zoomedEvent=this.handle_zoomed.bind(this),this._pannedEvent=this.handle_panned.bind(this),this._mousedownEvent=this.handle_mousedown.bind(this),this._mouseupEvent=this.handle_mouseup.bind(this),this._mousemoveEvent=this.handle_mousemove.bind(this),this._mouseoutEvent=this.handle_mouseout.bind(this),this._mouseoverEvent=this.handle_mouseover.bind(this),this._keydownEvent=this.handle_keydown.bind(this),this._keyupEvent=this.handle_keyup.bind(this),this._contextmenu=this.handle_contextmenu.bind(this),t.on("zoomed",this._zoomedEvent),t.on("moved",this._pannedEvent),t.on("mousedown",this._mousedownEvent),t.on("mouseup",this._mouseupEvent),t.on("mousemove",this._mousemoveEvent),t.on("mouseout",this._mouseoutEvent),t.on("mouseover",this._mouseoverEvent),document.addEventListener("keydown",this._keydownEvent),document.addEventListener("keyup",this._keyupEvent),document.addEventListener("contextmenu",this._contextmenu))}},{key:"unmount",value:function(){var t=this.renderer.viewport;t&&(t.drag({wheel:!1,mouseButtons:"right",pressDrag:!1}).wheel({wheelZoom:!1}),t.off("zoomed",this._zoomedEvent),t.off("moved",this._pannedEvent),t.off("mousedown",this._mousedownEvent),t.off("mouseup",this._mouseupEvent),t.off("mousemove",this._mousemoveEvent),t.off("mouseout",this._mouseoutEvent),document.removeEventListener("keydown",this._keydownEvent),document.removeEventListener("keyup",this._keyupEvent),document.removeEventListener("contextmenu",this._contextmenu),this.clear())}},{key:"clear",value:function(){Object(St.a)(Object(Mt.a)(i.prototype),"clear",this).call(this),this._hitTarget=void 0,this.element=void 0,this._onMouseDown=void 0,this._onMouseMove=void 0,this._onMouseUp=void 0}},{key:"handle_zoomed",value:function(t){}},{key:"handle_panned",value:function(t){}},{key:"isCtrlDown",value:function(t){return t.ctrlKey||t.metaKey}},{key:"handle_mousedown",value:function(t){var e=this.renderer,i=e.viewport,n=e.model;if(i&&i&&n){var o=t&&t.data.getLocalPosition(i);if(this._onMouseDown){var s=this._onMouseDown(o,this);if(s){var a;if(s.id===(null===(a=this.element)||void 0===a?void 0:a.id))return void(this._onMouseMove&&this._onMouseMove(o,this));this.element=s,n.add(s)}}}}},{key:"handle_mouseup",value:function(t){var e=this;if(this._doubleClickedTimeout=setTimeout((function(){e._doubleClickedTimeout=null}),300),this.__dragEnd(t),this._onMouseUp){var i=this.renderer,n=i.viewport;if(!n)return;var o=t&&t.data.getLocalPosition(n);if(this.element){this.element.isEditing=!1;var s=this.element,a=i.selectionModel;if(a)if(this._ctrlDown)a.contains(s)?a.removeSelection(s):a.appendSelection(s);else if(!a.contains(s)){var r=a.getSelection();i.changeLayer(r,B.DefaultZIndex),a.setSelection(s),i.changeLayer(s,B.SelectZIndex)}}this._onMouseUp(o,this)}}},{key:"handle_mousemove",value:function(t){var e=this.renderer.viewport;if(e){if(this._hitTarget&&this._hitTarget instanceof qt){var i=this._hitTarget._element;if(i){var n=i.center,o=t.data.global.x-n[0],s=t.data.global.y-n[1];i.translation(o,s)}}if(this.element&&this._onMouseMove){var a=t&&t.data.getLocalPosition(e);this._onMouseMove(a,this)}}}},{key:"handle_mouseout",value:function(t){var e=this.renderer.viewport;if(e){this.__dragEnd(t),this._oldOutTarget=this._hitTarget;var i=t.data.getLocalPosition(e);this._oldMousePoint=new Lt.f(i.x,i.y)}}},{key:"handle_mouseover",value:function(t){var e=this.renderer.viewport;if(e&&this._oldOutTarget&&this._oldMousePoint){var i=this._oldMousePoint,n=t.data.getLocalPosition(e);this._hitTarget=this._oldOutTarget,this._hitTarget._element.translation(n.x-i.x,n.y-i.y),this.__dragStart(t),this._oldOutTarget=void 0,document.removeEventListener("mouseup",this._onDocumentMouseUp)}}},{key:"__dragStart",value:function(t){var e=this._hitTarget;if(!this._isDragging&&e instanceof qt){var i=t.data.getLocalPosition(e.parent);this._mousePoint=new Lt.f(i.x,i.y),this._isDragging=!0}}},{key:"__dragMove",value:function(t){if(this._isDragging){var e=this._hitTarget;if(e instanceof qt&&this._mousePoint){var i=t.data.getLocalPosition(e.parent);this.renderer.moveUI(e,i.x-this._mousePoint.x,i.y-this._mousePoint.y),this._mousePoint=new Lt.f(i.x,i.y),t.stopPropagation(),this.emit(st.Dragging,{source:this,target:e._element})}}}},{key:"__dragEnd",value:function(t){this.renderer.viewport&&this._isDragging&&(this._isDragging=!1,t&&t.stopPropagation())}},{key:"handle_keydown",value:function(t){t.code;this._ctrlDown=this.isCtrlDown(t),this.__dragEnd(),this._onFinish&&this._onFinish(this)}},{key:"handle_keyup",value:function(t){t.code;if(this._ctrlDown=this.isCtrlDown(t),"Escape"===t.code){if(!this.renderer.viewport)return;this._isDragging&&(this._isDragging=!1),this._onFinish&&this._onFinish(this)}}},{key:"handle_contextmenu",value:function(t){t.preventDefault(),this.__dragEnd(t),this._onFinish&&this._onFinish(this)}},{key:"onMouseDown",set:function(t){this._onMouseDown=t.bind(this)}},{key:"onMouseMove",set:function(t){this._onMouseMove=t.bind(this)}},{key:"onMouseUp",set:function(t){this._onMouseUp=t.bind(this)}},{key:"onFinish",set:function(t){this._onFinish=t.bind(this)}}]),i}(le),ce=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n,o,s,a){return Object(r.a)(this,i),e.call(this,t,n,o,s,a)}return Object(h.a)(i,[{key:"handle_mousedown",value:function(t){this.renderer.viewport}},{key:"handle_mousemove",value:function(t){var e=this.renderer,i=e.viewport,n=e.model;if(i&&n&&e){var o=t&&t.data.getLocalPosition(i);this._onMouseMove&&!this.element?(this.element=this._onMouseMove(o,this),this.element&&(n.add(this.element),this.element.isEditing=!0,this._hitTarget=e.uis.get(this.element.id),this.__dragStart(t),this._onDocumentMouseDown=this.handle_documentMouseDown.bind(this),document.addEventListener("mousedown",this._onDocumentMouseDown))):this.__dragMove(t),t.stopPropagation()}}},{key:"handle_keyup",value:function(t){Object(St.a)(Object(Mt.a)(i.prototype),"handle_keyup",this).call(this,t),"Escape"===t.code&&document.removeEventListener("mousedown",this._onDocumentMouseDown)}},{key:"handle_documentMouseDown",value:function(t){this._oldOutTarget&&(t.preventDefault(),t.stopPropagation(),this._onFinish&&this._onFinish(this,t),this._oldOutTarget=void 0),document.removeEventListener("mousedown",this._onDocumentMouseDown)}},{key:"handle_mouseover",value:function(t){var e=this.renderer.viewport;if(e&&this._oldOutTarget&&this._oldMousePoint){var i=this._oldMousePoint,n=t.data.getLocalPosition(e);this._hitTarget=this._oldOutTarget,this.element=this._hitTarget._element,this.element.translation(n.x-i.x,n.y-i.y),this.__dragStart(t),this._oldOutTarget=void 0}}}]),i}(de),ve=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t,n,o,s,a){return Object(r.a)(this,i),e.call(this,t,n,o,s,a)}return Object(h.a)(i,[{key:"handle_keydown",value:function(t){this._ctrlDown=this.isCtrlDown(t)}}]),i}(de),_e=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;Object(r.a)(this,i),(n=e.call(this))._renderer=void 0,n._current=void 0,n._interactionMap=new Map,n._renderer=t;var o=new le(t);n.execute(o),n._interactionMap.set("default",o),n._current=o;var s=new ue(t);return n._interactionMap.set("edit",s),n}return Object(h.a)(i,[{key:"execute",value:function(t){if(!Object(b.a)(this._current,t)){var e=this._current;e instanceof Array?e.forEach((function(t){null===t||void 0===t||t.clear(),null===t||void 0===t||t.unmount()})):(null===e||void 0===e||e.clear(),null===e||void 0===e||e.unmount()),this._current=t,t instanceof Array?t.forEach((function(t){t.mount()})):null===t||void 0===t||t.mount(),this._renderer.refline&&this._renderer.refline.clear(),this.emit("interaction.change",{source:this,oldValue:e,newValue:t})}}},{key:"setInteractions",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["default"],i=[];e.forEach((function(e){var n=t._interactionMap.get(e);n||("default"===e?(n=new le(t._renderer),t._interactionMap.set(e,n)):"edit"===e&&(n=new ue(t._renderer),t._interactionMap.set(e,n))),n&&i.push(n)})),this.execute(i)}},{key:"getInteraction",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return this._interactionMap.get(t)}},{key:"setDefaultInteraction",value:function(){var t=this._interactionMap.get("default")||new le(this._renderer);this._interactionMap.set("default",t),this.execute(t)}},{key:"setEditInteraction",value:function(){var t=this._interactionMap.get("edit")||new ue(this._renderer);this._interactionMap.set("edit",t),this.execute(t)}},{key:"setCreateInteraction",value:function(t,e,i,n){var o=this._interactionMap.get("create")||new de(this._renderer,t,e,i,n);this._interactionMap.set("create",o),t&&(o.onMouseDown=t),e&&(o.onMouseMove=e),i&&(o.onMouseUp=i),n&&(o.onFinish=n),this.execute(o)}},{key:"setAutoCreateInteraction",value:function(t,e,i,n){var o=this._interactionMap.get("autocreate")||new ce(this._renderer,t,e,i,n);this._interactionMap.set("autocreate",o),t&&(o.onMouseDown=t),e&&(o.onMouseMove=e),i&&(o.onMouseUp=i),n&&(o.onFinish=n),this.execute(o)}},{key:"setCreateLineInteraction",value:function(t,e,i,n){var o=this._interactionMap.get("createline")||new ve(this._renderer,t,e,i,n);this._interactionMap.set("createline",o),t&&(o.onMouseDown=t),e&&(o.onMouseMove=e),i&&(o.onMouseUp=i),n&&(o.onFinish=n),this.execute(o)}},{key:"setCreateShapeInteraction",value:function(t,e,i,n){var o=this._interactionMap.get("create")||new de(this._renderer,t,e,i,n);this._interactionMap.set("create",o),t&&(o.onMouseDown=t),e&&(o.onMouseMove=e),i&&(o.onMouseUp=i),n&&(o.onFinish=n),this.execute(o)}},{key:"getCurrentInteraction",value:function(){return this._current}}]),i}(g.EventEmitter),fe=i(238);!function(t){t.Add="model.data.add",t.Remove="model.data.remove",t.Clear="model.data.clear",t.BatchAdd="model.data.batchAdd"}(te||(te={})),function(t){t.Change="selection.data.change",t.SetSelection="selection.data.set",t.AppendSelection="selection.data.append",t.RemoveSelection="selection.data.remove",t.ClearSelection="selection.data.clear",t.SelectionAll="selection.data.all"}(ee||(ee={}));var ge,me=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this))._pros=void 0,n._datas=[],n._datasMap=new Map,n._pros=t,n}return Object(h.a)(i,[{key:"add",value:function(t){var e=this._datas,i=this._datasMap;if(this.contains(t))return this;return Object.assign([],e),e.push(t),i.set(t._id,t),this.emit(te.Add,{source:this,data:t}),this}},{key:"get",value:function(t){return this._datas[t]}},{key:"getById",value:function(t){return this._datasMap.get(t)}},{key:"remove",value:function(t){var e=this;if(!t)return this;if(t instanceof Array)t.forEach((function(t){e.remove(t)}));else{var i=this._datas,n=i.indexOf(t);n>=0&&(i.splice(n,1),this._datasMap.delete(t._id),this.emit(te.Remove,{source:this,data:t}))}return this}},{key:"contains",value:function(t){return!!this._datasMap.get(t._id)}},{key:"forEach",value:function(t,e){return this._datas.forEach(t,e),this}},{key:"clear",value:function(){this._datas;return this._datas=[],this._datasMap.clear(),this.emit(te.Clear,{source:this,data:null}),this}},{key:"getDatas",value:function(t){if(t){var e=[];return this._datas.forEach((function(i){t(i)&&e.push(i)})),e}return this._datas}},{key:"getDatasMap",value:function(t){if(t){var e=new Map;return this._datas.forEach((function(i){t(i)&&e.set(i._id,i)})),e}return this._datasMap}},{key:"batchAdd",value:function(t){var e=this,i=this._datas,n=this._datasMap;return Object.assign([],i),t.forEach((function(t){if(e.contains(t))return e;i.push(t),n.set(t._id,t)})),this.emit(te.BatchAdd,{source:this,data:t}),this}}]),i}(g.EventEmitter),pe=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this))._model=void 0,n._pros=void 0,n._datas=[],n._datasMap=new Map,n._selectionMode="single",n._filterFunction=void 0,n._pros=t,n._model=(null===t||void 0===t?void 0:t.model)||new me,n}return Object(h.a)(i,[{key:"contains",value:function(t){return!!t&&!!this._datasMap.get(t._id)}},{key:"add",value:function(t){var e=this._datas,i=this._datasMap;if(this.contains(t))return this;return Object.assign([],e),e.push(t),i.set(t._id,t),this}},{key:"remove",value:function(t){if(!t)return this;var e=this._datas,i=e.indexOf(t);return i>=0&&(e.splice(i,1),this._datasMap.delete(t._id)),this}},{key:"get",value:function(t){return this._datas[t]}},{key:"getById",value:function(t){return this._datasMap.get(t)}},{key:"clear",value:function(){var t=this._datas;if(0!==this._datas.length)return this._datas=[],this._datasMap.clear(),this.emit(ee.Change,{source:this,type:ee.ClearSelection,oldValue:t}),this}},{key:"getDatas",value:function(){return this._datas}},{key:"getDatasMap",value:function(){return this._datasMap}},{key:"batchAdd",value:function(t){var e=this,i=this._datas,n=this._datasMap;return Object.assign([],i),t.forEach((function(t){if(e.contains(t))return e;i.push(t),n.set(t._id,t)})),this}},{key:"getSelectionMode",value:function(){return this._selectionMode}},{key:"appendSelection",value:function(t){t&&(t instanceof Array?this.batchAdd(t):this.add(t),this.emit(ee.Change,{source:this,type:ee.AppendSelection}))}},{key:"removeSelection",value:function(t){var e=this;t&&(t instanceof Array?t.forEach((function(t){e.remove(t)})):this.remove(t),this.emit(ee.Change,{source:this,type:ee.RemoveSelection}))}},{key:"getSelection",value:function(){return this._datas}},{key:"setSelection",value:function(t){var e=this._datas;this.clear(),t&&(t instanceof Array?this.batchAdd(t):this.add(t),this.emit(ee.Change,{source:this,type:ee.SetSelection,oldValue:e,newValue:t}))}},{key:"clearSelection",value:function(){this.clear(),this.emit(ee.Change,{source:this,type:ee.ClearSelection})}},{key:"selectAll",value:function(){this.emit(ee.SelectionAll,{source:this,data:this._datas})}},{key:"size",value:function(){return this._datas.length}},{key:"getLastData",value:function(){return this._datas[this._datas.length-1]}},{key:"getFirstData",value:function(){return this._datas[0]}}]),i}(g.EventEmitter),ye=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n,o,s;Object(r.a)(this,i),(s=e.call(this,{width:(null===(n=t.canvas)||void 0===n?void 0:n.clientWidth)||0,height:(null===(o=t.canvas)||void 0===o?void 0:o.clientHeight)||0,resolution:window.devicePixelRatio||2,antialias:!0,backgroundAlpha:1,view:t.canvas,resizeTo:window}))._config=void 0,s._canvas=void 0,s._viewrect=new Lt.i,s._enabled=!0,s._stats=void 0,s._model=void 0,s._uis=new Map,s.eventEmitter=new m.a,s.interactionManager=void 0,s.viewport=void 0,s.selectionModel=void 0,s.grid=void 0,s.guide=void 0,s.refline=void 0,s._timeout=null,s._config=t||{},s._canvas=t.canvas||document.createElement("canvas");var a=s._canvas.getBoundingClientRect();s.renderer.backgroundColor=16777215,s.renderer.resize(a.width,a.height);var h=new fe.a({screenWidth:a.width,screenHeight:a.height,worldWidth:a.width,worldHeight:a.height,interaction:s.renderer.plugins.interaction,disableOnContextMenu:!0});s.stage.addChild(h),s.viewport=h,h.sortableChildren=!0,h.children.sort((function(t,e){return t.zIndex=t.zIndex||0,e.zIndex=e.zIndex||0,e.zIndex-t.zIndex})),s._viewrect=new Lt.i(a.x,a.y,a.width,a.height),s.selectionModel=new pe,s.selectionModel.on(ee.ClearSelection,(function(t){var e=t.oldValue;e&&e.forEach((function(t){t.selected=!1}))})),s.selectionModel.on(ee.Change,(function(t){s.handleSelectionChange(t)})),s.interactionManager=new _e(Object(v.a)(s));var l=new Pt({graphWidth:2e3,graphHeight:2e3});return l.set(jt.dark()),s.grid=l,l.visible=!1,h.addChild(l),s.guide=new ie,h.addChild(s.guide),s.refline=new ne,h.addChild(s.refline),s.stopTimer(),s.startTimer(),s}return Object(h.a)(i,[{key:"render",value:function(){if(this._enabled){var t=this._stats;t&&t.update(),Object(St.a)(Object(Mt.a)(i.prototype),"render",this).call(this)}}},{key:"enable",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._canvas&&(this._canvas.style.display=t?"block":"none",this._enabled=t)}},{key:"model",get:function(){return this._model},set:function(t){var e=this;t&&(this._model=t,this._model.on(te.Add,(function(t){t.source;var i=t.data;i&&e._add(i)})),this._model.on(te.BatchAdd,(function(t){t.source;var i=t.data;i&&i instanceof Array&&i.forEach((function(t){e._add(t)}))})),this._model.on(te.Remove,(function(t){t.source;var i=t.data;i&&e._remove(i)})),this._model.on(te.Clear,(function(t){e._clear()})))}},{key:"_add",value:function(t){var e=this;if(t){t.on(Z.AttributeChange,(function(i){var n=e._uis.get(t._id);null===n||void 0===n||n.update(),e.stopTimer(i),e.startTimer(i)})),t.on(Z.StyleChange,(function(i){var n=e._uis.get(t._id);null===n||void 0===n||n.update()}));var i=t.ui2d;if("NodeUI"===i){if(!this._uis.get(t._id)){var n,o=new Xt(t,this);this._uis.set(t._id,o),null===(n=this.viewport)||void 0===n||n.addChild(o)}}else if("ShapeUI"===i){if(!this._uis.get(t._id)){var s,a=new Jt(t,this);this._uis.set(t._id,a),null===(s=this.viewport)||void 0===s||s.addChild(a)}}else if("GroupUI"===i){if(!this._uis.get(t._id)){var r,h=new re(t,this);this._uis.set(t._id,h),null===(r=this.viewport)||void 0===r||r.addChild(h)}}else if("LineUI"===i){if(!this._uis.get(t._id)){var l,u=new oe(t,this);this._uis.set(t._id,u),null===(l=this.viewport)||void 0===l||l.addChild(u)}}else if("ShapeLineUI"===i){if(!this._uis.get(t._id)){var d,c=new se(t,this);this._uis.set(t._id,c),null===(d=this.viewport)||void 0===d||d.addChild(c)}}else if("EdgeUI"===i){if(!this._uis.get(t._id)){var v,_=new ae(t,this);this._uis.set(t._id,_),null===(v=this.viewport)||void 0===v||v.addChild(_)}}else if("DomainUI"===i);else if("DoorUI"===i);else if(!this._uis.get(t._id)){var f,g=new qt(t,this);this._uis.set(t._id,g),null===(f=this.viewport)||void 0===f||f.addChild(g)}}}},{key:"_remove",value:function(t){if(t){var e=this._uis.get(t._id);e&&(this.viewport&&this.viewport.removeChild(e),this._uis&&this._uis.delete(t._id))}}},{key:"_clear",value:function(){var t=this;this._uis&&(this._uis.forEach((function(e){var i;null===(i=t.viewport)||void 0===i||i.removeChild(e)})),this._uis.clear())}},{key:"zoomOverview",value:function(t){if(t){var e=(null===t||void 0===t?void 0:t.width)||0,i=(null===t||void 0===t?void 0:t.height)||0;if(this._viewrect&&this.viewport){var n=.75*Math.min(this._viewrect.width/e,this._viewrect.height/i);this.viewport.setTransform(this._viewrect.x+this._viewrect.width/2-(t.x+t.width/2),this._viewrect.y+this._viewrect.height/2-56-(t.y+t.height/2),1,1,0,0,0,0,0),this.viewport.setZoom(n,!0)}}}},{key:"zoomIn",value:function(){if(this.viewport){var t=this.viewport.scale;t.x+=.1,t.y+=.1,this.viewport.setZoom(t.x,!0)}}},{key:"zoomOut",value:function(){if(this.viewport){var t=this.viewport.scale;t.x-.1<0||(t.x-=.1,t.y-=.1,this.viewport.setZoom(t.x,!0))}}},{key:"handleSelectionChange",value:function(t){var e=t.oldValue;e&&e.forEach((function(t){t.selected=!1}));var i=this.selectionModel;i&&i.getSelection().forEach((function(t){t.selected=!0}))}},{key:"moveUI",value:function(t,e,i){var n=t._element;t&&n&&n.translation(e,i)}},{key:"moveSelectedElements",value:function(t,e){var i=this,n=this.selectionModel;n&&n.getSelection().forEach((function(n){i.isMovable(n)&&n.translation(t,e)}))}},{key:"isMovable",value:function(t){return t.movable}},{key:"isEditable",value:function(t){var e=t.points,i=t.mode;if(t.type===D.Domain){var n=this.interactionManager.getCurrentInteraction();if(n instanceof le&&n._shiftDown)return!0;if(i===L.Show){if(4!==e.length)return!1;var o=(e[0][0]-e[2][0])*(e[0][0]-e[2][0])+(e[0][1]-e[2][1])*(e[0][1]-e[2][1]),s=(e[1][0]-e[3][0])*(e[1][0]-e[3][0])+(e[1][1]-e[3][1])*(e[1][1]-e[3][1]);return Math.abs(o-s)<1}}return!0}},{key:"setGridVisible",value:function(t){var e;this.grid?this.grid.visible=t:(this.grid=new Pt,null===(e=this.viewport)||void 0===e||e.addChild(this.grid))}},{key:"setGridStyle",value:function(t){if(this.grid&&this.grid instanceof Pt)switch(t){case"dark":this.grid.set(jt.dark());break;case"blueprint":this.grid.set(jt.blueprint());break;case"engineering":this.grid.set(jt.engineering());break;case"quad":this.grid.set(jt.quad())}}},{key:"setEditable",value:function(t){this.interactionManager.setInteractions(["edit"])}},{key:"uis",get:function(){return this._uis}},{key:"changeLayer",value:function(t,e){t&&(t instanceof Array?t.forEach((function(t){t.styles.zIndex=e})):t instanceof dt&&(t.styles.zIndex=e))}},{key:"getScaled",value:function(){var t;return(null===(t=this.viewport)||void 0===t?void 0:t.scaled)||1}},{key:"invalidatElementUI",value:function(t){if(t){var e=this._uis.get(t.id);e&&e._invalidate()}}},{key:"selectElements",value:function(t){}},{key:"unSelectElements",value:function(t){var e=this;if(t)if(t instanceof Array)t.forEach((function(t){var i=e._uis.get(t.id);i&&i._invalidate()}));else{var i=this._uis.get(t.id);i&&i._invalidate()}}},{key:"startTimer",value:function(t){var e=this;this._timeout=setTimeout((function(){e.eventEmitter&&e.eventEmitter.emit(Z.UnDirty,{source:e,target:t})}),3e5)}},{key:"pauseTimer",value:function(t){this._timeout&&clearTimeout(this._timeout)}},{key:"resumeTimer",value:function(t){this._timeout&&clearTimeout(this._timeout),this.startTimer()}},{key:"stopTimer",value:function(t){this._timeout&&(clearTimeout(this._timeout),this.eventEmitter&&this.eventEmitter.emit(Z.Dirty,{source:this,target:t}))}},{key:"exportImage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.viewport;i&&this.renderer&&this.renderer.plugins.extract.canvas(i).toBlob((function(i){var n=new FileReader;if(n.onload=function(e){t&&t(e.target.result)},n.readAsDataURL(i),e){var o=document.createElement("a");document.body.append(o),o.download="bubble.png",o.href=URL.createObjectURL(i),o.click(),o.remove()}}),"image/png")}},{key:"getUIById",value:function(t){return this._uis.get(t)}}]),i}(Lt.a),be=i(142),ke=i(239),we=function(){function t(e){Object(r.a)(this,t),this._pane=new be.Pane({title:"Control Pane"}),this._tabs=void 0,this._config=void 0,this._model=void 0,this._renderer=void 0,this._anime=void 0,this._app=void 0,this._config=Object(c.a)({show:!0},e),this._pane||(this._pane=new be.Pane({title:"Control Pane"})),this._pane.element.parentElement&&(this._pane.element.parentElement.style.top="0px",this._pane.element.parentElement.style.right="0px",this._pane.element.parentElement.style.zIndex="99999");var i=this._pane;i.title=null!==e&&void 0!==e&&e.title?"".concat(null===e||void 0===e?void 0:e.title):"Control Pane",this._model=null===e||void 0===e?void 0:e.model,this._app=null===e||void 0===e?void 0:e.app,this._renderer=null===e||void 0===e?void 0:e.renderer,i.expanded=!0;var n=i.addTab({pages:[{title:"Dev"},{title:"Model"},{title:"Render"},{title:"Element"}]});this._tabs=n,this._initToolPane(),this._initModelPane()}return Object(h.a)(t,[{key:"model",set:function(t){this._model=t}},{key:"visible",set:function(t){this._pane.hidden=!t}},{key:"dispose",value:function(){this._pane.dispose()}},{key:"renderer",set:function(t){t&&(this._renderer=t,this._initRenderPane())}},{key:"_initToolPane",value:function(){var t=this,e=this._tabs;if(e){var i=e.pages[0],n=i.addFolder({title:"Dev"});n.expanded=!0,n.addButton({title:"Add",label:"Scene",disabled:!1}).on("click",(function(e){var i;null===(i=t._app)||void 0===i||i.initScene()})),n.addButton({title:"Clear",label:"Scene",disabled:!1}).on("click",(function(e){var i;null===(i=t._app)||void 0===i||i.clearScene()}));var o=i.addFolder({title:"Tools"});o.expanded=!0,o.addButton({title:"Delete",label:"\u5220\u9664",disabled:!1}).on("click",(function(e){var i,n=null===(i=t._renderer)||void 0===i?void 0:i.selectionModel,o=t._model;if(n&&o){var s=n.getSelection();o.remove(s)}})),o.addButton({title:"Undo",label:"\u64a4\u9500",disabled:!0}).on("click",(function(t){})),o.addButton({title:"Redo",label:"\u91cd\u505a",disabled:!0}).on("click",(function(t){})),o.addButton({title:"\u7ed8\u5236\u7ebf",label:"\u7ed8\u5236\u7ebf",disabled:!1}).on("click",(function(t){}));var s=i.addFolder({title:"\u6570\u636e\u63a5\u53e3"});s.expanded=!0,s.addButton({title:"\u5bfc\u5165\u6570\u636e",disabled:!1}).on("click",(function(t){})),s.addButton({title:"\u5bfc\u51fa\u6570\u636e",disabled:!1}).on("click",(function(t){})),s.addButton({title:"\u52a0\u8f7dMock\u6570\u636e",disabled:!1}).on("click",(function(e){fetch("/api/data",{method:"POST"}).then((function(e){e.json().then((function(e){var i;console.log("Success data:",e);var n=null===(i=t._app)||void 0===i?void 0:i.model;if(n){var o=e.data,s=[];o.nodes.forEach((function(t,e){if(!(e>1e3)){var i=new Et({id:t.id,name:t.id,x:t.x,y:t.y});s.push(i)}})),n.batchAdd(s);var a=[];o.edges.forEach((function(t,e){if(!(e>1e3)){var i=n.getById(t.source),o=n.getById(t.target);i&&o&&a.push(new Ct({from:i,to:o}))}})),n.batchAdd(a)}}))}))}))}}},{key:"_initModelPane",value:function(){var t=this,e=this._tabs;if(e){var i=e.pages[1],n=i.addFolder({title:"\u6570\u636e\u5bb9\u5668"});n.addButton({title:"Add",label:"\u6dfb\u52a0"}).on("click",(function(e){console.log("add ".concat(10," data into model"));for(var i=0;i<10;i++){var n,o=new vt({name:"Random".concat(i),x:1920*Math.random(),y:600*Math.random(),width:100*Math.random(),height:100*Math.random(),angle:0,debug:!1,clients:{easing:"linear"}});null===(n=t._model)||void 0===n||n.add(o)}})),n.addButton({title:"Batch Add",label:"\u6279\u91cf\u6dfb\u52a0"}).on("click",(function(e){for(var i,n=[],o=0;o<10;o++){var s=new vt({name:"Random".concat(o),x:1920*Math.random(),y:600*Math.random(),width:100*Math.random(),height:100*Math.random(),angle:0,debug:!1,clients:{easing:"linear"}});n.push(s)}console.log("batch add ".concat(n.length," data into model")),null===(i=t._model)||void 0===i||i.batchAdd(n)})),n.addButton({title:"Remove Select",label:"\u5220\u9664"}).on("click",(function(e){var i,n=null===(i=t._renderer)||void 0===i?void 0:i.selectionModel,o=t._model;if(n&&o){var s=n.getSelection();o.remove(s)}})),n.addButton({title:"Clear",label:"\u6e05\u7a7a"}).on("click",(function(e){var i;null===(i=t._model)||void 0===i||i.clear()})),n.addButton({title:"Clear Domain",label:"\u6e05\u7a7a\u6c14\u6ce1"}).on("click",(function(t){})),n.addButton({title:"Datas Count",label:"\u573a\u666f\u6570\u91cf"}).on("click",(function(e){var i;alert(null===(i=t._model)||void 0===i?void 0:i._datas.length)})),n.addButton({title:"Console All Datas Array"}).on("click",(function(e){var i;console.log(null===(i=t._model)||void 0===i?void 0:i.getDatas())})),n.addButton({title:"Console All Datas Map"}).on("click",(function(e){var i;console.log(null===(i=t._model)||void 0===i?void 0:i.getDatasMap())})),n.addButton({title:"Console Last Data"}).on("click",(function(e){var i,n,o=(null===(i=t._model)||void 0===i?void 0:i.getDatas().length)||0;console.log(null===(n=t._model)||void 0===n?void 0:n.get(o-1))})),n.addButton({title:"Console Select Data"}).on("click",(function(e){var i,n=null===(i=t._renderer)||void 0===i?void 0:i.selectionModel,o=t._model;if(n&&o){var s=n.getSelection();console.log(s)}})),i.addFolder({title:"\u5c5e\u6027\u5bb9\u5668"}).addButton({title:"Console Property"}).on("click",(function(t){}))}}},{key:"_initRenderPane",value:function(){var t,e=this,i=this._renderer;if(i){null===(t=i.selectionModel)||void 0===t||t.on(ee.Change,(function(t){var n=i.selectionModel,o=null===n||void 0===n?void 0:n.getLastData();e._initSelectPane(o)}));var n={background:6382180,grid:!1},o=this._tabs.pages[2],s=o.addFolder({title:"Basic"});s.addInput(n,"background",{view:"color"}).on("change",(function(t){var i=t.value;e._renderer&&(e._renderer.renderer.backgroundColor=i)})),s.addBlade({view:"list",label:"grid style",options:[{text:"dark",value:"dark"},{text:"blueprint",value:"blueprint"},{text:"engineering",value:"engineering"},{text:"quad",value:"quad"}],value:"dark"}).on("change",(function(t){console.log(t);var i=t.value;e._renderer&&e._renderer.setGridStyle(i)})),s.addInput(n,"grid",{}).on("change",(function(t){var i;console.log(t),null===(i=e._renderer)||void 0===i||i.setGridVisible(t.value)}));o.addFolder({title:"Mode"});var a=o.addFolder({title:"Interactions"});a.addButton({title:"Default"}).on("click",(function(t){i.interactionManager.setDefaultInteraction()})),a.addButton({title:"Edit"}).on("click",(function(t){i.interactionManager.setEditInteraction()})),a.addButton({title:"Default+Edit"}).on("click",(function(t){i.interactionManager.setInteractions(["default","edit"])})),a.addButton({title:"Create Node"}).on("click",(function(t){})),a.addButton({title:"Create Node (Auto)"}).on("click",(function(t){})),a.addButton({title:"Create Shape"}).on("click",(function(t){})),a.addButton({title:"Create Line"}).on("click",(function(t){})),a.addButton({title:"Create Shape Line"}).on("click",(function(t){}));var r=o.addFolder({title:"API"});r.addButton({title:"ZoomOverview"}).on("click",(function(t){})),r.addButton({title:"DownloadImage"}).on("click",(function(t){}))}}},{key:"_initSelectPane",value:function(t){var e=this,i=this._renderer;if(i){var n=i.selectionModel,o=this._tabs.pages[3];if(o.children.forEach((function(t){t.dispose()})),t){this._pane.expanded=!0,this._anime&&this._anime.pause(),this._anime=void 0;var s=o.addFolder({title:"Attribute"});s.expanded=!1,s.addInput(t,"_id",{}),s.addInput(t,"name",{}).on("change",(function(t){var e=null===n||void 0===n?void 0:n.getLastData();e&&(e.name=t.value)})),s.addInput(t,"name2",{}).on("change",(function(t){var e=null===n||void 0===n?void 0:n.getLastData();e&&(e.name2=t.value)})),s.addInput(t,"x",{}),s.addInput(t,"y",{}),s.addInput(t,"width",{}),s.addInput(t,"height",{}),s.addInput(t,"visible",{}).on("change",(function(t){var e=null===n||void 0===n?void 0:n.getLastData();e&&(e.visible=t.value)})),s.addInput(t,"movable",{}).on("change",(function(t){var e=null===n||void 0===n?void 0:n.getLastData();e&&(e.movable=t.value)})),s.addInput(t,"debug").on("change",(function(t){var e=null===n||void 0===n?void 0:n.getLastData();e&&(e.debug=t.value)}));var a=o.addFolder({title:"Style"});a.expanded=!1,a.addInput(t.styles,"interactive",{}).on("change",(function(t){var e=null===n||void 0===n?void 0:n.getLastData();e&&(e.styles.interactive=t.value)})),a.addInput(t.styles,"buttonMode",{}).on("change",(function(t){var e=null===n||void 0===n?void 0:n.getLastData();e&&(e.styles.buttonMode=t.value)})),s.addInput(t.styles,"zIndex",{min:0,max:99999,speed:1}).on("change",(function(t){var e=null===n||void 0===n?void 0:n.getLastData();e&&(e.styles.zIndex=t.value)})),a.addBlade({view:"list",label:"Cursor",options:[{text:"auto",value:"auto"},{text:"default",value:"default"},{text:"none",value:"none"},{text:"context-menu",value:"context-menu"},{text:"help",value:"help"},{text:"pointer",value:"pointer"},{text:"progress",value:"progress"},{text:"wait",value:"wait"},{text:"cell",value:"cell"},{text:"crosshair",value:"crosshair"},{text:"text",value:"text"},{text:"vertical-text",value:"vertical-text"},{text:"alias",value:"alias"},{text:"copy",value:"copy"},{text:"move",value:"move"},{text:"no-drop",value:"no-drop"},{text:"not-allowed",value:"not-allowed"},{text:"grab",value:"grab"},{text:"grabbing",value:"grabbing"},{text:"all-scroll",value:"all-scroll"},{text:"col-resize",value:"col-resize"},{text:"row-resize",value:"row-resize"},{text:"n-resize",value:"n-resize"},{text:"e-resize",value:"e-resize"},{text:"s-resize",value:"s-resize"},{text:"w-resize",value:"w-resize"},{text:"ne-resize",value:"ne-resize"},{text:"nw-resize",value:"nw-resize"},{text:"se-resize",value:"se-resize"},{text:"sw-resize",value:"sw-resize"},{text:"ew-resize",value:"ew-resize"},{text:"ns-resize",value:"ns-resize"},{text:"nesw-resize",value:"nesw-resize"},{text:"nwse-resize",value:"nwse-resize"},{text:"zoom-in",value:"zoom-in"},{text:"zoom-out",value:"zoom-out"}],value:"default"}).on("change",(function(e){t&&(t.styles.cursor=e.value)})),a.addInput(t.styles,"shapeClosed",{}).on("change",(function(t){var e=null===n||void 0===n?void 0:n.getLastData();e&&e.setStyle("shapeClosed",t.value)})),a.addInput(t.styles,"fill",{}).on("change",(function(e){t.styles.fill=e.value})),a.addBlade({view:"list",label:"fillType",options:[{text:"Default",value:P.Default},{text:"ImageVector",value:P.ImageVector},{text:"VectorImage",value:P.VectorImage}],value:P.Default}).on("change",(function(e){t.styles.fillType=e.value})),a.addInput(t.styles,"fillVector",{}),a.addInput(t.styles,"fillImage",{}),a.addInput(t.styles,"fillColor",{view:"color"}),a.addInput(t.styles,"fillAlpha",{min:0,max:1,step:.1}),a.addInput(t.styles,"strokeWidth",{min:0,max:10,step:1}),a.addInput(t.styles,"strokeColor",{view:"color"}),a.addInput(t.styles,"strokeAlpha",{min:0,max:1,step:.1}),a.addInput(t.styles,"offsetDelta",{min:-100,max:100,step:.1});var r=a.addFolder({title:"Label Gizmo"});r.expanded=!1,r.addBlade({view:"list",label:"Label Position",options:[{text:"center",value:"center"},{text:"top",value:"top"},{text:"bottom",value:"bottom"},{text:"left",value:"left"},{text:"right",value:"right"},{text:"topleft",value:"topleft"},{text:"topright",value:"topright"},{text:"bottomleft",value:"bottomleft"},{text:"bottomright",value:"bottomright"}],value:"center"}).on("change",(function(e){t&&(t.styles.labelGizmoPosition=e.value)})),r.addInput(t.styles,"labelGizmoRotation",{}),r.addInput(t.styles,"labelGizmoPositionOffsetX",{min:-200,max:200}),r.addInput(t.styles,"labelGizmoPositionOffsetY",{min:-200,max:200});var h=a.addFolder({title:"Label2 Gizmo"});h.expanded=!1,h.addBlade({view:"list",label:"Label2 Position",options:[{text:"center",value:"center"},{text:"top",value:"top"},{text:"bottom",value:"bottom"},{text:"left",value:"left"},{text:"right",value:"right"},{text:"topleft",value:"topleft"},{text:"topright",value:"topright"},{text:"bottomleft",value:"bottomleft"},{text:"bottomright",value:"bottomright"}],value:"center"}).on("change",(function(e){t&&(t.styles.label2GizmoPosition=e.value)})),h.addInput(t.styles,"label2GizmoRotation",{}),h.addInput(t.styles,"label2GizmoPositionOffsetX",{min:-200,max:200}),h.addInput(t.styles,"label2GizmoPositionOffsetY",{min:-200,max:200});var l=a.addFolder({title:"Editor Gizmo"});l.expanded=!1,l.addInput(t.styles,"editorGizmoZIndex",{min:0,max:10});var u=o.addFolder({title:"Client"});u.expanded=!1,t.clients.type,void 0!==t.clients.people&&u.addInput(t.clients,"people",{min:0,max:24,speed:1,step:1}).on("change",(function(e){t.clients.people=e.value}));var d=o.addFolder({title:"Animate"});d.expanded=!1,d.addButton({title:"Start",label:"Start"}).on("click",(function(){e._anime?e._anime.start():e._anime=Object(ke.a)({targets:t,angle:360,round:1,easing:t.getClient("easing")||"easeInOutSine",loop:!0})})),d.addButton({title:"Pause",label:"Pause"}).on("click",(function(){e._anime&&e._anime.pause()})),d.addButton({title:"Remove",label:"Remove",disabled:!1}).on("click",(function(t){var i,n=null===(i=e._renderer)||void 0===i?void 0:i.selectionModel,o=e._model;if(n&&o){var s=n.getSelection();o.remove(s)}}));var c=o.addFolder({title:"Algorithm"});c.addButton({title:"subtract",label:"subtract"}).on("click",(function(){})),c.addButton({title:"union",label:"union"}).on("click",(function(){})),c.addButton({title:"intersect",label:"intersect"}).on("click",(function(){}))}else this._tabs.pages[0].selected=!0,this._pane.expanded=!1}}}]),t}();!function(t){t[t.AccessLine=0]="AccessLine",t[t.UnAccessLine=1]="UnAccessLine",t[t.ProsceniumLine=2]="ProsceniumLine"}(ge||(ge={}));var xe=16777215,Se=1,Me=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var n;Object(r.a)(this,i),(n=e.call(this))._options=void 0,n._debug={model:!1,ui:!1,origin:!1,controlPane:!1,stats:!1},n._controlPane=void 0,n.model=new me,n.pixiRenderer=void 0,n.boundingBox=new A(0,0,0,0),n._mode="show",n.io=void 0,n.graphics=new Lt.d,n.mementoManager=new wt,n.commandManager=new xt,n._options=Object(c.a)({},t),n._debug=Object(c.a)({},null===t||void 0===t?void 0:t.debug),n.pixiRenderer=new ye({canvas:(null===t||void 0===t?void 0:t.canvas)||document.createElement("canvas")}),n.model||(n.model=new me);var o=n.model,s=n.pixiRenderer;return s.renderer.backgroundColor=16119285,s.model=o,n._debug.controlPane&&(n._controlPane=new we({title:"Control Pane",model:n.model,app:Object(v.a)(n)}),n._controlPane.visible=!!n._debug.controlPane,n._controlPane.renderer=s,n._controlPane.model=o),n.initCommandManager(),n.initMementoManager(),n.initInteractionListener(),n.initModelListener(),n}return Object(h.a)(i,[{key:"initInteractionListener",value:function(){var t=this,e=this.pixiRenderer,i=this.model;if(e&&i){var n=e.interactionManager.getCurrentInteraction();n instanceof le&&(n.on(ot.KeyUp,function(){var t=Object(d.a)(f.a.mark((function t(e){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.event.key;case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n.on(st.Scale,(function(t){t.source,t.target})),n.on(st.UnableResize,(function(t){})),n.on(st.Click,function(){var t=Object(d.a)(f.a.mark((function t(e){var i,n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.source,n=e.target,i&&n){t.next=3;break}return t.abrupt("return");case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n.on(st.Sleep,(function(e){t.emit(st.Sleep,{source:t})})),n.on(ot.KeyDown,function(){var e=Object(d.a)(f.a.mark((function e(i){var n,o,s,a,r,h,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.source,"KeyL"!==(o=i.event).code||"edit"!==t.mode){e.next=4;break}e.next=21;break;case 4:if("Delete"!==o.code){e.next=10;break}s=t.pixiRenderer.selectionModel,a=t.model,s&&a&&s.getSelection().forEach((function(t){var e=t.getChildren();e&&e.forEach((function(t){a.remove(t)})),a.remove(t)})),e.next=21;break;case 10:if(!n._ctrlDown||"KeyA"!==o.code){e.next=16;break}r=t.pixiRenderer.selectionModel,h=t.model,r&&h&&t._debug.ui&&(l=h.getDatas((function(t){return t instanceof dt})),r.setSelection(l)),e.next=21;break;case 16:if(!n._ctrlDown||"KeyS"!==o.code){e.next=21;break}return o.stopPropagation(),o.preventDefault(),e.next=21,t.save();case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}}},{key:"initModelListener",value:function(){var t=this.model;t&&t.on(te.Remove,(function(t){t.data}))}},{key:"initModel",value:function(){var t=this.model;if(t){var e=new Et({name:"v0",x:660,y:260});t.add(e);var i=new Et({name:"v1",x:1093,y:493});t.add(i);var n=new Et({name:"v2",x:693,y:593});t.add(n);var o=new Et({name:"v3",x:393,y:493});t.add(o);var s=new Et({name:"v4",x:1266,y:293});t.add(s);var a=new Et({name:"v5",x:360,y:260});t.add(a),t.add(new Ct({from:e,to:i})),t.add(new Ct({from:i,to:n})),t.add(new Ct({from:n,to:e}));new zt({styles:{fill:!0,fillColor:13487565,fillAlpha:.8,fillVector:!0,fillImage:!1,zIndex:B.BottomZIndex}})}}},{key:"initCommandManager",value:function(){this.commandManager||(this.commandManager=new xt),this.commandManager.onBeforeAdd((function(t){t.current,t.cursor,t.action,t.commands,t.scope})).onUpdate((function(t){t.current,t.cursor,t.action,t.commands,t.scope})).onSuspended((function(t){t.current,t.cursor,t.action,t.commands,t.scope})).onLimited((function(t){t.current,t.cursor,t.action,t.commands,t.scope}))}},{key:"initMementoManager",value:function(){this.mementoManager||(this.mementoManager=new wt),this.mementoManager.onUpdate((function(t){if(t)t.current,t.action,t.history,t.scope})).onBeforeSave((function(t){t.current,t.action,t.history,t.scope})).onMaxLength((function(t){t.current,t.action,t.history,t.scope}))}},{key:"clear",value:function(){var t;null===(t=this.model)||void 0===t||t.clear(),this.pixiRenderer.guide&&(this.pixiRenderer.guide.datas=[])}},{key:"exit",value:function(){this.mode="show",this._controlPane&&(this._controlPane.visible=!1),this.clear()}},{key:"mount",value:function(){this._controlPane&&(this._controlPane.visible=!!this._debug.controlPane),this.load()}},{key:"unmount",value:function(){this._controlPane&&(this._controlPane.visible=!1),this.clear()}},{key:"_createShape",value:function(t,e){var i=this.model;if(i){var n=t.map((function(t){return[t[0],t[1]]}));i.add(new gt({name:"Shape",points:n,debug:this._debug.ui,angle:e||0,mode:L.Edit,clients:{easing:"easeInOutQuart"}}))}}},{key:"_createShapeLine",value:function(t,e,i){var n=this.model;if(n){var o=t.map((function(t){return[t[0],t[1]]}));n.add(new pt({name:"ShapeLine",points:o,debug:this._debug.ui,dash:e,angle:i||0,clients:{easing:"easeInOutQuart"}}))}}},{key:"load",value:function(){var t=Object(d.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.clear(),this.emit("loading.start",{source:this}),this.initModel(),this.emit("loading.end",{source:this});case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"setRefLinesVisible",value:function(t){this.pixiRenderer.guide.visible=t}},{key:"importData",value:function(t){var e;this.model&&(null===(e=this.io)||void 0===e||e.deserialize(t))}},{key:"exportData",value:function(){var t;return null===(t=this.io)||void 0===t?void 0:t.serializer()}},{key:"mode",get:function(){return this._mode},set:function(t){var e;this._mode=t,null===(e=this.model)||void 0===e||e.forEach((function(e){e instanceof dt&&(e.mode=t===L.Show?L.Show:L.Edit,t===L.Show?(e.styles.fillColor=xe,e.styles.fillAlpha=Se):t===L.Edit&&(e.styles.fillColor=0,e.styles.fillAlpha=.1))}))}},{key:"changeMode",value:function(){var t=Object(d.a)(f.a.mark((function t(e){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.mode=e,this.model){t.next=4;break}return t.abrupt("return");case 4:e===L.Show||e===L.Edit&&(this.emit("loading.start",{source:this}),this.emit("loading.end",{source:this}));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"isDirty",value:function(){var t,e,i=null===(t=this.io)||void 0===t?void 0:t.serializer(),n=null===(e=this.mementoManager)||void 0===e?void 0:e.current();return JSON.stringify(i)!==JSON.stringify(n)}},{key:"hoverById",value:function(t){var e=this.model;if(e)if(t){var i=e.getById(t);i&&(e.getDatas().forEach((function(t){t.hovered=!1})),i.hovered=!0)}else e.getDatas().forEach((function(t){t.hovered=!1}))}},{key:"selectById",value:function(t){var e=this.model;if(e){var i=this.pixiRenderer.selectionModel,n=e.getById(t);n&&(null===i||void 0===i||i.clearSelection(),null===i||void 0===i||i.setSelection(n),n.selected=!0)}}},{key:"save",value:function(){}},{key:"dispose",value:function(){var t;console.log("application dispose"),null===(t=this._controlPane)||void 0===t||t.dispose()}},{key:"initScene",value:function(){var t;if(this.pixiRenderer){var e=this.graphics||new Lt.d;e.beginFill(14561865),e.drawRect(50,50,100,100),e.endFill(),e.lineStyle(2,16706423,1),e.beginFill(6621786),e.drawRect(200,50,100,100),e.endFill(),e.lineStyle(10,16760065,1),e.beginFill(12796552),e.drawRect(350,50,100,100),e.endFill(),e.lineStyle(2,16777215,1),e.beginFill(11161352),e.drawRect(530,50,140,100),e.endFill(),e.lineStyle(0),e.beginFill(14561865,1),e.drawCircle(100,250,50),e.endFill(),e.lineStyle(2,16706423,1),e.beginFill(6621786,1),e.drawCircle(250,250,50),e.endFill(),e.lineStyle(10,16760065,1),e.beginFill(12796552,1),e.drawCircle(400,250,50),e.endFill(),e.lineStyle(2,16777215,1),e.beginFill(11161352,1),e.drawEllipse(600,250,80,50),e.endFill(),e.beginFill(16724736),e.lineStyle(4,16767232,1),e.moveTo(50,350),e.lineTo(250,350),e.lineTo(100,400),e.lineTo(50,350),e.closePath(),e.endFill(),e.lineStyle(2,16711935,1),e.beginFill(6621786,.25),e.drawRoundedRect(50,440,100,100,16),e.endFill();e.lineStyle(0),e.beginFill(3473658,1),e.drawPolygon([600,370,700,460,780,420,730,570,590,520]),e.endFill(),null===(t=this.pixiRenderer.viewport)||void 0===t||t.addChild(e)}}},{key:"clearScene",value:function(){var t,e=this.pixiRenderer.viewport;this.pixiRenderer&&e&&(null===(t=this.graphics)||void 0===t||t.clear())}}]),i}(m.a),Ee=i(43),Ce={width:"100%",height:"100%",backgroundColor:"#CDCDCD"},ze=function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(t){var o;return Object(r.a)(this,i),(o=e.call(this,t)).app=void 0,o.canvasRef=Object(n.createRef)(),o}return Object(h.a)(i,[{key:"componentDidMount",value:function(){console.log("PixiRenderer:componentDidMount"),this.app=new Me({canvas:this.canvasRef.current,id:"application",debug:{model:!!location.search.includes("debug")&&!!location.search.includes("model"),ui:!!location.search.includes("debug")&&!!location.search.includes("ui"),origin:!!location.search.includes("debug")&&!!location.search.includes("origin"),controlPane:!0}}),window.renderer=this.app,window.application=this.app,this.app.load()}},{key:"componentWillUnmount",value:function(){console.log("PixiRenderer:componentWillUnmount"),this.app&&this.app.dispose()}},{key:"render",value:function(){return Object(Ee.jsx)("canvas",{style:Ce,ref:this.canvasRef})}}]),i}(n.Component),Oe=(i(621),function(t){Object(l.a)(i,t);var e=Object(u.a)(i);function i(){var t;Object(r.a)(this,i);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).state={isMounted:!0},t}return Object(h.a)(i,[{key:"render",value:function(){var t=this,e=this.state.isMounted,i=void 0===e||e;return Object(Ee.jsxs)("div",{children:[Object(Ee.jsx)("button",{onClick:function(){return t.setState((function(t){return{isMounted:!t.isMounted}}))},children:i?"UnMount":"Mount"}),i&&Object(Ee.jsx)(ze,{})]})}}]),i}(n.Component)),Le=Oe,Pe=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,626)).then((function(e){var i=e.getCLS,n=e.getFID,o=e.getFCP,s=e.getLCP,a=e.getTTFB;i(t),n(t),o(t),s(t),a(t)}))};a.a.render(Object(Ee.jsx)(o.a.StrictMode,{children:Object(Ee.jsx)(Le,{})}),document.getElementById("root")),Pe()}},[[622,1,2]]]);
//# sourceMappingURL=main.25385a62.chunk.js.map